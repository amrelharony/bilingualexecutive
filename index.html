<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Bilingual Executive Toolkit v0.1</title>
    
    <!-- PWA Manifest & Meta -->
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

   <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>

    <!-- GSAP Animation Engine -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/Flip.min.js"></script>

    <!-- 3D Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>

    <!-- PDF.js Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    // Initialize PDF.js Worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>

    <!-- YOUR LOCAL FILES -->
    <link rel="stylesheet" href="styles.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a', card: '#1e293b', primary: '#4ade80', risk: '#f87171', warn: '#fbbf24', hotpink: '#f472b6', textMain: '#f1f5f9', textMuted: '#94a3b8',
                        glass: 'rgba(255,255,255,0.05)', 'glass-border': 'rgba(255,255,255,0.1)',
                    },
                    fontFamily: { mono: ['"JetBrains Mono"', 'monospace'], sans: ['"Inter"', 'sans-serif'], },
                    boxShadow: {
                        'glow': '0 0 15px rgba(74, 222, 128, 0.1)',
                        'glow-vip': '0 0 20px rgba(244, 114, 182, 0.2)',
                        'glass': '0 8px 32px rgba(0, 0, 0, 0.3)',
                        'glass-lg': '0 12px 48px rgba(0, 0, 0, 0.4)',
                        'glass-glow': '0 0 30px rgba(74, 222, 128, 0.08), 0 8px 32px rgba(0, 0, 0, 0.3)',
                    },
                    animation: { 'glitch': 'glitch 1s linear infinite' }
                }
            }
        }
    </script>
    <script>
        (function(){
            var mode = localStorage.getItem('bilingual_theme') || 'auto';
            var theme = mode;
            if (mode === 'auto') {
                var h = new Date().getHours();
                theme = (h >= 6 && h < 18) ? 'light' : 'dark';
            }
            document.documentElement.setAttribute('data-theme', theme);
            window.__initialTheme = theme;
        })();
    </script>
    <style>
        /* Prevent flash of unstyled Alpine content */
        [x-cloak] { display: none !important; }
        .gsap-hidden { visibility: hidden; }

        /* App preloader — Book-Split loading animation */
        #app-preloader {
            position: fixed;
            inset: 0;
            z-index: 99999;
            background: #0f172a;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: preloader-fallback 0s ease 8s forwards;
        }
        #app-preloader.done {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        @keyframes preloader-fallback {
            to { opacity: 0; visibility: hidden; pointer-events: none; }
        }

        #book-loader {
            position: relative;
            width: 160px;
            height: 200px;
            perspective: 900px;
            opacity: 0;
        }

        .book-cover {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            transform-style: preserve-3d;
        }
        .book-cover-left {
            left: 0;
            transform-origin: right center;
        }
        .book-cover-right {
            right: 0;
            transform-origin: left center;
        }
        .book-cover-inner {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .book-cover-face {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 3px 0 0 3px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0,0,0,0.5);
        }
        .book-cover-right .book-cover-face {
            border-radius: 0 3px 3px 0;
            background: linear-gradient(225deg, #1e293b 0%, #0f172a 100%);
        }
        .book-cover-texture {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                180deg,
                transparent 0px,
                rgba(255,255,255,0.015) 1px,
                transparent 2px,
                transparent 8px
            );
        }
        .book-spine-edge {
            position: absolute;
            top: 4px;
            bottom: 4px;
            width: 3px;
            border-radius: 1px;
        }
        .book-cover-left .book-spine-edge {
            right: 0;
            background: linear-gradient(180deg, rgba(74,222,128,0.25), rgba(74,222,128,0.08));
        }
        .book-cover-right .book-spine-edge {
            left: 0;
            background: linear-gradient(180deg, rgba(74,222,128,0.25), rgba(74,222,128,0.08));
        }
        .book-cover-title {
            position: absolute;
            top: 30%;
            left: 16px;
            right: 8px;
        }
        .book-title-line {
            height: 3px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            margin-bottom: 8px;
        }
        .book-title-line.short {
            width: 60%;
        }
        .book-title-accent {
            width: 24px;
            height: 2px;
            background: #4ade80;
            border-radius: 1px;
            margin-top: 14px;
            box-shadow: 0 0 8px rgba(74,222,128,0.4);
        }

        .book-pages {
            position: absolute;
            top: 6px;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 16px);
            perspective: 800px;
        }
        .book-page {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, #e2e8f0, #f1f5f9);
            border-radius: 1px;
            transform-origin: left center;
            opacity: 0;
            box-shadow: 1px 0 3px rgba(0,0,0,0.1);
        }

        .book-glow {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 40px;
            background: radial-gradient(ellipse, rgba(74,222,128,0.15) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            filter: blur(8px);
        }

        /* ── Book Loader — Daylight theme ────────────────────────── */
        [data-theme="light"] #app-preloader {
            background: linear-gradient(160deg, #c9d6e8 0%, #d4dced 40%, #e0e7f2 100%);
        }
        [data-theme="light"] .book-cover-face {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
            border-color: rgba(0,0,0,0.1) !important;
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
        }
        [data-theme="light"] .book-cover-right .book-cover-face {
            background: linear-gradient(225deg, #f8fafc 0%, #e2e8f0 100%) !important;
        }
        [data-theme="light"] .book-cover-texture {
            background: repeating-linear-gradient(
                180deg,
                transparent 0px,
                rgba(0,0,0,0.02) 1px,
                transparent 2px,
                transparent 8px
            );
        }
        [data-theme="light"] .book-cover-left .book-spine-edge {
            background: linear-gradient(180deg, rgba(21,128,61,0.35), rgba(21,128,61,0.1));
        }
        [data-theme="light"] .book-cover-right .book-spine-edge {
            background: linear-gradient(180deg, rgba(21,128,61,0.35), rgba(21,128,61,0.1));
        }
        [data-theme="light"] .book-title-line {
            background: rgba(0,0,0,0.12);
        }
        [data-theme="light"] .book-title-accent {
            background: #15803d;
            box-shadow: 0 0 8px rgba(21,128,61,0.3);
        }
        [data-theme="light"] .book-page {
            background: linear-gradient(90deg, #f1f5f9, #ffffff);
            box-shadow: 1px 0 3px rgba(0,0,0,0.06);
        }
        [data-theme="light"] .book-glow {
            background: radial-gradient(ellipse, rgba(21,128,61,0.12) 0%, transparent 70%);
        }

        /* 1. Make Range Sliders easier to grab on mobile */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px; /* Bigger touch target */
            width: 24px;  /* Bigger touch target */
            border-radius: 50%;
            background: #f472b6; /* Hotpink to match the theme */
            cursor: pointer;
            margin-top: -8px; /* Centers thumb on the track */
            box-shadow: 0 0 10px rgba(244, 114, 182, 0.5);
            border: 2px solid #fff;
        }

        /* Firefox support */
        input[type=range]::-moz-range-thumb {
            height: 24px;
            width: 24px;
            border: none;
            border-radius: 50%;
            background: #f472b6;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(244, 114, 182, 0.5);
            border: 2px solid #fff;
        }

        /* 2. Fix Scrolling on iOS */
        .overflow-y-auto {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
        }
        .safe-area-top { padding-top: env(safe-area-inset-top, 0px); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
        #pdf-scroll-container {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            scroll-behavior: smooth;
        }
        #pdf-scroll-container .pdf-page-canvas {
            background: white;
            border-radius: 4px;
        }
    </style>

    
</head>
<body class="bg-dark text-textMain font-sans h-screen overflow-hidden flex flex-col md:flex-row selection:bg-primary selection:text-dark">
<script>document.body.style.background = window.__initialTheme === 'light' ? '#cdd9ea' : '#0f172a';</script>

    <!-- App Preloader — Book-Split loading animation -->
    <div id="app-preloader">
        <div id="book-loader">
            <!-- Left Cover -->
            <div class="book-cover book-cover-left">
                <div class="book-cover-inner">
                    <div class="book-spine-edge"></div>
                    <div class="book-cover-face">
                        <div class="book-cover-texture"></div>
                        <div class="book-cover-title">
                            <div class="book-title-line"></div>
                            <div class="book-title-line short"></div>
                            <div class="book-title-accent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pages (visible between covers) -->
            <div class="book-pages">
                <div class="book-page" style="--i:0"></div>
                <div class="book-page" style="--i:1"></div>
                <div class="book-page" style="--i:2"></div>
                <div class="book-page" style="--i:3"></div>
                <div class="book-page" style="--i:4"></div>
            </div>

            <!-- Right Cover -->
            <div class="book-cover book-cover-right">
                <div class="book-cover-inner">
                    <div class="book-spine-edge"></div>
                    <div class="book-cover-face">
                        <div class="book-cover-texture"></div>
                    </div>
                </div>
            </div>

            <!-- Glow effect under book -->
            <div class="book-glow"></div>
        </div>
    </div>

    <div x-data="toolkit" class="flex w-full h-full relative">

        <!-- FLOATING SIDEBAR — synced with bottom nav visibility -->
        <div x-data="{ open: false }"
             x-show="!showLanding" x-cloak
             class="fixed right-3 top-4 z-[60] flex flex-col items-end"
             :class="(navVisible || open) ? 'sidebar-visible' : 'sidebar-hidden'"
             @mouseleave="if (open) open = false">

            <!-- Toggle Pill -->
            <button @click="open = !open"
                    class="w-8 h-8 rounded-full flex items-center justify-center glass-panel transition-all duration-300 hover:bg-white/[0.12] active:scale-90 sidebar-toggle-pill">
                <i class="fa-solid text-[9px] transition-transform duration-300"
                   :class="open ? 'fa-xmark text-white/70 rotate-90' : 'fa-ellipsis-vertical text-slate-500'"></i>
            </button>

            <!-- Expandable Items -->
            <div class="flex flex-col items-end gap-1 mt-1.5 transition-all duration-300 overflow-hidden"
                 :style="open ? 'max-height:320px; opacity:1' : 'max-height:0; opacity:0'">

                <!-- Theme -->
                <button @click="$store.app.toggleTheme(); $store.haptics?.fire('doubleTap')"
                        class="sidebar-item group" :title="'Theme: ' + $store.app.themeLabel">
                    <span class="sidebar-label" x-text="$store.app.themeLabel"></span>
                    <div class="sidebar-icon">
                        <i class="fa-solid text-[10px]"
                           :class="$store.app.themeIcon + ($store.app.effectiveTheme === 'light' ? ' text-amber-400' : ' text-blue-300')"></i>
                    </div>
                </button>

                <!-- Haptics -->
                <button x-show="$store.haptics?.supported"
                        @click="$store.haptics.toggle()"
                        class="sidebar-item group" :title="$store.haptics.enabled ? 'Haptics On' : 'Haptics Off'">
                    <span class="sidebar-label" x-text="$store.haptics.enabled ? 'Haptics' : 'No Haptics'"></span>
                    <div class="sidebar-icon">
                        <i class="fa-solid text-[10px]"
                           :class="$store.haptics.enabled ? 'fa-hand-sparkles text-emerald-400' : 'fa-hand text-slate-500'"></i>
                    </div>
                </button>

                <!-- Rank -->
                <button @click="$store.gamification.showProfile = true; open = false; $store.haptics?.fire('press')"
                        class="sidebar-item group" :title="$store.gamification.rank.title">
                    <span class="sidebar-label" x-text="$store.gamification.xp + ' XP'"></span>
                    <div class="sidebar-icon" :class="isVipMode ? 'shadow-glow-vip' : ''" :style="'border-color:' + (isVipMode ? '#00ff4130' : $store.gamification.rank.hex + '30')">
                        <i class="fa-solid text-[10px]"
                           :class="$store.gamification.rank.icon"
                           :style="'color:' + (isVipMode ? '#00ff41' : $store.gamification.rank.hex)"></i>
                    </div>
                </button>

                <!-- Online -->
                <button x-show="$store.presence.isConnected" x-cloak
                        @click="$store.presence.togglePanel(); open = false; $store.haptics?.fire('press')"
                        class="sidebar-item group" title="Online Users">
                    <span class="sidebar-label" x-text="$store.presence.totalOnline + ' online'"></span>
                    <div class="sidebar-icon">
                        <i class="fa-solid fa-users text-[10px] text-emerald-400"></i>
                    </div>
                </button>

                <!-- Guestbook -->
                <button x-show="$store.guestbook._initialized" x-cloak
                        @click="$store.guestbook.togglePanel(); open = false; $store.haptics?.fire('press')"
                        class="sidebar-item group" title="Guestbook">
                    <span class="sidebar-label" x-text="($store.guestbook.stats.total_entries || 0) + ' entries'"></span>
                    <div class="sidebar-icon">
                        <i class="fa-solid fa-book-open text-[10px] text-amber-400"></i>
                    </div>
                </button>
            </div>
        </div>

        <!-- ── Presence Side Panel (Slide-over) ─────────────────────── -->
        <div x-show="$store.presence.showPanel" x-cloak
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click.self="$store.presence.showPanel = false"
             class="fixed inset-0 z-[200] bg-black/40 backdrop-blur-sm flex justify-end">

            <!-- Panel -->
            <div x-show="$store.presence.showPanel"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="translate-x-full"
                 x-transition:enter-end="translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="translate-x-0"
                 x-transition:leave-end="translate-x-full"
                 @click.stop
                 class="w-full max-w-md h-full flex flex-col bg-slate-900/80 backdrop-blur-2xl border-l border-white/10 shadow-2xl overflow-hidden">

                <!-- Panel Header -->
                <div class="flex-shrink-0 p-5 border-b border-white/10 bg-white/[0.03]">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-emerald-500/15 flex items-center justify-center">
                                <i class="fa-solid fa-tower-broadcast text-emerald-400"></i>
                            </div>
                            <div>
                                <h2 class="text-white font-bold text-lg leading-tight">Live Presence</h2>
                                <p class="text-slate-400 text-xs font-mono">Real-time executive network</p>
                            </div>
                        </div>
                        <button @click="$store.presence.showPanel = false; $store.haptics?.fire('dismiss')"
                                class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors">
                            <i class="fa-solid fa-xmark text-slate-400"></i>
                        </button>
                    </div>

                    <!-- Live Stats Bar -->
                    <div class="grid grid-cols-4 gap-2">
                        <div class="text-center p-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                            <div class="text-emerald-400 font-bold text-lg font-mono" x-text="$store.presence.liveStats.online_count || 0"></div>
                            <div class="text-[9px] text-emerald-400/70 uppercase tracking-wider">Online</div>
                        </div>
                        <div class="text-center p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
                            <div class="text-amber-400 font-bold text-lg font-mono" x-text="$store.presence.liveStats.idle_count || 0"></div>
                            <div class="text-[9px] text-amber-400/70 uppercase tracking-wider">Idle</div>
                        </div>
                        <div class="text-center p-2 rounded-lg bg-red-500/10 border border-red-500/20">
                            <div class="text-red-400 font-bold text-lg font-mono" x-text="$store.presence.liveStats.busy_count || 0"></div>
                            <div class="text-[9px] text-red-400/70 uppercase tracking-wider">Busy</div>
                        </div>
                        <div class="text-center p-2 rounded-lg bg-blue-500/10 border border-blue-500/20">
                            <div class="text-blue-400 font-bold text-lg font-mono" x-text="$store.presence.liveStats.daily_unique || 0"></div>
                            <div class="text-[9px] text-blue-400/70 uppercase tracking-wider">Today</div>
                        </div>
                    </div>

                    <!-- My Status Selector -->
                    <div class="mt-3 flex items-center gap-2">
                        <span class="text-[10px] text-slate-500 uppercase tracking-wider font-mono">My Status:</span>
                        <template x-for="(meta, key) in $store.presence.STATUS_META" :key="key">
                            <button x-show="key !== 'offline'"
                                    @click="$store.presence.setStatus(key)"
                                    :class="$store.presence.myStatus === key ? 'ring-2 scale-110' : 'opacity-50 hover:opacity-80'"
                                    :style="'--tw-ring-color:' + meta.color"
                                    class="w-7 h-7 rounded-full flex items-center justify-center bg-white/5 border border-white/10 transition-all duration-200"
                                    :title="meta.label">
                                <i class="fa-solid text-[10px]" :class="meta.icon" :style="'color:' + meta.color"></i>
                            </button>
                        </template>
                    </div>
                </div>

                <!-- Tab Bar -->
                <div class="flex-shrink-0 flex border-b border-white/10">
                    <button @click="$store.presence.panelTab = 'users'"
                            :class="$store.presence.panelTab === 'users' ? 'text-emerald-400 border-b-2 border-emerald-400 bg-emerald-400/5' : 'text-slate-500 hover:text-slate-300'"
                            class="flex-1 py-3 text-xs font-semibold uppercase tracking-wider transition-all">
                        <i class="fa-solid fa-users mr-1.5"></i> Users
                        <span class="ml-1 px-1.5 py-0.5 rounded-full bg-white/5 text-[9px] font-mono" x-text="$store.presence.totalOnline"></span>
                    </button>
                    <button @click="$store.presence.panelTab = 'feed'"
                            :class="$store.presence.panelTab === 'feed' ? 'text-blue-400 border-b-2 border-blue-400 bg-blue-400/5' : 'text-slate-500 hover:text-slate-300'"
                            class="flex-1 py-3 text-xs font-semibold uppercase tracking-wider transition-all">
                        <i class="fa-solid fa-bolt mr-1.5"></i> Activity
                    </button>
                    <button @click="$store.presence.panelTab = 'insights'"
                            :class="$store.presence.panelTab === 'insights' ? 'text-purple-400 border-b-2 border-purple-400 bg-purple-400/5' : 'text-slate-500 hover:text-slate-300'"
                            class="flex-1 py-3 text-xs font-semibold uppercase tracking-wider transition-all">
                        <i class="fa-solid fa-chart-pie mr-1.5"></i> Insights
                    </button>
                </div>

                <!-- Tab Content (scrollable) -->
                <div class="flex-1 overflow-y-auto">

                    <!-- ═══ USERS TAB ═══ -->
                    <div x-show="$store.presence.panelTab === 'users'" class="p-4 space-y-2">
                        <template x-if="$store.presence.onlineSorted.length === 0">
                            <div class="text-center py-12 text-slate-500">
                                <i class="fa-solid fa-satellite-dish text-3xl mb-3 opacity-40"></i>
                                <p class="text-sm">No other users online</p>
                                <p class="text-xs text-slate-600 mt-1">You're the first one here!</p>
                            </div>
                        </template>

                        <template x-for="user in $store.presence.onlineSorted" :key="user.user_id">
                            <div class="presence-user-card p-3 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] hover:bg-white/[0.08] transition-all duration-200 group">
                                <div class="flex items-center gap-3">
                                    <!-- Avatar with status dot -->
                                    <div class="relative flex-shrink-0">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all"
                                             :style="'border-color:' + (user.rank_hex || '#94a3b8') + '; background:' + (user.rank_hex || '#94a3b8') + '15'">
                                            <span class="text-sm font-bold" :style="'color:' + (user.rank_hex || '#94a3b8')"
                                                  x-text="(user.display_name || 'E')[0].toUpperCase()"></span>
                                        </div>
                                        <!-- Status indicator dot -->
                                        <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-slate-900"
                                             :class="$store.presence.STATUS_META[user.status]?.pulse ? 'animate-pulse' : ''"
                                             :style="'background-color:' + ($store.presence.STATUS_META[user.status]?.color || '#64748b')"></div>
                                    </div>

                                    <!-- User Info -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2">
                                            <span class="text-white text-sm font-semibold truncate" x-text="user.display_name || 'Executive'"></span>
                                            <span x-show="user.user_id === $store.presence.userId"
                                                  class="text-[8px] font-mono px-1.5 py-0.5 rounded-full bg-emerald-500/15 text-emerald-400 uppercase">You</span>
                                            <span x-show="user.prestige > 0"
                                                  class="text-[9px] font-mono text-yellow-400" x-text="'P' + user.prestige"></span>
                                        </div>
                                        <div class="flex items-center gap-2 mt-0.5">
                                            <span class="text-[10px] font-mono px-1.5 py-0.5 rounded-full border"
                                                  :style="'color:' + (user.rank_hex || '#94a3b8') + '; border-color:' + (user.rank_hex || '#94a3b8') + '40; background:' + (user.rank_hex || '#94a3b8') + '10'"
                                                  x-text="user.rank_title || 'Intern'"></span>
                                            <span class="text-[10px] text-slate-500 font-mono" x-text="(user.xp || 0).toLocaleString() + ' XP'"></span>
                                        </div>
                                    </div>

                                    <!-- Right side: current activity -->
                                    <div class="flex-shrink-0 text-right">
                                        <div x-show="user.current_tool" class="text-[10px] text-slate-400 font-mono truncate max-w-[80px]"
                                             x-text="$store.presence.TOOL_LABELS[user.current_tool] || user.current_tool"></div>
                                        <div class="flex items-center gap-1 justify-end mt-1">
                                            <i class="fa-solid fa-clock text-[8px] text-slate-600"></i>
                                            <span class="text-[9px] text-slate-600 font-mono"
                                                  x-text="$store.presence.formatDuration(user.focus_duration_mins)"></span>
                                        </div>
                                        <div class="flex items-center gap-1 justify-end mt-0.5" x-show="user.device_type">
                                            <i class="fa-solid text-[8px] text-slate-600"
                                               :class="user.device_type === 'mobile' ? 'fa-mobile-screen' : user.device_type === 'tablet' ? 'fa-tablet-screen-button' : 'fa-desktop'"></i>
                                            <span x-show="user.browser" class="text-[8px] text-slate-600 font-mono" x-text="user.browser"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Last Action Bar (expanded on hover) -->
                                <div x-show="user.last_action" class="mt-2 pt-2 border-t border-white/5 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fa-solid fa-bolt text-[9px] text-blue-400/60"></i>
                                    <span class="text-[10px] text-slate-500 truncate" x-text="user.last_action"></span>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- ═══ ACTIVITY FEED TAB ═══ -->
                    <div x-show="$store.presence.panelTab === 'feed'" class="p-4 space-y-1.5">
                        <template x-if="$store.presence.feedFormatted.length === 0">
                            <div class="text-center py-12 text-slate-500">
                                <i class="fa-solid fa-rss text-3xl mb-3 opacity-40"></i>
                                <p class="text-sm">No activity yet</p>
                            </div>
                        </template>

                        <template x-for="item in $store.presence.feedFormatted" :key="item.id">
                            <div class="flex items-start gap-3 p-2.5 rounded-lg hover:bg-white/[0.03] transition-colors">
                                <div class="flex-shrink-0 w-7 h-7 rounded-full flex items-center justify-center mt-0.5"
                                     :style="'background:' + item.color + '15'">
                                    <i class="fa-solid text-[10px]" :class="item.icon" :style="'color:' + item.color"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs leading-relaxed">
                                        <span class="text-white font-semibold" x-text="item.display_name || 'Executive'"></span>
                                        <span class="text-slate-400" x-text="' ' + item.message"></span>
                                    </p>
                                    <span class="text-[9px] text-slate-600 font-mono" x-text="item.ago"></span>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- ═══ INSIGHTS TAB ═══ -->
                    <div x-show="$store.presence.panelTab === 'insights'" class="p-4 space-y-4">
                        <!-- Popular Tool -->
                        <div class="p-4 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08]">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-2">Most Popular Tool Right Now</div>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-blue-500/15 flex items-center justify-center">
                                    <i class="fa-solid fa-fire-flame-curved text-blue-400"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold" x-text="$store.presence.TOOL_LABELS[$store.presence.liveStats.most_popular_tool] || 'None'"></div>
                                    <div class="text-xs text-slate-500">Being used by the most executives</div>
                                </div>
                            </div>
                        </div>

                        <!-- Average Focus Time -->
                        <div class="p-4 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08]">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-2">Avg. Focus Session</div>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-purple-500/15 flex items-center justify-center">
                                    <i class="fa-solid fa-brain text-purple-400"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold" x-text="$store.presence.formatDuration($store.presence.liveStats.avg_focus_mins || 0)"></div>
                                    <div class="text-xs text-slate-500">Average time actively engaged</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tool Distribution -->
                        <div class="p-4 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08]">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3">Tool Distribution</div>
                            <div class="space-y-2" x-data="{
                                get toolCounts() {
                                    const counts = {};
                                    $store.presence.onlineUsers.forEach(u => {
                                        if (u.current_tool && u.status !== 'offline') {
                                            const label = $store.presence.TOOL_LABELS[u.current_tool] || u.current_tool;
                                            counts[label] = (counts[label] || 0) + 1;
                                        }
                                    });
                                    return Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 6);
                                },
                                get maxCount() { return Math.max(1, ...this.toolCounts.map(t => t[1])); }
                            }">
                                <template x-for="[tool, count] in toolCounts" :key="tool">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-slate-400 w-24 truncate text-right" x-text="tool"></span>
                                        <div class="flex-1 h-2 rounded-full bg-white/5 overflow-hidden">
                                            <div class="h-full rounded-full bg-gradient-to-r from-emerald-500 to-cyan-500 transition-all duration-500"
                                                 :style="'width:' + (count / maxCount * 100) + '%'"></div>
                                        </div>
                                        <span class="text-[10px] text-slate-500 font-mono w-6 text-right" x-text="count"></span>
                                    </div>
                                </template>
                                <template x-if="toolCounts.length === 0">
                                    <div class="text-center py-4 text-slate-600 text-xs">No tool usage data yet</div>
                                </template>
                            </div>
                        </div>

                        <!-- Device Breakdown -->
                        <div class="p-4 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08]">
                            <div class="text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3">Devices Online</div>
                            <div class="flex items-center justify-around" x-data="{
                                get devices() {
                                    const d = { desktop: 0, mobile: 0, tablet: 0 };
                                    $store.presence.onlineUsers.forEach(u => {
                                        if (u.status !== 'offline') d[u.device_type || 'desktop']++;
                                    });
                                    return d;
                                }
                            }">
                                <div class="text-center">
                                    <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center mx-auto mb-1">
                                        <i class="fa-solid fa-desktop text-slate-400"></i>
                                    </div>
                                    <div class="text-white font-bold text-sm font-mono" x-text="devices.desktop"></div>
                                    <div class="text-[9px] text-slate-600 uppercase">Desktop</div>
                                </div>
                                <div class="text-center">
                                    <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center mx-auto mb-1">
                                        <i class="fa-solid fa-mobile-screen text-slate-400"></i>
                                    </div>
                                    <div class="text-white font-bold text-sm font-mono" x-text="devices.mobile"></div>
                                    <div class="text-[9px] text-slate-600 uppercase">Mobile</div>
                                </div>
                                <div class="text-center">
                                    <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center mx-auto mb-1">
                                        <i class="fa-solid fa-tablet-screen-button text-slate-400"></i>
                                    </div>
                                    <div class="text-white font-bold text-sm font-mono" x-text="devices.tablet"></div>
                                    <div class="text-[9px] text-slate-600 uppercase">Tablet</div>
                                </div>
                            </div>
                        </div>

                        <!-- Connection Status -->
                        <div class="p-3 rounded-lg bg-white/[0.02] border border-white/[0.05] flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full" :class="$store.presence.isConnected ? 'bg-emerald-400 animate-pulse' : 'bg-red-400'"></div>
                            <span class="text-[10px] text-slate-500 font-mono" x-text="$store.presence.isConnected ? 'Connected — Heartbeat every 30s' : 'Disconnected — Reconnecting...'"></span>
                        </div>
                    </div>

                </div><!-- /Tab Content -->

            </div><!-- /Panel -->
        </div><!-- /Backdrop -->

        <!-- ═══════════════════════════════════════════════════════════
             GUESTBOOK — Floating Button + Slide Panel
             ═══════════════════════════════════════════════════════════ -->

        <!-- Guestbook Side Panel -->
        <div x-show="$store.guestbook.showPanel" x-cloak
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click.self="$store.guestbook.showPanel = false"
             class="fixed inset-0 z-[200] bg-black/40 backdrop-blur-sm flex justify-end">

            <div x-show="$store.guestbook.showPanel" x-cloak
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="translate-x-full"
                 x-transition:enter-end="translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="translate-x-0"
                 x-transition:leave-end="translate-x-full"
                 @click.stop
                 class="w-full max-w-md h-full flex flex-col bg-slate-900/80 backdrop-blur-2xl border-l border-white/10 shadow-2xl overflow-hidden">

                <!-- Header -->
                <div class="flex-shrink-0 p-5 border-b border-white/10 bg-white/[0.03]">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-amber-500/15 flex items-center justify-center">
                                <i class="fa-solid fa-book-open text-amber-400"></i>
                            </div>
                            <div>
                                <h2 class="text-white font-bold text-lg leading-tight">Guestbook</h2>
                                <p class="text-slate-400 text-xs font-mono" x-text="($store.guestbook.stats.total_entries || 0) + ' entries · ' + ($store.guestbook.stats.unique_authors || 0) + ' authors'"></p>
                            </div>
                        </div>
                        <button @click="$store.guestbook.showPanel = false; $store.haptics?.fire('dismiss')"
                                class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors">
                            <i class="fa-solid fa-xmark text-slate-400"></i>
                        </button>
                    </div>

                    <!-- Sentiment Mini Stats -->
                    <div class="flex gap-3 text-[10px] font-mono">
                        <span class="flex items-center gap-1 text-green-400"><i class="fa-solid fa-face-smile"></i> <span x-text="$store.guestbook.stats.positive_count || 0"></span></span>
                        <span class="flex items-center gap-1 text-slate-400"><i class="fa-solid fa-face-meh"></i> <span x-text="$store.guestbook.stats.neutral_count || 0"></span></span>
                        <span class="flex items-center gap-1 text-red-400"><i class="fa-solid fa-face-frown"></i> <span x-text="$store.guestbook.stats.negative_count || 0"></span></span>
                        <span class="flex items-center gap-1 text-blue-400 ml-auto"><i class="fa-solid fa-calendar-day"></i> <span x-text="($store.guestbook.stats.today_entries || 0) + ' today'"></span></span>
                    </div>
                </div>

                <!-- Compose Box -->
                <div class="flex-shrink-0 p-4 border-b border-white/10 bg-white/[0.02]">
                    <!-- Replying indicator -->
                    <div x-show="$store.guestbook.replyingTo" x-cloak class="flex items-center gap-2 mb-2 text-xs text-blue-400">
                        <i class="fa-solid fa-reply"></i>
                        <span>Replying to a message</span>
                        <button @click="$store.guestbook.replyingTo = null" class="ml-auto text-slate-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
                    </div>

                    <div class="flex gap-2">
                        <textarea x-model="$store.guestbook.newMessage"
                                  @keydown.enter.meta="$store.guestbook.postEntry()"
                                  @keydown.ctrl.enter="$store.guestbook.postEntry()"
                                  maxlength="500" tabindex="0"
                                  placeholder="Leave a message..."
                                  class="gb-compose-area flex-1 bg-white/[0.05] backdrop-blur-md border border-white/10 rounded-xl px-3 py-2.5 text-sm text-white placeholder-slate-500 resize-none focus:border-amber-400/40 focus:outline-none focus:ring-1 focus:ring-amber-400/20 transition-all"
                                  rows="2"></textarea>
                        <button @click="$store.guestbook.postEntry(); $store.haptics?.fire('confirm')"
                                :disabled="!$store.guestbook.newMessage?.trim() || $store.guestbook.isRateLimited"
                                :class="$store.guestbook.newMessage?.trim() && !$store.guestbook.isRateLimited ? 'bg-amber-500 hover:bg-amber-600 text-white' : 'bg-white/5 text-slate-600 cursor-not-allowed'"
                                class="flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-all self-end">
                            <i class="fa-solid fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between mt-1.5">
                        <span class="text-[9px] text-slate-600 font-mono" x-text="($store.guestbook.newMessage?.length || 0) + '/500'"></span>
                        <span x-show="$store.guestbook.isRateLimited" x-cloak class="text-[9px] text-amber-400/70 font-mono">Wait <span x-text="$store.guestbook.rateLimitRemaining"></span>s</span>
                        <span x-show="$store.guestbook._filteredMessage" x-cloak class="text-[9px] text-red-400 font-mono">Message contains inappropriate words</span>
                    </div>
                </div>

                <!-- Filter / Sort Bar -->
                <div class="flex-shrink-0 flex items-center gap-2 px-4 py-2.5 border-b border-white/[0.05] bg-white/[0.01]">
                    <select x-model="$store.guestbook.filter" @change="$store.guestbook.refresh()"
                            class="text-[10px] bg-white/5 border border-white/10 rounded-lg px-2 py-1 text-slate-300 focus:outline-none">
                        <option value="all">All</option>
                        <option value="pinned">Pinned</option>
                        <option value="mine">Mine</option>
                    </select>
                    <select x-model="$store.guestbook.sortBy" @change="$store.guestbook.refresh()"
                            class="text-[10px] bg-white/5 border border-white/10 rounded-lg px-2 py-1 text-slate-300 focus:outline-none">
                        <option value="newest">Newest</option>
                        <option value="oldest">Oldest</option>
                    </select>
                    <div class="flex-1">
                        <input type="text" x-model="$store.guestbook.searchQuery" placeholder="Search..."
                               class="w-full text-[10px] bg-white/5 border border-white/10 rounded-lg px-2 py-1 text-slate-300 placeholder-slate-600 focus:outline-none focus:border-amber-400/30">
                    </div>
                </div>

                <!-- Entries List -->
                <div class="flex-1 overflow-y-auto p-4 space-y-3">
                    <template x-if="$store.guestbook.loading && $store.guestbook.entries.length === 0">
                        <div class="text-center py-12 text-slate-500">
                            <i class="fa-solid fa-spinner fa-spin text-2xl mb-3"></i>
                            <p class="text-sm">Loading entries...</p>
                        </div>
                    </template>

                    <template x-if="!$store.guestbook.loading && $store.guestbook.filteredEntries.length === 0">
                        <div class="text-center py-12 text-slate-500">
                            <i class="fa-solid fa-feather text-3xl mb-3 opacity-40"></i>
                            <p class="text-sm">No entries yet</p>
                            <p class="text-xs text-slate-600 mt-1">Be the first to sign the guestbook!</p>
                        </div>
                    </template>

                    <template x-for="entry in $store.guestbook.filteredEntries" :key="entry.id">
                        <div class="gb-entry-card rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] overflow-hidden transition-all duration-200 hover:bg-white/[0.06]"
                             :class="entry.is_pinned ? 'ring-1 ring-amber-400/20' : ''">

                            <!-- Pinned indicator -->
                            <div x-show="entry.is_pinned" class="px-3 py-1 bg-amber-500/10 text-[9px] text-amber-400 font-mono flex items-center gap-1">
                                <i class="fa-solid fa-thumbtack"></i> Pinned
                            </div>

                            <div class="p-3">
                                <!-- Author row -->
                                <div class="flex items-center gap-2.5 mb-2">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center border flex-shrink-0 text-xs font-bold"
                                         :style="'border-color:' + (entry.avatar_color || '#94a3b8') + '; background:' + (entry.avatar_color || '#94a3b8') + '15; color:' + (entry.avatar_color || '#94a3b8')"
                                         x-text="(entry.display_name || 'E')[0].toUpperCase()"></div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1.5">
                                            <span class="text-white text-xs font-semibold truncate" x-text="entry.display_name || 'Executive'"></span>
                                            <span class="text-[8px] font-mono px-1 py-0.5 rounded border"
                                                  :style="'color:' + (entry.avatar_color || '#94a3b8') + '; border-color:' + (entry.avatar_color || '#94a3b8') + '30; background:' + (entry.avatar_color || '#94a3b8') + '10'"
                                                  x-text="entry.rank_title || 'Intern'"></span>
                                            <i class="fa-solid text-[8px]" :class="$store.guestbook.sentimentIcon(entry.sentiment)" :style="'color:' + $store.guestbook.sentimentColor(entry.sentiment)"></i>
                                        </div>
                                        <div class="flex items-center gap-2 text-[9px] text-slate-600 font-mono">
                                            <span x-text="$store.guestbook.timeAgo(entry.created_at)"></span>
                                            <i class="fa-solid" :class="entry.device_type === 'mobile' ? 'fa-mobile-screen' : 'fa-desktop'"></i>
                                        </div>
                                    </div>
                                    <button x-show="$store.guestbook.isMyEntry(entry)"
                                            @click="$store.guestbook.deleteEntry(entry.id)"
                                            class="text-slate-600 hover:text-red-400 transition-colors text-xs p-1">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </button>
                                </div>

                                <!-- Message -->
                                <p class="text-slate-300 text-sm leading-relaxed mb-2.5" x-text="entry.message"></p>

                                <!-- Reactions Bar -->
                                <div class="flex items-center gap-1 flex-wrap mb-2">
                                    <template x-for="emoji in $store.guestbook.EMOJIS" :key="emoji">
                                        <button @click="$store.guestbook.toggleReaction(entry.id, emoji); $store.haptics?.fire('tap')"
                                                x-show="$store.guestbook.getReactionCount(entry.id, emoji) > 0 || $store.guestbook.hasMyReaction(entry.id, emoji)"
                                                :class="$store.guestbook.hasMyReaction(entry.id, emoji) ? 'bg-amber-500/15 border-amber-400/30' : 'bg-white/5 border-white/10'"
                                                class="flex items-center gap-1 px-1.5 py-0.5 rounded-full border text-[10px] transition-all hover:scale-105 active:scale-95">
                                            <span x-text="$store.guestbook.EMOJI_DISPLAY[emoji]"></span>
                                            <span class="text-slate-400 font-mono" x-text="$store.guestbook.getReactionCount(entry.id, emoji)"></span>
                                        </button>
                                    </template>

                                    <!-- Add reaction dropdown -->
                                    <div x-data="{ open: false }" class="relative">
                                        <button @click="open = !open" class="w-6 h-6 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] text-slate-500 hover:text-slate-300 hover:bg-white/10 transition-all">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                        <div x-show="open" @click.outside="open = false"
                                             x-transition
                                             class="absolute bottom-full left-0 mb-1 flex gap-1 p-1.5 rounded-lg bg-slate-800/90 backdrop-blur-xl border border-white/15 shadow-lg z-10">
                                            <template x-for="emoji in $store.guestbook.EMOJIS" :key="emoji">
                                                <button @click="$store.guestbook.toggleReaction(entry.id, emoji); $store.haptics?.fire('tap'); open = false"
                                                        class="w-7 h-7 rounded hover:bg-white/10 flex items-center justify-center transition-colors text-sm"
                                                        x-text="$store.guestbook.EMOJI_DISPLAY[emoji]"></button>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Reply button -->
                                    <button @click="$store.guestbook.replyingTo = entry.id; document.querySelector('.gb-compose-area')?.focus()"
                                            class="ml-auto flex items-center gap-1 text-[10px] text-slate-500 hover:text-blue-400 transition-colors">
                                        <i class="fa-solid fa-reply"></i>
                                        <span x-text="(entry._replies?.length || 0) > 0 ? (entry._replies.length + ' replies') : 'Reply'"></span>
                                    </button>
                                </div>

                                <!-- Replies (threaded) -->
                                <template x-if="entry._replies && entry._replies.length > 0">
                                    <div class="mt-2 pt-2 border-t border-white/5 space-y-2 pl-4 border-l-2 border-white/[0.06]">
                                        <template x-for="reply in entry._replies" :key="reply.id">
                                            <div class="flex items-start gap-2">
                                                <div class="w-6 h-6 rounded-full flex items-center justify-center border text-[9px] font-bold flex-shrink-0 mt-0.5"
                                                     :style="'border-color:' + (reply.avatar_color || '#94a3b8') + '; background:' + (reply.avatar_color || '#94a3b8') + '15; color:' + (reply.avatar_color || '#94a3b8')"
                                                     x-text="(reply.display_name || 'E')[0].toUpperCase()"></div>
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center gap-1.5">
                                                        <span class="text-white text-[11px] font-semibold truncate" x-text="reply.display_name || 'Executive'"></span>
                                                        <span class="text-[8px] text-slate-600 font-mono" x-text="$store.guestbook.timeAgo(reply.created_at)"></span>
                                                        <button x-show="$store.guestbook.isMyEntry(reply)"
                                                                @click="$store.guestbook.deleteEntry(reply.id)"
                                                                class="text-slate-600 hover:text-red-400 transition-colors text-[9px] ml-auto p-0.5">
                                                            <i class="fa-solid fa-trash-can"></i>
                                                        </button>
                                                    </div>
                                                    <p class="text-slate-400 text-[11px] leading-relaxed" x-text="reply.message"></p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <!-- Load More -->
                    <button x-show="$store.guestbook.hasMore && $store.guestbook.entries.length > 0" x-cloak
                            @click="$store.guestbook.loadMore()"
                            :disabled="$store.guestbook.loading"
                            class="w-full py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-xs text-slate-400 font-mono transition-all">
                        <span x-show="!$store.guestbook.loading">Load More</span>
                        <span x-show="$store.guestbook.loading" x-cloak><i class="fa-solid fa-spinner fa-spin mr-1"></i> Loading...</span>
                    </button>
                </div>

            </div><!-- /Panel -->
        </div><!-- /Backdrop -->

        <!-- RANK-UP CELEBRATION OVERLAY -->
        <div x-data="{ showRankUp: false, rankData: null, init() {
                let lastRank = $store.gamification.rank.level;
                setInterval(() => {
                    const current = $store.gamification.rank.level;
                    if (current > lastRank) {
                        this.rankData = $store.gamification.rank;
                        this.showRankUp = true;
                        lastRank = current;
                        setTimeout(() => { this.showRankUp = false; }, 3000);
                    }
                    lastRank = current;
                }, 500);
             }}"
             x-show="showRankUp" x-cloak
             x-transition:enter="transition ease-out duration-500"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-500"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-[95] flex items-center justify-center pointer-events-none">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
            <div class="rankup-flash relative text-center z-10">
                <div class="w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-4 border-2 shadow-glass-lg"
                     :style="rankData ? 'border-color:' + rankData.hex + '; box-shadow: 0 0 40px ' + rankData.hex + '40' : ''">
                    <i class="fa-solid text-4xl" 
                       :class="rankData?.icon || 'fa-trophy'"
                       :style="rankData ? 'color:' + rankData.hex : ''"></i>
                </div>
                <div class="text-xs font-bold uppercase tracking-[0.3em] text-slate-400 mb-1">PROMOTED TO</div>
                <div class="text-3xl font-bold text-white" x-text="rankData?.title || ''"></div>
            </div>
        </div>

        <!-- TOAST NOTIFICATIONS -->
        <div x-data="{
                toasts: [],
                _xpBatch: 0,
                _xpTimer: null,
                init() {
                    setInterval(() => {
                        const t = $store.gamification.popToast();
                        if (!t) return;
                        if (t.type === 'xp') {
                            this._xpBatch += t.amount;
                            if (this._xpTimer) clearTimeout(this._xpTimer);
                            this._xpTimer = setTimeout(() => {
                                this._push({ ...t, amount: this._xpBatch });
                                this._xpBatch = 0;
                                this._xpTimer = null;
                            }, 800);
                        } else {
                            this._push(t);
                        }
                    }, 300);
                },
                _push(t) {
                    if (this.toasts.length >= 3) this.toasts.splice(0, this.toasts.length - 2);
                    this.toasts.push(t);
                    const dur = t.type === 'xp' || t.type === 'quest' ? 2200 : 3000;
                    setTimeout(() => { this.toasts = this.toasts.filter(x => x.id !== t.id); }, dur);
                },
                label(t) {
                    if (t.type === 'xp') return '+' + t.amount + ' XP';
                    if (t.type === 'rankup') return 'Rank: ' + t.rank.title;
                    if (t.type === 'achievement') return t.achievement.name;
                    if (t.type === 'quest') return t.quest.text;
                    if (t.type === 'weekly') return 'Weekly complete +150 XP';
                    if (t.type === 'prestige') return 'Prestige ' + t.level;
                    return '';
                },
                accent(t) {
                    if (t.type === 'xp') return 'bg-primary/80';
                    if (t.type === 'rankup') return 'bg-cyan-400/80';
                    if (t.type === 'achievement') return ({bronze:'bg-amber-500/80',silver:'bg-slate-400/80',gold:'bg-yellow-400/80',platinum:'bg-violet-400/80'}[t.achievement?.tier] || 'bg-white/60');
                    if (t.type === 'quest') return 'bg-primary/80';
                    if (t.type === 'weekly') return 'bg-amber-400/80';
                    if (t.type === 'prestige') return 'bg-yellow-300/80';
                    return 'bg-white/60';
                }
             }"
             class="toast-stack">
            <template x-for="toast in toasts" :key="toast.id">
                <div class="toast-pill">
                    <span class="toast-dot" :class="accent(toast)"></span>
                    <span class="text-[11px] text-white/80 font-medium" x-text="label(toast)"></span>
                </div>
            </template>
        </div>

        <!-- GAMIFICATION PROFILE MODAL -->
        <div x-show="$store.gamification.showProfile" x-cloak
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-[90] flex items-start justify-center overflow-y-auto"
             @keydown.escape.window="$store.gamification.showProfile = false">
            
            <!-- Backdrop -->
            <div class="fixed inset-0 bg-black/60 backdrop-blur-md" @click="$store.gamification.showProfile = false; $store.haptics?.fire('dismiss')"></div>
            
            <!-- Profile Content -->
            <div x-data="gamificationProfile" 
                 x-init="$watch('$store.gamification.showProfile', v => { if(v) renderSkillChart() })"
                 class="relative z-10 w-full max-w-3xl mx-2 md:mx-4 my-4 md:my-8 mb-20 md:mb-24 bg-white/[0.04] backdrop-blur-2xl border border-white/[0.12] rounded-2xl shadow-glass-lg overflow-hidden">
                
                <!-- Profile Header -->
                <div class="relative p-4 md:p-6 pb-3 md:pb-4 bg-gradient-to-br from-white/[0.06] to-transparent border-b border-white/[0.08]">
                    <button @click="$store.gamification.showProfile = false; $store.haptics?.fire('dismiss')" 
                            class="absolute top-3 right-3 md:top-4 md:right-4 w-7 h-7 md:w-8 md:h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors z-10">
                        <i class="fa-solid fa-xmark text-slate-400 text-xs md:text-sm"></i>
                    </button>
                    
                    <div class="flex items-center gap-3 md:gap-5">
                        <!-- Large Rank Badge -->
                        <div class="relative flex-shrink-0">
                            <svg class="w-16 h-16 md:w-20 md:h-20 -rotate-90" viewBox="0 0 80 80">
                                <circle cx="40" cy="40" r="34" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="4"/>
                                <circle cx="40" cy="40" r="34" fill="none"
                                        :stroke="g.rank.hex" stroke-width="4" stroke-linecap="round"
                                        :stroke-dasharray="213.6"
                                        :stroke-dashoffset="213.6 - (213.6 * g.rankProgress / 100)"
                                        class="transition-all duration-700"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-11 h-11 md:w-14 md:h-14 rounded-full flex items-center justify-center bg-white/[0.06] border-2 shadow-glass"
                                     :style="'border-color:' + g.rank.hex + '60'">
                                    <i class="fa-solid text-base md:text-xl" :class="g.rank.icon" :style="'color:' + g.rank.hex"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Title & XP -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1">
                                <h2 class="text-xl md:text-2xl font-bold text-white" x-text="g.rank.title"></h2>
                                <template x-for="i in g.prestige" :key="i">
                                    <i class="fa-solid fa-star text-yellow-400 text-xs"></i>
                                </template>
                            </div>
                            <div class="flex items-center gap-2 md:gap-3 text-xs md:text-sm flex-wrap">
                                <span class="font-mono" :style="'color:' + g.rank.hex" x-text="g.xp.toLocaleString() + ' XP'"></span>
                                <template x-if="g.nextRank">
                                    <span class="text-slate-500 text-[10px] md:text-sm">
                                        <span x-text="g.xpToNext.toLocaleString()"></span> to <span x-text="g.nextRank.title"></span>
                                    </span>
                                </template>
                            </div>
                            <!-- XP Bar -->
                            <div class="mt-1.5 md:mt-2 h-1 md:h-1.5 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full rounded-full transition-all duration-700"
                                     :style="'width:' + g.rankProgress + '%; background:' + g.rank.hex"></div>
                            </div>
                            <!-- Display Name -->
                            <div class="mt-1.5 md:mt-2 flex items-center gap-1.5 md:gap-2">
                                <input type="text" :value="g.displayName" 
                                       @change="g.setDisplayName($event.target.value)"
                                       class="bg-transparent border-b border-white/10 text-xs md:text-sm text-slate-300 focus:border-white/30 outline-none px-0 py-0.5 w-28 md:w-40 font-mono"
                                       placeholder="Your name..." maxlength="20">
                                <span class="text-[9px] md:text-[10px] text-slate-600 font-mono">CALLSIGN</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="flex border-b border-white/[0.06] overflow-x-auto scrollbar-none">
                    <template x-for="tab in ['overview','achievements','quests','leaderboard']" :key="tab">
                        <button @click="activeTab = tab; $store.haptics?.fire('nav'); if(tab==='leaderboard') g.fetchLeaderboard(); if(tab==='overview') renderSkillChart()"
                                class="px-3 md:px-5 py-2.5 md:py-3 text-[10px] md:text-xs font-bold uppercase tracking-widest whitespace-nowrap transition-colors border-b-2"
                                :class="activeTab === tab ? 'text-white border-white/30' : 'text-slate-500 border-transparent hover:text-slate-300'">
                            <span x-text="tab"></span>
                        </button>
                    </template>
                </div>

                <!-- TAB: Overview -->
                <div x-show="activeTab === 'overview'" class="p-4 md:p-6 space-y-4 md:space-y-6">
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-3 md:grid-cols-6 gap-2 md:gap-3">
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold text-white font-mono" x-text="g.xp.toLocaleString()"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Total XP</div>
                        </div>
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold font-mono" :class="g.streak > 0 ? 'text-orange-400' : 'text-slate-500'" x-text="g.streak"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Streak</div>
                        </div>
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold text-cyan-400 font-mono" x-text="g.uniqueToolsUsed"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Tools</div>
                        </div>
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold text-primary font-mono" x-text="g.chaptersCompleted.length"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Chapters</div>
                        </div>
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold text-purple-400 font-mono" x-text="g.promptsGenerated"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Prompts</div>
                        </div>
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-2 md:p-3 text-center border border-white/[0.06]">
                            <div class="text-sm md:text-lg font-bold text-hotpink font-mono" x-text="g.gamesWon"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-500 uppercase tracking-widest mt-0.5 md:mt-1">Wins</div>
                        </div>
                    </div>

                    <!-- Multiplier Bar -->
                    <div x-show="g.totalMultiplier > 1" class="bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-lg md:rounded-xl p-2.5 md:p-3 flex items-center gap-2 md:gap-3">
                        <i class="fa-solid fa-bolt text-amber-400 text-sm md:text-base"></i>
                        <div class="flex-1 min-w-0">
                            <div class="text-[10px] md:text-xs font-bold text-amber-300">MULTIPLIER ACTIVE</div>
                            <div class="text-[9px] md:text-[10px] text-amber-400/60 font-mono truncate">
                                <span x-text="g.totalMultiplier + 'x'"></span>
                                <span x-show="g.streakMultiplier > 1" x-text="' (Streak ' + g.streakMultiplier.toFixed(2) + 'x)'"></span>
                                <span x-show="g.comboMultiplier > 1" x-text="' (Combo ' + g.comboMultiplier + 'x)'"></span>
                                <span x-show="g.isPowerHour"> (Power Hour 2x)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Skill Tree Radar Chart -->
                    <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-3 md:p-4 border border-white/[0.06]">
                        <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-slate-400 mb-2 md:mb-3">Competency Radar</h3>
                        <div class="flex justify-center">
                            <div class="w-48 h-48 md:w-72 md:h-72">
                                <canvas id="skillRadarChart"></canvas>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-1 md:gap-2 mt-2 md:mt-3">
                            <div class="text-center">
                                <div class="text-[10px] md:text-xs font-bold text-primary" x-text="g.skillTree.strategic + '%'"></div>
                                <div class="text-[8px] md:text-[9px] text-slate-500">Strategic</div>
                            </div>
                            <div class="text-center">
                                <div class="text-[10px] md:text-xs font-bold text-cyan-400" x-text="g.skillTree.technical + '%'"></div>
                                <div class="text-[8px] md:text-[9px] text-slate-500">Technical</div>
                            </div>
                            <div class="text-center">
                                <div class="text-[10px] md:text-xs font-bold text-amber-400" x-text="g.skillTree.battle + '%'"></div>
                                <div class="text-[8px] md:text-[9px] text-slate-500">Battle</div>
                            </div>
                            <div class="text-center">
                                <div class="text-[10px] md:text-xs font-bold text-purple-400" x-text="g.skillTree.knowledge + '%'"></div>
                                <div class="text-[8px] md:text-[9px] text-slate-500">Knowledge</div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Heatmap -->
                    <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-3 md:p-4 border border-white/[0.06] overflow-x-auto">
                        <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-slate-400 mb-2 md:mb-3">Activity (90 Days)</h3>
                        <div class="flex flex-wrap gap-[2px] md:gap-[3px]">
                            <template x-for="day in g.heatmapData" :key="day.date">
                                <div class="w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-sm transition-colors"
                                     :class="g.heatmapColor(day.count)"
                                     :title="day.label + ': ' + day.count + ' actions'"></div>
                            </template>
                        </div>
                        <div class="flex items-center gap-1.5 md:gap-2 mt-1.5 md:mt-2 text-[8px] md:text-[9px] text-slate-500">
                            <span>Less</span>
                            <div class="w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-sm bg-white/5"></div>
                            <div class="w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-sm bg-green-900/50"></div>
                            <div class="w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-sm bg-green-600/60"></div>
                            <div class="w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-sm bg-green-400/80"></div>
                            <span>More</span>
                        </div>
                    </div>

                    <!-- Prestige Button -->
                    <div x-show="g.canPrestige()" class="bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border border-yellow-500/20 rounded-lg md:rounded-xl p-3 md:p-4 text-center">
                        <h3 class="text-xs md:text-sm font-bold text-yellow-300 mb-0.5 md:mb-1">PRESTIGE AVAILABLE</h3>
                        <p class="text-[10px] md:text-xs text-yellow-400/60 mb-2 md:mb-3">Reset rank to Intern. Keep achievements. Earn a prestige star.</p>
                        <button @click="$store.haptics?.fire('warning'); if(confirm('Prestige will reset your rank and XP. Achievements and stats are kept. Continue?')) g.doPrestige()"
                                class="px-4 md:px-6 py-1.5 md:py-2 bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-500/30 rounded-full text-yellow-300 text-[10px] md:text-xs font-bold uppercase tracking-widest transition-colors">
                            Prestige <span x-text="'→ Level ' + (g.prestige + 1)"></span>
                        </button>
                    </div>
                </div>

                <!-- TAB: Achievements -->
                <div x-show="activeTab === 'achievements'" class="p-3 md:p-6 space-y-4 md:space-y-5">
                    <div class="flex items-center justify-between mb-1 md:mb-2">
                        <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-slate-400">
                            Unlocked: <span class="text-white" x-text="g.achievementCount + ' / ' + g.ACHIEVEMENTS.length"></span>
                        </h3>
                    </div>
                    <template x-for="(achievements, category) in g.achievementsByCategory" :key="category">
                        <div class="space-y-2">
                            <h4 class="text-[9px] md:text-[10px] font-bold uppercase tracking-[0.2em] text-slate-500" x-text="category"></h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-1.5 md:gap-2">
                                <template x-for="a in achievements" :key="a.id">
                                    <div class="p-2 md:p-3 rounded-lg md:rounded-xl border transition-all duration-300"
                                         :class="a.unlocked 
                                            ? 'bg-white/[0.05] border-white/[0.15] shadow-glass' 
                                            : 'bg-white/[0.02] border-white/[0.05] opacity-40'">
                                        <div class="flex items-center gap-1.5 md:gap-2 mb-0.5 md:mb-1">
                                            <div class="w-6 h-6 md:w-7 md:h-7 rounded-lg flex items-center justify-center text-[10px] md:text-xs"
                                                 :class="{
                                                    'bg-amber-900/30 text-amber-500': a.tier === 'bronze',
                                                    'bg-slate-400/20 text-slate-300': a.tier === 'silver',
                                                    'bg-yellow-500/20 text-yellow-400': a.tier === 'gold',
                                                    'bg-purple-500/20 text-purple-400': a.tier === 'platinum'
                                                 }">
                                                <i class="fa-solid" :class="a.icon"></i>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <div class="text-[10px] md:text-xs font-bold text-white truncate" x-text="a.name"></div>
                                                <div class="text-[8px] md:text-[9px] text-slate-500 truncate" x-text="a.desc"></div>
                                            </div>
                                        </div>
                                        <div class="text-[7px] md:text-[8px] font-mono uppercase tracking-widest mt-0.5 md:mt-1"
                                             :class="{
                                                'text-amber-600': a.tier === 'bronze',
                                                'text-slate-500': a.tier === 'silver',
                                                'text-yellow-600': a.tier === 'gold',
                                                'text-purple-500': a.tier === 'platinum'
                                             }" x-text="a.tier"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- TAB: Quests -->
                <div x-show="activeTab === 'quests'" class="p-3 md:p-6 space-y-3 md:space-y-4">
                    <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-slate-400 mb-1.5 md:mb-2">Daily Quests</h3>
                    <template x-for="quest in g.dailyQuestsProgress" :key="quest.id">
                        <div class="bg-white/[0.03] rounded-lg md:rounded-xl p-3 md:p-4 border border-white/[0.06]">
                            <div class="flex items-center justify-between mb-1.5 md:mb-2 gap-2">
                                <span class="text-xs md:text-sm text-white" x-text="quest.text"></span>
                                <span class="text-[10px] md:text-xs font-mono flex-shrink-0" 
                                      :class="quest.completed ? 'text-primary' : 'text-slate-500'"
                                      x-text="quest.completed ? '✓ DONE' : quest.current + '/' + quest.target"></span>
                            </div>
                            <div class="h-1 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full rounded-full transition-all duration-500"
                                     :class="quest.completed ? 'bg-primary' : 'bg-white/20'"
                                     :style="'width:' + quest.progress + '%'"></div>
                            </div>
                            <div class="text-[8px] md:text-[9px] text-primary/60 font-mono mt-0.5 md:mt-1">+35 XP</div>
                        </div>
                    </template>

                    <template x-if="g.weeklyQuestProgress">
                        <div class="mt-3 md:mt-4">
                            <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-amber-400 mb-1.5 md:mb-2">Weekly Challenge</h3>
                            <div class="bg-gradient-to-br from-amber-500/5 to-orange-500/5 rounded-lg md:rounded-xl p-3 md:p-4 border border-amber-500/15">
                                <div class="flex items-center justify-between mb-1.5 md:mb-2 gap-2">
                                    <span class="text-xs md:text-sm text-white" x-text="g.weeklyQuestProgress.text"></span>
                                    <span class="text-[10px] md:text-xs font-mono flex-shrink-0"
                                          :class="g.weeklyQuestProgress.completed ? 'text-amber-400' : 'text-slate-500'"
                                          x-text="g.weeklyQuestProgress.completed ? '✓ DONE' : g.weeklyQuestProgress.current + '/' + g.weeklyQuestProgress.target"></span>
                                </div>
                                <div class="h-1 md:h-1.5 bg-white/5 rounded-full overflow-hidden">
                                    <div class="h-full rounded-full bg-amber-400 transition-all duration-500"
                                         :style="'width:' + g.weeklyQuestProgress.progress + '%'"></div>
                                </div>
                                <div class="text-[8px] md:text-[9px] text-amber-400/60 font-mono mt-0.5 md:mt-1">+150 XP</div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- TAB: Leaderboard -->
                <div x-show="activeTab === 'leaderboard'" class="p-3 md:p-6">
                    <div x-show="g.leaderboardLoading" class="text-center py-8 md:py-12">
                        <i class="fa-solid fa-spinner fa-spin text-slate-500 text-xl md:text-2xl"></i>
                        <p class="text-[10px] md:text-xs text-slate-500 mt-1.5 md:mt-2">Loading leaderboard...</p>
                    </div>
                    <div x-show="!g.leaderboardLoading && g.leaderboard.length === 0" class="text-center py-8 md:py-12">
                        <i class="fa-solid fa-trophy text-slate-600 text-2xl md:text-3xl mb-2 md:mb-3"></i>
                        <p class="text-xs md:text-sm text-slate-500">No entries yet. Be the first!</p>
                    </div>
                    <div x-show="!g.leaderboardLoading && g.leaderboard.length > 0" class="space-y-1.5 md:space-y-2">
                        <template x-for="(entry, idx) in g.leaderboard" :key="idx">
                            <div class="flex items-center gap-2 md:gap-3 p-2 md:p-3 rounded-lg md:rounded-xl border border-white/[0.06] bg-white/[0.02]"
                                 :class="idx < 3 ? 'bg-white/[0.05]' : ''">
                                <div class="w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center text-[10px] md:text-xs font-bold"
                                     :class="{
                                        'bg-yellow-500/20 text-yellow-400': idx === 0,
                                        'bg-slate-400/20 text-slate-300': idx === 1,
                                        'bg-amber-700/20 text-amber-600': idx === 2,
                                        'bg-white/5 text-slate-500': idx > 2
                                     }" x-text="idx + 1"></div>
                                <div class="flex-1 min-w-0">
                                    <div class="text-xs md:text-sm font-bold text-white truncate" x-text="entry.display_name"></div>
                                    <div class="text-[9px] md:text-[10px] text-slate-500 font-mono">
                                        Rank <span x-text="entry.rank"></span>
                                        <template x-if="entry.prestige > 0">
                                            <span class="text-yellow-400" x-text="' ★' + entry.prestige"></span>
                                        </template>
                                    </div>
                                </div>
                                <div class="text-xs md:text-sm font-bold font-mono text-primary" x-text="entry.xp.toLocaleString() + ' XP'"></div>
                            </div>
                        </template>
                    </div>
                </div>

            </div>
        </div>

        <!-- VIP TERMINAL GATE + BOOT SEQUENCE -->
        <div x-show="vipTerminal.active" x-cloak x-transition.opacity.duration.300ms
             class="fixed inset-0 z-[100] vip-terminal flex flex-col items-center justify-center overflow-hidden"
             @keydown.escape.window="vipTerminal.phase === 'prompt' && (vipTerminal.active = false, vipTerminal._submitting = false)"
             @click="if(vipTerminal.phase === 'boot') skipBoot()">

            <div class="matrix-rain" x-show="vipTerminal.phase === 'rain' || vipTerminal.phase === 'boot'" x-cloak x-ref="matrixRain"></div>

            <div class="relative z-10 w-full max-w-2xl px-6">

                <!-- PHASE: Terminal Prompt -->
                <div x-show="vipTerminal.phase === 'prompt'" x-cloak class="space-y-4" @click.stop>
                    <div class="text-xs text-[#00ff41]/40 mb-6 tracking-widest">MERIDIAN SECURE TERMINAL v4.2.1</div>
                    <div class="text-sm leading-relaxed space-y-1">
                        <p class="text-[#00ff41]/60">Last login: <span x-text="new Date().toUTCString()"></span></p>
                        <p class="text-[#00ff41]/60">WARNING: Unauthorized access is prohibited.</p>
                    </div>
                    <div class="mt-8 flex items-center text-sm">
                        <span class="text-[#00ff41]/80 mr-2 whitespace-nowrap">root@meridian:~$</span>
                        <input type="text" x-ref="vipInput" class="term-input flex-1"
                               x-model="vipTerminal.code"
                               @keydown.enter="submitVipCode()"
                               placeholder="enter access code"
                               autocomplete="off" spellcheck="false">
                        <span class="term-cursor"></span>
                    </div>
                    <div x-show="vipTerminal.result === 'denied'" class="mt-4 text-red-500 text-sm font-bold term-shake">
                        ACCESS DENIED — INTRUSION LOGGED
                    </div>
                    <div x-show="vipTerminal.result === 'granted'" class="mt-4 text-[#00ff41] text-lg font-bold glitch-text vip-glow">
                        ACCESS GRANTED
                    </div>
                    <p class="text-[10px] text-[#00ff41]/20 mt-8">Press ESC to abort</p>
                </div>

                <!-- PHASE: Boot Sequence -->
                <div x-show="vipTerminal.phase === 'boot'" x-cloak class="space-y-2">
                    <template x-for="(line, i) in vipTerminal.bootLines" :key="i">
                        <p class="text-sm" :class="line.startsWith('>') ? 'text-[#00ff41]' : (line.startsWith('[') ? 'text-[#00ff41]/60' : 'text-[#00ff41]/80')" x-text="line"></p>
                    </template>
                    <span x-show="vipTerminal.bootLines.length < 8" class="term-cursor"></span>
                    <p class="text-[10px] text-[#00ff41]/20 mt-4">tap anywhere to skip</p>
                </div>

                <!-- PHASE: ASCII Reveal -->
                <div x-show="vipTerminal.phase === 'ascii'" x-cloak class="text-center" @click.stop>
                    <pre class="text-[#00ff41] text-[10px] sm:text-xs leading-tight vip-glow mx-auto inline-block text-left">
    _   ___  ___ _  _ ___ _____ ___ ___ _____
   /_\ | _ \/ __| || |_ _|_   _| __/ __|_   _|
  / _ \|   / (__| __ || |  | | | _| (__  | |
 /_/ \_\_|_\\___|_||_|___| |_| |___\___| |_|
          __  __  ___  ___  ___
         |  \/  |/ _ \|   \| __|
         | |\/| | (_) | |) | _|
         |_|  |_|\___/|___/|___| </pre>
                    <p class="text-[#00ff41] text-sm mt-4 vip-glow tracking-[0.3em] uppercase">Welcome, Architect.</p>
                </div>

                <!-- PHASE: Welcome Back Flash -->
                <div x-show="vipTerminal.phase === 'welcome'" x-cloak class="text-center" @click.stop>
                    <p class="text-[#00ff41] text-2xl font-bold vip-glow tracking-widest">WELCOME BACK, ARCHITECT.</p>
                    <p class="text-[#00ff41]/40 text-xs mt-2 tracking-widest">SESSION RESTORED</p>
                </div>

            </div>
        </div>

        <!-- PWA INSTALL PROMPT -->
        <div x-show="showPwaPrompt && isMobile" x-cloak x-transition 
             class="md:hidden fixed top-0 left-0 w-full bg-slate-900/80 backdrop-blur-xl text-white p-4 pt-safe z-[100] border-b border-primary/20 flex justify-between items-center shadow-glass">
            <button @click="installPwa(); $store.haptics?.fire('confirm')" class="flex items-center gap-4 text-left flex-1">
                <div class="bg-primary/20 w-10 h-10 rounded-full flex items-center justify-center text-primary shrink-0 animate-pulse">
                    <i class="fa-solid fa-download"></i>
                </div>
                <div>
                    <p class="font-bold text-sm">Install Application</p>
                    <p class="text-xs text-slate-400">Tap here to add to Home Screen</p>
                </div>
            </button>
            <button @click.stop="dismissPwa(); $store.haptics?.fire('dismiss')" class="text-slate-500 hover:text-white px-4 py-2">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>

<!-- Gap Analysis Banner -->
        <template x-if="challengerData">
            <div x-cloak class="absolute top-0 left-0 w-full bg-hotpink/10 border-b border-hotpink z-40 p-2 text-center backdrop-blur-md pt-safe">
                <p class="font-mono text-hotpink text-xs md:text-sm font-bold truncate px-2"><i class="fa-solid fa-people-arrows mr-2"></i>GAP MODE: Comparing against <span x-text="challengerData?.title || 'Colleague'"></span></p>
            </div>
        </template>


<!-- MAIN VIEW SWITCHER -->
        <div class="hidden" x-show="false"> 
    </div>
        
        <!-- LANDING PAGE / COVER SIMULATOR -->
<script>if(localStorage.getItem('app_entered'))document.write('<style>#landing-page{display:none}</style>')</script>
<div x-show="showLanding" id="landing-page"
     class="fixed inset-0 z-[999] bg-black overflow-y-auto will-change-transform">

    <!-- Background Texture -->
    <div class="fixed inset-0 opacity-20 pointer-events-none landing-texture" 
         style="background-image: url('https://www.transparenttextures.com/patterns/stardust.png');">
    </div>

    <!-- Main Container -->
    <div class="min-h-screen w-full flex flex-col items-center justify-center p-6 text-center relative z-10">
        
        <div class="max-w-xl w-full flex flex-col items-center py-10 md:py-0">
            
            <p class="text-[10px] md:text-xs font-mono text-slate-400 tracking-[0.3em] uppercase mb-4 gsap-hidden">
                System Initializing...
            </p>

            <h1 class="text-5xl md:text-7xl font-sans font-extrabold tracking-tighter leading-none text-white mb-2 gsap-hidden">
                THE<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-500 landing-title-gradient">BILINGUAL</span><br>
                EXECUTIVE
            </h1>

            <div class="h-1 w-16 md:w-24 bg-red-600 my-4 md:my-6 gsap-hidden landing-divider"></div>
            
            <p class="font-mono text-xs md:text-sm text-slate-300 max-w-md mx-auto leading-relaxed mb-6 md:mb-8 gsap-hidden">
                HOW TO BUILD THE <span class="text-white font-bold">AGILE BANK</span><br> 
                AND SURVIVE THE FINTECH TSUNAMI
            </p>

        <!-- Video Player Container -->
<div id="youtube-player-container" class="w-full h-[50vh] md:h-[60vh] max-h-[600px] landing-glass bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden shadow-[0_0_50px_rgba(255,255,255,0.08)] mb-8 relative group gsap-hidden"
     tabindex="0" @keydown.prevent.space="player ? toggleVideoPlay() : _initLandingPlayer()" @keydown.prevent.left="seekVideo(Math.max(0, videoCurrentTime - 5))" @keydown.prevent.right="seekVideo(Math.min(videoDuration, videoCurrentTime + 5))" @keydown.prevent.up="setPlayerVolume(Math.min(100, videoVolume + 10))" @keydown.prevent.down="setPlayerVolume(Math.max(0, videoVolume - 10))" @keydown.m="toggleVideoMute()" @keydown.f="toggleFullscreen()">
    
    <!-- YouTube Player (lazy-loaded on first play) -->
    <div id="youtube-player" class="w-full h-full"></div>

    <!-- Thumbnail placeholder (shown until player loads) -->
    <div x-show="!_landingPlayerReady" class="absolute inset-0 z-[25] cursor-pointer" @click="_initLandingPlayer()">
        <img src="https://img.youtube.com/vi/8GvrODrkQ7M/maxresdefault.jpg" 
             alt="Video thumbnail" class="w-full h-full object-cover" loading="lazy">
        <div class="absolute inset-0 flex items-center justify-center bg-black/30 landing-play-overlay">
            <div class="w-20 h-20 rounded-full bg-white/25 backdrop-blur-md border-2 border-white/40 flex items-center justify-center hover:bg-white/35 hover:scale-110 transition-all shadow-[0_0_40px_rgba(255,255,255,0.2)] active:scale-95 landing-play-btn">
                <i class="fa-solid fa-play text-white text-2xl ml-1"></i>
            </div>
        </div>
    </div>

    <!-- Video Overlay for Click-to-Play (covers entire video area) -->
    <div class="absolute inset-0 video-overlay z-20" 
         x-show="_landingPlayerReady"
         @click="toggleVideoPlay()"
         :title="videoPlaying ? 'Pause video' : 'Play video'">
    </div>

    <!-- Custom Controls Bar (NOW AT BOTTOM) -->
    <div class="absolute bottom-0 left-0 right-0 z-30 video-controls-bar p-4 opacity-90 group-hover:opacity-100 transition-opacity duration-300">
        <div class="flex items-center gap-3 md:gap-4">
            
            <!-- Play/Pause Button -->
            <button @click="player ? toggleVideoPlay() : _initLandingPlayer()" 
                    class="video-control-btn w-10 h-10 rounded-full flex items-center justify-center text-white">
                <i class="fa-solid text-sm" :class="videoPlaying ? 'fa-pause' : 'fa-play'"></i>
            </button>
            
            <!-- Time Display -->
            <div class="video-time-display flex items-center gap-1 text-xs text-white font-mono">
                <span x-text="formatTime(videoCurrentTime)"></span>
                <span>/</span>
                <span x-text="formatTime(videoDuration)"></span>
            </div>
            
            <!-- Seek Bar -->
            <div class="flex-1 mx-2">
                <input type="range" 
                       x-model="videoCurrentTime"
                       @input="seekVideo($event.target.value)"
                       :max="videoDuration"
                       step="1"
                       class="seek-bar w-full"
                       :style="'--seek-progress: ' + (videoDuration > 0 ? (videoCurrentTime / videoDuration * 100) : 0) + '%'">
            </div>
            
            <!-- Volume Controls -->
            <div class="flex items-center gap-2">
                <button @click="toggleVideoMute()" 
                        class="video-control-btn w-8 h-8 rounded-full flex items-center justify-center text-white">
                    <i class="fa-solid text-sm" :class="videoMuted ? 'fa-volume-xmark' : 'fa-volume-high'"></i>
                </button>
                
                <!-- Volume Slider -->
                <input type="range"
                       x-model="videoVolume"
                       @input="setPlayerVolume($event.target.value)"
                       min="0"
                       max="100"
                       class="volume-slider"
                       :style="'--volume-level: ' + videoVolume + '%'">
                
                <!-- NEW: Fullscreen Button -->
                                <button @click="toggleFullscreen()" 
                        class="video-control-btn w-8 h-8 rounded-full flex items-center justify-center text-white ml-2">
                    <i class="fa-solid text-sm" :class="isFullscreen ? 'fa-compress' : 'fa-expand'"></i>
                </button>

            </div>
            
        </div>
    </div>

</div>

              <!-- Enter Button -->
            <button @click="enterApp()" 
                    class="landing-enter-btn group relative px-10 py-4 bg-gradient-to-r from-red-600 to-red-500 text-white font-bold font-mono text-sm md:text-base tracking-widest uppercase rounded-full hover:from-red-500 hover:to-red-400 transition-all duration-300 shadow-[0_0_40px_rgba(220,38,38,0.5),0_0_80px_rgba(220,38,38,0.2)] hover:shadow-[0_0_50px_rgba(220,38,38,0.7),0_0_100px_rgba(220,38,38,0.3)] hover:scale-105 active:scale-95 mb-8 gsap-hidden border border-red-400/30">
                <span class="relative z-10 flex items-center gap-3">
                    Initialize Operations <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </span>
            </button>

            <!-- Footer Info -->
            <div class="text-[10px] text-slate-500 font-mono tracking-widest gsap-hidden landing-footer">
                &copy; Amr Elharony 2026
            </div>

        </div>
    </div>
</div>

        
<!-- Main Content Area -->
<main class="flex-1 h-full overflow-y-auto overscroll-contain bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-slate-900/90 via-[#0B1120] to-black p-6 pt-8 pb-32 md:pb-24">

    


    <!-- ACADEMY VIEW -->
<div x-show="viewMode === 'academy'" class="pb-24">
    
    <!-- 1. METRO MAP (The Curriculum List) -->
    <div x-show="!activeChapterId">
        
        <div class="p-6 md:p-10">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
                <div data-gsap="reveal" data-gsap-from="left">
                    <h1 class="text-4xl font-black text-white mb-2 tracking-tighter">THE ACADEMY</h1>
                    <p class="text-slate-400 font-mono text-xs uppercase tracking-widest">Level up your Tech Fluency</p>
                </div>
                <div class="hidden md:flex items-center gap-2 flex-wrap">
                    <button @click="$store.academy.toggleSearch(); $store.haptics?.fire('press')" :class="$store.academy.search.active ? 'bg-primary/20 border-primary/40 text-white' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white hover:border-white/25'" class="px-3 py-2 rounded-lg border text-xs font-mono transition-all flex items-center gap-2">
                        <i class="fa-solid fa-magnifying-glass"></i> Search
                    </button>
                    <button @click="$store.academy.togglePanel('analyticsOpen')" :class="$store.academy.analyticsOpen ? 'bg-primary/20 border-primary/40 text-white' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white hover:border-white/25'" class="px-3 py-2 rounded-lg border text-xs font-mono transition-all flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie"></i> Analytics
                    </button>
                    <button @click="$store.academy.togglePanel('knowledgeGraphOpen')" :class="$store.academy.knowledgeGraphOpen ? 'bg-primary/20 border-primary/40 text-white' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white hover:border-white/25'" class="px-3 py-2 rounded-lg border text-xs font-mono transition-all flex items-center gap-2">
                        <i class="fa-solid fa-diagram-project"></i> Map
                    </button>
                    <button @click="$store.academy.togglePanel('heatmapOpen')" :class="$store.academy.heatmapOpen ? 'bg-primary/20 border-primary/40 text-white' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white hover:border-white/25'" class="px-3 py-2 rounded-lg border text-xs font-mono transition-all flex items-center gap-2">
                        <i class="fa-solid fa-fire"></i> Activity
                    </button>
                </div>
            </div>

            <!-- MOBILE FLOATING ACADEMY SIDEBAR (vertical, pinned left-middle) -->
            <div class="md:hidden fixed left-2 top-1/2 -translate-y-1/2 z-[35] academy-mobile-sidebar"
                 style="opacity:0; pointer-events:none"
                 :class="(navVisible || $store.academy.anyPanelOpen) && viewMode === 'academy' && !activeChapterId ? 'acad-nav-show' : 'acad-nav-hide'">
                <div class="flex flex-col items-center gap-1.5 px-1.5 py-2 rounded-2xl glass-panel shadow-glass-lg">
                    <button @click.stop="$store.academy.toggleSearch(); $store.haptics?.fire('press'); document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                            :class="$store.academy.search.active ? 'bg-primary/25 text-white shadow-inner' : 'text-slate-400 hover:text-white'"
                            class="w-9 h-9 rounded-xl flex items-center justify-center transition-all text-sm">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                    <button @click.stop="$store.academy.togglePanel('analyticsOpen'); document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                            :class="$store.academy.analyticsOpen ? 'bg-primary/25 text-white shadow-inner' : 'text-slate-400 hover:text-white'"
                            class="w-9 h-9 rounded-xl flex items-center justify-center transition-all text-sm">
                        <i class="fa-solid fa-chart-pie"></i>
                    </button>
                    <button @click.stop="$store.academy.togglePanel('knowledgeGraphOpen'); document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                            :class="$store.academy.knowledgeGraphOpen ? 'bg-primary/25 text-white shadow-inner' : 'text-slate-400 hover:text-white'"
                            class="w-9 h-9 rounded-xl flex items-center justify-center transition-all text-sm">
                        <i class="fa-solid fa-diagram-project"></i>
                    </button>
                    <button @click.stop="$store.academy.togglePanel('heatmapOpen'); document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                            :class="$store.academy.heatmapOpen ? 'bg-primary/25 text-white shadow-inner' : 'text-slate-400 hover:text-white'"
                            class="w-9 h-9 rounded-xl flex items-center justify-center transition-all text-sm">
                        <i class="fa-solid fa-fire"></i>
                    </button>
                </div>
            </div>

            <!-- SEARCH PANEL -->
            <div x-show="$store.academy.search.active" x-collapse x-cloak class="mb-8">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-4 shadow-glass">
                    <input type="text" placeholder="Search chapters..." 
                           x-model="$store.academy.search.query"
                           @input="$store.academy.searchAcademy($store.academy.search.query)"
                           class="w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-slate-500 text-sm font-mono focus:border-primary/50 focus:outline-none">
                    <div x-show="$store.academy.search.results.length > 0" class="mt-3 space-y-2">
                        <template x-for="(r, idx) in $store.academy.search.results" :key="idx">
                            <button @click="r.status !== 'locked' ? openChapter(r.id) : null" class="w-full text-left p-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.08] border border-white/[0.06] transition-all flex items-center gap-3">
                                <span class="text-[10px] font-mono text-slate-500">CH <span x-text="r.id"></span></span>
                                <span class="text-sm text-white font-bold" x-text="r.title"></span>
                                <span class="ml-auto text-[9px] font-mono px-2 py-0.5 rounded" :class="r.status === 'completed' ? 'bg-green-500/20 text-green-400' : r.status === 'active' ? 'text-blue-400 bg-blue-500/20' : 'text-slate-500 bg-white/5'" x-text="r.status"></span>
                            </button>
                        </template>
                    </div>
                    <p x-show="$store.academy.search.query && $store.academy.search.results.length === 0" class="text-xs text-slate-500 mt-3 text-center font-mono">No results found</p>
                </div>
            </div>

            <!-- ANALYTICS DASHBOARD -->
            <div x-show="$store.academy.analyticsOpen" x-collapse x-cloak class="mb-8">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 shadow-glass space-y-6">
                    <h3 class="text-sm font-mono font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-chart-pie text-primary"></i> Learning Analytics</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="bg-black/30 rounded-lg p-3 text-center border border-white/[0.06]">
                            <div class="text-2xl font-bold text-primary font-mono" x-text="$store.academy.completedCount + '/' + $store.academy.totalChapters"></div>
                            <div class="text-[9px] text-slate-500 uppercase mt-1">Completed</div>
                        </div>
                        <div class="bg-black/30 rounded-lg p-3 text-center border border-white/[0.06]">
                            <div class="text-2xl font-bold text-hotpink font-mono" x-text="$store.academy.completionRate + '%'"></div>
                            <div class="text-[9px] text-slate-500 uppercase mt-1">Progress</div>
                        </div>
                        <div class="bg-black/30 rounded-lg p-3 text-center border border-white/[0.06]">
                            <div class="text-2xl font-bold text-orange-400 font-mono" x-text="$store.academy.getActivityStreak()"></div>
                            <div class="text-[9px] text-slate-500 uppercase mt-1">Day Streak</div>
                        </div>
                        <div class="bg-black/30 rounded-lg p-3 text-center border border-white/[0.06]">
                            <div class="text-2xl font-bold text-blue-400 font-mono" x-text="$store.academy.getTotalActiveDays()"></div>
                            <div class="text-[9px] text-slate-500 uppercase mt-1">Active Days</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-black/20 rounded-lg p-4 border border-white/[0.06]">
                            <p class="text-[10px] text-slate-500 uppercase mb-2 font-mono">Completion</p>
                            <div class="h-40"><canvas id="analyticsDonut"></canvas></div>
                        </div>
                        <div class="bg-black/20 rounded-lg p-4 border border-white/[0.06]">
                            <p class="text-[10px] text-slate-500 uppercase mb-2 font-mono">Time per Chapter (min)</p>
                            <div class="h-40"><canvas id="analyticsTimeBar"></canvas></div>
                        </div>
                        <div class="bg-black/20 rounded-lg p-4 border border-white/[0.06]">
                            <p class="text-[10px] text-slate-500 uppercase mb-2 font-mono">Quiz Best Scores</p>
                            <div class="h-40"><canvas id="analyticsQuizRadar"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KNOWLEDGE GRAPH -->
            <div x-show="$store.academy.knowledgeGraphOpen" x-collapse x-cloak class="mb-8">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 shadow-glass">
                    <h3 class="text-sm font-mono font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2"><i class="fa-solid fa-diagram-project text-purple-400"></i> Knowledge Map</h3>
                    <div class="relative w-full" style="height: 320px;">
                        <svg viewBox="0 0 100 100" class="w-full h-full" preserveAspectRatio="xMidYMid meet">
                            <template x-for="(edge, idx) in $store.academy.graphEdges" :key="'e'+idx">
                                <line :x1="$store.academy.graphNodes.find(n=>n.id===edge.from)?.x" 
                                      :y1="$store.academy.graphNodes.find(n=>n.id===edge.from)?.y"
                                      :x2="$store.academy.graphNodes.find(n=>n.id===edge.to)?.x"
                                      :y2="$store.academy.graphNodes.find(n=>n.id===edge.to)?.y"
                                      stroke="rgba(148,163,184,0.2)" stroke-width="0.3"/>
                            </template>
                            <template x-for="(node, idx) in $store.academy.graphNodes" :key="'n'+idx">
                                <g :transform="'translate('+node.x+','+node.y+')'" 
                                   @click="node.id && metroMap.flatMap(p=>p.chapters).find(c=>c.id===node.id)?.status !== 'locked' && openChapter(node.id)" class="cursor-pointer">
                                    <circle r="4" 
                                            :fill="metroMap.flatMap(p=>p.chapters).find(c=>c.id===node.id)?.status === 'completed' ? '#4ade80' : metroMap.flatMap(p=>p.chapters).find(c=>c.id===node.id)?.status === 'active' ? '#60a5fa' : '#334155'"
                                            stroke="rgba(255,255,255,0.15)" stroke-width="0.3"/>
                                    <text y="-6" text-anchor="middle" fill="#94a3b8" font-size="2.5" font-family="monospace" x-text="node.label"></text>
                                    <text y="1" text-anchor="middle" fill="white" font-size="2.8" font-weight="bold" x-text="node.id"></text>
                                </g>
                            </template>
                        </svg>
                    </div>
                    <div class="flex items-center justify-center gap-6 mt-3 text-[10px] font-mono text-slate-500">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> Completed</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-400"></span> Active</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-slate-600"></span> Locked</span>
                    </div>
                </div>
            </div>

            <!-- ACTIVITY HEATMAP -->
            <div x-show="$store.academy.heatmapOpen" x-collapse x-cloak class="mb-8">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 shadow-glass">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-mono font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-fire text-orange-400"></i> Activity Heatmap</h3>
                        <div class="flex items-center gap-4 text-[10px] font-mono text-slate-500">
                            <span><span class="text-orange-400 font-bold" x-text="$store.academy.getActivityStreak()"></span> day streak</span>
                            <span><span class="text-emerald-400 font-bold" x-text="$store.academy.getTotalActiveDays()"></span> active days</span>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <div class="flex gap-[2px] min-w-[600px]" x-data="{ get weeks() { return $store.academy.getHeatmapData() } }">
                            <template x-for="(week, wi) in weeks" :key="wi">
                                <div class="flex flex-col gap-[2px]">
                                    <template x-for="(day, di) in week" :key="di">
                                        <div class="w-[10px] h-[10px] rounded-[2px] transition-colors" 
                                             :class="$store.academy.heatmapColor(day.count)"
                                             :title="day.date + ': ' + day.count + ' actions'"></div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="flex items-center justify-end gap-1 mt-2 text-[9px] font-mono text-slate-500">
                        <span>Less</span>
                        <span class="w-[10px] h-[10px] rounded-[2px] bg-white/[0.04]"></span>
                        <span class="w-[10px] h-[10px] rounded-[2px] bg-emerald-900/60"></span>
                        <span class="w-[10px] h-[10px] rounded-[2px] bg-emerald-700/70"></span>
                        <span class="w-[10px] h-[10px] rounded-[2px] bg-emerald-500/80"></span>
                        <span class="w-[10px] h-[10px] rounded-[2px] bg-emerald-400"></span>
                        <span>More</span>
                    </div>
                </div>
            </div>

            <!-- CERTIFICATE PROGRESS BAR -->
            <div class="mb-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-4 shadow-glass">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">Academy Progress</span>
                    <span class="text-xs font-mono font-bold" :class="$store.academy.isCertificateEligible ? 'text-primary' : 'text-slate-400'" x-text="$store.academy.completedCount + '/' + $store.academy.totalChapters + ' chapters'"></span>
                </div>
                <div class="h-2 bg-white/5 rounded-full overflow-hidden">
                    <div class="h-full bg-primary rounded-full transition-all duration-700" :style="'width:' + $store.academy.completionRate + '%'"></div>
                </div>
                <div x-show="$store.academy.isCertificateEligible" class="mt-4 text-center">
                    <p class="text-sm text-primary font-bold mb-3">All chapters completed! Download your certificate.</p>
                    <div class="flex items-center justify-center gap-3 mb-3">
                        <input type="text" x-model="$store.academy.certificate.name" placeholder="Your name..." 
                               class="bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 font-mono focus:border-primary/50 focus:outline-none w-48">
                        <button @click="$store.academy.generateCertificate(); $store.haptics?.fire('confirm')" class="px-6 py-2 bg-primary hover:bg-green-400 text-dark font-bold rounded-lg text-xs font-mono uppercase tracking-widest shadow-glow transition-all">
                            <i class="fa-solid fa-certificate mr-1"></i> Download
                        </button>
                    </div>
                </div>
            </div>

            <div class="space-y-12 relative pl-4">
                <!-- Continuous Vertical Line -->
                <div class="absolute left-4 top-2 bottom-0 w-0.5 bg-white/10 -z-10"></div>

                <template x-for="part in metroMap" :key="part.id">
                    <div class="relative">
                        <!-- Part Label -->
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-3 h-3 rounded-full border-2 bg-dark z-10" :class="part.color"></div>
                            <h3 class="text-xs font-bold text-slate-500 font-mono uppercase tracking-widest" x-text="part.label"></h3>
                        </div>

                        <!-- Chapters -->
                        <div class="space-y-4 pl-8 border-l-2 border-white/10 ml-[5px]">
                            <template x-for="chapter in part.chapters" :key="chapter.id">
                                <div @click="chapter.status !== 'locked' ? openChapter(chapter.id) : null"
                                        role="button" tabindex="0"
                                        @keydown.enter="chapter.status !== 'locked' ? openChapter(chapter.id) : null"
                                        class="w-full text-left p-6 rounded-xl border-2 transition-all relative group overflow-hidden cursor-pointer"
                                        :class="chapter.status === 'locked' ? 'border-white/5 bg-white/[0.02] opacity-60 cursor-not-allowed' : 'border-white/10 bg-white/5 backdrop-blur-md hover:border-white/25 hover:-translate-y-1 hover:shadow-glass'">
                                    
                                    <!-- Status Icon -->
                                    <div class="absolute top-6 right-6 text-xl">
                                        <i class="fa-solid" 
                                           :class="{
                                               'fa-lock text-slate-600': chapter.status === 'locked',
                                               'fa-circle-play text-white animate-pulse': chapter.status === 'active',
                                               'fa-circle-check text-green-500': chapter.status === 'completed'
                                           }"></i>
                                    </div>

                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-[10px] font-mono text-slate-400 block">CHAPTER <span x-text="chapter.id"></span></span>
                                        <button @click.stop="$store.academy.toggleBookmark(chapter.id); $store.haptics?.fire('tap')" class="ml-auto mr-8 text-sm transition-colors" :class="$store.academy.isBookmarked(chapter.id) ? 'text-yellow-400' : 'text-slate-600 hover:text-yellow-400'">
                                            <i class="fa-solid fa-bookmark"></i>
                                        </button>
                                    </div>
                                    <h4 class="text-xl font-bold text-white mb-2" x-text="chapter.title"></h4>
                                    <p class="text-sm text-slate-400" x-text="chapter.desc"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

<!-- 2. CHAPTER DASHBOARD (Detail View) -->
    <div x-show="activeChapterId" x-cloak 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         class="fixed inset-0 z-[100] bg-dark/95 backdrop-blur-xl overflow-y-auto">
        
        <template x-if="activeChapter">
            <div class="relative w-full min-h-full">
                
                <!-- Sticky Header (Auto-Hiding) -->
                <div class="fixed top-0 left-0 right-0 z-40 bg-slate-900/70 backdrop-blur-xl border-b border-white/10 p-4 flex items-center gap-4 transition-all duration-500 ease-in-out"
                     :class="navVisible ? 'translate-y-0 opacity-100' : '-translate-y-full opacity-0 pointer-events-none'">
                    
                    <button @click="closeChapter()" class="w-10 h-10 rounded-full border border-white/20 bg-white/5 flex items-center justify-center text-white hover:bg-white hover:text-black transition-all">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase">NOW PLAYING</p>
                        <h3 class="font-bold text-white text-sm md:text-base truncate" x-text="activeChapter.title"></h3>
                    </div>
                </div>

                <!-- Spacer div to prevent content from hiding behind the fixed header when it is visible -->
                <div class="h-20"></div>

                <div class="max-w-4xl mx-auto p-4 md:p-8 space-y-8 pb-32">

                    <!-- A. Video Player (Custom) -->
<div class="aspect-video w-full bg-black/30 backdrop-blur-lg rounded-2xl overflow-hidden shadow-glass-lg border border-white/10 relative" id="academy-player-wrapper"
     tabindex="0" @keydown.prevent.space="acTogglePlay()" @keydown.prevent.left="acSeek(Math.max(0, acCurrentTime - 5))" @keydown.prevent.right="acSeek(Math.min(acDuration, acCurrentTime + 5))" @keydown.prevent.up="acSetVolume(Math.min(100, acVolume + 10))" @keydown.prevent.down="acSetVolume(Math.max(0, acVolume - 10))" @keydown.m="acToggleMute()" @keydown.f="toggleFullscreen('academy-player-wrapper')">
    
    <!-- The YouTube Target Div -->
    <div id="academy-player" class="w-full h-full"></div>

    <!-- Video Overlay (Click to Play/Pause + tap to show controls on mobile) -->
    <div class="absolute inset-0 z-20" 
         @click="acTogglePlay(); acShowControls()"
         @touchstart.passive="acShowControls()"
         :title="acPlaying ? 'Pause' : 'Play'">
    </div>

    <!-- Custom Controls Bar -->
    <div class="absolute bottom-0 left-0 right-0 z-30 p-4 transition-opacity duration-300 bg-gradient-to-t from-black/90 to-transparent"
         :class="acControlsVisible || acPlaying === false ? 'opacity-100' : 'opacity-0 hover:opacity-100'"
         @mouseenter="acShowControls()" @touchstart.passive="acShowControls()">
        <div class="flex items-center gap-3 md:gap-4">
            
            <!-- Play/Pause -->
            <button @click.stop="acTogglePlay()" class="w-8 h-8 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all touch-manipulation active:scale-90">
                <i class="fa-solid text-xs" :class="acPlaying ? 'fa-pause' : 'fa-play'"></i>
            </button>
            
            <!-- Time Display -->
            <div class="flex items-center gap-1 text-[10px] text-white font-mono" style="font-variant-numeric:tabular-nums">
                <span x-text="formatTime(acCurrentTime)">0:00</span>
                <span>/</span>
                <span x-text="formatTime(acDuration)">0:00</span>
            </div>
            
            <!-- Seek Bar -->
            <div class="flex-1 mx-2 relative flex items-center">
                <input type="range" 
                       x-model="acCurrentTime"
                       @input="acSeek($event.target.value)"
                       @click.stop
                       :max="acDuration"
                       step="1"
                       class="seek-bar w-full"
                       :style="'--seek-progress: ' + (acDuration > 0 ? (acCurrentTime / acDuration * 100) : 0) + '%'">
            </div>
            
            <!-- Volume -->
            <div class="flex items-center gap-2">
                <button @click.stop="acToggleMute()" class="text-white hover:text-hotpink transition-colors touch-manipulation">
                    <i class="fa-solid text-xs" :class="acMuted ? 'fa-volume-xmark' : 'fa-volume-high'"></i>
                </button>
                <input type="range" x-model="acVolume" @input="acSetVolume($event.target.value)" @click.stop min="0" max="100" 
                       class="volume-slider"
                       :style="'--volume-level: ' + acVolume + '%'">
            </div>

            <!-- Fullscreen -->
            <button @click.stop="toggleFullscreen('academy-player-wrapper')" class="text-white hover:text-hotpink transition-colors touch-manipulation">
                <i class="fa-solid text-xs" :class="isFullscreen ? 'fa-compress' : 'fa-expand'"></i>
            </button>
        </div>
    </div>
</div>


                    <!-- B. Audio Deep Dive -->
                    <div class="bg-white/5 backdrop-blur-lg p-6 rounded-2xl border border-white/10 shadow-glass">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-10 h-10 rounded-full bg-purple-500/20 backdrop-blur-sm border border-purple-500/30 flex items-center justify-center text-purple-400">
                                <i class="fa-solid fa-headphones"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold">Audio Deep Dive</h4>
                                <p class="text-xs text-slate-400">Listen on the go (Background Play)</p>
                            </div>
                        </div>
                        <audio controls controlsList="nodownload" oncontextmenu="return false;" class="w-full h-10 rounded">
    <source :src="getAudioUrl(activeChapter)" type="audio/mp4">
    Your browser does not support the audio element.
</audio>
                     
                    </div>

                    <!-- C. Asset Grid (OFFLINE & CACHING ENABLED) -->
                    <div class="grid grid-cols-2 gap-4">
                        
                        <!-- 1. VIEW SLIDES -->
                        <button @click="viewPdf(activeChapter)" class="p-6 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-blue-400/50 hover:bg-white/10 transition-all text-center group">
                            <i class="fa-solid fa-file-pdf text-3xl text-slate-400 group-hover:text-blue-400 mb-2 transition-colors"></i>
                            <p class="text-xs font-bold text-white">VIEW SLIDES</p>
                        </button>
                        
                        <!-- 2. SAVE OFFLINE (Caches 2 Chapters/Day) -->
                        <button @click="toggleOfflineCache(activeChapter)" 
                                class="p-6 rounded-xl border transition-all text-center group relative overflow-hidden backdrop-blur-md"
                                :class="offlineManager.isCached(activeChapter.id) ? 'bg-green-900/20 border-green-500/40' : 'bg-white/5 border-white/10 hover:border-green-400/50'">
                            
                            <!-- Status Badge -->
                            <div class="absolute top-2 right-2 text-[9px] font-mono px-2 py-0.5 rounded border"
                                 :class="offlineManager.isCached(activeChapter.id) ? 'bg-green-500 text-black border-green-500' : 'bg-black/50 text-slate-400 border-white/15'">
                                <span x-text="offlineManager.isCached(activeChapter.id) ? 'OFFLINE READY' : offlineManager.getQuotaText()"></span>
                            </div>

                            <!-- Dynamic Icon -->
                            <div class="mb-2">
                                <i class="fa-solid text-3xl transition-colors"
                                   :class="offlineManager.loading === activeChapter.id ? 'fa-circle-notch fa-spin text-white' : (offlineManager.isCached(activeChapter.id) ? 'fa-circle-check text-green-500' : 'fa-cloud-arrow-down text-slate-400 group-hover:text-green-400')"></i>
                            </div>
                            
                            <p class="text-xs font-bold" 
                               :class="offlineManager.isCached(activeChapter.id) ? 'text-green-400' : 'text-white'"
                               x-text="offlineManager.loading === activeChapter.id ? 'SAVING...' : (offlineManager.isCached(activeChapter.id) ? 'SAVED LOCALLY' : 'SAVE OFFLINE')"></p>
                        </button>

                        <!-- 3. FLASHCARDS -->
                        <button @click="launchFlashcards(activeChapter)" class="col-span-2 p-4 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-yellow-400/50 hover:bg-white/10 transition-all text-center group">
                            <div class="flex items-center justify-center gap-3">
                                <i class="fa-solid fa-layer-group text-xl text-slate-400 group-hover:text-yellow-400 transition-colors"></i>
                                <span class="text-xs font-bold text-white">PRACTICE FLASHCARDS</span>
                            </div>
                        </button>

                        <!-- 4. VISUAL SUMMARY -->
                        <button @click="viewImage(activeChapter, 'infographic')" class="p-6 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-green-400/50 hover:bg-white/10 transition-all text-center group">
                            <i class="fa-solid fa-image text-3xl text-slate-400 group-hover:text-green-400 mb-2 transition-colors"></i>
                            <p class="text-xs font-bold text-white">VISUAL SUMMARY</p>
                        </button>

                        <!-- 5. MIND MAP -->
                        <button @click="viewImage(activeChapter, 'mindmap')" class="p-6 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-purple-400/50 hover:bg-white/10 transition-all text-center group">
                            <i class="fa-solid fa-diagram-project text-3xl text-slate-400 group-hover:text-purple-400 mb-2 transition-colors"></i>
                            <p class="text-xs font-bold text-white">MIND MAP</p>
                        </button>

                        <!-- 6. TAKE QUIZ -->
                        <button @click="$store.academy.startQuiz(activeChapter.id); $store.haptics?.fire('press')" class="p-6 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-hotpink/50 hover:bg-white/10 transition-all text-center group relative">
                            <i class="fa-solid fa-clipboard-question text-3xl text-slate-400 group-hover:text-hotpink mb-2 transition-colors"></i>
                            <p class="text-xs font-bold text-white">TAKE QUIZ</p>
                            <span x-show="$store.academy.getQuizScores()[activeChapter.id]" class="absolute top-2 right-2 text-[9px] font-mono px-2 py-0.5 rounded bg-primary/20 text-primary border border-primary/20" x-text="($store.academy.getQuizScores()[activeChapter.id]?.best || 0) + '%'"></span>
                        </button>

                        <!-- 7. MY NOTES -->
                        <button @click="$store.academy.openNotes(activeChapter.id); $store.haptics?.fire('press')" class="p-6 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-orange-400/50 hover:bg-white/10 transition-all text-center group relative">
                            <i class="fa-solid fa-pen-to-square text-3xl text-slate-400 group-hover:text-orange-400 mb-2 transition-colors"></i>
                            <p class="text-xs font-bold text-white">MY NOTES</p>
                            <span x-show="$store.academy.hasNotes(activeChapter.id)" class="absolute top-2 right-2 w-2 h-2 rounded-full bg-orange-400"></span>
                        </button>

                        <!-- 8. AI TUTOR -->
                        <button @click="$store.academy.openAiTutor(activeChapter.id); $store.haptics?.fire('press')" class="col-span-2 p-4 bg-white/5 backdrop-blur-md rounded-xl border border-white/10 hover:border-cyan-400/50 hover:bg-white/10 transition-all text-center group">
                            <div class="flex items-center justify-center gap-3">
                                <i class="fa-solid fa-robot text-xl text-slate-400 group-hover:text-cyan-400 transition-colors"></i>
                                <span class="text-xs font-bold text-white">AI TUTOR</span>
                            </div>
                        </button>
                    </div>


<!-- ... existing Asset Grid div ends here ... -->
                    
<!-- NEW: COMPLETION FOOTER (Clean Version) -->
                    <div class="mt-8 pt-8 border-t border-white/10 text-center">
                        <p class="text-[10px] text-slate-500 uppercase mb-4 tracking-widest">
                            Ready to advance?
                        </p>
                        
                        <!-- Removed the internal 'shine' div for a flat look -->
                        <button @click="completeActiveChapter()" 
                                class="inline-flex items-center justify-center px-8 py-4 font-bold text-dark transition-all duration-200 bg-primary hover:bg-green-400 hover:-translate-y-1 font-mono text-xs rounded-full shadow-glow">
                            
                            <span class="mr-2">COMPLETE CHAPTER</span>
                            <i class="fa-solid fa-check-circle text-lg"></i>
                            
                        </button>
                    </div>

                </div> <!-- End of max-w-4xl container -->                

                        </div> <!-- End of content wrapper -->
        </template>
    </div> <!-- End of activeChapterId view -->
  </div>
                    
  <!-- PDF / IMAGE VIEWER MODAL -->
<div x-show="viewer.active" x-cloak x-transition.opacity 
     class="fixed inset-0 z-[150] bg-black/95 flex flex-col h-full w-full">
    
    <!-- Viewer Header -->
    <div class="flex items-center justify-between p-3 md:p-4 border-b border-white/10 bg-slate-900/90 backdrop-blur-xl shrink-0 gap-2 safe-area-top">
        <button @click="closeViewer(); $store.haptics?.fire('dismiss')" class="w-10 h-10 rounded-full border border-white/20 bg-white/5 flex items-center justify-center text-white hover:bg-white hover:text-black transition-all shrink-0 touch-manipulation">
            <i class="fa-solid fa-xmark"></i>
        </button>
        <h3 class="text-white font-bold text-xs md:text-sm truncate flex-1 text-center" x-text="viewer.title"></h3>
        
        <!-- PDF Zoom Controls (Desktop) -->
        <div x-show="viewer.type === 'pdf' && !viewer.loading" class="hidden md:flex items-center gap-1 shrink-0">
            <button @click="pdfZoomOut()" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all"><i class="fa-solid fa-minus"></i></button>
            <button @click="pdfZoomReset()" class="px-2 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-[10px] font-mono transition-all" x-text="Math.round(pdfViewer.zoom * 100) + '%'"></button>
            <button @click="pdfZoomIn()" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all"><i class="fa-solid fa-plus"></i></button>
            <button @click="toggleViewerFullscreen()" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all" title="Fullscreen"><i class="fa-solid" :class="viewerFullscreen ? 'fa-compress' : 'fa-expand'"></i></button>
        </div>
        
        <!-- Image Zoom Controls (Desktop) -->
        <div x-show="viewer.type === 'image' && !viewer.loading && !viewer.error" class="hidden md:flex items-center gap-1 shrink-0">
            <button @click="imgZoomOut(); $store.haptics?.fire('tap')" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all" title="Zoom Out (-)"><i class="fa-solid fa-minus"></i></button>
            <button @click="imgZoomReset(); $store.haptics?.fire('tap')" class="px-2 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-[10px] font-mono transition-all" x-text="Math.round(imageViewer.zoom * 100) + '%'" title="Reset Zoom (0)"></button>
            <button @click="imgZoomIn(); $store.haptics?.fire('tap')" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all" title="Zoom In (+)"><i class="fa-solid fa-plus"></i></button>
            <button @click="toggleViewerFullscreen()" class="w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all" title="Fullscreen"><i class="fa-solid" :class="viewerFullscreen ? 'fa-compress' : 'fa-expand'"></i></button>
        </div>

        <div x-show="(viewer.type !== 'pdf' && viewer.type !== 'image') || viewer.loading || viewer.error" class="w-10 shrink-0"></div>
    </div>

    <!-- Viewer Body -->
    <div class="flex-1 relative w-full overflow-hidden">
        
        <!-- Loading Spinner -->
        <div x-show="viewer.loading" class="absolute inset-0 flex items-center justify-center">
            <div class="text-center">
                <i class="fa-solid fa-circle-notch fa-spin text-4xl text-primary mb-4"></i>
                <p class="text-slate-400 font-mono text-xs">LOADING DOCUMENT...</p>
            </div>
        </div>

        <!-- PDF Continuous Scroll Viewer -->
        <div x-show="viewer.type === 'pdf' && !viewer.loading && pdfViewer.mode === 'scroll'" 
             class="w-full h-full overflow-auto overscroll-contain" 
             id="pdf-scroll-container"
             @scroll.throttle.100ms="_updateScrollPageNum()">
            <div class="pdf-scroll-inner py-4 px-2 md:px-4">
            </div>
        </div>

        <!-- PDF Single-Page Viewer (fallback) -->
        <div x-show="viewer.type === 'pdf' && !viewer.loading && pdfViewer.mode === 'single'" 
             class="w-full h-full overflow-auto flex justify-center p-2 md:p-4" id="pdf-container">
            <canvas id="the-canvas" class="shadow-glass max-w-full h-auto self-start bg-white rounded-lg"></canvas>
        </div>

        <!-- Image Viewer (Enhanced) -->
        <div x-show="viewer.type === 'image' && !viewer.loading && !viewer.error" 
             id="image-viewer-container"
             class="w-full h-full overflow-hidden flex items-center justify-center image-viewer-container"
             :class="imageViewer.zoom > 1.05 ? 'cursor-grab' : 'cursor-zoom-in'"
             @mousedown.prevent="_imgPointerDown($event)"
             @mousemove.prevent="_imgPointerMove($event)"
             @mouseup="_imgPointerUp()"
             @mouseleave="_imgPointerUp()"
             @wheel.prevent="_imgWheel($event)"
             @touchstart="_imgTouchStart($event)"
             @touchmove="_imgTouchMove($event)"
             @touchend="_imgTouchEnd()"
             @dblclick="imgToggleZoom()">
            <img :src="viewer.url" 
                 id="image-viewer-img"
                 @load="viewer.loading = false" 
                 @error="viewer.loading = false; viewer.error = true" 
                 class="max-w-full max-h-full object-contain rounded-lg select-none image-viewer-img"
                 :class="imageViewer.dragging ? '' : 'image-viewer-smooth'"
                 draggable="false"
                 :style="`transform: translate(${imageViewer.panX}px, ${imageViewer.panY}px) scale(${imageViewer.zoom}); transform-origin: center center;`">
        </div>

        <!-- Image Error State -->
        <div x-show="viewer.type === 'image' && viewer.error" class="w-full h-full flex items-center justify-center">
            <div class="text-center text-slate-500">
                <i class="fa-solid fa-image-slash text-3xl mb-3 block opacity-40"></i>
                <p class="text-xs">Failed to load image</p>
                <button @click="viewer.error = false; viewer.loading = true; let u = viewer.url; viewer.url = ''; $nextTick(() => viewer.url = u)" 
                        class="mt-3 px-4 py-2 text-xs rounded-lg bg-white/5 border border-white/10 text-slate-400 hover:text-white hover:bg-white/10 transition-all">
                    <i class="fa-solid fa-rotate-right mr-1"></i> Retry
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Bottom Controls (Image) -->
    <div x-show="viewer.type === 'image' && !viewer.loading && !viewer.error" x-transition 
         class="shrink-0 border-t border-white/10 bg-slate-900/90 backdrop-blur-xl safe-area-bottom">
        <div class="flex items-center justify-center px-4 py-3 gap-2">
            <!-- Mobile Zoom Controls -->
            <div class="flex md:hidden items-center gap-1">
                <button @click="imgZoomOut(); $store.haptics?.fire('tap')" class="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90"><i class="fa-solid fa-minus"></i></button>
                <button @click="imgZoomReset(); $store.haptics?.fire('tap')" class="px-3 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-mono text-slate-400 hover:text-white transition-all touch-manipulation" x-text="Math.round(imageViewer.zoom * 100) + '%'"></button>
                <button @click="imgZoomIn(); $store.haptics?.fire('tap')" class="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90"><i class="fa-solid fa-plus"></i></button>
            </div>
            <!-- Fit / Actual Toggle -->
            <button @click="imgToggleZoom()" class="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90" title="Toggle Fit/Zoom">
                <i class="fa-solid" :class="imageViewer.zoom > 1.05 ? 'fa-down-left-and-up-right-to-center' : 'fa-up-right-and-down-left-from-center'"></i>
            </button>
            <!-- Fullscreen -->
            <button @click="toggleViewerFullscreen()" class="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90" title="Fullscreen">
                <i class="fa-solid" :class="viewerFullscreen ? 'fa-compress' : 'fa-expand'"></i>
            </button>
        </div>
    </div>

    <!-- Floating Bottom Controls (PDF only) -->
    <div x-show="viewer.type === 'pdf' && !viewer.loading" x-transition 
         class="shrink-0 border-t border-white/10 bg-slate-900/90 backdrop-blur-xl safe-area-bottom">
        
        <!-- Page Slider -->
        <div x-show="pdfState.numPages > 1" class="px-4 pt-3">
            <input type="range" min="1" :max="pdfState.numPages" :value="pdfState.pageNum"
                   @change="scrollToPage(parseInt($event.target.value, 10))"
                   class="w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-primary">
        </div>

        <!-- Controls Row -->
        <div class="flex items-center justify-between px-4 py-3 gap-2">
            <!-- Prev -->
            <button @click="prevPage()" :disabled="pdfState.pageNum <= 1" 
                    class="w-11 h-11 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white disabled:opacity-20 hover:bg-white/10 transition-all touch-manipulation active:scale-90">
                <i class="fa-solid fa-chevron-left text-sm"></i>
            </button>

            <!-- Page Counter -->
            <div class="flex items-center gap-3">
                <span class="text-xs font-mono font-bold text-white"><span x-text="pdfState.pageNum"></span></span>
                <span class="text-[10px] font-mono text-slate-500">of</span>
                <span class="text-xs font-mono font-bold text-slate-400"><span x-text="pdfState.numPages"></span></span>
            </div>

            <!-- Mobile Zoom -->
            <div class="flex md:hidden items-center gap-1">
                <button @click="pdfZoomOut()" class="w-9 h-9 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90"><i class="fa-solid fa-minus"></i></button>
                <button @click="pdfZoomReset()" class="px-2 h-9 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[10px] font-mono text-slate-400 hover:text-white transition-all touch-manipulation" x-text="Math.round(pdfViewer.zoom * 100) + '%'"></button>
                <button @click="pdfZoomIn()" class="w-9 h-9 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90"><i class="fa-solid fa-plus"></i></button>
            </div>

            <!-- Fullscreen -->
            <button @click="toggleViewerFullscreen()" class="w-9 h-9 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white text-xs transition-all touch-manipulation active:scale-90" title="Fullscreen">
                <i class="fa-solid" :class="viewerFullscreen ? 'fa-compress' : 'fa-expand'"></i>
            </button>

            <!-- Next -->
            <button @click="nextPage()" :disabled="pdfState.pageNum >= pdfState.numPages"
                    class="w-11 h-11 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white disabled:opacity-20 hover:bg-white/10 transition-all touch-manipulation active:scale-90">
                <i class="fa-solid fa-chevron-right text-sm"></i>
            </button>
        </div>
    </div>
</div>


<!-- FLASHCARD MODAL OVERLAY -->
<div x-show="showFlashcards" x-cloak x-transition.opacity 
     class="fixed inset-0 z-[120] flex items-center justify-center">
    
    <!-- 1. BACKDROP (Click to Close) -->
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" 
         @click="showFlashcards = false"></div>

    <!-- 2. CONTENT CONTAINER (Pointer Events Safe) -->
    <div class="relative z-10 w-full max-w-md p-6 flex flex-col items-center pointer-events-none">
        
        <!-- Close Button (Enable pointer events) -->
        <button @click="showFlashcards = false" 
                class="absolute -top-12 right-6 text-slate-400 hover:text-white text-2xl p-4 pointer-events-auto">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <!-- Loading State -->
        <div x-show="flashcardLoading" class="text-white text-center py-20">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl mb-4"></i>
            <p>Shuffling Deck...</p>
        </div>

        <!-- THE CARD (Enable pointer events) -->
        <div x-show="!flashcardLoading && flashcardDeck.length > 0" 
             @click="isFlipped = !isFlipped; $store.haptics?.fire('pageFlip')"
             class="relative w-full aspect-[4/5] transition-all duration-300 transform-style-3d cursor-pointer mb-8 pointer-events-auto perspective-1000"
             :class="isFlipped ? 'rotate-y-180' : ''">
            
            <!-- Front -->
            <div class="absolute inset-0 backface-hidden bg-white/5 backdrop-blur-xl rounded-2xl border-2 border-white/15 flex flex-col items-center justify-center p-8 text-center shadow-glass-lg">
                <span class="text-xs font-mono text-slate-400 uppercase tracking-widest mb-4">QUESTION</span>
                <h3 class="text-xl md:text-2xl font-bold text-white leading-tight select-none" x-text="flashcardDeck[currentCardIndex]?.q"></h3>
                <p class="text-[10px] text-slate-500 mt-8 absolute bottom-8 uppercase tracking-widest">Tap to Flip</p>
            </div>

            <!-- Back -->
            <div class="absolute inset-0 backface-hidden bg-white/95 backdrop-blur-xl rounded-2xl border-2 border-white/80 flex flex-col items-center justify-center p-8 text-center rotate-y-180 shadow-glass-lg">
                <span class="text-xs font-mono text-slate-400 uppercase tracking-widest mb-4">ANSWER</span>
                <h3 class="text-lg md:text-xl font-medium text-slate-900 leading-relaxed select-none" x-text="flashcardDeck[currentCardIndex]?.a"></h3>
            </div>
        </div>

        <!-- CONTROLS BAR (Enable pointer events + High Z-Index) -->
        <div x-show="!flashcardLoading && flashcardDeck.length > 0" 
             class="w-full pointer-events-auto relative z-[110] space-y-3">
            
            <div class="flex items-center justify-between">
                <div class="text-slate-400 font-mono text-xs pl-2">
                    <span x-text="currentCardIndex + 1"></span> / <span x-text="flashcardDeck.length"></span>
                </div>
                <div x-show="isFlipped" class="flex items-center gap-2">
                    <button @click.stop="$store.haptics?.fire('tap'); $store.academy.gradeFlashcard(activeChapterId, currentCardIndex, 0); nextCard()" class="px-3 py-2 bg-red-500/80 hover:bg-red-500 text-white rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all active:scale-95">Again</button>
                    <button @click.stop="$store.haptics?.fire('tap'); $store.academy.gradeFlashcard(activeChapterId, currentCardIndex, 3); nextCard()" class="px-3 py-2 bg-orange-500/80 hover:bg-orange-500 text-white rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all active:scale-95">Hard</button>
                    <button @click.stop="$store.haptics?.fire('tap'); $store.academy.gradeFlashcard(activeChapterId, currentCardIndex, 4); nextCard()" class="px-3 py-2 bg-blue-500/80 hover:bg-blue-500 text-white rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all active:scale-95">Good</button>
                    <button @click.stop="$store.haptics?.fire('tap'); $store.academy.gradeFlashcard(activeChapterId, currentCardIndex, 5); nextCard()" class="px-3 py-2 bg-green-500/80 hover:bg-green-500 text-white rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all active:scale-95">Easy</button>
                </div>
                <button x-show="!isFlipped" @click.stop="nextCard()" 
                        class="group px-6 py-3 bg-hotpink hover:bg-pink-600 text-white rounded-full text-xs font-bold uppercase tracking-widest shadow-glow-vip transition-all active:scale-95 touch-manipulation">
                    <span class="flex items-center gap-2">
                        NEXT <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </button>
            </div>
        </div>

    </div>
</div>


<!-- QUIZ MODAL -->
<div x-show="$store.academy.quiz.active" x-transition.opacity x-cloak
     class="fixed inset-0 z-[160] flex items-center justify-center">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" @click="$store.academy.closeQuiz(); $store.haptics?.fire('dismiss')"></div>
    <div class="relative z-10 w-full max-w-lg mx-4 bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-white/10 shadow-glass-lg overflow-hidden">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-sm font-mono font-bold text-hotpink uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-clipboard-question"></i> Chapter Quiz</h3>
                <button @click="$store.academy.closeQuiz(); $store.haptics?.fire('dismiss')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>

            <!-- Quiz In Progress -->
            <template x-if="$store.academy.quiz.score === null">
                <div>
                    <div class="flex gap-1 mb-6">
                        <template x-for="i in ($store.academy.quizData[$store.academy.quiz.chapterId]?.length || 5)" :key="'qd'+i">
                            <div class="flex-1 h-1 rounded-full" :class="i - 1 < $store.academy.quiz.currentQ ? 'bg-primary' : i - 1 === $store.academy.quiz.currentQ ? 'bg-hotpink' : 'bg-white/10'"></div>
                        </template>
                    </div>
                    <p class="text-[10px] font-mono text-slate-500 uppercase mb-2">Question <span x-text="$store.academy.quiz.currentQ + 1"></span> of <span x-text="$store.academy.quizData[$store.academy.quiz.chapterId]?.length || 5"></span></p>
                    <h4 class="text-lg font-bold text-white mb-6" x-text="$store.academy.getCurrentQuizQuestion()?.q"></h4>
                    <div class="space-y-3">
                        <template x-for="(opt, oi) in ($store.academy.getCurrentQuizQuestion()?.opts || [])" :key="oi">
                            <button @click="$store.academy.submitQuizAnswer(oi); $store.haptics?.fire('tap')" 
                                    class="w-full text-left p-4 rounded-xl border transition-all text-sm"
                                    :class="$store.academy.quiz.answered ? (oi === $store.academy.getCurrentQuizQuestion()?.correct ? 'border-green-500/50 bg-green-500/10 text-green-300' : oi === $store.academy.quiz.selectedIdx ? 'border-red-500/50 bg-red-500/10 text-red-300' : 'border-white/5 bg-white/[0.02] text-slate-500') : 'border-white/10 bg-white/5 hover:border-white/25 hover:bg-white/10 text-white'"
                                    :disabled="$store.academy.quiz.answered">
                                <span class="font-mono text-[10px] mr-2" x-text="['A','B','C','D'][oi]"></span>
                                <span x-text="opt"></span>
                            </button>
                        </template>
                    </div>
                    <div x-show="$store.academy.quiz.answered" class="mt-4 p-3 bg-white/5 rounded-lg border border-white/[0.06]">
                        <p class="text-xs text-slate-400" x-text="$store.academy.getCurrentQuizQuestion()?.explain"></p>
                    </div>
                    <div x-show="$store.academy.quiz.answered" class="mt-4 text-right">
                        <button @click="$store.academy.nextQuizQuestion()" class="px-6 py-2 bg-hotpink hover:bg-pink-600 text-white rounded-lg text-xs font-bold uppercase tracking-wider transition-all">
                            <span x-text="$store.academy.quiz.currentQ < ($store.academy.quizData[$store.academy.quiz.chapterId]?.length || 5) - 1 ? 'Next Question' : 'See Results'"></span>
                            <i class="fa-solid fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </template>

            <!-- Quiz Results -->
            <template x-if="$store.academy.quiz.score !== null">
                <div class="text-center py-4">
                    <div class="text-6xl font-black font-mono mb-2" :class="$store.academy.quiz.passed ? 'text-primary' : 'text-red-400'" x-text="$store.academy.quiz.score + '/' + ($store.academy.quizData[$store.academy.quiz.chapterId]?.length || 5)"></div>
                    <div class="text-sm font-bold mb-4" :class="$store.academy.quiz.passed ? 'text-primary' : 'text-red-400'" x-text="$store.academy.quiz.passed ? 'PASSED' : 'TRY AGAIN'"></div>
                    <p class="text-xs text-slate-500 mb-6" x-text="$store.academy.quiz.passed ? 'Great job! You have mastered this chapter.' : 'You need 80% to pass. Review the material and try again.'"></p>
                    <div class="flex items-center gap-2 mb-6 justify-center">
                        <template x-for="(a, ai) in $store.academy.quiz.answers" :key="ai">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold" :class="a.isCorrect ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'bg-red-500/20 text-red-400 border border-red-500/30'" x-text="ai + 1"></div>
                        </template>
                    </div>
                    <div class="flex items-center justify-center gap-3">
                        <button @click="$store.academy.startQuiz($store.academy.quiz.chapterId); $store.haptics?.fire('press')" class="px-5 py-2 bg-white/5 border border-white/10 hover:border-white/25 text-white rounded-lg text-xs font-bold uppercase tracking-wider transition-all"><i class="fa-solid fa-redo mr-1"></i> Retry</button>
                        <button @click="$store.academy.closeQuiz(); $store.haptics?.fire('confirm')" class="px-5 py-2 bg-hotpink hover:bg-pink-600 text-white rounded-lg text-xs font-bold uppercase tracking-wider transition-all">Done</button>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- NOTES SLIDE-OVER -->
<div x-show="$store.academy.notes.active" x-transition.opacity x-cloak
     class="fixed inset-0 z-[160]">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" @click="$store.academy.closeNotes(); $store.haptics?.fire('dismiss')"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full max-w-md bg-slate-900/95 backdrop-blur-xl border-l border-white/10 shadow-2xl flex flex-col"
         x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
         x-transition:leave="transition ease-in duration-200 transform" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
        <div class="p-4 border-b border-white/10 flex items-center justify-between shrink-0">
            <h3 class="text-sm font-mono font-bold text-orange-400 uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-pen-to-square"></i> Chapter Notes</h3>
            <div class="flex items-center gap-2">
                <button @click="$store.academy.notes.preview = !$store.academy.notes.preview" class="text-xs text-slate-400 hover:text-white px-2 py-1 rounded border border-white/10 font-mono" x-text="$store.academy.notes.preview ? 'Edit' : 'Preview'"></button>
                <button @click="$store.academy.closeNotes(); $store.haptics?.fire('dismiss')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <textarea x-show="!$store.academy.notes.preview" 
                      x-model="$store.academy.notes.content" 
                      @input.debounce.500ms="$store.academy.saveNote()"
                      placeholder="Start typing your notes..."
                      class="w-full h-full bg-black/30 border border-white/10 rounded-lg p-4 text-sm text-white placeholder-slate-600 font-mono resize-none focus:border-orange-400/50 focus:outline-none leading-relaxed"></textarea>
            <div x-show="$store.academy.notes.preview" class="prose prose-sm prose-invert max-w-none text-sm leading-relaxed" x-html="$store.academy.notes.content ? $store.academy.notes.content.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g, '<br>') : '<em class=&quot;text-slate-500&quot;>No notes yet...</em>'"></div>
        </div>
        <div class="p-3 border-t border-white/10 flex items-center justify-between text-[10px] font-mono text-slate-500 shrink-0">
            <span x-text="($store.academy.notes.content?.length || 0) + ' chars'"></span>
            <span x-show="$store.academy.notes.lastSaved" x-text="'Saved ' + $store.academy.notes.lastSaved"></span>
            <button @click="$store.academy.exportNotesAsPdf()" class="text-orange-400 hover:text-orange-300 flex items-center gap-1"><i class="fa-solid fa-file-pdf"></i> Export All Notes</button>
        </div>
    </div>
</div>

<!-- AI TUTOR MODAL -->
<div x-show="$store.academy.aiTutor.active" x-transition.opacity x-cloak
     class="fixed inset-0 z-[160] flex items-center justify-center">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" @click="$store.academy.closeAiTutor(); $store.haptics?.fire('dismiss')"></div>
    <div class="relative z-10 w-full max-w-lg mx-4 bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-white/10 shadow-glass-lg max-h-[85vh] overflow-y-auto">
        <div class="p-6 space-y-4">
            <div class="flex items-center justify-between">
                <h3 class="text-sm font-mono font-bold text-cyan-400 uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-robot"></i> AI Tutor</h3>
                <button @click="$store.academy.closeAiTutor(); $store.haptics?.fire('dismiss')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>

            <div class="bg-white/5 rounded-lg p-3 border border-white/[0.06]">
                <p class="text-[10px] text-slate-500 uppercase font-mono mb-1">Chapter Context</p>
                <p class="text-sm text-white font-bold" x-text="activeChapter?.title || 'Chapter'"></p>
                <p class="text-xs text-slate-400 mt-1" x-text="activeChapter?.desc || ''"></p>
            </div>

            <div>
                <p class="text-[10px] text-slate-500 uppercase font-mono mb-2">Suggested Questions</p>
                <div class="flex flex-wrap gap-2">
                    <template x-for="(sq, si) in ($store.academy.starterQuestions[$store.academy.aiTutor.chapterId] || [])" :key="si">
                        <button @click="$store.academy.aiTutor.question = sq" class="text-[10px] text-slate-400 hover:text-white bg-white/5 hover:bg-white/10 border border-white/[0.06] rounded-lg px-3 py-1.5 transition-all text-left" x-text="sq"></button>
                    </template>
                </div>
            </div>

            <div>
                <p class="text-[10px] text-slate-500 uppercase font-mono mb-2">Your Question</p>
                <textarea x-model="$store.academy.aiTutor.question" rows="3" placeholder="Ask the AI tutor anything about this chapter..."
                          class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-sm text-white placeholder-slate-600 font-mono focus:border-cyan-400/50 focus:outline-none resize-none"></textarea>
                <button @click="$store.academy.generateTutorPrompt()" 
                        :disabled="!$store.academy.aiTutor.question.trim()"
                        class="mt-2 w-full py-2 bg-cyan-500 hover:bg-cyan-400 disabled:opacity-30 text-dark rounded-lg text-xs font-bold uppercase tracking-wider transition-all">
                    <i class="fa-solid fa-wand-magic-sparkles mr-1"></i> Generate AI Prompt
                </button>
            </div>

            <div x-show="$store.academy.aiTutor.prompt" class="space-y-2">
                <div class="flex items-center justify-between">
                    <p class="text-[10px] text-slate-500 uppercase font-mono">Generated Prompt</p>
                    <button @click="copyToClipboard($store.academy.aiTutor.prompt)" class="text-[10px] text-cyan-400 hover:text-cyan-300 font-mono flex items-center gap-1"><i class="fa-solid fa-copy"></i> Copy for ChatGPT</button>
                </div>
                <div class="bg-black/40 border border-white/[0.06] rounded-lg p-4 text-xs text-slate-300 font-mono whitespace-pre-wrap leading-relaxed max-h-48 overflow-y-auto" x-text="$store.academy.aiTutor.prompt"></div>
            </div>
        </div>
    </div>
</div>

    <!-- EBOOK & SUMMARY TAB -->
<div x-show="viewMode === 'ebook'" x-cloak class="pb-32 max-w-5xl mx-auto px-4">

    <!-- ═══ SECTION A: 3D HERO ═══ -->
    <div class="relative bg-white/[0.04] backdrop-blur-2xl border border-white/[0.08] rounded-3xl shadow-glass-lg overflow-hidden mb-8 mt-4">

        <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/[0.06] via-transparent to-purple-500/[0.04] pointer-events-none"></div>

        <div class="relative flex flex-col lg:flex-row items-center gap-6 lg:gap-12 p-6 md:p-10">

            <!-- 3D Book Viewer -->
            <div class="w-full lg:w-[45%] shrink-0 flex flex-col items-center">
                <div class="w-full rounded-2xl overflow-hidden bg-black/20 border border-white/[0.06] shadow-[0_8px_60px_rgba(0,0,0,0.4)]"
                     style="aspect-ratio: 4/3; min-height: 220px; max-height: 420px;">
                    <model-viewer
                        :src="bookConfig.modelSrc"
                        :ios-src="bookConfig.modelIos"
                        :poster="bookConfig.coverImage"
                        alt="3D Book Preview"
                        auto-rotate
                        camera-controls
                        touch-action="pan-y"
                        shadow-intensity="0.6"
                        shadow-softness="0.8"
                        exposure="1.1"
                        camera-orbit="30deg 75deg 2.5m"
                        min-camera-orbit="auto auto 1.5m"
                        max-camera-orbit="auto auto 5m"
                        ar
                        ar-modes="webxr scene-viewer quick-look"
                        style="width:100%; height:100%; --poster-color:transparent;"
                        loading="lazy">
                        <button slot="ar-button" aria-label="View book in augmented reality"
                                class="absolute bottom-3 right-3 bg-white/10 backdrop-blur-md border border-white/20 text-white text-[10px] font-mono uppercase tracking-widest px-3 py-1.5 rounded-full hover:bg-white/20 transition-colors">
                            <i class="fa-solid fa-cube mr-1"></i> View in AR
                        </button>
                    </model-viewer>
                </div>
                <p class="text-[10px] text-slate-500 font-mono mt-3 text-center tracking-widest">DRAG TO ROTATE &bull; PINCH TO ZOOM</p>
            </div>

            <!-- Hero Text & Actions -->
            <div class="flex-1 text-center lg:text-left">
                <span class="text-[10px] font-mono text-indigo-400 uppercase tracking-[0.2em] bg-indigo-500/10 backdrop-blur-sm px-3 py-1 rounded-full border border-indigo-500/20 mb-5 inline-block">
                    Available Now
                </span>
                <h1 class="text-3xl md:text-5xl font-black text-white mb-2 tracking-tighter leading-[1.1]" x-text="bookConfig.title"></h1>
                <p class="font-mono text-indigo-400 text-xs md:text-sm uppercase tracking-widest mb-2" x-text="bookConfig.subtitle"></p>
                <p class="text-[11px] text-slate-500 font-mono mb-6">by <span x-text="bookConfig.author" class="text-slate-300"></span></p>
                <p class="text-slate-400 text-sm leading-relaxed mb-8 max-w-lg" x-text="bookConfig.description"></p>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row flex-wrap gap-3">
                    <a :href="bookConfig.amazonLink" target="_blank"
                       class="bg-[#FF9900] hover:bg-[#ffad33] text-black font-bold py-3 px-6 rounded-full shadow-[0_0_20px_rgba(255,153,0,0.2)] transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                        <i class="fa-brands fa-amazon text-lg"></i> Buy on Amazon
                    </a>
                    <a :href="bookConfig.spotifyLink" target="_blank"
                       class="bg-[#1DB954] hover:bg-[#1ed760] text-black font-bold py-3 px-6 rounded-full shadow-[0_0_20px_rgba(29,185,84,0.2)] transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                        <i class="fa-brands fa-spotify text-lg"></i> Listen on Spotify
                    </a>
                    <button @click="readBookPdf()"
                            class="bg-white/[0.06] hover:bg-white/[0.12] backdrop-blur-xl border border-white/[0.12] hover:border-indigo-500/40 text-white font-bold py-3 px-6 rounded-full transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                        <i class="fa-solid fa-file-pdf text-indigo-400"></i>
                        <span>Read Summary PDF</span>
                    </button>
                    <button @click="$refs.summaryStart.scrollIntoView({behavior: 'smooth'})"
                            class="bg-white/[0.04] hover:bg-white/[0.08] backdrop-blur-xl border border-white/[0.08] text-slate-400 hover:text-white font-bold py-3 px-6 rounded-full transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                        <i class="fa-solid fa-list-ul"></i> Quick Outline
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ SECTION B: AUTHOR CARD ═══ -->
    <div data-gsap="reveal" class="bg-white/[0.04] backdrop-blur-2xl border border-white/[0.08] rounded-2xl shadow-glass p-4 md:p-6 mb-6 md:mb-8">
        <div class="flex items-center gap-3 md:gap-5">
            <div class="w-11 h-11 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-indigo-500/30 to-purple-500/20 backdrop-blur-md border border-white/10 flex items-center justify-center shrink-0 shadow-lg">
                <span class="text-base md:text-xl font-black text-white">A</span>
            </div>
            <div class="flex-1 min-w-0">
                <h3 class="font-bold text-white text-sm" x-text="bookConfig.author"></h3>
                <p class="text-[10px] md:text-xs text-slate-400 mt-0.5 leading-snug">Delivery Lead | Mentor | Fintech Author &amp; Speaker</p>
            </div>
            <a :href="bookConfig.authorWebsite" target="_blank"
               class="shrink-0 bg-white/[0.06] hover:bg-white/[0.12] backdrop-blur-md border border-white/[0.1] hover:border-indigo-500/30 text-slate-300 hover:text-white px-3 md:px-4 py-1.5 md:py-2 rounded-full transition-all flex items-center gap-1.5 md:gap-2 text-[10px] md:text-[11px] font-mono uppercase tracking-widest">
                <i class="fa-solid fa-globe text-indigo-400"></i> Website
            </a>
        </div>
    </div>

    <!-- ═══ SECTION C: SPOTIFY AUDIOBOOK PLAYER ═══ -->
    <a :href="bookConfig.spotifyLink" target="_blank" rel="noopener noreferrer"
       data-gsap="reveal" data-gsap-delay="0.1"
       class="hidden md:block audiobook-card rounded-2xl overflow-hidden mb-6 md:mb-8 group no-underline">
        <div class="flex items-stretch">
            <!-- Cover Art -->
            <div class="relative w-28 md:w-40 shrink-0">
                <img :src="bookConfig.coverImage" :alt="bookConfig.title"
                     class="w-full h-full object-cover" loading="lazy">
                <div class="absolute inset-0 bg-gradient-to-r from-transparent to-black/20"></div>
            </div>
            <!-- Info -->
            <div class="flex-1 min-w-0 p-3 md:p-5 flex flex-col justify-between">
                <div>
                    <div class="flex items-center gap-1.5 mb-2 md:mb-3">
                        <i class="fa-brands fa-spotify text-[#1DB954] text-sm md:text-lg"></i>
                        <span class="font-mono text-[8px] md:text-[10px] font-bold uppercase tracking-[0.15em] audiobook-label">Audiobook</span>
                    </div>
                    <h3 class="font-bold text-sm md:text-lg leading-tight audiobook-title mb-0.5 md:mb-1 truncate" x-text="bookConfig.title"></h3>
                    <p class="text-[10px] md:text-xs audiobook-subtitle" x-text="bookConfig.author"></p>
                </div>
                <div class="flex items-center justify-between mt-2 md:mt-3">
                    <span class="text-[9px] md:text-[11px] font-mono audiobook-cta group-hover:underline">
                        Listen on Spotify <i class="fa-solid fa-arrow-right text-[8px] ml-1 transition-transform group-hover:translate-x-0.5"></i>
                    </span>
                    <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-[#1DB954] flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-play text-white text-[10px] md:text-xs ml-0.5"></i>
                    </div>
                </div>
            </div>
        </div>
    </a>

    <!-- ═══ SECTION D: SUMMARY ACCORDION ═══ -->
    <div x-ref="summaryStart">
        <div data-gsap="reveal" data-gsap-from="left" class="flex items-center gap-3 mb-6">
            <div class="w-8 h-8 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-center justify-center">
                <i class="fa-solid fa-layer-group text-indigo-400 text-sm"></i>
            </div>
            <h2 class="font-mono text-sm font-bold text-white uppercase tracking-widest">Executive Summary</h2>
        </div>

        <div class="space-y-3">
            <template x-for="(section, index) in bookConfig.summary" :key="index">
                <div class="bg-white/[0.04] backdrop-blur-2xl border rounded-xl overflow-hidden transition-all duration-300"
                     :class="bookConfig.activeSummarySection === index ? 'border-indigo-500/30 shadow-[0_0_30px_rgba(99,102,241,0.08)]' : 'border-white/[0.08] hover:border-white/[0.15]'">

                    <button @click="bookConfig.activeSummarySection = (bookConfig.activeSummarySection === index ? null : index)"
                            class="w-full flex justify-between items-center p-5 text-left hover:bg-white/[0.03] transition-colors">
                        <span class="font-bold text-white text-sm" x-text="section.title"></span>
                        <i class="fa-solid fa-chevron-down text-slate-600 transition-transform duration-300"
                           :class="bookConfig.activeSummarySection === index ? 'rotate-180 text-indigo-400' : ''"></i>
                    </button>

                    <div x-show="bookConfig.activeSummarySection === index" x-cloak x-collapse
                         class="bg-white/[0.02] p-6 border-t border-white/[0.06]">
                        <p class="text-slate-400 text-sm leading-7" x-text="section.content"></p>
                    </div>
                </div>
            </template>
        </div>

        <!-- Footer CTA -->
        <div data-gsap="reveal" data-gsap-delay="0.2" class="mt-10 p-8 bg-white/[0.04] backdrop-blur-2xl rounded-2xl border border-white/[0.08] text-center shadow-glass relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/[0.06] via-transparent to-purple-500/[0.04] pointer-events-none"></div>
            <div class="relative">
                <h3 class="text-lg font-bold text-white mb-2">Ready to go deeper?</h3>
                <p class="text-sm text-slate-500 mb-6">The summary is just the map. The book is the engine.</p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <a :href="bookConfig.amazonLink" target="_blank"
                       class="bg-white/[0.06] hover:bg-white/[0.12] backdrop-blur-md border border-white/[0.1] text-white px-6 py-2.5 rounded-full transition-all text-xs font-mono uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-brands fa-amazon text-[#FF9900]"></i> Get Full Copy
                    </a>
                    <a :href="bookConfig.spotifyLink" target="_blank"
                       class="bg-white/[0.06] hover:bg-white/[0.12] backdrop-blur-md border border-white/[0.1] text-white px-6 py-2.5 rounded-full transition-all text-xs font-mono uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-brands fa-spotify text-[#1DB954]"></i> Listen on Spotify
                    </a>
                    <a :href="bookConfig.authorWebsite" target="_blank"
                       class="text-slate-500 hover:text-indigo-400 transition-colors text-xs font-mono uppercase tracking-widest flex items-center gap-1">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i> Visit Author
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- TOOLS SECTION -->
<div x-show="viewMode === 'tools'" x-cloak>
    
<!-- Header Area -->
    <div data-gsap="reveal" data-gsap-from="left" class="mb-12 pt-4 pl-4">
        <h1 class="text-4xl font-black text-white mb-2 tracking-tighter uppercase select-none"
            @click="if(!isVipMode){ vipTapCount = (vipTapCount||0)+1; clearTimeout(vipTapTimer); vipTapTimer = setTimeout(()=>vipTapCount=0, 800); if(vipTapCount>=3){ vipTapCount=0; openVipTerminal(); }}">
            THE <span x-text="currentGroup"></span>
        </h1>
        <p class="text-slate-400 font-mono text-xs uppercase tracking-widest">
            <span x-text="navGroups.find(g => g.id === currentGroup)?.desc || 'Executive Toolkit'"></span>
        </p>
    </div>
        


<!-- TOOLS DASHBOARD VIEW (DIAGNOSTIC MODE) -->
<div x-show="currentTab === 'dashboard'" class="w-full">

    <!-- 1. SAFETY CHECK: Is 'tools' loaded? -->
    <div x-show="!tools" class="bg-red-500 text-white p-4 rounded-xl mb-4 animate-pulse">
        <i class="fa-solid fa-bug mr-2"></i> 
        <strong>CRITICAL ERROR:</strong> The 'tools' data is missing. Check your app.js syntax.
    </div>

    <!-- 2. SAFETY CHECK: Does the current group exist? -->
    <div x-show="tools && !tools[currentGroup]" class="bg-yellow-500 text-black p-4 rounded-xl mb-4">
        <i class="fa-solid fa-triangle-exclamation mr-2"></i>
        <strong>GROUP ERROR:</strong> Cannot find tools for group "<span x-text="currentGroup"></span>". 
        <br>Available groups: <span x-text="Object.keys(tools).join(', ')"></span>
    </div>

    <!-- 3. THE GRID (Protected Loop) -->
    <div x-show="tools && tools[currentGroup]" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">
        <template x-for="tool in (tools && tools[currentGroup] ? tools[currentGroup] : [])" :key="tool.id">
            <button @click="$store.haptics?.fire('nav'); currentTab = tool.id; window.scrollTo({ top: 0, behavior: 'smooth' })" 
                    class="group relative backdrop-blur-lg p-4 md:p-6 rounded-2xl text-left transition-all hover:-translate-y-1 flex flex-col justify-between h-full min-h-[140px]"
                    :class="currentGroup === 'sims' ? 'bg-[#0a0a0a] border border-[#00ff41]/15 hover:border-[#00ff41]/40 hover:shadow-[0_0_20px_rgba(0,255,65,0.1)] scanline-bg' : 'bg-gradient-to-br from-white/[0.08] to-transparent border border-white/10 hover:border-white/25 hover:shadow-glass-glow'">
                
                <div class="w-10 h-10 rounded-full bg-black/30 backdrop-blur-sm flex items-center justify-center mb-4 border border-white/10 group-hover:scale-110 transition-transform shadow-lg">
                    <!-- Safe Class Binding -->
                    <i :class="tool.icon + ' ' + tool.color" class="text-lg" aria-hidden="true"></i>
                </div>
                
                <div class="relative w-full">
                    <span class="block text-white font-medium text-sm leading-tight pr-4" x-text="tool.label"></span>
                    <div class="absolute bottom-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i class="fa-solid fa-arrow-right text-xs text-slate-500"></i>
                    </div>
                </div>
            </button>
        </template>
    </div>
</div>
    
    <!-- ACTIVE TOOL RENDERER -->
    <!-- Only show the specific tool UI if one is selected, overlaying the grid -->
    <div x-show="currentTab !== 'dashboard'" x-cloak
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0 scale-95"
     x-transition:enter-end="opacity-100 scale-100"
     class="fixed inset-0 z-50 bg-dark/90 backdrop-blur-xl overflow-y-auto touch-pan-y">

        
<!-- Tool Header (Sticky, auto-hide via GSAP) -->
        <div class="tool-header-bar sticky top-0 z-[60] px-3 py-2.5 md:p-4 border-b border-white/10 flex items-center justify-between bg-slate-900/70 backdrop-blur-xl relative">
            
            <!-- Back Button -->
            <button @click="$store.haptics?.fire('nav'); currentTab = 'dashboard'" class="relative z-10 text-slate-400 hover:text-white flex items-center gap-1.5 md:gap-2 font-mono text-[11px] md:text-xs uppercase shrink-0">
                <i class="fa-solid fa-chevron-left text-[10px]"></i> 
                <span class="hidden md:inline">Back to Hub</span>
                <span class="md:hidden">Back</span>
            </button>
            
            <!-- Title: hidden on small mobile to prevent overlap -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <div class="font-bold text-white tracking-tight text-center text-[11px] md:text-base hidden sm:block">THE BILINGUAL EXECUTIVE</div>
            </div>
            
            <!-- Right Spacer -->
            <div class="w-6 md:w-8 shrink-0"></div> 
        </div>
        
        <!-- Tool Content Container -->
         <div class="px-3 py-4 md:p-8 pb-20">

             
             <!-- SIMULATOR TAB (REDESIGNED) -->
<div x-show="currentTab === 'simulator'" x-data="caseStudySimulator" x-cloak class="max-w-5xl mx-auto pb-20">
    
    <!-- Intro Screen -->
    <div x-show="!$data.active" class="text-center py-10 md:py-20 px-2">
        <div class="inline-block p-5 md:p-8 rounded-full bg-white/[0.03] backdrop-blur-md border-2 border-primary/30 mb-6 md:mb-8 shadow-[0_0_30px_rgba(74,222,128,0.1)]">
            <i class="fa-solid fa-chess-knight text-4xl md:text-6xl text-primary"></i>
        </div>
        <h2 class="text-2xl md:text-5xl font-mono font-bold text-white mb-4 md:mb-6 tracking-tight">The Meridian Trust Protocol</h2>
        <p class="text-slate-400 max-w-xl mx-auto mb-8 md:mb-10 text-sm md:text-lg leading-relaxed">
            Simulation Mode: <span class="text-white font-bold">Active</span><br>
            Role: <span class="text-white font-bold">Chief Digital Officer</span><br>
            Objective: <span class="text-white font-bold">Survive 90 Days</span>
        </p>
        <button @click="$data.start()" class="bg-primary hover:bg-green-400 text-dark font-bold py-3 px-8 md:py-4 md:px-10 rounded-full shadow-glow transition-all text-xs md:text-sm tracking-widest uppercase">
            Initialize Simulation
        </button>
    </div>

    <!-- Active Game UI -->
    <div x-show="$data.active && !$data.gameOver" class="space-y-8">
        
        <!-- HEADS-UP DISPLAY (Telemetry) -->
        <div class="sticky top-0 z-30 bg-slate-900/70 backdrop-blur-xl border-b border-white/10 p-2.5 md:p-4 -mx-3 md:mx-0 md:rounded-xl md:border md:border-white/10 shadow-glass">
            <div class="grid grid-cols-3 gap-2 md:gap-4 text-center">
                <!-- Political Capital -->
                <div>
                    <div class="text-[8px] md:text-[10px] uppercase font-mono text-slate-500 mb-0.5 md:mb-1 truncate">Capital</div>
                    <div class="w-full bg-white/10 h-1.5 md:h-2 rounded-full overflow-hidden mb-0.5 md:mb-1">
                        <div class="h-full transition-all duration-500" 
                             :class="$data.metrics.politicalCapital < 30 ? 'bg-risk' : 'bg-primary'"
                             :style="`width: ${$data.metrics.politicalCapital}%`"></div>
                    </div>
                    <span class="font-mono text-xs md:text-sm font-bold text-white" x-text="$data.metrics.politicalCapital + '%'"></span>
                </div>
                <!-- Velocity -->
                <div>
                    <div class="text-[8px] md:text-[10px] uppercase font-mono text-slate-500 mb-0.5 md:mb-1 truncate">Velocity</div>
                    <div class="w-full bg-white/10 h-1.5 md:h-2 rounded-full overflow-hidden mb-0.5 md:mb-1">
                        <div class="bg-purple-400 h-full transition-all duration-500" :style="`width: ${$data.metrics.velocity}%`"></div>
                    </div>
                    <span class="font-mono text-xs md:text-sm font-bold text-white" x-text="$data.metrics.velocity"></span>
                </div>
                <!-- Risk -->
                <div>
                    <div class="text-[8px] md:text-[10px] uppercase font-mono text-slate-500 mb-0.5 md:mb-1 truncate">Risk</div>
                    <div class="w-full bg-white/10 h-1.5 md:h-2 rounded-full overflow-hidden mb-0.5 md:mb-1">
                        <div class="h-full transition-all duration-500" 
                             :class="$data.metrics.risk > 70 ? 'bg-risk' : 'bg-blue-400'"
                             :style="`width: ${$data.metrics.risk}%`"></div>
                    </div>
                    <span class="font-mono text-xs md:text-sm font-bold text-white" x-text="$data.metrics.risk + '%'"></span>
                </div>
            </div>
        </div>

        <!-- SCENARIO CARD -->
        <div class="bg-white/5 backdrop-blur-lg border-l-4 border-primary p-4 md:p-8 rounded-r-xl shadow-glass relative overflow-hidden max-w-3xl mx-auto">
            
            <!-- Progress Pill -->
            <div class="absolute top-3 right-3 md:top-6 md:right-6">
                <span class="bg-white/10 text-slate-300 text-[10px] md:text-xs font-mono px-2 md:px-3 py-0.5 md:py-1 rounded-full border border-white/10">
                    DAY <span x-text="($data.step + 1) * 30"></span> / 90
                </span>
            </div>

            <span class="text-[10px] md:text-xs font-mono text-primary tracking-widest uppercase mb-3 md:mb-4 block">
                INCOMING SITUATION
            </span>
            
            <h3 class="text-xl md:text-3xl font-bold text-white mb-3 md:mb-4 pr-16 md:pr-0" x-text="$data.scenarios[$data.step].title"></h3>
            <p class="text-slate-300 leading-relaxed text-sm md:text-lg mb-5 md:mb-8" x-text="$data.scenarios[$data.step].context"></p>
            
            <div class="bg-black/20 p-3 md:p-6 rounded-lg border border-white/10 mb-5 md:mb-8">
                <p class="font-mono text-warn text-[10px] md:text-xs mb-1.5 md:mb-2 uppercase"><i class="fa-solid fa-triangle-exclamation mr-1.5"></i>Decision Required</p>
                <p class="text-white font-bold text-sm md:text-xl italic" x-text="$data.scenarios[$data.step].question"></p>
            </div>

            <!-- Choices -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                <template x-for="(choice, index) in $data.scenarios[$data.step].choices" :key="index">
                    <button @click="$data.makeChoice(index)" 
                            class="text-left p-4 md:p-6 rounded-xl border border-white/15 hover:border-primary hover:bg-white/10 transition-all group relative h-full flex flex-col justify-between active:scale-[0.98]">
                        
                        <div>
                            <span class="font-mono text-[10px] text-slate-500 block mb-1.5 md:mb-2">OPTION <span x-text="index + 1"></span></span>
                            <span class="text-white font-medium block text-sm md:text-base" x-text="choice.text"></span>
                        </div>
                        
                        <div class="mt-3 md:mt-4 flex justify-end text-primary md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-arrow-right text-xs"></i>
                        </div>
                    </button>
                </template>
            </div>
        </div>
    </div>

    <!-- GAME OVER / RESULTS SCREEN -->
    <div x-show="$data.gameOver" class="max-w-3xl mx-auto px-1">
        
        <!-- Result Banner -->
        <div class="text-center mb-6 md:mb-10">
            <div class="mb-3 md:mb-4 inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/[0.03] backdrop-blur-md border-2" 
                 :class="$data.metrics.politicalCapital > 0 ? 'border-primary text-primary' : 'border-risk text-risk'">
                <i class="fa-solid text-3xl md:text-4xl" :class="$data.metrics.politicalCapital > 0 ? 'fa-flag-checkered' : 'fa-skull'"></i>
            </div>
            <h2 class="text-2xl md:text-4xl font-bold text-white mb-2" x-text="$data.metrics.politicalCapital > 0 ? 'MISSION COMPLETE' : 'TERMINATED'"></h2>
            <p class="text-base md:text-xl text-slate-300" x-text="$data.finalMessage"></p>
        </div>

        <!-- AI DEBRIEF BOX -->
        <div class="bg-white/[0.03] backdrop-blur-md border border-white/10 p-4 md:p-6 rounded-xl relative overflow-hidden group mb-6 md:mb-8">
            
            <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-2 mb-3 md:mb-4">
                <h3 class="font-mono text-white font-bold flex items-center gap-2 text-sm md:text-base">
                    <i class="fa-solid fa-robot text-white"></i> 
                    PERFORMANCE REVIEW AI
                </h3>
                <span class="text-[9px] md:text-[10px] uppercase bg-white/10 text-slate-300 px-2 py-0.5 md:py-1 rounded border border-white/10 self-start sm:self-auto">
                    Decision Log Ready
                </span>
            </div>

            <div class="font-mono text-xs text-slate-400 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/[0.08] mb-4 h-24 overflow-hidden relative">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                <pre class="whitespace-pre-wrap font-sans" x-text="$data.generateSimulatorPrompt()"></pre>
            </div>

            <button @click="
                    copyToClipboard($data.generateSimulatorPrompt(), 'Sim Results');
                    $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> DATA EXPORTED';
                    $el.classList.add('bg-white', 'text-black', 'border-white');
                    setTimeout(() => {
                        $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY REVIEW FOR AI';
                        $el.classList.remove('bg-white', 'text-black', 'border-white');
                    }, 2000)
                    " 
                    class="w-full py-4 bg-transparent border border-white/20 text-white hover:bg-white hover:text-black font-bold rounded-lg transition-all flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest">
                <i class="fa-solid fa-wand-magic-sparkles"></i> COPY REVIEW FOR AI
            </button>
            
            <p class="text-center text-[10px] text-slate-500 mt-3">
                Paste into AI to get a breakdown of your leadership psychology.
            </p>
        </div>

        <!-- Replay -->
        <div class="text-center">
            <button @click="$data.start()" class="text-sm text-slate-400 hover:text-white underline decoration-dotted">
                <i class="fa-solid fa-rotate-right mr-2"></i>Reset Simulation
            </button>
        </div>

    </div>

</div>
            
<!-- NEGOTIATION DOJO (REDESIGNED) -->
<div x-show="currentTab === 'roleplay'" x-data="negotiationDojoComponent" x-cloak class="max-w-4xl mx-auto pb-20">
    
    <!-- PHASE 1: LOBBY -->
    <div x-show="!$data.active">
        <div class="text-center py-8 md:py-12 px-1">
            <h2 class="text-2xl md:text-3xl font-mono font-bold text-orange-400 mb-3 md:mb-4">Negotiation Dojo</h2>
            <p class="text-textMuted mb-6 md:mb-8 text-sm md:text-base">Select a sparring partner. Logic-based simulation.</p>
            
            <div class="grid md:grid-cols-1 gap-6 max-w-md mx-auto">
                <template x-for="(scen, idx) in $data.scenarios" :key="idx">
                    <button @click="$data.start(idx)" 
                            class="bg-white/[0.03] backdrop-blur-md border border-white/10 hover:border-orange-400 p-6 rounded-xl text-left transition-all hover:shadow-[0_0_20px_rgba(251,146,60,0.2)]">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold bg-orange-900/50 text-orange-400 px-2 py-1 rounded border border-orange-500/30">LEVEL 1</span>
                            <i class="fa-solid fa-arrow-right text-slate-500"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white" x-text="scen.title"></h3>
                        <p class="text-sm text-slate-400 mt-1">Opponent: <span class="text-white" x-text="scen.opponent"></span></p>
                    </button>
                </template>
            </div>
        </div>
    </div>

    <!-- PHASE 2: THE ARENA -->
    <div x-show="$data.active && !$data.gameOver" class="space-y-6">
        
        <!-- Telemetry Bar -->
        <div class="bg-white/[0.03] backdrop-blur-md border border-white/10 p-2.5 md:p-4 rounded-xl flex justify-between items-center shadow-lg">
            <!-- Trust -->
            <div class="flex-1 px-2 md:px-4 border-r border-white/10">
                <div class="flex justify-between text-[8px] md:text-[10px] uppercase font-bold text-slate-400 mb-0.5 md:mb-1">
                    <span>Trust</span>
                    <span x-text="$data.metrics.trust"></span>
                </div>
                <div class="w-full bg-white/10 h-1 md:h-1.5 rounded-full overflow-hidden">
                    <div class="h-full bg-green-500 transition-all duration-500" :style="`width: ${$data.metrics.trust}%`"></div>
                </div>
            </div>
            <!-- Leverage -->
            <div class="flex-1 px-2 md:px-4 border-r border-white/10">
                <div class="flex justify-between text-[8px] md:text-[10px] uppercase font-bold text-slate-400 mb-0.5 md:mb-1">
                    <span>Leverage</span>
                    <span x-text="$data.metrics.leverage"></span>
                </div>
                <div class="w-full bg-white/10 h-1 md:h-1.5 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500 transition-all duration-500" :style="`width: ${$data.metrics.leverage}%`"></div>
                </div>
            </div>
            <!-- Patience -->
            <div class="px-2 md:px-4 text-center">
                <div class="text-[8px] md:text-[10px] uppercase font-bold text-slate-400 mb-0.5 md:mb-1">Patience</div>
                <div class="flex gap-0.5 md:gap-1 justify-center">
                    <template x-for="i in 3" :key="i">
                        <div class="w-1.5 h-1.5 md:w-2 md:h-2 rounded-full transition-all" 
                             :class="i <= $data.metrics.patience ? 'bg-orange-500 shadow-[0_0_5px_orange]' : 'bg-white/10'"></div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Opponent Dialogue -->
        <div class="bg-white/5 backdrop-blur-lg border-l-4 border-orange-500 p-4 md:p-8 rounded-r-xl shadow-glass relative">
            <span class="text-[9px] md:text-[10px] font-mono text-orange-400 uppercase tracking-widest block mb-2" x-text="$data.currentScenario?.opponent"></span>
            <p class="text-base md:text-2xl text-white font-medium leading-relaxed italic">
                "<span x-text="$data.currentScenario?.nodes?.[$data.currentNode]?.text"></span>"
            </p>
        </div>

        <!-- Tactical Options -->
        <div class="grid gap-3 md:gap-4">
            <template x-for="(opt, idx) in ($data.currentScenario?.nodes?.[$data.currentNode]?.options || [])" :key="idx">
                <button @click="$data.choose(opt)" 
                        class="group text-left p-3.5 md:p-5 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 hover:border-white transition-all relative overflow-hidden active:scale-[0.98]">
                    
                    <div class="relative z-10 flex justify-between items-center gap-3">
                        <span class="text-xs md:text-sm font-bold text-slate-200 group-hover:text-white" x-text="opt.text"></span>
                        <i class="fa-solid fa-chevron-right text-slate-600 group-hover:text-white transition-colors shrink-0 text-[10px]"></i>
                    </div>
                    
                    <!-- Hover Impact Preview (Optional: Show impact on hover) -->
                    <div class="h-1 bg-gradient-to-r from-transparent via-white/10 to-transparent absolute bottom-0 left-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                </button>
            </template>
        </div>

    </div>

    <!-- PHASE 3: DEBRIEF & AI PROMPT -->
    <div x-show="$data.gameOver" class="max-w-3xl mx-auto text-center pt-6 md:pt-10 px-1">
        
        <!-- Outcome Icon -->
        <div class="mb-4 md:mb-6 inline-flex items-center justify-center w-16 h-16 md:w-24 md:h-24 rounded-full border-4 shadow-glass"
             :class="$data.result === 'win' ? 'border-green-500 bg-green-500/10' : 'border-red-500 bg-red-500/10'">
            <i class="fa-solid text-3xl md:text-5xl" 
               :class="$data.result === 'win' ? 'fa-handshake text-green-500' : 'fa-hand-paper text-red-500'"></i>
        </div>

        <h2 class="text-2xl md:text-4xl font-bold text-white mb-2" x-text="$data.result === 'win' ? 'DEAL CLOSED' : 'WALKED AWAY'"></h2>
        <p class="text-slate-400 mb-6 md:mb-10 text-sm md:text-base" x-text="$data.finalMessage"></p>

        <!-- AI Coaching Box -->
        <div class="bg-white/[0.03] backdrop-blur-md border border-orange-500/30 p-4 md:p-6 rounded-xl text-left relative overflow-hidden group">
            
            <div class="flex justify-between items-center mb-4 relative z-10">
                <h3 class="font-mono text-white font-bold flex items-center gap-2">
                    <i class="fa-solid fa-user-secret text-orange-400"></i> 
                    PSYCHOLOGICAL ANALYSIS
                </h3>
                <span class="text-[10px] uppercase bg-orange-900/50 text-orange-400 px-2 py-1 rounded border border-orange-500/30 font-bold tracking-wider">
                    Trace Generated
                </span>
            </div>

            <!-- Preview -->
            <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateNegotiationPrompt()"></pre>
            </div>

            <!-- Copy Button -->
            <button @click="
                    copyToClipboard($data.generateNegotiationPrompt(), 'Analysis Data');
                    $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                    $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    setTimeout(() => {
                        $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> ANALYZE MY PSYCHOLOGY (AI)';
                        $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    }, 2000)
                    " 
                    class="relative z-10 w-full py-4 bg-transparent border border-orange-500 text-orange-400 hover:bg-orange-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(251,146,60,0.1)] hover:shadow-[0_0_20px_rgba(251,146,60,0.4)]">
                <i class="fa-solid fa-wand-magic-sparkles"></i> ANALYZE MY PSYCHOLOGY (AI)
            </button>
            
            <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
                Generates a detailed breakdown of your negotiation tactics, leverage points, and mistakes.
            </p>
        </div>

        <div class="mt-8">
            <button @click="$data.restart()" class="text-slate-500 hover:text-white text-sm underline decoration-dotted">
                Return to Lobby
            </button>
        </div>

    </div>

</div>
             
             <!-- CULTURAL DEBT MONITOR TAB -->
            <div x-show="currentTab === 'culture'" x-data="culturalMonitorComponent" x-cloak class="max-w-4xl mx-auto">
                
                <div class="flex flex-col sm:flex-row justify-between sm:items-end gap-3 mb-5 md:mb-6">
                    <div>
                        <h2 class="text-xl md:text-3xl font-mono font-bold text-white">Cultural Debt Monitor</h2>
                        <p class="text-textMuted text-xs md:text-sm mt-1">Intangible friction, measured.</p>
                    </div>
                    <button @click="$data.isCheckinOpen = true" class="bg-primary hover:bg-green-400 text-dark font-bold py-2 px-5 md:px-6 rounded-full shadow-glow transition-all text-xs md:text-sm self-start sm:self-auto shrink-0">
                        <i class="fa-solid fa-plus mr-1.5 md:mr-2"></i>Log Check-In
                    </button>
                </div>

                <!-- EMPTY STATE -->
                <div x-show="$data.history.length === 0" class="text-center py-12 bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl border-dashed">
                    <i class="fa-solid fa-chart-line text-4xl text-slate-500 mb-4"></i>
                    <p class="text-slate-400">No data points yet. Log your first weekly check-in.</p>
                </div>

                <!-- DASHBOARD (Visible if history exists) -->
                <div x-show="$data.history.length > 0">
                    
                    <!-- The Meter -->
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                            <h3 class="font-mono text-xs text-slate-400 uppercase mb-2">Current Debt Level</h3>
                            <div class="flex items-baseline gap-2">
                                <span class="text-6xl font-bold font-mono" :class="$data.status.color" x-text="$data.currentScore + '%'"></span>
                                <span class="text-sm font-bold uppercase tracking-widest" :class="$data.status.color" x-text="$data.status.label"></span>
                            </div>
                            <p class="text-xs text-slate-300 mt-2" x-text="$data.status.desc"></p>
                            
                            <!-- Background Pulse -->
                            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-transparent to-white opacity-5 rounded-full blur-2xl"></div>
                        </div>

                        <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl flex flex-col justify-center">
                            <h3 class="font-mono text-xs text-slate-400 uppercase mb-2"><i class="fa-solid fa-user-doctor mr-2"></i>Prescription</h3>
                            <p class="text-white text-sm leading-relaxed font-medium">"<span x-text="$data.recommendation"></span>"</p>
                        </div>
                    </div>

                    <!-- The Chart -->
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl shadow-lg mb-8">
                        <h3 class="font-mono text-xs text-slate-400 uppercase mb-4">Trend Analysis (Last 10 Check-ins)</h3>
                        <div class="h-64 w-full">
                            <canvas id="debtChart"></canvas>
                        </div>
                        <!-- CULTURAL AI PROMPT BOX -->
<div x-show="$data.history.length > 0" class="mt-8 bg-white/[0.03] backdrop-blur-md border border-risk/30 p-6 rounded-xl relative overflow-hidden group">
    
    <!-- Decorative Icon -->
    <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
        <i class="fa-solid fa-user-doctor text-9xl text-risk"></i>
    </div>

    <!-- Header -->
    <div class="flex justify-between items-center mb-4 relative z-10">
        <h3 class="font-mono text-white font-bold flex items-center gap-2">
            <i class="fa-solid fa-heart-pulse text-risk"></i> 
            CULTURAL DIAGNOSTICS
        </h3>
        <span class="text-[10px] uppercase bg-risk/20 text-risk px-2 py-1 rounded border border-risk/30 font-bold tracking-wider">
            Intervention Ready
        </span>
    </div>

    <!-- The Prompt Preview -->
    <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateCulturePrompt()"></pre>
    </div>

    <!-- Copy Button -->
    <button @click="
            copyToClipboard($data.generateCulturePrompt(), 'Culture Prompt');
            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
            $el.classList.remove('border-risk', 'text-risk', 'hover:bg-risk');
            $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
            setTimeout(() => {
                $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY FOR AI COACH';
                $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                $el.classList.add('border-risk', 'text-risk', 'hover:bg-risk');
            }, 2000)
            " 
            class="relative z-10 w-full py-4 bg-transparent border border-risk text-risk hover:bg-risk hover:text-dark font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest group-hover:shadow-glow">
        <i class="fa-solid fa-wand-magic-sparkles"></i> COPY FOR AI COACH
    </button>
    
    <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
        Generates a psychological safety intervention based on your debt score.
    </p>

</div>
                    </div>

                    <div class="text-center">
                        <button @click="$data.reset()" class="text-xs text-red-400 hover:text-red-300 underline">Reset History</button>
                    </div>
                </div>

                <!-- CHECK-IN MODAL -->
                <div x-show="$data.isCheckinOpen" x-cloak x-transition.opacity 
                     class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/15 p-8 rounded-2xl max-w-md w-full shadow-glass relative">
                        <button @click="$data.isCheckinOpen = false" class="absolute top-4 right-4 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                        
                        <h3 class="text-2xl font-bold text-white mb-1">Weekly Pulse</h3>
                        <p class="text-xs text-textMuted mb-6 uppercase tracking-widest">Honesty required</p>

                        <div class="space-y-6">
                            <!-- Q1 -->
                            <div>
                                <p class="text-sm text-white mb-2 font-bold">1. Did anyone share "Bad News" openly this week?</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <button @click="$data.answers.q1 = 'yes'" :class="$data.answers.q1 === 'yes' ? 'bg-primary text-dark ring-2 ring-primary' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">Yes (Safety)</button>
                                    <button @click="$data.answers.q1 = 'no'" :class="$data.answers.q1 === 'no' ? 'bg-risk text-dark ring-2 ring-risk' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">No (Fear)</button>
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div>
                                <p class="text-sm text-white mb-2 font-bold">2. Did a senior opinion override data?</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <button @click="$data.answers.q2 = 'yes'" :class="$data.answers.q2 === 'yes' ? 'bg-risk text-dark ring-2 ring-risk' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">Yes (HiPPO)</button>
                                    <button @click="$data.answers.q2 = 'no'" :class="$data.answers.q2 === 'no' ? 'bg-primary text-dark ring-2 ring-primary' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">No (Data)</button>
                                </div>
                            </div>

                            <!-- Q3 -->
                            <div>
                                <p class="text-sm text-white mb-2 font-bold">3. Did your team ship value to a customer?</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <button @click="$data.answers.q3 = 'yes'" :class="$data.answers.q3 === 'yes' ? 'bg-primary text-dark ring-2 ring-primary' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">Yes (Flow)</button>
                                    <button @click="$data.answers.q3 = 'no'" :class="$data.answers.q3 === 'no' ? 'bg-risk text-dark ring-2 ring-risk' : 'bg-white/10 text-slate-400'" class="p-3 rounded-lg text-sm font-bold transition-all">No (Stuck)</button>
                                </div>
                            </div>
                        </div>

                        <button @click="$data.submitCheckin()" 
                                :disabled="!$data.answers.q1 || !$data.answers.q2 || !$data.answers.q3"
                                class="w-full mt-8 bg-white hover:bg-white/90 text-dark font-bold py-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            CALCULATE DEBT
                        </button>
                    </div>
                </div>

            </div>

             
             <!-- WAR GAMES TAB (REDESIGNED) -->
<div x-show="currentTab === 'whatif'" x-data="warGamesComponent" x-cloak class="max-w-5xl mx-auto pb-20">
    
    <!-- PHASE 1: MISSION SELECT -->
    <div x-show="!$data.active">
        <div class="text-center py-8 md:py-12 px-1">
            <h2 class="text-2xl md:text-3xl font-mono font-bold text-purple-500 mb-3 md:mb-4">Strategic War Games</h2>
            <p class="text-textMuted mb-6 md:mb-8 text-sm md:text-base">Choose a crisis. Make executive decisions. Live with the consequences.</p>
            
            <div class="grid md:grid-cols-1 gap-6 max-w-lg mx-auto">
                <template x-for="(scen, idx) in $data.scenarios" :key="idx">
                    <button @click="$data.start(idx)" 
                            class="bg-white/[0.03] backdrop-blur-md border border-white/10 hover:border-purple-500 p-6 rounded-xl text-left transition-all hover:shadow-[0_0_20px_rgba(168,85,247,0.2)] group">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-bold bg-purple-900/50 text-purple-400 px-2 py-1 rounded border border-purple-500/30">SCENARIO 001</span>
                            <i class="fa-solid fa-play text-slate-500 group-hover:text-purple-400"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2" x-text="scen.title"></h3>
                        <p class="text-sm text-slate-400 leading-relaxed" x-text="scen.brief"></p>
                    </button>
                </template>
            </div>
        </div>
    </div>

    <!-- PHASE 2: WAR ROOM (ACTIVE) -->
    <div x-show="$data.active && !$data.gameOver" class="space-y-6">
        
        <!-- Strategic HUD -->
        <div class="bg-white/[0.03] border-y md:border border-white/10 p-2.5 md:p-4 md:rounded-xl flex justify-between items-center shadow-glass sticky top-0 z-20 bg-slate-900/70 backdrop-blur-xl">
            <!-- Capital -->
            <div class="flex-1 px-1.5 md:px-6 border-r border-white/10 text-center">
                <div class="text-[8px] md:text-[10px] uppercase font-bold text-slate-500 mb-0.5 md:mb-1">Capital</div>
                <div class="text-sm md:text-2xl font-mono font-bold" :class="$data.metrics.capital < 30 ? 'text-red-500' : 'text-green-400'">
                    $<span x-text="$data.metrics.capital"></span>M
                </div>
            </div>
            <!-- Innovation -->
            <div class="flex-1 px-1.5 md:px-6 border-r border-white/10 text-center">
                <div class="text-[8px] md:text-[10px] uppercase font-bold text-slate-500 mb-0.5 md:mb-1">Innovation</div>
                <div class="text-sm md:text-2xl font-mono font-bold text-purple-400">
                    <span x-text="$data.metrics.innovation"></span> pts
                </div>
            </div>
            <!-- Stability -->
            <div class="flex-1 px-1.5 md:px-6 text-center">
                <div class="text-[8px] md:text-[10px] uppercase font-bold text-slate-500 mb-0.5 md:mb-1">Stability</div>
                <div class="text-sm md:text-2xl font-mono font-bold" :class="$data.metrics.stability < 40 ? 'text-red-500' : 'text-blue-400'">
                    <span x-text="$data.metrics.stability"></span>%
                </div>
            </div>
        </div>

        <!-- The Situation Board -->
        <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 md:p-8 rounded-xl shadow-lg relative min-h-[140px] md:min-h-[200px] flex items-center justify-center">
            <div class="absolute top-0 left-0 w-1 h-full bg-purple-500 rounded-l-xl"></div>
            <p class="text-base md:text-2xl text-white font-medium text-center leading-relaxed">
                "<span x-text="$data.currentScenario?.nodes?.[$data.currentNode]?.text"></span>"
            </p>
        </div>

        <!-- Command Console (Choices) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
            <template x-for="(opt, idx) in ($data.currentScenario?.nodes?.[$data.currentNode]?.options || [])" :key="idx">
                <button @click="$data.choose(opt)" 
                        class="group text-left p-4 md:p-6 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 hover:border-purple-400 transition-all relative overflow-hidden h-full active:scale-[0.98]">
                    
                    <div class="relative z-10">
                        <span class="text-[9px] md:text-[10px] font-mono text-slate-500 uppercase mb-1.5 md:mb-2 block">STRATAGEM <span x-text="String.fromCharCode(65 + idx)"></span></span>
                        <span class="text-xs md:text-sm font-bold text-white block mb-2 md:mb-4" x-text="opt.text"></span>
                        
                        <!-- Mini Impact Preview -->
                        <div class="flex gap-2 text-[9px] md:text-[10px] font-mono md:opacity-50 md:group-hover:opacity-100 transition-opacity">
                            <span x-show="opt.impact.capital < 0" class="text-red-400">Cap <i class="fa-solid fa-arrow-down"></i></span>
                            <span x-show="opt.impact.innovation > 0" class="text-purple-400">Inn <i class="fa-solid fa-arrow-up"></i></span>
                            <span x-show="opt.impact.stability < 0" class="text-orange-400">Stb <i class="fa-solid fa-arrow-down"></i></span>
                        </div>
                    </div>
                </button>
            </template>
        </div>

    </div>

    <!-- PHASE 3: DEBRIEF & AI ANALYSIS -->
    <div x-show="$data.gameOver" class="max-w-3xl mx-auto text-center pt-10">
        
        <!-- Outcome Visual -->
        <div class="mb-6 inline-flex items-center justify-center w-24 h-24 rounded-full border-4 shadow-[0_0_30px_currentColor]"
             :class="{
                'border-green-500 text-green-500 bg-green-500/10': $data.result === 'victory',
                'border-red-500 text-red-500 bg-red-500/10': $data.result === 'bankruptcy' || $data.result === 'regulatory_shutdown',
                'border-yellow-500 text-yellow-500 bg-yellow-500/10': $data.result === 'stagnation'
             }">
            <i class="fa-solid text-5xl" 
               :class="{
                'fa-trophy': $data.result === 'victory',
                'fa-land-mine-on': $data.result === 'bankruptcy',
                'fa-gavel': $data.result === 'regulatory_shutdown',
                'fa-stopwatch': $data.result === 'stagnation'
               }"></i>
        </div>

        <h2 class="text-4xl font-bold text-white mb-2 uppercase" x-text="$data.result?.replace('_', ' ')"></h2>
        <p class="text-slate-400 mb-10 text-lg" x-text="$data.finalMessage"></p>

        <!-- AI Post-Mortem Box -->
        <div class="bg-white/[0.03] backdrop-blur-md border border-purple-500/30 p-6 rounded-xl text-left relative overflow-hidden group mb-8">
            
            <div class="flex justify-between items-center mb-4 relative z-10">
                <h3 class="font-mono text-white font-bold flex items-center gap-2">
                    <i class="fa-solid fa-chess text-purple-400"></i> 
                    STRATEGIC POST-MORTEM
                </h3>
                <span class="text-[10px] uppercase bg-purple-900/50 text-purple-400 px-2 py-1 rounded border border-purple-500/30 font-bold tracking-wider">
                    Game Logs Ready
                </span>
            </div>

            <!-- Preview -->
            <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-32 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateWarGamePrompt()"></pre>
            </div>

            <!-- Copy Button -->
            <button @click="
                    copyToClipboard($data.generateWarGamePrompt(), 'Strategy Logs');
                    $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                    $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    setTimeout(() => {
                        $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE POST-MORTEM (AI)';
                        $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    }, 2000)
                    " 
                    class="relative z-10 w-full py-4 bg-transparent border border-purple-500 text-purple-400 hover:bg-purple-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(168,85,247,0.1)] hover:shadow-[0_0_20px_rgba(168,85,247,0.4)]">
                <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE POST-MORTEM (AI)
            </button>
            
            <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
                Paste into AI to analyze your strategic blind spots and "Second Order Effects".
            </p>
        </div>

        <div class="mt-8">
            <button @click="$data.restart()" class="text-slate-500 hover:text-white text-sm underline decoration-dotted">
                <i class="fa-solid fa-rotate-left mr-2"></i>Play Another Scenario
            </button>
        </div>

    </div>

</div>

             
             <!-- ASSESSMENT -->
            <div x-show="currentTab === 'assessment'" x-cloak class="max-w-4xl mx-auto">

                                <!-- TEAM COLLABORATION INTERFACE -->
                <div class="mb-5 md:mb-8 border-b border-white/10 pb-5 md:pb-8">
                    
                    <!-- State 0: Intro (Join or Create) -->
                    <div x-show="!$data.activeTeam" class="bg-gradient-to-r from-slate-800 to-slate-900 p-4 md:p-6 rounded-xl border border-white/10 flex flex-col md:flex-row items-center justify-between gap-4 md:gap-6">
                        <div class="flex-1">
                            <h3 class="font-mono text-lg md:text-xl font-bold text-white mb-1.5 md:mb-2"><i class="fa-solid fa-users mr-2 text-hotpink"></i>Team Mode</h3>
                            <p class="text-xs md:text-sm text-textMuted">Align your Board. Compare scores to find the "Reality Gap."</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 md:gap-3 w-full md:w-auto">
                            <div class="flex">
                                <input type="text" x-model="$data.joinInput" placeholder="Code" class="bg-dark border border-white/15 rounded-l px-2.5 md:px-3 py-2 w-24 md:w-28 text-sm focus:outline-none uppercase font-mono">
                                <button @click="$data.joinTeam()" class="bg-white/10 hover:bg-white/15 px-3 md:px-4 py-2 rounded-r text-sm font-bold border border-l-0 border-white/15">JOIN</button>
                            </div>
                            <div class="text-xs text-slate-500 flex items-center font-mono">OR</div>
                            <div class="flex">
                                <input type="text" x-model="$data.createInput" placeholder="Team Name" class="bg-dark border border-white/15 rounded-l px-2.5 md:px-3 py-2 w-28 md:w-32 text-sm focus:outline-none">
                                <button @click="$data.createTeam()" class="bg-hotpink hover:bg-pink-600 text-white px-3 md:px-4 py-2 rounded-r text-sm font-bold shadow-glow-vip">CREATE</button>
                            </div>
                        </div>
                    </div>

                    <!-- State 1: Active Team Dashboard -->
                    <div x-show="$data.activeTeam" class="bg-white/5 backdrop-blur-lg border border-hotpink/30 p-4 md:p-6 rounded-xl relative overflow-hidden">
                        <!-- Header -->
                        <div class="flex justify-between items-start mb-4 md:mb-6 relative z-10">
                            <div class="min-w-0 flex-1">
                                <span class="text-[9px] md:text-[10px] font-mono text-hotpink uppercase tracking-widest">ACTIVE SESSION</span>
                                <h3 class="text-lg md:text-2xl font-bold text-white flex items-center gap-2 md:gap-3 flex-wrap">
                                    <span x-text="$data.activeTeam?.name" class="truncate"></span>
                                    <span class="bg-white/10 text-[10px] md:text-xs px-1.5 md:px-2 py-0.5 md:py-1 rounded font-mono text-slate-300" x-text="$data.activeTeam?.join_code"></span>
                                </h3>
                            </div>
                            <div class="flex gap-1.5 md:gap-2 shrink-0 ml-2">
                                <button @click="$data.copyInvite()" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-white px-2 md:px-3 py-1.5 md:py-2 rounded transition-colors"><i class="fa-solid fa-share-nodes md:mr-2"></i><span class="hidden md:inline">Invite</span></button>
                                <button @click="$data.logout()" class="text-[10px] md:text-xs bg-white/5 hover:bg-red-900/50 text-slate-400 hover:text-red-400 px-2 md:px-3 py-1.5 md:py-2 rounded transition-colors"><i class="fa-solid fa-power-off"></i></button>
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div x-show="$data.memberResults.length > 0" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 relative z-10">
                            <div class="bg-dark/50 p-4 rounded-lg border border-white/10">
                                <div class="text-xs text-slate-400 font-mono uppercase mb-1">Respondents</div>
                                <div class="text-2xl font-bold text-white" x-text="$data.memberResults.length"></div>
                            </div>
                            <div class="bg-dark/50 p-4 rounded-lg border border-white/10">
                                <div class="text-xs text-slate-400 font-mono uppercase mb-1">Avg Score</div>
                                <div class="text-2xl font-bold text-primary">
                                    <span x-text="Math.round($data.memberResults.reduce((a,b)=>a+b.total_score,0)/$data.memberResults.length)"></span>/75
                                </div>
                            </div>
                            <div class="bg-dark/50 p-4 rounded-lg border border-white/10">
                                <div class="text-xs text-slate-400 font-mono uppercase mb-1">Alignment</div>
                                <div class="text-2xl font-bold" :class="$data.alignmentScore > 80 ? 'text-primary' : 'text-warn'" x-text="$data.alignmentScore + '%'"></div>
                            </div>
                        </div>

                        <div x-show="$data.memberResults.length === 0" class="text-center py-6 text-slate-500 font-mono text-sm relative z-10">
                            Waiting for team members to submit...
                        </div>

                        <!-- Team List -->
                        <div x-show="$data.memberResults.length > 0" class="relative z-10">
                            <h4 class="font-mono text-xs text-slate-400 uppercase mb-3">Submission Log</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                                <template x-for="member in $data.memberResults" :key="member.id">
                                    <div class="flex justify-between items-center text-sm p-2 rounded bg-white/5">
                                        <span x-text="member.role" class="font-bold text-white"></span>
                                        <span class="font-mono" :class="member.total_score < 40 ? 'text-risk' : 'text-primary'" x-text="member.total_score"></span>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Background Decoration -->
                        <div class="absolute -right-10 -bottom-10 opacity-10">
                            <i class="fa-solid fa-people-group text-9xl text-hotpink"></i>
                        </div>
                    </div>
                </div>

                <div x-show="!assessmentSubmitted">
                    <div class="flex justify-between items-center mb-4 md:mb-6"><h2 class="font-mono text-lg md:text-2xl font-bold text-primary flex items-center"><i class="fa-solid fa-clipboard-check mr-2 md:mr-3"></i>Agile Readiness Assessment</h2><button @click="resetAssessment()" class="text-xs text-textMuted underline hover:text-white shrink-0 ml-2"><i class="fa-solid fa-rotate-left mr-1"></i>Reset</button></div>
                      <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-4 md:p-6 mb-4 md:mb-6 border-l-4 border-blue-400">
        <label class="block text-xs md:text-sm font-mono text-white font-bold mb-3 md:mb-4 uppercase">Step 0: Profile & Context</label>
        <div class="grid md:grid-cols-2 gap-4 md:gap-6">
            <div>
                <label class="block text-xs font-mono text-textMuted mb-2">ORGANIZATION TYPE</label>
                <select x-model="selectedIndustry" class="w-full bg-dark border border-white/15 rounded p-3 text-white font-mono focus:border-primary focus:outline-none">
                    <option value="" disabled selected>Select Organization...</option>
                    <option value="Tier-1 Bank">Tier-1 Bank (Global)</option>
                    <option value="Regional Bank">Regional Bank</option>
                    <option value="Fintech">Fintech / Scale-up</option>
                    <option value="Neobank">Neobank</option>
                    <option value="Regulator">Regulator / Central Bank</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-mono text-textMuted mb-2">YOUR ROLE</label>
                <select x-model="selectedTitle" class="w-full bg-dark border border-white/15 rounded p-3 text-white font-mono focus:border-primary focus:outline-none">
                    <option value="" disabled selected>Select Your Role...</option>
                    <option value="C-Suite / Executive">C-Suite / Executive</option>
                    <option value="Head of Business / Product">Head of Business / Product</option>
                    <option value="Head of Technology">Head of Technology</option>
                    <option value="Architecture / Data">Architecture / Data</option>
                    <option value="Risk / Compliance">Risk / Compliance</option>
                </select>
            </div>
        </div>
    </div>
                    <div class="space-y-12 mb-20">
                        <template x-for="(section, sIdx) in assessmentData" :key="sIdx">
                            <div class="bg-card/50 p-6 rounded-xl border border-white/[0.08]"><h3 class="font-mono text-xl text-white mb-6 border-l-4 border-primary pl-3" x-text="section.title"></h3><div class="space-y-8"><template x-for="(q, qIdx) in section.questions" :key="qIdx"><div class="bg-dark/50 p-5 rounded border border-white/10"><div class="flex justify-between items-start mb-2"><label class="font-mono font-bold text-slate-200 text-sm uppercase tracking-wide" x-text="q.text"></label><span class="font-mono text-primary font-bold text-lg" x-text="q.score"></span></div><p class="text-xs text-textMuted mb-2" x-text="q.desc"></p><input type="range" min="1" max="5" step="1" x-model.number="q.score" class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer"></div></template></div></div>
                        </template>
                        <button @click="finishAssessment()" class="w-full py-4 bg-primary text-dark font-mono font-bold rounded-lg shadow-glow hover:bg-green-400 transition-colors flex justify-center items-center gap-2">CALCULATE SCORE <i class="fa-solid fa-calculator"></i></button>
                    </div>
                </div>

                <!-- Results -->
               <div x-show="calculateScore.isSafetyVeto" class="mb-4 p-4 border border-risk bg-risk/10 rounded flex items-start gap-3 text-left max-w-lg mx-auto"><i class="fa-solid fa-ban text-risk mt-1"></i><div><h4 class="font-mono font-bold text-risk text-sm">SAFETY VETO APPLIED</h4><p class="text-xs text-slate-300 mt-1">Low Safety score. Agility is impossible in fear. Score capped at 40.</p></div></div>
                        <div x-show="calculateScore.isManualDrag" class="mb-6 p-4 border border-warn bg-warn/10 rounded flex items-start gap-3 text-left max-w-lg mx-auto"><i class="fa-solid fa-hand text-warn mt-1"></i><div><h4 class="font-mono font-bold text-warn text-sm">MANUAL DRAG PENALTY</h4><p class="text-xs text-slate-300 mt-1">Manual compliance reduces velocity. -20% final score reduction applied.</p></div></div>

                        <!-- NEW ROADMAP GENERATOR UI -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                            
                            <!-- Standard PDF Report -->
                            <button @click="generatePDF()" class="bg-white/5 backdrop-blur-lg hover:bg-white/10 border border-white/15 text-white p-4 rounded-xl flex items-center justify-center gap-3 transition-all group">
                                <div class="bg-white/10 group-hover:bg-white/15 w-10 h-10 rounded-full flex items-center justify-center">
                                    <i class="fa-solid fa-file-pdf"></i>
                                </div>
                                <div class="text-left">
                                    <span class="block font-bold text-xs">DOWNLOAD REPORT</span>
                                    <span class="block text-[10px] text-textMuted">Standard Audit Certificate</span>
                                </div>
                            </button>

                            <!-- The New Roadmap Generator -->
                            <button @click="generateRoadmap()" class="bg-primary/10 hover:bg-primary/20 border border-primary text-primary p-4 rounded-xl flex items-center justify-center gap-3 transition-all group shadow-glow">
                                <div class="bg-primary text-dark w-10 h-10 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-map-location-dot"></i>
                                </div>
                                <div class="text-left">
                                    <span class="block font-bold text-xs">GENERATE PLAYBOOK</span>
                                    <span class="block text-[10px] opacity-80">90-Day Action Plan</span>
                                </div>
                            </button>
                        </div>


                <!-- GAP ANALYSIS CHART -->
                <div x-show="assessmentSubmitted" class="mt-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 shadow-glass">
                    <h3 class="font-mono text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-radar text-primary"></i> Gap Analysis — You vs Challenger
                    </h3>
                    <div class="h-64 flex items-center justify-center">
                        <canvas id="gapChart"></canvas>
                    </div>
                </div>

                <!-- STRATEGIC AI PROMPT BOX -->
<div x-show="assessmentSubmitted" class="mt-8 bg-white/[0.03] backdrop-blur-md border border-primary/30 p-6 rounded-xl relative overflow-hidden group">
    
    <!-- Decorative Background -->
    <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
        <i class="fa-solid fa-microchip text-9xl text-primary"></i>
    </div>

    <!-- Header -->
    <div class="flex justify-between items-center mb-4 relative z-10">
        <h3 class="font-mono text-white font-bold flex items-center gap-2">
            <i class="fa-solid fa-brain text-primary"></i> 
            STRATEGIC AI ANALYSIS
        </h3>
        <span class="text-[10px] uppercase bg-primary/20 text-primary px-2 py-1 rounded border border-primary/30 font-bold tracking-wider">
            Report Ready
        </span>
    </div>

    <!-- The Prompt Preview -->
    <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="generateAuditPrompt()"></pre>
    </div>

    <!-- Action Buttons Row -->
    <div class="flex gap-3 relative z-10">
        
        <!-- Copy Button (Generic) -->
        <button @click="
                copyToClipboard(generateAuditPrompt(), 'Strategy Prompt');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                $el.classList.add('bg-primary', 'text-dark', 'border-primary');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY FOR AI AGENT';
                    $el.classList.remove('bg-primary', 'text-dark', 'border-primary');
                }, 2000)
                " 
                class="flex-1 py-4 bg-transparent border border-primary text-primary hover:bg-primary hover:text-dark font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest group-hover:shadow-glow">
            <i class="fa-solid fa-wand-magic-sparkles"></i> COPY FOR AI AGENT
        </button>

        <!-- Reset Button -->
        <button @click="resetAssessment()" 
                class="px-6 py-4 bg-white/5 border border-white/15 text-slate-400 hover:text-white hover:bg-white/10 hover:border-white font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest">
            <i class="fa-solid fa-rotate-left"></i> RESET
        </button>
    </div>
    
    <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
        Compatible with ChatGPT, Claude, Gemini, or DeepSeek.
    </p>

</div>
                
                
                    <div class="mt-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 shadow-glow border-l-4 border-blue-400">
        <div class="flex justify-between items-start">
            <div>
                <h3 class="font-mono text-xl font-bold text-white mb-2 flex items-center">
                    <i class="fa-solid fa-globe mr-2 text-blue-400"></i>THE INDUSTRY INDEX
                </h3>
                
                <!-- State 1: Ready to Benchmark -->
                <div x-show="!percentileResult && !benchmarkLoading">
                    <p class="text-sm text-textMuted mb-3">Compare your score against the global database.</p>
                    <button @click="submitAndBenchmark()" class="px-6 py-2 bg-blue-500 hover:bg-blue-400 text-white font-mono text-sm font-bold rounded shadow-glow transition-all">
                        CALCULATE BENCHMARK
                    </button>
                </div>

                <!-- State 2: Loading -->
                <div x-show="benchmarkLoading" class="flex items-center gap-2 text-blue-400 font-mono text-sm py-2">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> CONNECTING TO SATELLITE...
                </div>

                <!-- State 3: Result -->
<template x-if="percentileResult">
    <div class="mt-2" x-transition>
        <span class="text-xs font-mono text-slate-400 uppercase tracking-widest">MARKET POSITION</span>
        <div class="text-4xl font-mono font-bold text-blue-400 my-1" x-text="percentileResult.rank"></div>
        <p class="text-sm text-white font-medium" x-text="percentileResult.msg"></p>
        <p class="text-xs text-slate-500 mt-2 font-mono">Based on <span x-text="totalBenchmarks"></span> verified audits.</p>
    </div>
</template>     
         </div>
                
            <div class="hidden md:block opacity-30">
                <i class="fa-solid fa-ranking-star text-6xl"></i>
            </div>
        </div>


                        <div class="mt-6">
                            <button @click="copyChallengeLink()" class="text-xs text-textMuted hover:text-white underline"><i class="fa-solid fa-link mr-2"></i><span x-text="copyBtnText"></span></button>
                        </div>
                    </div>
                 </div>
             </div>
            
<!-- TRANSLATOR TAB -->
            <div x-show="currentTab === 'translator'" x-cloak class="max-w-5xl mx-auto h-full flex flex-col">
                
                <!-- Header with Toggles -->
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6">
                    <h2 class="font-mono text-lg md:text-2xl font-bold text-blue-400 flex items-center">
                        <i class="fa-solid fa-language mr-2 md:mr-3"></i>The Translator
                    </h2>
                    <div class="flex space-x-4 mt-4 md:mt-0 font-mono text-sm border-b border-white/10 pb-2 md:border-0 md:pb-0">
                        <button @click="translatorView = 'dict'" 
                                :class="translatorView === 'dict' ? 'text-blue-400 border-b-2 border-blue-400' : 'text-slate-500 hover:text-white transition-colors'">
                            Dictionary
                        </button>
                        <button @click="translatorView = 'reporting'" 
                                :class="translatorView === 'reporting' ? 'text-blue-400 border-b-2 border-blue-400' : 'text-slate-500 hover:text-white transition-colors'">
                            Reporting Guide
                        </button>
                    </div>
                </div>

                <!-- VIEW 1: DICTIONARY -->
                <div x-show="translatorView === 'dict'" class="flex-1 flex flex-col">
                    <div class="mb-6 relative">
                        <input type="text" x-model="searchQuery" placeholder="Search technical or business terms..." class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded-lg py-4 pl-12 pr-4 text-white focus:outline-none focus:border-blue-400 font-mono">
                        <i class="fa-solid fa-search absolute left-4 top-5 text-slate-500"></i>
                    </div>
                    <div class="grid gap-4 pb-20">
                        <template x-for="row in filteredDictionary" :key="row.banker">
                            <div class="bg-white/5 backdrop-blur-lg border border-white/[0.08] p-5 rounded-lg hover:border-blue-400/50 transition-colors">
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div><span class="text-[10px] text-textMuted font-mono block uppercase mb-1">Banker Says</span><p class="font-bold text-white" x-text="row.banker"></p></div>
                                    <div><span class="text-[10px] text-textMuted font-mono block uppercase mb-1">Engineer Says</span><p class="font-mono text-blue-300 text-sm" x-text="row.tech"></p></div>
                                    <div class="md:border-l border-white/10 md:pl-4"><span class="text-[10px] text-primary font-mono block uppercase mb-1">True Meaning</span><p class="text-sm text-slate-300 italic" x-text="row.translation"></p></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- VIEW 2: REPORTING GUIDE -->
                <div x-show="translatorView === 'reporting'" class="pb-20 space-y-8">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-6 border-l-4 border-blue-400">
                        <h3 class="font-mono text-lg font-bold text-white mb-2">The Rosetta Stone for Board Reporting</h3>
                        <p class="text-sm text-textMuted">Never present a raw technical metric to the Board. Always translate it into a financial outcome.</p>
                    </div>

                    <div class="grid gap-6">
                        <template x-for="item in reportingData" :key="item.metric">
                            <div class="bg-dark p-5 rounded-lg border border-white/10 hover:border-blue-400 transition-colors">
                                <div class="grid md:grid-cols-12 gap-4 items-start">
                                    <div class="md:col-span-3">
                                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">IF YOU MEASURE...</span>
                                        <span class="font-mono text-sm font-bold text-blue-300" x-text="item.metric"></span>
                                    </div>
                                    <div class="hidden md:flex md:col-span-1 justify-center items-center pt-3">
                                        <i class="fa-solid fa-arrow-right text-slate-600"></i>
                                    </div>
                                    <div class="md:col-span-3">
                                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">TRANSLATE TO...</span>
                                        <span class="font-mono text-sm font-bold text-primary" x-text="item.financial"></span>
                                    </div>
                                    <div class="md:col-span-5 bg-white/5 p-3 rounded border border-white/10">
                                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">THE SCRIPT</span>
                                        <p class="text-sm italic text-slate-300 leading-relaxed">
                                            <i class="fa-solid fa-quote-left text-slate-600 text-xs mr-1"></i>
                                            <span x-text="item.script"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

            </div>

<!-- MATRIX TAB (REDESIGNED) -->
<div x-show="currentTab === 'matrix'" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <!-- Header -->
    <div class="mb-5 md:mb-8 flex flex-col md:flex-row md:items-end justify-between border-b border-white/[0.08] pb-4 md:pb-6">
        <div>
            <h2 class="font-mono text-xl md:text-3xl font-bold text-purple-400 flex items-center">
                <i class="fa-solid fa-chess-board mr-2 md:mr-3"></i>Execution Strategy Matrix
            </h2>
            <p class="text-textMuted text-xs md:text-sm mt-1.5 md:mt-2 max-w-xl">
                The "Build vs. Buy" decision framework. Don't build commodities. Don't outsource your secret sauce.
            </p>
        </div>
        <!-- Live Result Badge -->
        <div class="mt-3 md:mt-0 text-right">
            <span class="text-[9px] md:text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">STRATEGY</span>
            <div class="text-base md:text-xl font-bold text-white bg-white/5 px-3 md:px-4 py-1.5 md:py-2 rounded-lg border border-purple-500/30">
                <span x-text="getMatrixResult().strategy"></span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 mb-5 md:mb-8">
        
        <!-- Left Column: Controls -->
        <div class="lg:col-span-5 space-y-6">
            
            <!-- Y-Axis Control -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 md:p-6 rounded-xl">
                <div class="flex justify-between mb-3 md:mb-4 font-mono text-[10px] md:text-xs font-bold text-white">
                    <span>Commodity</span>
                    <span class="text-purple-400">Differentiator</span>
                </div>
                <input type="range" min="0" max="100" x-model="matrixCoords.y" 
                       class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-purple-500">
                <div class="mt-2 md:mt-3 text-right font-mono text-[10px] md:text-xs text-slate-400">
                    Strategic Importance: <span x-text="matrixCoords.y"></span>%
                </div>
                <p class="hidden md:block text-[10px] text-slate-500 mt-2 leading-relaxed">
                    <strong class="text-white">The Test:</strong> If this software disappeared tomorrow, would your customers leave you?
                </p>
            </div>

            <!-- X-Axis Control -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 md:p-6 rounded-xl">
                <div class="flex justify-between mb-3 md:mb-4 font-mono text-[10px] md:text-xs font-bold text-white">
                    <span>Simple</span>
                    <span class="text-purple-400">Complex</span>
                </div>
                <input type="range" min="0" max="100" x-model="matrixCoords.x" 
                       class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-purple-500">
                <div class="mt-2 md:mt-3 text-right font-mono text-[10px] md:text-xs text-slate-400">
                    Technical Complexity: <span x-text="matrixCoords.x"></span>%
                </div>
                <p class="hidden md:block text-[10px] text-slate-500 mt-2 leading-relaxed">
                    <strong class="text-white">The Test:</strong> Is this standard tech available off-the-shelf, or does it require specialized R&D?
                </p>
            </div>

        </div>

        <!-- Right Column: The Matrix Visual -->
        <div class="lg:col-span-7">
            <div class="bg-white/[0.03] backdrop-blur-md border border-white/10 rounded-xl relative aspect-square w-full max-w-[500px] mx-auto flex items-center justify-center overflow-hidden shadow-glass">
                
                <!-- Background Labels -->
                <div class="absolute inset-0 grid grid-cols-2 grid-rows-2 pointer-events-none">
                    <!-- Top Left: BUILD -->
                    <div class="border-r border-b border-white/[0.08]/50 p-4 relative bg-purple-500/5">
                        <span class="absolute top-4 left-4 text-xs font-bold font-mono text-purple-400">BUILD</span>
                        <span class="absolute top-8 left-4 text-[8px] text-slate-500 uppercase tracking-wider">Secret Sauce</span>
                    </div>
                    <!-- Top Right: PARTNER -->
                    <div class="border-b border-white/[0.08]/50 p-4 relative">
                        <span class="absolute top-4 right-4 text-xs font-bold font-mono text-slate-400">PARTNER</span>
                        <span class="absolute top-8 right-4 text-[8px] text-slate-500 uppercase tracking-wider text-right">Hard but Needed</span>
                    </div>
                    <!-- Bottom Left: DEPRIORITIZE -->
                    <div class="border-r border-white/[0.08]/50 p-4 relative">
                        <span class="absolute bottom-4 left-4 text-xs font-bold font-mono text-slate-600">IGNORE</span>
                        <span class="absolute bottom-8 left-4 text-[8px] text-slate-500 uppercase tracking-wider">Don't do it</span>
                    </div>
                    <!-- Bottom Right: OUTSOURCE -->
                    <div class="p-4 relative">
                        <span class="absolute bottom-4 right-4 text-xs font-bold font-mono text-slate-400">OUTSOURCE</span>
                        <span class="absolute bottom-8 right-4 text-[8px] text-slate-500 uppercase tracking-wider text-right">Commodity</span>
                    </div>
                </div>

                <!-- Center Grid Lines -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="w-full h-px bg-white/10"></div>
                    <div class="h-full w-px bg-white/10 absolute"></div>
                </div>

                <!-- The Floating Dot -->
                <div class="absolute w-6 h-6 bg-purple-500 border-2 border-white rounded-full shadow-[0_0_20px_rgba(168,85,247,0.6)] transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 ease-out z-20 flex items-center justify-center" 
                     :style="`left: ${matrixCoords.x}%; bottom: ${matrixCoords.y}%`">
                    <div class="w-1 h-1 bg-white rounded-full"></div>
                </div>

            </div>
            
            <div class="mt-4 text-center">
                <p class="text-sm text-slate-300 italic" x-text="getMatrixResult().desc"></p>
            </div>
        </div>
    </div>

    <!-- AI DECISION MEMO BOX -->
    <div class="mt-8 bg-white/[0.03] backdrop-blur-md border border-purple-500/30 p-6 rounded-xl relative overflow-hidden group">
        
        <!-- Icon -->
        <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <i class="fa-solid fa-file-signature text-9xl text-purple-500"></i>
        </div>

        <!-- Header -->
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2">
                <i class="fa-solid fa-robot text-purple-400"></i> 
                INVESTMENT COMMITTEE MEMO
            </h3>
            <span class="text-[10px] uppercase bg-purple-900/50 text-purple-400 px-2 py-1 rounded border border-purple-500/30 font-bold tracking-wider">
                <span x-text="getMatrixResult().strategy"></span> MODE
            </span>
        </div>

        <!-- Preview -->
        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="generateMatrixPrompt()"></pre>
        </div>

        <!-- Interactive Copy Button -->
        <button @click="
                copyToClipboard(generateMatrixPrompt(), 'Strategy Memo');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> DECISION LOGGED';
                $el.classList.remove('border-purple-500', 'text-purple-400', 'hover:bg-purple-400', 'hover:text-black');
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY MEMO FOR AI';
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    $el.classList.add('border-purple-500', 'text-purple-400', 'hover:bg-purple-400', 'hover:text-black');
                }, 2000)
                " 
                class="relative z-10 w-full py-4 bg-transparent border border-purple-500 text-purple-400 hover:bg-purple-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(168,85,247,0.1)] hover:shadow-[0_0_20px_rgba(168,85,247,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> COPY MEMO FOR AI
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Generates a rigorous justification for building, buying, or killing this project.
        </p>

    </div>

</div>
        <!-- COMPASS TAB (REDESIGNED) -->
<div x-show="currentTab === 'compass'" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <!-- Header Area -->
    <div class="mb-5 md:mb-8 flex flex-col md:flex-row md:items-end justify-between border-b border-white/[0.08] pb-4 md:pb-6">
        <div>
            <h2 class="font-mono text-xl md:text-3xl font-bold text-cyan-400 flex items-center">
                <i class="fa-regular fa-compass mr-2 md:mr-3"></i>The Bilingual Compass
            </h2>
            <p class="text-textMuted text-xs md:text-sm mt-1.5 md:mt-2 max-w-xl">
                Map your leadership style. Building value or cutting costs? Moving fast or minimizing risk?
            </p>
        </div>
        <!-- Live Result Badge -->
        <div class="mt-3 md:mt-0 text-right">
            <span class="text-[9px] md:text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">TRAJECTORY</span>
            <div class="text-base md:text-xl font-bold text-white bg-white/5 px-3 md:px-4 py-1.5 md:py-2 rounded-lg border border-cyan-400/30">
                <span x-text="getCompassResult().title"></span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 mb-5 md:mb-8">
        
        <!-- Left Column: The Controls -->
        <div class="lg:col-span-5 space-y-6">
            
            <!-- Axis 1 Control -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 md:p-6 rounded-xl">
                <div class="flex justify-between mb-3 md:mb-4 font-mono text-[10px] md:text-xs font-bold text-white">
                    <span>SOUTH (Cost)</span>
                    <span class="text-cyan-400">NORTH (Value)</span>
                </div>
                <input type="range" min="0" max="100" x-model="compassCoords.y" 
                       class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-cyan-400">
                <div class="mt-2 md:mt-3 text-right font-mono text-[10px] md:text-xs text-slate-400">
                    Y: <span x-text="compassCoords.y"></span>%
                </div>
                <p class="hidden md:block text-[10px] text-slate-500 mt-2 leading-relaxed">
                    <strong class="text-white">Ask yourself:</strong> Is your primary mandate to "Keep the lights on for cheap" (0%) or "Create new revenue streams" (100%)?
                </p>
            </div>

            <!-- Axis 2 Control -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 md:p-6 rounded-xl">
                <div class="flex justify-between mb-3 md:mb-4 font-mono text-[10px] md:text-xs font-bold text-white">
                    <span>WEST (Risk)</span>
                    <span class="text-cyan-400">EAST (Speed)</span>
                </div>
                <input type="range" min="0" max="100" x-model="compassCoords.x" 
                       class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-cyan-400">
                <div class="mt-2 md:mt-3 text-right font-mono text-[10px] md:text-xs text-slate-400">
                    X: <span x-text="compassCoords.x"></span>%
                </div>
                <p class="hidden md:block text-[10px] text-slate-500 mt-2 leading-relaxed">
                    <strong class="text-white">Ask yourself:</strong> Do you need 5 signatures to deploy code (0%) or do you deploy on demand (100%)?
                </p>
            </div>

        </div>

        <!-- Right Column: The Visualizer -->
        <div class="lg:col-span-7">
            <div class="bg-white/[0.03] backdrop-blur-md border border-white/10 rounded-xl relative aspect-square w-full max-w-[500px] mx-auto flex items-center justify-center overflow-hidden shadow-glass">
                
                <!-- Grid Lines -->
                <div class="absolute inset-0 grid grid-cols-2 grid-rows-2 pointer-events-none">
                    <div class="border-r border-b border-white/[0.08]/50 p-2 relative">
                        <span class="absolute top-2 left-2 text-[10px] font-mono text-slate-600">RISK TAKER (NW)</span>
                    </div>
                    <div class="border-b border-white/[0.08]/50 p-2 relative">
                        <span class="absolute top-2 right-2 text-[10px] font-mono text-cyan-400/50">LEADER (NE)</span>
                    </div>
                    <div class="border-r border-white/[0.08]/50 p-2 relative">
                        <span class="absolute bottom-2 left-2 text-[10px] font-mono text-slate-600">TRADITIONAL (SW)</span>
                    </div>
                    <div class="p-2 relative">
                        <span class="absolute bottom-2 right-2 text-[10px] font-mono text-slate-600">FACTORY (SE)</span>
                    </div>
                </div>

                <!-- Center Crosshair -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="w-full h-px bg-cyan-400/20"></div>
                    <div class="h-full w-px bg-cyan-400/20 absolute"></div>
                </div>

                <!-- The Floating Dot (Now unobscured) -->
                <div class="absolute w-6 h-6 bg-cyan-400 border-2 border-white rounded-full shadow-[0_0_20px_rgba(34,211,238,0.6)] transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 ease-out z-20 flex items-center justify-center" 
                     :style="`left: ${compassCoords.x}%; bottom: ${compassCoords.y}%`">
                    <div class="w-1 h-1 bg-white rounded-full"></div>
                </div>

                <!-- Radar Sweep Animation -->
                <div class="absolute inset-0 rounded-full border border-cyan-400/10 scale-0 animate-[ping_3s_ease-out_infinite]"></div>
                <div class="absolute inset-0 rounded-full border border-cyan-400/10 scale-0 animate-[ping_3s_ease-out_infinite_1s]"></div>

            </div>
            
            <!-- Result Description (Moved below chart) -->
            <div class="mt-4 text-center">
                <p class="text-sm text-slate-300 italic" x-text="getCompassResult().desc"></p>
            </div>
        </div>
    </div>

    <!-- NEW: AI STRATEGY BOX -->
    <div class="mt-8 bg-white/[0.03] backdrop-blur-md border border-cyan-500/30 p-6 rounded-xl relative overflow-hidden group">
        
        <!-- Decorative Icon -->
        <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <i class="fa-solid fa-map-location-dot text-9xl text-cyan-400"></i>
        </div>

        <!-- Header -->
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2">
                <i class="fa-solid fa-robot text-cyan-400"></i> 
                NAVIGATION AI STRATEGY
            </h3>
            <span class="text-[10px] uppercase bg-cyan-900/50 text-cyan-400 px-2 py-1 rounded border border-cyan-500/30 font-bold tracking-wider">
                <span x-text="compassCoords.x"></span>, <span x-text="compassCoords.y"></span>
            </span>
        </div>

        <!-- Prompt Preview -->
        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="generateCompassPrompt()"></pre>
        </div>

        <!-- Interactive Copy Button -->
        <button @click="
                copyToClipboard(generateCompassPrompt(), 'Compass Strategy');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COURSE PLOTTED (COPIED)';
                $el.classList.remove('border-cyan-500', 'text-cyan-400', 'hover:bg-cyan-400', 'hover:text-black');
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY STRATEGY FOR AI';
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    $el.classList.add('border-cyan-500', 'text-cyan-400', 'hover:bg-cyan-400', 'hover:text-black');
                }, 2000)
                " 
                class="relative z-10 w-full py-4 bg-transparent border border-cyan-500 text-cyan-400 hover:bg-cyan-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(34,211,238,0.1)] hover:shadow-[0_0_20px_rgba(34,211,238,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> COPY STRATEGY FOR AI
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Get a tailored pivot strategy to move from "<span x-text="getCompassResult().title"></span>" to Market Leader.
        </p>

    </div>

</div>

            <!-- CANVAS -->
            <div x-show="currentTab === 'canvas'" x-cloak class="max-w-4xl mx-auto"><h2 class="font-mono text-lg md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center"><i class="fa-solid fa-file-contract mr-2 md:mr-3 text-blue-400"></i>Data Product Canvas</h2><div class="grid md:grid-cols-2 gap-4 md:gap-8"><div class="space-y-3 md:space-y-4"><div><label class="text-xs font-mono text-textMuted">PRODUCT NAME</label><input type="text" x-model="canvasData.name" class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded p-2 text-white font-mono text-sm"></div><div><label class="text-xs font-mono text-textMuted">OWNER</label><input type="text" x-model="canvasData.owner" class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded p-2 text-white font-mono text-sm"></div><div><label class="text-xs font-mono text-textMuted">JOBS TO BE DONE</label><textarea x-model="canvasData.jobs" class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded p-2 text-white font-mono text-sm h-16 md:h-20"></textarea></div><div><label class="text-xs font-mono text-textMuted">SLO: FRESHNESS</label><input type="text" x-model="canvasData.slo1" class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded p-2 text-white font-mono text-sm"></div></div><div class="bg-white text-dark p-4 md:p-6 rounded-lg shadow-glass relative font-sans"><div class="absolute top-0 left-0 w-full h-2 bg-blue-500 rounded-t-lg"></div><div class="flex justify-between items-start mb-4 md:mb-6 mt-2"><div class="min-w-0 flex-1"><h3 class="font-bold text-lg md:text-2xl uppercase tracking-tighter truncate" x-text="canvasData.name || 'PRODUCT NAME'"></h3><p class="text-[10px] md:text-xs text-slate-500 font-mono mt-1">OWNER: <span x-text="canvasData.owner || '---'"></span></p></div><div class="bg-blue-100 text-blue-800 text-[10px] md:text-xs font-bold px-1.5 md:px-2 py-0.5 md:py-1 rounded shrink-0 ml-2">CERTIFIED</div></div><div class="grid grid-cols-2 gap-3 md:gap-4 mb-4"><div class="border border-slate-200 p-2 md:p-3 rounded"><p class="text-[9px] md:text-[10px] text-slate-400 font-bold uppercase mb-1">CONSUMER JOB</p><p class="text-xs md:text-sm font-medium leading-tight" x-text="canvasData.jobs || '---'"></p></div><div class="border border-slate-200 p-2 md:p-3 rounded bg-slate-50"><p class="text-[9px] md:text-[10px] text-slate-400 font-bold uppercase mb-1">GUARANTEE (SLO)</p><ul class="text-xs md:text-sm font-mono space-y-1"><li class="flex items-center"><i class="fa-solid fa-clock mr-1.5 md:mr-2 text-blue-500"></i> <span x-text="canvasData.slo1 || '---'"></span></li></ul></div></div></div></div></div>

        <!-- TALENT RADAR (Your Fixed Layout) -->
<div x-show="currentTab === 'talent'" x-cloak class="max-w-6xl mx-auto w-full pb-10">
    
    <!-- Compact Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-5 md:mb-8 border-b border-white/[0.08] pb-4 md:pb-6">
        <div class="mb-3 md:mb-0">
            <h2 class="font-mono text-xl md:text-3xl font-bold text-hotpink flex items-center mb-1 md:mb-2">
                <i class="fa-solid fa-fingerprint mr-2 md:mr-3"></i>Talent Radar
            </h2>
            <p class="hidden md:block text-textMuted text-sm max-w-2xl leading-relaxed">
                "We don't look for a 3/5 Mediocre Generalist. We look for <strong class="text-white">Spiky Profiles</strong>."
            </p>
        </div>
        <!-- Archetype Badge -->
        <div class="w-full md:w-auto">
             <div class="px-3 md:px-4 py-2 md:py-3 rounded bg-white/5 border border-white/10 flex items-center justify-between gap-2 md:gap-3 shadow-lg">
                <span class="text-[9px] md:text-[10px] uppercase font-mono text-slate-500">Shape</span>
                <div class="flex items-center gap-1.5 md:gap-2">
                    <span class="font-bold text-white text-xs md:text-sm" x-text="talentManager.getArchetype(talentSkills).label"></span>
                    <i :class="talentManager.getArchetype(talentSkills).icon" class="text-hotpink"></i>
                </div>
             </div>
        </div>
    </div>

    <!-- Grid Layout -->
    <div class="flex flex-col lg:grid lg:grid-cols-12 gap-4 md:gap-6 md:gap-8">
        
        <!-- CHART (Top on Mobile) -->
        <div class="order-1 lg:order-2 lg:col-span-5 flex flex-col gap-6">
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl shadow-glass relative overflow-hidden">
                <!-- UPDATED CHART CONTAINER -->
                <div class="h-56 md:h-64 w-full flex items-center justify-center relative z-10">
                    <canvas id="talentChart" width="400" height="400"></canvas>
                </div>
            </div>
            <!-- NEW DYNAMIC PROMPT AREA (Replaces Desktop Button) -->
<div class="mt-4 md:mt-6 bg-white/[0.03] backdrop-blur-md border border-white/10 p-4 md:p-6 rounded-xl relative overflow-hidden group">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-3 md:mb-4">
        <h3 class="font-mono text-white text-sm md:text-base font-bold flex items-center gap-1.5 md:gap-2">
            <i class="fa-solid fa-robot text-hotpink"></i> 
            <span class="hidden sm:inline">AI CO-PILOT PROMPT</span><span class="sm:hidden">AI PROMPT</span>
        </h3>
        <span class="text-[9px] md:text-[10px] uppercase bg-hotpink/20 text-hotpink px-1.5 md:px-2 py-0.5 md:py-1 rounded border border-hotpink/30 shrink-0">
            Your Radar
        </span>
    </div>

    <!-- Preview Text (Truncated) -->
    <div class="font-mono text-[10px] md:text-xs text-slate-400 bg-black/40 backdrop-blur-sm p-3 md:p-4 rounded border border-white/[0.08] mb-3 md:mb-4 h-20 md:h-24 overflow-hidden relative">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
        <pre class="whitespace-pre-wrap font-sans" x-text="talentManager.generateSystemPrompt(talentSkills)"></pre>
    </div>

    <!-- Interactive Copy Button -->
    <button @click="
            copyToClipboard(talentManager.generateSystemPrompt(talentSkills), 'AI Coach Prompt');
            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
            setTimeout(() => $el.innerHTML = '<i class=\'fa-solid fa-copy\'></i> COPY PROMPT FOR CHATGPT', 2000)
            " 
            class="w-full py-3 md:py-4 bg-hotpink hover:bg-pink-600 text-white font-bold rounded-lg transition-all shadow-glow-vip flex items-center justify-center gap-2 font-mono text-[10px] md:text-xs uppercase tracking-widest">
        <i class="fa-regular fa-copy"></i> COPY PROMPT FOR CHATGPT
    </button>
    
    <p class="text-center text-[9px] md:text-[10px] text-slate-500 mt-2 md:mt-3">
        Paste into ChatGPT, Claude, or Gemini for a personalized career strategy.
    </p>

</div>
        </div>

        <!-- SLIDERS (Bottom on Mobile) -->
        <div class="order-2 lg:order-1 lg:col-span-7 space-y-4 md:space-y-6">
            <template x-for="(skill, idx) in talentSkills" :key="idx">
                <div class="bg-card/50 p-4 rounded-xl border border-white/10 active:border-hotpink/50 transition-colors relative overflow-hidden">
                    <div class="absolute right-0 top-0 bottom-0 bg-hotpink/5 transition-all duration-500 pointer-events-none" :style="`width: ${(skill.val / 5) * 100}%`"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-4">
                            <label class="font-mono text-xs md:text-sm font-bold text-white uppercase tracking-wider flex items-center gap-2">
                                <i :class="skill.icon" class="text-slate-500 w-5 text-center"></i>
                                <span x-text="skill.label"></span>
                            </label>
                            <span class="font-mono font-bold text-lg" :class="skill.val >= 4 ? 'text-hotpink' : (skill.val <= 2 ? 'text-slate-500' : 'text-white')" x-text="skill.val + '/5'"></span>
                        </div>
                        <div class="relative h-8 mb-2 flex items-center">
                            <!-- UPDATED INPUT WITH PROPER EVENT HANDLERS -->
                            <input type="range" 
                                   min="1" 
                                   max="5" 
                                   step="1" 
                                   x-model.number="skill.val" 
                                   @change="updateTalentChart()"
                                   @input="updateTalentChart()"
                                   class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer z-20 relative">
                        </div>
                        <div class="min-h-[2.5em]">
                            <p class="text-xs text-slate-300 italic leading-relaxed">"<span x-text="talentManager.getBehavior(idx, skill.val)"></span>"</p>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- LIGHTHOUSE TAB (REDESIGNED) -->
<div x-show="currentTab === 'lighthouse'" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <!-- Header -->
    <div class="mb-5 md:mb-8 flex flex-col md:flex-row md:items-end justify-between border-b border-white/[0.08] pb-4 md:pb-6">
        <div>
            <h2 class="font-mono text-xl md:text-3xl font-bold text-warn flex items-center">
                <i class="fa-solid fa-lightbulb mr-2 md:mr-3"></i>Lighthouse Kit
            </h2>
            <p class="text-textMuted text-xs md:text-sm mt-1.5 md:mt-2 max-w-xl">
                The "Definition of Ready" for digital initiatives. Verify all 10 signals or risk building a legacy silo.
            </p>
        </div>
        <!-- Live Counter -->
        <div class="mt-3 md:mt-0 text-right">
            <span class="text-[9px] md:text-[10px] font-mono text-slate-500 uppercase tracking-widest block mb-1">READINESS</span>
            <div class="text-xl md:text-2xl font-bold font-mono" :class="lighthouseCount === 10 ? 'text-primary' : (lighthouseCount >= 8 ? 'text-warn' : 'text-risk')">
                <span x-text="lighthouseCount"></span>/10
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 mb-5 md:mb-8">
        
        <!-- Left Column: The Checklist (Launch Controls) -->
        <div class="lg:col-span-7 space-y-3">
            <template x-for="(item, index) in lighthouseData" :key="index">
                <label class="group relative flex items-center justify-between p-4 rounded-xl border transition-all cursor-pointer select-none"
                       :class="item.checked ? 'bg-white/[0.07] border-warn/50 shadow-[0_0_10px_rgba(251,191,36,0.1)]' : 'bg-white/5 backdrop-blur-lg border-white/10 hover:border-white/20'">
                    
                    <div class="flex items-center gap-4">
                        <!-- Custom Checkbox UI -->
                        <div class="w-6 h-6 rounded border flex items-center justify-center transition-colors"
                             :class="item.checked ? 'bg-warn border-warn text-black' : 'bg-dark border-white/15 text-transparent'">
                            <i class="fa-solid fa-check text-xs font-bold"></i>
                        </div>
                        
                        <div>
                            <span class="text-[10px] font-mono uppercase tracking-widest block mb-0.5" 
                                  :class="item.checked ? 'text-warn' : 'text-slate-500'" 
                                  x-text="item.category"></span>
                            <span class="text-sm font-bold transition-colors"
                                  :class="item.checked ? 'text-white' : 'text-slate-300'"
                                  x-text="item.text"></span>
                        </div>
                    </div>

                    <!-- Hidden Input -->
                    <input type="checkbox" x-model="item.checked" class="hidden">
                    
                    <!-- Glow Effect -->
                    <div class="absolute right-4 w-2 h-2 rounded-full transition-all duration-500"
                         :class="item.checked ? 'bg-warn shadow-[0_0_10px_#fbbf24]' : 'bg-white/10'"></div>
                </label>
            </template>
        </div>

        <!-- Right Column: The Signal Tower (Visualizer) -->
        <div class="lg:col-span-5">
            <div class="sticky top-6">
                <!-- Status Card -->
                <div class="bg-white/[0.03] backdrop-blur-md border-2 rounded-xl p-5 md:p-8 text-center shadow-glass relative overflow-hidden transition-all duration-500"
                     :class="getLighthouseStatus().border">
                    
                    <!-- Background Glow -->
                    <div class="absolute inset-0 opacity-20 transition-colors duration-500" :class="getLighthouseStatus().bg"></div>

                    <!-- Big Icon -->
                    <div class="relative z-10 mb-4 md:mb-6 transition-transform duration-500" :class="lighthouseCount === 10 ? 'scale-110' : ''">
                        <i class="fa-solid fa-tower-broadcast text-4xl md:text-6xl transition-colors duration-300" :class="getLighthouseStatus().text"></i>
                    </div>

                    <!-- Status Text -->
                    <h3 class="relative z-10 font-mono text-xl md:text-3xl font-bold mb-2 transition-colors duration-300" 
                        :class="getLighthouseStatus().text" 
                        x-text="getLighthouseStatus().title"></h3>
                    
                    <p class="relative z-10 text-slate-300 text-xs md:text-sm italic" x-text="getLighthouseStatus().desc"></p>

                    <!-- Progress Bar -->
                    <div class="relative z-10 mt-5 md:mt-8 w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-700 ease-out"
                             :class="getLighthouseStatus().text.replace('text-', 'bg-')"
                             :style="`width: ${(lighthouseCount / 10) * 100}%`"></div>
                    </div>
                </div>

                <!-- Helper Text -->
                <div class="mt-6 bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-lg">
                    <h4 class="text-xs font-mono text-white font-bold mb-2"><i class="fa-solid fa-circle-info mr-2 text-slate-500"></i>RULES OF ENGAGEMENT</h4>
                    <ul class="text-xs text-slate-400 space-y-2 list-disc list-inside">
                        <li><span class="text-primary">10/10</span> = Approved for production funding.</li>
                        <li><span class="text-warn">8/10</span> = Approved for "Alpha" only. Waiver needed.</li>
                        <li><span class="text-risk">&lt; 8/10</span> = Back to the drawing board.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- AI LAUNCH MEMO BOX -->
    <div class="mt-8 bg-white/[0.03] backdrop-blur-md border border-warn/30 p-6 rounded-xl relative overflow-hidden group">
        
        <!-- Icon -->
        <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <i class="fa-solid fa-rocket text-9xl text-warn"></i>
        </div>

        <!-- Header -->
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2">
                <i class="fa-solid fa-robot text-warn"></i> 
                LAUNCH DECISION MEMO
            </h3>
            <span class="text-[10px] uppercase bg-yellow-900/50 text-warn px-2 py-1 rounded border border-warn/30 font-bold tracking-wider">
                <span x-text="getLighthouseStatus().title"></span> PHASE
            </span>
        </div>

        <!-- Preview -->
        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="generateLighthousePrompt()"></pre>
        </div>

        <!-- Interactive Copy Button -->
        <button @click="
                copyToClipboard(generateLighthousePrompt(), 'Launch Memo');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> MEMO GENERATED';
                $el.classList.remove('border-warn', 'text-warn', 'hover:bg-warn', 'hover:text-black');
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY MEMO FOR AI';
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    $el.classList.add('border-warn', 'text-warn', 'hover:bg-warn', 'hover:text-black');
                }, 2000)
                " 
                class="relative z-10 w-full py-4 bg-transparent border border-warn text-warn hover:bg-warn hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(251,191,36,0.1)] hover:shadow-[0_0_20px_rgba(251,191,36,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> COPY MEMO FOR AI
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Generates a Go/No-Go decision document based on your missing criteria.
        </p>

    </div>

</div>
        
            <!-- BOARD -->
            <div x-show="currentTab === 'board'" x-cloak class="max-w-4xl mx-auto"><h2 class="font-mono text-lg md:text-2xl font-bold mb-4 md:mb-6 text-risk flex items-center"><i class="fa-solid fa-chess-king mr-2 md:mr-3"></i>Board Director's Guide</h2><div class="space-y-4 md:space-y-6"><template x-for="risk in boardRisks" :key="risk.title"><div class="bg-white/5 backdrop-blur-lg border border-white/10 border-l-4 border-l-risk rounded-r-xl overflow-hidden"><div class="bg-risk/10 p-3 md:p-4 border-b border-white/10"><h3 class="font-mono font-bold text-risk text-sm md:text-base" x-text="risk.title"></h3><p class="text-white font-bold text-sm md:text-base" x-text="risk.subtitle"></p></div><div class="p-4 md:p-6 grid md:grid-cols-2 gap-4 md:gap-8"><div><div class="mb-3 md:mb-4"><span class="text-[9px] md:text-[10px] font-mono text-risk bg-risk/10 px-1.5 md:px-2 py-0.5 md:py-1 rounded">THE LIE</span><p class="mt-1.5 md:mt-2 text-slate-300 italic text-xs md:text-sm" x-text="risk.lie"></p></div><div><span class="text-[9px] md:text-[10px] font-mono text-primary bg-primary/10 px-1.5 md:px-2 py-0.5 md:py-1 rounded">THE TRUTH</span><p class="mt-1.5 md:mt-2 text-white font-medium text-xs md:text-sm" x-text="risk.truth"></p></div></div><div class="bg-dark p-3 md:p-4 rounded border border-white/10 flex flex-col justify-center"><span class="text-[9px] md:text-[10px] font-mono text-slate-500 mb-1.5 md:mb-2 uppercase">Question for the CEO</span><p class="font-mono text-xs md:text-sm text-primary leading-relaxed"><i class="fa-solid fa-quote-left text-slate-600 mr-1.5 md:mr-2"></i><span x-text="risk.question"></span></p></div></div></div></template></div></div>

            <!-- REPAIR -->
            <div x-show="currentTab === 'repair'" x-cloak class="max-w-4xl mx-auto"><h2 class="font-mono text-lg md:text-2xl font-bold mb-4 md:mb-6 text-risk flex items-center"><i class="fa-solid fa-toolbox mr-2 md:mr-3"></i>Repair Kit</h2><div class="space-y-3 md:space-y-4"><template x-for="(item, index) in repairKitData" :key="index"><div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden"><button @click="activeRepair = activeRepair === index ? null : index" class="w-full flex justify-between items-center p-3.5 md:p-5 text-left hover:bg-white/10 transition-colors"><div class="min-w-0 flex-1"><span class="font-mono text-[9px] md:text-[10px] text-risk mb-0.5 md:mb-1 block">SYMPTOM</span><span class="font-bold text-sm md:text-lg text-slate-200" x-text="item.symptom"></span></div><i class="fa-solid fa-chevron-down text-slate-500 transition-transform duration-300 shrink-0 ml-2" :class="activeRepair === index ? 'rotate-180' : ''"></i></button><div x-show="activeRepair === index" x-collapse><div class="p-3.5 md:p-5 border-t border-white/10 bg-dark/30"><div class="mb-3 md:mb-4"><h4 class="font-mono text-primary text-xs font-bold mb-1.5 md:mb-2">// DIAGNOSIS</h4><p class="text-slate-300 text-xs md:text-sm" x-text="item.diagnosis"></p></div><div class="p-3 md:p-4 bg-white/5 rounded border-l-2 border-primary"><h4 class="font-mono text-white text-xs font-bold mb-1.5 md:mb-2">RX: PRESCRIPTION</h4><ul class="list-disc list-inside text-slate-400 text-xs md:text-sm space-y-1"><template x-for="step in item.prescription" :key="step"><li x-text="step"></li></template></ul></div></div></div></div></template></div></div>
            
            <!-- GLOSSARY -->
            <div x-show="currentTab === 'glossary'" x-cloak class="max-w-4xl mx-auto"><h2 class="font-mono text-lg md:text-2xl font-bold mb-4 md:mb-6 text-purple-400 flex items-center"><i class="fa-solid fa-book-open mr-2 md:mr-3"></i>Glossary</h2><div class="mb-4 md:mb-6"><input type="text" x-model="glossarySearch" placeholder="Filter terms..." class="w-full bg-white/5 backdrop-blur-lg border border-white/10 rounded-lg py-2.5 md:py-3 px-3 md:px-4 text-sm text-white focus:outline-none focus:border-purple-400 font-mono"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 pb-20"><template x-for="term in filteredGlossary" :key="term.term"><div class="bg-white/5 backdrop-blur-lg border border-white/10 p-3.5 md:p-5 rounded-lg hover:border-purple-400/50 transition-colors"><h3 class="font-mono text-primary font-bold mb-1.5 md:mb-2 text-sm md:text-base" x-text="term.term"></h3><p class="text-xs md:text-sm text-slate-300 leading-relaxed" x-text="term.def"></p></div></template></div></div>

            <!-- RESOURCES -->
            <div x-show="currentTab === 'resources'" x-cloak class="max-w-4xl mx-auto"><h2 class="font-mono text-lg md:text-2xl font-bold mb-4 md:mb-6 text-green-300 flex items-center"><i class="fa-solid fa-book-bookmark mr-2 md:mr-3"></i>Resources</h2><div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-4 md:p-6"><ul class="space-y-3 md:space-y-4"><li class="p-3 md:p-4 border-b border-white/10 last:border-0"><h4 class="text-white font-bold text-sm md:text-base">Project to Product (Mik Kersten)</h4><p class="text-xs md:text-sm text-textMuted">Definitive guide to the "Flow Framework".</p></li><li class="p-3 md:p-4 border-b border-white/10 last:border-0"><h4 class="text-white font-bold text-sm md:text-base">Team Topologies (Skelton & Pais)</h4><p class="text-xs md:text-sm text-textMuted">Blueprint for structuring squads.</p></li><li class="p-3 md:p-4 border-b border-white/10 last:border-0"><h4 class="text-white font-bold text-sm md:text-base">Sooner Safer Happier (Jonathan Smart)</h4><p class="text-xs md:text-sm text-textMuted">Agile for regulated banks.</p></li><li class="p-3 md:p-4 border-b border-white/10 last:border-0"><h4 class="text-white font-bold text-sm md:text-base">Data Mesh (Zhamak Dehghani)</h4><p class="text-xs md:text-sm text-textMuted">Data as a Product.</p></li></ul></div></div>

          <!-- KPI DESIGNER TAB -->
<div x-show="currentTab === 'kpi'" x-data="kpiDesignerComponent" x-cloak class="max-w-3xl mx-auto">
    
    <div class="text-center mb-5 md:mb-8">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Outcome Generator</h2>
        <p class="text-textMuted text-xs md:text-sm">Don't write the prompt. Let the machine build the prompt.</p>
    </div>

    <!-- MAIN CARD -->
    <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl p-4 md:p-8 relative overflow-hidden shadow-glass min-h-[350px] md:min-h-[450px] flex flex-col">
        
        <!-- Progress Bar (Visible only on Steps 1-4) -->
        <div x-show="$data.step < 5" class="flex gap-2 mb-8">
            <template x-for="i in 4" :key="i">
                <div class="h-1 flex-1 rounded-full transition-all duration-500" 
                     :class="$data.step >= i ? 'bg-green-500' : 'bg-white/10'"></div>
            </template>
        </div>

        <!-- STEP 1: THE PROJECT (Output) -->
        <div x-show="$data.step === 1" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-x-10" x-transition:enter-end="opacity-100 translate-x-0">
            <label class="block text-xs font-mono text-green-400 font-bold uppercase mb-2">Step 1/4: The Output</label>
            <h3 class="text-xl font-bold text-white mb-4">What are you being asked to build?</h3>
            <input type="text" x-model="$data.form.project" @keydown.enter="$data.next()"
                   placeholder="e.g. A new Mobile Banking App" 
                   class="w-full bg-dark border border-white/15 rounded p-4 text-white focus:border-green-400 focus:outline-none mb-6">
            
            <div class="grid grid-cols-2 gap-3">
                <template x-for="(preset, idx) in $data.presets" :key="idx">
                    <button @click="$data.quickFill(preset)" class="text-left text-xs p-3 rounded border border-white/10 bg-white/5 hover:border-green-500 hover:text-white text-slate-400 transition-all">
                        <span class="block font-bold text-white" x-text="preset.label"></span>
                        <span class="opacity-50 text-[10px]">Autofill Demo</span>
                    </button>
                </template>
            </div>
        </div>

        <!-- STEP 2: THE WHO (User) -->
        <div x-show="$data.step === 2" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-x-10" x-transition:enter-end="opacity-100 translate-x-0">
            <label class="block text-xs font-mono text-green-400 font-bold uppercase mb-2">Step 2/4: The Customer</label>
            <h3 class="text-xl font-bold text-white mb-4">Who is going to use this?</h3>
            <p class="text-xs text-slate-400 mb-4">Be specific. "Everyone" is the wrong answer.</p>
            <input type="text" x-model="$data.form.who" @keydown.enter="$data.next()"
                   placeholder="e.g. Small Business Owners needing cashflow" 
                   class="w-full bg-dark border border-white/15 rounded p-4 text-white focus:border-green-400 focus:outline-none">
        </div>

        <!-- STEP 3: THE PAIN (Problem) -->
        <div x-show="$data.step === 3" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-x-10" x-transition:enter-end="opacity-100 translate-x-0">
            <label class="block text-xs font-mono text-green-400 font-bold uppercase mb-2">Step 3/4: The Friction</label>
            <h3 class="text-xl font-bold text-white mb-4">Why do they hate the current process?</h3>
            <textarea x-model="$data.form.pain" 
                      placeholder="e.g. It takes 3 weeks to get approved and they have to fax documents." 
                      class="w-full h-32 bg-dark border border-white/15 rounded p-4 text-white focus:border-green-400 focus:outline-none"></textarea>
        </div>

        <!-- STEP 4: THE VALUE (Goal) -->
        <div x-show="$data.step === 4" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-x-10" x-transition:enter-end="opacity-100 translate-x-0">
            <label class="block text-xs font-mono text-green-400 font-bold uppercase mb-2">Step 4/4: The Business Value</label>
            <h3 class="text-xl font-bold text-white mb-4">What does the Bank get out of this?</h3>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <button @click="$data.form.value = 'Reduce Cost to Serve'" :class="$data.form.value === 'Reduce Cost to Serve' ? 'bg-green-600 text-white' : 'bg-white/10 text-slate-400'" class="p-3 rounded border border-white/15 text-xs font-bold transition-all">Reduce Cost</button>
                <button @click="$data.form.value = 'Increase Revenue / Sales'" :class="$data.form.value === 'Increase Revenue / Sales' ? 'bg-green-600 text-white' : 'bg-white/10 text-slate-400'" class="p-3 rounded border border-white/15 text-xs font-bold transition-all">Increase Revenue</button>
                <button @click="$data.form.value = 'Reduce Compliance Risk'" :class="$data.form.value === 'Reduce Compliance Risk' ? 'bg-green-600 text-white' : 'bg-white/10 text-slate-400'" class="p-3 rounded border border-white/15 text-xs font-bold transition-all">Reduce Risk</button>
                <button @click="$data.form.value = 'Increase Velocity (Speed)'" :class="$data.form.value === 'Increase Velocity (Speed)' ? 'bg-green-600 text-white' : 'bg-white/10 text-slate-400'" class="p-3 rounded border border-white/15 text-xs font-bold transition-all">Increase Speed</button>
            </div>
            <input type="text" x-model="$data.form.value" placeholder="Or type custom value..." class="w-full bg-dark border border-white/15 rounded p-3 text-white text-sm focus:border-green-400 focus:outline-none">
        </div>

        <!-- STEP 5: THE RESULT (The Prompt) -->
        <div x-show="$data.step === 5" x-transition:enter="transition ease-out duration-500 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0" class="h-full flex flex-col">
            
            <div x-show="$data.loading" class="flex-1 flex flex-col items-center justify-center text-green-400">
                <i class="fa-solid fa-circle-notch fa-spin text-4xl mb-4"></i>
                <p class="font-mono text-xs">ENGINEERING PROMPT...</p>
            </div>

            <div x-show="!$data.loading" class="flex-1 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-white text-lg"><i class="fa-solid fa-robot mr-2 text-green-400"></i>Prompt Generated</h3>
                    <button @click="$data.reset()" class="text-xs text-slate-500 hover:text-white">Start Over</button>
                </div>

                <div class="bg-black p-4 rounded-lg border-l-4 border-green-500 flex-1 overflow-y-auto max-h-[300px] font-mono text-xs text-slate-300 whitespace-pre-wrap leading-relaxed shadow-inner" x-text="$data.generatedPrompt"></div>

                <button @click="$data.copyPrompt()" class="mt-6 w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-lg shadow-glow transition-all flex items-center justify-center gap-2 group">
                    <i class="fa-regular fa-copy group-hover:scale-110 transition-transform"></i> COPY TO CLIPBOARD
                </button>
                <p class="text-center text-[10px] text-slate-500 mt-2">Ready to paste into ChatGPT / Claude / Gemini.</p>
            </div>
        </div>

        <!-- NAV BUTTONS (Bottom) -->
        <div x-show="$data.step < 5" class="mt-auto pt-8 flex justify-between border-t border-white/10">
            <button @click="$data.back()" x-show="$data.step > 1" class="text-slate-400 hover:text-white text-sm font-mono flex items-center gap-2">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <div x-show="$data.step === 1"></div> <!-- Spacer -->
            
            <button @click="$data.step === 4 ? $data.generate() : $data.next()" 
                    class="bg-white hover:bg-white/90 text-dark font-bold px-6 py-2 rounded-lg text-sm transition-all flex items-center gap-2">
                <span x-text="$data.step === 4 ? 'GENERATE PROMPT' : 'NEXT'"></span>
                <i class="fa-solid" :class="$data.step === 4 ? 'fa-wand-magic-sparkles' : 'fa-arrow-right'"></i>
            </button>
        </div>

    </div>
</div>

        <!-- SQUAD BUILDER TAB (REDESIGNED) -->
<div x-show="currentTab === 'squad'" x-data="squadBuilderComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-indigo-400 mb-2">Bilingual Squad Designer</h2>
        <p class="text-textMuted text-xs md:text-sm">Optimize for Flow, not Headcount. Respect Brooks' Law.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-6 items-start">
        
        <!-- LEFT: THE BENCH (Select Roles) -->
        <div class="lg:col-span-3 bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl h-fit">
            <h3 class="font-mono text-xs text-slate-400 uppercase mb-4 pl-2 tracking-widest">Available Talent</h3>
            <div class="space-y-2">
                <template x-for="role in $data.catalog" :key="role.id">
                    <button @click="$data.addRole(role)" 
                            class="w-full flex items-center p-3 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 hover:border-indigo-400 transition-all text-left group relative overflow-hidden">
                        <!-- Icon -->
                        <div class="w-8 h-8 rounded bg-dark flex items-center justify-center text-slate-300 group-hover:text-white mr-3 shrink-0">
                            <i :class="'fa-solid ' + role.icon"></i>
                        </div>
                        <!-- Text -->
                        <div class="flex-1 min-w-0">
                            <div class="text-xs font-bold text-white truncate" x-text="role.title"></div>
                            <div class="flex gap-1 mt-1">
                                <!-- Mini Stat Bars -->
                                <div class="h-1 bg-blue-500 rounded" :style="`width: ${role.tech * 5}px`" title="Tech"></div>
                                <div class="h-1 bg-green-500 rounded" :style="`width: ${role.biz * 5}px`" title="Biz"></div>
                            </div>
                        </div>
                        <i class="fa-solid fa-plus text-slate-500 group-hover:text-indigo-400 ml-2"></i>
                    </button>
                </template>
            </div>
        </div>

        <!-- CENTER: THE FIELD (Active Roster) -->
        <div class="lg:col-span-5">
            <div class="bg-dark border-2 border-dashed border-white/10 rounded-xl p-4 min-h-[500px] relative flex flex-col">
                
                <!-- Roster Header -->
                <div class="flex justify-between items-center mb-4 pb-2 border-b border-white/10">
                    <h3 class="font-mono text-xs text-indigo-400 uppercase">Active Roster</h3>
                    <span class="text-xs font-mono" :class="$data.roster.length > 8 ? 'text-red-400' : 'text-slate-400'">
                        <span x-text="$data.roster.length"></span>/12 Members
                    </span>
                </div>

                <!-- Empty State -->
                <div x-show="$data.roster.length === 0" class="flex-1 flex flex-col items-center justify-center text-slate-600 pointer-events-none">
                    <div class="w-20 h-20 rounded-full border-2 border-dashed border-white/10 flex items-center justify-center mb-4">
                        <i class="fa-solid fa-users text-2xl"></i>
                    </div>
                    <p class="text-xs font-mono">Squad is empty.</p>
                </div>

                <!-- The Grid of Heads -->
                <div class="grid grid-cols-2 gap-2 content-start">
                    <template x-for="member in $data.roster" :key="member.uid">
                        <div class="flex items-center p-2 rounded bg-white/5 border border-white/15 animate-[fadeIn_0.3s]">
                            <i :class="'fa-solid ' + member.icon + ' text-slate-400 mr-2 text-xs'"></i>
                            <span class="text-xs text-white font-bold truncate flex-1" x-text="member.title"></span>
                            <button @click="$data.removeRole(member.uid)" class="text-slate-600 hover:text-red-400 px-1">
                                <i class="fa-solid fa-xmark text-xs"></i>
                            </button>
                        </div>
                    </template>
                </div>

                <!-- Footer Actions -->
                <div class="mt-auto pt-4 flex justify-center">
                    <button x-show="$data.roster.length > 0" @click="$data.reset()" class="text-[10px] text-red-400 hover:text-red-300 underline">
                        CLEAR SQUAD
                    </button>
                </div>
            </div>
        </div>

        <!-- RIGHT: TELEMETRY (Math Output) -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Main Status Card -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest mb-1">SYSTEM DIAGNOSIS</p>
                <h3 class="text-2xl font-bold font-mono uppercase mb-4" :class="$data.stats.statusColor" x-text="$data.stats.status"></h3>
                
                <!-- Velocity Meter -->
                <div class="mb-4">
                    <div class="flex justify-between text-xs text-slate-300 mb-1">
                        <span>Raw Velocity</span>
                        <span class="font-mono text-white" x-text="$data.stats.velocity"></span>
                    </div>
                    <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="bg-indigo-500 h-full transition-all duration-500" :style="`width: ${Math.min(100, $data.stats.velocity)}%`"></div>
                    </div>
                </div>

                <!-- Friction/Overhead Meter (The Inverse) -->
                <div class="mb-4">
                    <div class="flex justify-between text-xs text-slate-300 mb-1">
                        <span>Comm. Overhead (Brooks' Law)</span>
                        <span class="font-mono text-red-400" x-text="'-' + $data.stats.overhead"></span>
                    </div>
                    <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="bg-red-500/80 h-full transition-all duration-500" :style="`width: ${Math.min(100, $data.stats.overhead * 2)}%`"></div>
                    </div>
                </div>

                <!-- Alignment Meter -->
                <div>
                    <div class="flex justify-between text-xs text-slate-300 mb-1">
                        <span>Biz/Tech Alignment</span>
                        <span class="font-mono text-white" x-text="$data.stats.alignment + '%'"></span>
                    </div>
                    <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-500" 
                             :class="$data.stats.alignment > 60 ? 'bg-green-500' : 'bg-yellow-500'" 
                             :style="`width: ${$data.stats.alignment}%`"></div>
                    </div>
                </div>
            </div>

            <!-- AI Prompt Box -->
            <div x-show="$data.roster.length > 0" x-transition class="bg-white/[0.03] backdrop-blur-md border border-indigo-500/30 p-5 rounded-xl group relative overflow-hidden">
                <div class="absolute top-0 right-0 p-3 opacity-10 pointer-events-none"><i class="fa-solid fa-robot text-6xl text-indigo-500"></i></div>
                
                <h4 class="font-mono text-xs text-indigo-400 font-bold uppercase mb-2">Simulation Engine</h4>
                <p class="text-[10px] text-slate-400 mb-4">Run a "Pre-Mortem" on this specific team composition to see how it fails.</p>
                
                <button @click="
                        copyToClipboard($data.generateSquadPrompt(), 'Simulation Config');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                        setTimeout(() => {
                            $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY SIMULATION PROMPT';
                            $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                        }, 2000)
                        " 
                        class="w-full py-3 bg-transparent border border-indigo-500 text-indigo-400 hover:bg-indigo-500 hover:text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2 font-mono text-[10px] uppercase tracking-widest shadow-[0_0_10px_rgba(99,102,241,0.1)] hover:shadow-[0_0_15px_rgba(99,102,241,0.4)]">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> COPY SIMULATION PROMPT
                </button>
            </div>

        </div>
    </div>
</div>

        <!-- EXCEL CALCULATOR TAB (REDESIGNED) -->
<div x-show="currentTab === 'excel'" x-data="excelCalcComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-green-400 mb-2">The "Excel Factory" Auditor</h2>
        <p class="text-textMuted text-xs md:text-sm">Turn hidden manual work into a quantitative business case for automation.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: INPUTS -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <h3 class="font-mono text-xs text-slate-400 uppercase border-b border-white/10 pb-2 tracking-widest">Process Parameters</h3>
            
            <!-- Name -->
            <div>
                <label class="block text-xs font-bold text-white mb-1">Process Name</label>
                <input type="text" x-model="$data.inputs.process_name" placeholder="e.g. Monthly Reg Report" class="w-full bg-dark border border-white/15 rounded p-2 text-white focus:border-green-500 focus:outline-none">
            </div>

            <!-- Steps Slider -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-bold text-white">Manual Actions (Copy/Pastes)</label>
                    <span class="font-mono text-xs text-green-400" x-text="$data.inputs.steps"></span>
                </div>
                <input type="range" min="5" max="200" step="5" x-model="$data.inputs.steps" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-green-500">
                <p class="text-[10px] text-slate-500 mt-1">Every touchpoint increases error probability.</p>
            </div>

            <!-- Frequency -->
            <div>
                <label class="block text-xs font-bold text-white mb-2">Frequency</label>
                <select x-model="$data.inputs.frequency" class="w-full bg-dark border border-white/15 rounded p-2 text-sm text-white focus:border-green-500">
                    <option value="1">Annual (1x)</option>
                    <option value="4">Quarterly (4x)</option>
                    <option value="12">Monthly (12x)</option>
                    <option value="52">Weekly (52x)</option>
                    <option value="250">Daily (250x)</option>
                </select>
            </div>

            <!-- Criticality Buttons -->
            <div>
                <label class="block text-xs font-bold text-white mb-2">Risk Impact</label>
                <div class="grid grid-cols-3 gap-2">
                    <button @click="$data.inputs.criticality = 1" :class="$data.inputs.criticality === 1 ? 'bg-white/15 text-white' : 'bg-white/10 text-slate-400'" class="p-2 rounded text-[10px] font-bold border border-white/15 hover:border-white transition-all">
                        Internal
                    </button>
                    <button @click="$data.inputs.criticality = 2" :class="$data.inputs.criticality === 2 ? 'bg-yellow-600 text-white' : 'bg-white/10 text-slate-400'" class="p-2 rounded text-[10px] font-bold border border-white/15 hover:border-yellow-500 transition-all">
                        Regulatory
                    </button>
                    <button @click="$data.inputs.criticality = 3" :class="$data.inputs.criticality === 3 ? 'bg-red-600 text-white' : 'bg-white/10 text-slate-400'" class="p-2 rounded text-[10px] font-bold border border-white/15 hover:border-red-500 transition-all">
                        Customer
                    </button>
                </div>
            </div>

            <button @click="$data.calculate()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-glow transition-all">
                CALCULATE EXPOSURE
            </button>
        </div>

        <!-- RIGHT: RESULTS -->
        <div class="lg:col-span-7">
            
            <!-- Empty State -->
            <div x-show="!$data.result" class="h-64 border-2 border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center text-slate-500">
                <i class="fa-solid fa-calculator text-4xl mb-3 opacity-20"></i>
                <p class="text-xs font-mono">Awaiting inputs...</p>
            </div>

            <!-- Result Card -->
            <div x-show="$data.result" x-transition class="space-y-6">
                
                <!-- Main Metrics -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">ANNUAL WASTE (OPEX)</p>
                        <h3 class="text-3xl font-bold font-mono text-white my-1" x-text="'$' + $data.result?.annualCost.toLocaleString()"></h3>
                        <p class="text-[10px] text-slate-400"><span x-text="$data.result?.annualHours"></span> wasted hours</p>
                    </div>
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-red-500/5" x-show="$data.result?.errorProb > 50"></div>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">ERROR PROBABILITY</p>
                        <h3 class="text-3xl font-bold font-mono my-1" :class="$data.result?.errorProb > 50 ? 'text-red-500' : 'text-yellow-500'">
                            <span x-text="$data.result?.errorProb"></span>%
                        </h3>
                        <p class="text-[10px] text-slate-400">Swiss Cheese Model</p>
                    </div>
                </div>

                <!-- Liability Warning -->
                <div class="bg-white/[0.03] backdrop-blur-md border-l-4 p-5 rounded-r-xl flex items-center justify-between"
                     :class="$data.result?.riskExposure > 100000 ? 'border-red-500' : 'border-yellow-500'">
                    <div>
                        <p class="text-[10px] font-bold uppercase mb-1" :class="$data.result?.riskExposure > 100000 ? 'text-red-500' : 'text-yellow-500'">TOTAL RISK LIABILITY</p>
                        <h2 class="text-2xl font-mono font-bold text-white" x-text="'$' + $data.result?.riskExposure.toLocaleString()"></h2>
                    </div>
                    <div class="text-right">
                        <span class="block text-xs font-bold text-white bg-white/5 px-3 py-1 rounded border border-white/15">
                            <span x-text="$data.result?.verdict"></span>
                        </span>
                    </div>
                </div>

                <!-- AI Business Case Box -->
                <div class="bg-white/[0.03] backdrop-blur-md border border-green-500/30 p-5 rounded-xl group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-3 opacity-10 pointer-events-none"><i class="fa-solid fa-file-invoice-dollar text-6xl text-green-500"></i></div>
                    
                    <h4 class="font-mono text-xs text-green-400 font-bold uppercase mb-2">Automated Business Case</h4>
                    <p class="text-[10px] text-slate-400 mb-4">Use this prompt to generate the funding request for IT.</p>
                    
                    <button @click="
                            copyToClipboard($data.generateExcelPrompt(), 'Business Case');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            $el.classList.add('bg-white', 'text-black', 'border-white');
                            setTimeout(() => {
                                $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY PROMPT FOR AI';
                                $el.classList.remove('bg-white', 'text-black', 'border-white');
                            }, 2000)
                            " 
                            class="w-full py-3 bg-transparent border border-green-500 text-green-400 hover:bg-green-500 hover:text-black font-bold rounded-lg transition-all flex items-center justify-center gap-2 font-mono text-[10px] uppercase tracking-widest shadow-[0_0_10px_rgba(74,222,128,0.1)] hover:shadow-[0_0_15px_rgba(74,222,128,0.4)]">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> COPY PROMPT FOR AI
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

        <!-- LIGHTHOUSE ROI TAB (REDESIGNED) -->
<div x-show="currentTab === 'roi'" x-data="lighthouseRoiComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-green-400 mb-2">Lighthouse Value Engine</h2>
        <p class="text-textMuted text-xs md:text-sm">Translate "Agile Velocity" into "Balance Sheet Impact". Speak the CFO's language.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: THE INPUTS -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <div class="flex justify-between items-center border-b border-white/10 pb-2">
                <h3 class="font-mono text-xs text-slate-400 uppercase tracking-widest">Pilot Parameters</h3>
                <i class="fa-solid fa-sliders text-slate-500"></i>
            </div>
            
            <div>
                <label class="block text-xs font-bold text-white mb-1">Project Name</label>
                <input type="text" x-model="$data.inputs.name" placeholder="e.g. Instant SME Loan" class="w-full bg-dark border border-white/15 rounded p-2 text-white focus:border-green-500 focus:outline-none">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Duration (Weeks)</label>
                    <input type="number" x-model="$data.inputs.duration_weeks" class="w-full bg-dark border border-white/15 rounded p-2 text-white">
                </div>
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Squad Cost ($/Wk)</label>
                    <input type="number" x-model="$data.inputs.squad_cost_per_week" class="w-full bg-dark border border-white/15 rounded p-2 text-white">
                </div>
            </div>

            <div class="bg-green-900/10 border border-green-500/30 p-4 rounded-lg space-y-4">
                <p class="text-[10px] text-green-400 font-bold uppercase mb-2">Value Capture (Annual)</p>
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1">New Revenue Generated ($)</label>
                    <input type="number" x-model="$data.inputs.revenue_generated" class="w-full bg-dark border border-green-500/50 rounded p-2 text-white">
                </div>
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1">Cost Avoided / Saved ($)</label>
                    <input type="number" x-model="$data.inputs.cost_avoided" class="w-full bg-dark border border-green-500/50 rounded p-2 text-white">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">Old Speed (Weeks)</label>
                    <input type="number" x-model="$data.inputs.old_cycle_time" class="w-full bg-dark border border-white/15 rounded p-2 text-white">
                </div>
                <div>
                    <label class="block text-[10px] text-slate-400 mb-1 uppercase">New Speed (Weeks)</label>
                    <input type="number" x-model="$data.inputs.new_cycle_time" class="w-full bg-dark border border-white/15 rounded p-2 text-white">
                </div>
            </div>

            <button @click="$data.calculate()" class="w-full bg-white hover:bg-white/90 text-dark font-bold py-3 rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-calculator text-green-600"></i> CALCULATE ROI
            </button>
        </div>

        <!-- RIGHT: THE DASHBOARD -->
        <div class="lg:col-span-7">
            
            <!-- Empty State -->
            <div x-show="!$data.results" class="h-64 border-2 border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center text-slate-500">
                <i class="fa-solid fa-chart-pie text-4xl mb-3 opacity-20"></i>
                <p class="text-xs font-mono">Input data to generate business case.</p>
            </div>

            <!-- Results -->
            <div x-show="$data.results" x-transition class="space-y-6">
                
                <!-- 1. The Verdict Header -->
                <div class="flex justify-between items-center bg-white/[0.03] backdrop-blur-md border-l-4 p-4 rounded-r-xl shadow-lg"
                     :class="$data.results?.roiPercent > 0 ? 'border-green-500' : 'border-red-500'">
                    <div>
                        <p class="text-[10px] font-mono text-slate-400 uppercase tracking-widest">INVESTMENT VERDICT</p>
                        <h3 class="text-2xl font-bold text-white font-mono" :class="$data.results?.color" x-text="$data.results?.verdict"></h3>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-mono text-slate-400 uppercase tracking-widest">1-YEAR ROI</p>
                        <h3 class="text-4xl font-bold text-white" x-text="$data.results?.roiPercent + '%'"></h3>
                    </div>
                </div>

                <!-- 2. The Metrics Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] text-slate-500 uppercase">Payback Period</span>
                            <i class="fa-solid fa-hourglass-half text-slate-600"></i>
                        </div>
                        <p class="text-xl font-bold text-white"><span x-text="$data.results?.paybackMonths"></span> Months</p>
                        <p class="text-[10px] text-slate-400 mt-1">Time to break even</p>
                    </div>
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] text-slate-500 uppercase">Velocity Gain</span>
                            <i class="fa-solid fa-gauge-high text-purple-400"></i>
                        </div>
                        <p class="text-xl font-bold text-white"><span x-text="$data.results?.speedFactor"></span>x Faster</p>
                        <p class="text-[10px] text-slate-400 mt-1">Time-to-Market multiplier</p>
                    </div>
                </div>

                <!-- 3. The Cost of Delay (Scary Metric) -->
                <div class="bg-red-900/10 border border-red-500/30 p-5 rounded-xl flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center text-red-500">
                        <i class="fa-solid fa-stopwatch text-xl"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-red-400 uppercase tracking-widest">COST OF DELAY (COD)</p>
                        <p class="text-sm text-slate-300">
                            Every week of indecision costs the bank <strong class="text-white" x-text="'$' + $data.results?.weeklyValue.toLocaleString()"></strong> in lost value.
                        </p>
                    </div>
                </div>

                <!-- 4. AI CFO Script -->
                <div class="bg-white/[0.03] backdrop-blur-md border border-green-500/30 p-5 rounded-xl group relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-3 opacity-10 pointer-events-none"><i class="fa-solid fa-file-contract text-6xl text-green-500"></i></div>
                    
                    <h4 class="font-mono text-xs text-green-400 font-bold uppercase mb-2 flex items-center gap-2">
                        <i class="fa-solid fa-robot"></i> CFO Defense Script
                    </h4>
                    
                    <!-- Prompt Preview -->
                    <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/60 p-3 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateROIPrompt()"></pre>
                    </div>
                    
                    <button @click="
                            copyToClipboard($data.generateROIPrompt(), 'CFO Script');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            $el.classList.add('bg-white', 'text-black', 'border-white');
                            setTimeout(() => {
                                $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY SCRIPT FOR AI';
                                $el.classList.remove('bg-white', 'text-black', 'border-white');
                            }, 2000)
                            " 
                            class="w-full py-3 bg-transparent border border-green-500 text-green-400 hover:bg-green-500 hover:text-black font-bold rounded-lg transition-all flex items-center justify-center gap-2 font-mono text-[10px] uppercase tracking-widest shadow-[0_0_10px_rgba(74,222,128,0.1)] hover:shadow-[0_0_15px_rgba(74,222,128,0.4)]">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> COPY SCRIPT FOR AI
                    </button>
                </div>

            </div>

        </div>
    </div>
</div>

        <!-- FUTURE BANK SCENARIO BUILDER TAB -->
<div x-show="currentTab === 'future'" x-data="futureBankComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">The Future Bank Simulator</h2>
        <p class="text-textMuted text-xs md:text-sm">Decisions have compounding interest. Choose a strategy and navigate the crises of 2026-2030.</p>
    </div>

    <!-- 1. SCENARIO SELECTOR -->
    <div x-show="!$data.activeScenario" class="grid md:grid-cols-3 gap-6">
        <template x-for="scenario in $data.scenarios" :key="scenario.id">
            <button @click="$data.selectScenario(scenario.id)" 
                    class="bg-white/5 backdrop-blur-lg border border-white/10 hover:border-purple-500 p-8 rounded-xl text-center group transition-all hover:-translate-y-2 relative overflow-hidden shadow-lg">
                <div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-6 group-hover:bg-white/10 transition-colors relative z-10">
                    <i :class="'fa-solid ' + scenario.icon + ' text-3xl ' + scenario.color"></i>
                </div>
                <h3 class="font-bold text-white text-xl mb-2 relative z-10" x-text="scenario.title"></h3>
                <p class="text-sm text-slate-400 leading-relaxed relative z-10" x-text="scenario.desc"></p>
                <div class="mt-6 text-xs font-mono text-purple-400 opacity-0 group-hover:opacity-100 transition-opacity relative z-10">
                    INITIALIZE SIMULATION <i class="fa-solid fa-arrow-right ml-1"></i>
                </div>
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-purple-900/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </button>
        </template>
    </div>

    <!-- 2. ACTIVE SIMULATION -->
    <div x-show="$data.activeScenario" x-transition class="relative min-h-[500px]">
        
        <!-- Timeline Header -->
        <div class="flex justify-between items-center mb-8 border-b border-white/10 pb-4">
            <button @click="$data.activeScenario = null" :disabled="$data.isPlaying" class="text-xs text-slate-400 hover:text-white disabled:opacity-30 flex items-center">
                <i class="fa-solid fa-arrow-left mr-2"></i> ABORT
            </button>
            <div class="text-center">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">FISCAL YEAR</p>
                <h2 class="text-6xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500" 
                    x-text="$data.year"></h2>
            </div>
            <div class="w-24 text-right">
                <span class="text-xs font-bold px-2 py-1 rounded bg-white/10 text-slate-300 border border-white/15">
                    <i class="fa-solid fa-play mr-1 text-green-400" x-show="$data.isPlaying && !$data.activeEvent"></i>
                    <i class="fa-solid fa-pause mr-1 text-yellow-400" x-show="$data.activeEvent"></i>
                    <span x-text="$data.activeEvent ? 'ACTION' : ($data.isPlaying ? 'RUNNING' : 'COMPLETE')"></span>
                </span>
            </div>
        </div>

        <!-- LIVE TELEMETRY GRID -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">NET PROFIT</p>
                <h3 class="text-2xl font-mono font-bold text-green-400 mb-2">
                    $<span x-text="($data.metrics.profit / 1000).toFixed(1)"></span>B
                </h3>
                <div class="w-full bg-white/10 h-1 rounded-full mt-4">
                    <div class="bg-green-500 h-1 rounded-full transition-all duration-500" :style="`width: ${($data.metrics.profit / 5000) * 100}%`"></div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">CUSTOMER BASE</p>
                <h3 class="text-2xl font-bold text-white mb-2">
                    <span x-text="$data.metrics.customers.toFixed(1)"></span>M
                </h3>
                <div class="w-full bg-white/10 h-1 rounded-full mt-4">
                    <div class="bg-blue-500 h-1 rounded-full transition-all duration-500" :style="`width: ${($data.metrics.customers / 20) * 100}%`"></div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">EFFICIENCY RATIO</p>
                <h3 class="text-2xl font-mono font-bold mb-2" :class="$data.metrics.efficiency < 50 ? 'text-primary' : 'text-orange-400'">
                    <span x-text="$data.metrics.efficiency.toFixed(0)"></span>%
                </h3>
                <p class="text-[9px] text-slate-500">Lower is better</p>
            </div>
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl relative overflow-hidden">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">TECH DEBT</p>
                <h3 class="text-2xl font-mono font-bold mb-2" :class="$data.metrics.techDebt > 50 ? 'text-red-500' : 'text-slate-300'">
                    <span x-text="$data.metrics.techDebt"></span>/100
                </h3>
                <div class="w-full bg-white/10 h-1 rounded-full mt-4">
                    <div class="h-1 rounded-full transition-all duration-500" 
                         :class="$data.metrics.techDebt > 50 ? 'bg-red-500' : 'bg-white/20'"
                         :style="`width: ${$data.metrics.techDebt}%`"></div>
                </div>
            </div>
        </div>

        <!-- *** THE INTERACTIVE EVENT OVERLAY *** -->
        <div x-show="$data.activeEvent" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-90"
             x-transition:enter-end="opacity-100 scale-100"
             class="absolute inset-0 z-50 flex items-center justify-center p-4">
            
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black/90 backdrop-blur-sm rounded-xl"></div>
            
            <!-- Card -->
            <div class="bg-white/[0.03] backdrop-blur-md border-2 border-red-500 rounded-2xl p-8 max-w-lg w-full relative z-10 shadow-[0_0_50px_rgba(239,68,68,0.3)]">
                <div class="flex items-center gap-3 mb-4 text-red-500 animate-pulse">
                    <i class="fa-solid fa-triangle-exclamation text-2xl"></i>
                    <h3 class="font-mono text-xl font-bold uppercase">Breaking News</h3>
                </div>
                
                <h4 class="text-2xl font-bold text-white mb-2" x-text="$data.activeEvent?.title"></h4>
                <p class="text-slate-300 mb-8 leading-relaxed" x-text="$data.activeEvent?.desc"></p>
                
                <div class="space-y-3">
                    <template x-for="(choice, idx) in ($data.activeEvent?.choices || [])" :key="idx">
                        <button @click="$data.resolveEvent(choice)" 
                                class="w-full text-left p-4 rounded-lg bg-white/5 border border-white/15 hover:border-white hover:bg-white/10 transition-all group">
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-sm text-white" x-text="choice.label"></span>
                                <i class="fa-solid fa-arrow-right text-slate-500 group-hover:text-white"></i>
                            </div>
                            <div class="text-[10px] text-slate-400 mt-1 flex gap-3">
                                <span x-show="choice.cost > 0">Cost: $<span x-text="choice.cost"></span>M</span>
                                <span x-show="choice.debt < 0" class="text-green-400">Debt Down</span>
                                <span x-show="choice.debt > 0" class="text-red-400">Debt Up</span>
                            </div>
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <!-- 3. AI PROMPT BOX (End State) -->
        <div x-show="!$data.isPlaying && $data.year === 2030" 
             x-transition:enter="transition ease-out duration-1000 delay-200" 
             class="bg-white/[0.03] backdrop-blur-md border border-purple-500/30 p-6 rounded-xl relative overflow-hidden group mt-4">
            
            <div class="flex justify-between items-center mb-4 relative z-10">
                <h3 class="font-mono text-white font-bold flex items-center gap-2">
                    <i class="fa-solid fa-robot text-purple-400"></i> 
                    WALL STREET ANALYST REPORT
                </h3>
                <span class="text-[10px] uppercase bg-purple-900/50 text-purple-400 px-2 py-1 rounded border border-purple-500/30 font-bold tracking-wider">
                    Simulation Complete
                </span>
            </div>

            <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-32 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateFuturePrompt()"></pre>
            </div>

            <button @click="
                    copyToClipboard($data.generateFuturePrompt(), 'Simulation Data');
                    $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                    $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    setTimeout(() => {
                        $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE REPORT (AI)';
                        $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    }, 2000)
                    " 
                    class="relative z-10 w-full py-4 bg-transparent border border-purple-500 text-purple-400 hover:bg-purple-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(168,85,247,0.1)] hover:shadow-[0_0_20px_rgba(168,85,247,0.4)]">
                <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE REPORT (AI)
            </button>
            
            <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
                Includes your specific crisis decisions (2027/2029) in the prompt.
            </p>
        </div>

    </div>
</div>
        <!-- CONWAY'S LAW VISUALIZER TAB -->
<div x-show="currentTab === 'conway'" x-data="conwaySimComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Conway's Law Simulator</h2>
        <p class="text-textMuted text-xs md:text-sm">"You don't have a code problem. You have an org chart problem."</p>
    </div>

    <!-- 1. BUILDER UI -->
    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: Org Chart Builder -->
        <div class="lg:col-span-4 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl">
            <h3 class="font-mono text-xs text-indigo-400 uppercase mb-4 font-bold">1. Define the Org</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-slate-500 uppercase">Team Name</label>
                    <input type="text" x-model="$data.newTeamName" @keydown.enter="$data.addTeam()" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm focus:border-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 uppercase">Team Archetype</label>
                    <div class="grid grid-cols-2 gap-2 mt-1">
                        <button @click="$data.newTeamType = 'silo'" :class="$data.newTeamType === 'silo' ? 'bg-orange-500/20 border-orange-500 text-orange-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-building-columns mr-1"></i> Silo
                        </button>
                        <button @click="$data.newTeamType = 'squad'" :class="$data.newTeamType === 'squad' ? 'bg-green-500/20 border-green-500 text-green-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-rocket mr-1"></i> Squad
                        </button>
                        <button @click="$data.newTeamType = 'platform'" :class="$data.newTeamType === 'platform' ? 'bg-blue-500/20 border-blue-500 text-blue-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-layer-group mr-1"></i> Platform
                        </button>
                        <button @click="$data.newTeamType = 'gatekeeper'" :class="$data.newTeamType === 'gatekeeper' ? 'bg-red-500/20 border-red-500 text-red-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-hand-paper mr-1"></i> Gatekeeper
                        </button>
                    </div>
                </div>
                <button @click="$data.addTeam()" class="w-full bg-white hover:bg-gray-200 text-dark font-bold py-2 rounded-lg text-xs transition-all">
                    + ADD TEAM
                </button>
            </div>

            <!-- Help Text -->
            <div class="mt-6 p-4 bg-white/5 rounded-lg border border-white/10">
                <p class="text-[10px] text-slate-400 leading-relaxed">
                    <strong class="text-white">How it works:</strong> Add teams. Then, on the right panel, click any two teams to create a <span class="text-red-400">Dependency Line</span>. The simulator calculates the resulting architectural mess.
                </p>
            </div>
        </div>

        <!-- RIGHT: Interactive Graph -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- Matrix Visualizer -->
            <div class="bg-dark border-2 border-dashed border-white/10 rounded-xl p-6 relative min-h-[400px]">
                
                <p class="text-[10px] text-slate-500 uppercase tracking-widest absolute top-4 left-4">DEPENDENCY MATRIX (CLICK TO CONNECT)</p>
                
                <div x-show="$data.teams.length === 0" class="flex h-full items-center justify-center text-slate-600">
                    <div class="text-center">
                        <i class="fa-solid fa-sitemap text-4xl mb-2 opacity-30"></i>
                        <p class="text-xs">Add teams to visualize architecture.</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mt-8">
                    <template x-for="team in $data.teams" :key="team.id">
                        <div class="relative bg-white/5 p-4 rounded-lg border transition-all group"
                             :class="{
                                'border-orange-500': team.type === 'silo',
                                'border-green-500': team.type === 'squad',
                                'border-blue-500': team.type === 'platform',
                                'border-red-500': team.type === 'gatekeeper'
                             }">
                            
                            <!-- Delete Button -->
                            <button @click.stop="$data.removeTeam(team.id)" class="absolute -top-2 -right-2 w-6 h-6 bg-red-600 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity z-20">
                                <i class="fa-solid fa-xmark"></i>
                            </button>

                            <div class="flex items-center gap-2 mb-2">
                                <i class="fa-solid" :class="{
                                    'fa-building-columns text-orange-400': team.type === 'silo',
                                    'fa-rocket text-green-400': team.type === 'squad',
                                    'fa-layer-group text-blue-400': team.type === 'platform',
                                    'fa-hand-paper text-red-400': team.type === 'gatekeeper'
                                }"></i>
                                <span class="font-bold text-white text-sm truncate" x-text="team.name"></span>
                            </div>

                            <!-- Connection Grid -->
                            <div class="mt-3 pt-3 border-t border-white/10">
                                <p class="text-[9px] text-slate-500 mb-2 uppercase">Depends on:</p>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="target in $data.teams" :key="target.id">
                                        <button x-show="team.id !== target.id" 
                                                @click="$data.toggleDependency(team.id, target.id)"
                                                class="text-[9px] px-2 py-1 rounded border transition-all"
                                                :class="$data.hasDependency(team.id, target.id) 
                                                    ? 'bg-red-500/20 border-red-500 text-red-300' 
                                                    : 'bg-white/[0.03] backdrop-blur-md border-white/10 text-slate-500 hover:border-white/20'">
                                            <span x-text="target.name"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Calculated Results -->
            <div class="grid grid-cols-3 gap-4" x-show="$data.teams.length > 0">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">COUPLING SCORE</p>
                    <h3 class="text-2xl font-mono font-bold my-1" :class="$data.metrics.couplingScore > 50 ? 'text-red-500' : 'text-green-400'">
                        <span x-text="$data.metrics.couplingScore"></span>/100
                    </h3>
                    <p class="text-[9px] text-slate-400">Integration Pain</p>
                </div>
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">VELOCITY</p>
                    <h3 class="text-2xl font-mono font-bold my-1 text-blue-400">
                        <span x-text="$data.metrics.velocity.toFixed(0)"></span>
                    </h3>
                    <p class="text-[9px] text-slate-400">Deployment Speed</p>
                </div>
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">RESULTING SYSTEM</p>
                    <h3 class="text-sm font-bold text-white my-2" x-text="$data.metrics.archType"></h3>
                </div>
            </div>

        </div>
    </div>

    <!-- 2. AI DIAGNOSIS BOX -->
    <div x-show="$data.teams.length > 0" 
         class="mt-8 bg-white/[0.03] backdrop-blur-md border border-indigo-500/30 p-6 rounded-xl relative overflow-hidden group">
        
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2">
                <i class="fa-solid fa-robot text-indigo-400"></i> 
                ARCHITECTURAL DIAGNOSIS AI
            </h3>
            <span class="text-[10px] uppercase bg-indigo-900/50 text-indigo-400 px-2 py-1 rounded border border-indigo-500/30 font-bold tracking-wider">
                Topology Mapped
            </span>
        </div>

        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-32 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateConwayPrompt()"></pre>
        </div>

        <button @click="
                copyToClipboard($data.generateConwayPrompt(), 'Topology Data');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE RE-ORG PLAN (AI)';
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                }, 2000)
                " 
                class="relative z-10 w-full py-4 bg-transparent border border-indigo-500 text-indigo-400 hover:bg-indigo-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(129,140,248,0.1)] hover:shadow-[0_0_20px_rgba(129,140,248,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE RE-ORG PLAN (AI)
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Paste into AI to get the "Inverse Conway Maneuver" strategy.
        </p>
    </div>

</div>

        <!-- DUMB PIPE RISK CALCULATOR TAB -->
<div x-show="currentTab === 'dumbpipe'" x-data="strategyAnalyzerComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Dumb Pipe Risk Calculator</h2>
        <p class="text-textMuted text-xs md:text-sm">"If you lose the interface, you lose the margin." Are you becoming a utility?</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: INPUTS -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-8">
            
            <!-- Revenue Mix -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-slate-400 uppercase font-bold"><i class="fa-solid fa-money-bill-transfer mr-2"></i>Commodity Revenue</label>
                    <span class="text-xs font-bold text-white" x-text="dumbPipeCalc.inputs.commodity_share + '%'"></span>
                </div>
                <input type="range" min="0" max="100" x-model="dumbPipeCalc.inputs.commodity_share" @input="dumbPipeCalc.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-red-500">
                <p class="text-[10px] text-slate-500 mt-2">Revenue from Interchange, FX, or Overdrafts (Low Loyalty).</p>
            </div>

            <!-- Aggregator Traffic -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-slate-400 uppercase font-bold"><i class="fa-solid fa-server mr-2"></i>3rd Party Traffic</label>
                    <span class="text-xs font-bold text-white" x-text="dumbPipeCalc.inputs.aggregator_share + '%'"></span>
                </div>
                <input type="range" min="0" max="100" x-model="dumbPipeCalc.inputs.aggregator_share" @input="dumbPipeCalc.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-yellow-500">
                <p class="text-[10px] text-slate-500 mt-2">Customers accessing you via Apple Wallet, Mint, or Plaid.</p>
            </div>

            <!-- Engagement -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-slate-400 uppercase font-bold"><i class="fa-solid fa-mobile-screen mr-2"></i>Daily Logins (DAU)</label>
                    <span class="text-xs font-bold text-white" x-text="dumbPipeCalc.inputs.daily_logins + '%'"></span>
                </div>
                <input type="range" min="0" max="100" x-model="dumbPipeCalc.inputs.daily_logins" @input="dumbPipeCalc.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-blue-500">
                <p class="text-[10px] text-slate-500 mt-2">Percentage of customer base checking the app daily.</p>
            </div>

            <!-- NPS -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-slate-400 uppercase font-bold"><i class="fa-solid fa-heart mr-2"></i>Net Promoter Score</label>
                    <span class="text-xs font-bold text-white" x-text="dumbPipeCalc.inputs.nps"></span>
                </div>
                <input type="range" min="-100" max="100" x-model="dumbPipeCalc.inputs.nps" @input="dumbPipeCalc.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-green-500">
            </div>

            <button @click="dumbPipeCalc.analyze()" 
                    class="w-full py-4 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-calculator"></i> CALCULATE RISK
            </button>
        </div>

        <!-- RIGHT: RESULTS & STRATEGY -->
        <div class="lg:col-span-7 relative min-h-[400px]">
            
            <!-- Empty State -->
            <div x-show="!dumbPipeCalc.result" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-faucet-drip text-4xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Adjust Inputs to Audit</p>
            </div>

            <!-- Result Card -->
            <div x-show="dumbPipeCalc.result" x-transition class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden shadow-glass relative group">
                
                <!-- The Gauge Header -->
                <div class="p-8 text-center bg-gradient-to-b from-slate-800 to-slate-900 border-b border-white/10 relative overflow-hidden">
                    <!-- Background Glow -->
                    <div class="absolute inset-0 opacity-10 transition-colors duration-500" :class="'bg-' + dumbPipeCalc.result?.color.replace('text-', '')"></div>
                    
                    <p class="text-[10px] font-mono text-slate-400 uppercase tracking-widest mb-4">COMMODITIZATION INDEX</p>
                    
                    <div class="relative w-48 h-24 mx-auto overflow-hidden">
                        <!-- Gauge Arc (CSS Trick) -->
                        <div class="w-48 h-48 rounded-full border-[12px] border-white/10 border-t-transparent border-l-transparent -rotate-45 absolute top-0 left-0"></div>
                        <div class="w-48 h-48 rounded-full border-[12px] border-transparent border-t-current border-l-current -rotate-45 absolute top-0 left-0 transition-all duration-1000"
                             :class="dumbPipeCalc.result?.color"
                             :style="`transform: rotate(${(dumbPipeCalc.result?.score / 100 * 180) - 135}deg)`"></div>
                    </div>
                    <div class="relative -mt-10">
                        <span class="text-5xl font-bold font-mono text-white" x-text="dumbPipeCalc.result?.score"></span>
                    </div>
                    
                    <h3 class="text-2xl font-bold mt-4 uppercase tracking-tight" :class="dumbPipeCalc.result?.color" x-text="dumbPipeCalc.result?.verdict"></h3>
                    <p class="text-xs text-slate-400 mt-2 font-mono">Archetype: <span class="text-white font-bold" x-text="dumbPipeCalc.result?.archetype"></span></p>
                </div>

                <!-- AI Prompt Box -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-red-400"></i> Strategic Defense AI
                        </h3>
                        <span class="text-[9px] bg-red-900/50 text-red-400 px-2 py-1 rounded border border-red-500/30 font-bold uppercase tracking-wider">
                            Gap Identified
                        </span>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="dumbPipeCalc.generateStrategyPrompt()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard(dumbPipeCalc.generateStrategyPrompt(), 'Strategy Memo');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                            setTimeout(() => {
                                $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE DEFENSE STRATEGY (AI)';
                                $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                            }, 2000)
                            " 
                            class="w-full py-4 bg-transparent border border-red-500 text-red-400 hover:bg-red-500 hover:text-white font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(239,68,68,0.1)] hover:shadow-[0_0_20px_rgba(239,68,68,0.4)]">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE DEFENSE STRATEGY (AI)
                    </button>
                    
                    <p class="text-center text-[10px] text-slate-500 mt-3">
                        Paste into AI to get a roadmap for escaping the "Utility Trap".
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- AGILE DATA GOVERNANCE DASHBOARD TAB -->
<div x-show="currentTab === 'datagov'" x-data="dataGovComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <!-- Header: Optimized for Mobile Stacking -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 md:mb-8 gap-4">
        <div>
            <h2 class="font-mono text-2xl md:text-3xl font-bold text-white mb-2">Agile Data Governance</h2>
            <p class="text-textMuted text-sm">Don't fix data downstream (Janitor). Fix it at the source (Guardrails).</p>
        </div>
        
        <!-- Controls: Full width on mobile -->
        <div class="flex gap-2 w-full md:w-auto">
             <button @click="$data.injectFailure('schema')" class="flex-1 md:flex-none justify-center px-4 py-3 md:py-2 border border-red-500/50 text-red-400 hover:bg-red-900/20 rounded-full text-xs font-bold transition-all shadow-[0_0_15px_rgba(239,68,68,0.2)]">
                <i class="fa-solid fa-bug mr-2"></i> <span class="md:inline">INJECT BREAK</span>
            </button>
            <button @click="$data.toggleSim()" 
                    class="flex-1 md:flex-none justify-center font-bold py-3 md:py-2 px-6 rounded-full shadow-glow transition-all flex items-center gap-2 text-xs"
                    :class="$data.isLive ? 'bg-blue-500/20 text-blue-400 border border-blue-500' : 'bg-white/10 text-white'">
                <i class="fa-solid" :class="$data.isLive ? 'fa-spin fa-circle-notch' : 'fa-play'"></i>
                <span x-text="$data.isLive ? 'LIVE' : 'MONITOR'"></span>
            </button>
        </div>
    </div>

    <!-- Main Grid: 1 Col Mobile, 3 Cols Desktop -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
        
        <!-- LEFT: DATA PRODUCTS GRID -->
        <div class="lg:col-span-2 space-y-4">
            <template x-for="product in $data.products" :key="product.id">
                <div @click="$data.selectedProduct = product; $nextTick(() => { if(window.innerWidth < 1024) $refs.govPanel.scrollIntoView({behavior: 'smooth', block: 'center'}) })"
                     class="bg-white/5 backdrop-blur-lg border p-4 md:p-6 rounded-xl cursor-pointer transition-all hover:translate-x-1 relative overflow-hidden group active:scale-95 duration-200"
                     :class="product.status === 'critical' ? 'border-red-500 shadow-[0_0_15px_rgba(239,68,68,0.3)]' : ($data.selectedProduct?.id === product.id ? 'border-blue-500' : 'border-white/10')">
                    
                    <!-- Critical Alert Overlay -->
                    <div x-show="product.status === 'critical'" class="absolute inset-0 bg-red-900/10 z-0 animate-pulse"></div>

                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-2 h-2 rounded-full shrink-0" :class="product.status === 'critical' ? 'bg-red-500 shadow-[0_0_10px_red]' : 'bg-green-400'"></span>
                                    <h3 class="font-bold text-white text-base md:text-lg leading-tight" x-text="product.name"></h3>
                                </div>
                                <p class="text-xs text-slate-400 font-mono">Owner: <span class="text-white" x-text="product.owner"></span></p>
                            </div>
                            <div class="text-right shrink-0 ml-2">
                                <span class="text-[9px] md:text-[10px] uppercase tracking-widest text-slate-500 block">Service Level</span>
                                <div class="text-xl md:text-2xl font-mono font-bold" :class="product.status === 'critical' ? 'text-red-500' : 'text-green-400'">
                                    <span x-text="Math.min(product.slo.freshness, product.slo.accuracy).toFixed(1)"></span>%
                                </div>
                            </div>
                        </div>

                        <!-- SLO Metrics -->
                        <div class="grid grid-cols-2 gap-2 md:gap-4 text-center">
                            <div class="bg-white/[0.03] backdrop-blur-sm rounded p-2 border border-white/[0.08]">
                                <p class="text-[9px] text-slate-400 uppercase">Freshness</p>
                                <div class="w-full bg-white/10 h-1.5 rounded-full mt-1 mb-1 overflow-hidden">
                                    <div class="h-full transition-all duration-300" :class="product.slo.freshness < 99 ? 'bg-red-500' : 'bg-blue-400'" :style="`width: ${product.slo.freshness}%`"></div>
                                </div>
                                <p class="font-mono font-bold text-xs" :class="product.slo.freshness < 99 ? 'text-red-400' : 'text-white'" x-text="product.slo.freshness.toFixed(1) + '%'"></p>
                            </div>
                            <div class="bg-white/[0.03] backdrop-blur-sm rounded p-2 border border-white/[0.08]">
                                <p class="text-[9px] text-slate-400 uppercase">Quality</p>
                                <div class="w-full bg-white/10 h-1.5 rounded-full mt-1 mb-1 overflow-hidden">
                                    <div class="h-full transition-all duration-300" :class="product.slo.accuracy < 99 ? 'bg-red-500' : 'bg-blue-400'" :style="`width: ${product.slo.accuracy}%`"></div>
                                </div>
                                <p class="font-mono font-bold text-xs" :class="product.slo.accuracy < 99 ? 'text-red-400' : 'text-white'" x-text="product.slo.accuracy.toFixed(1) + '%'"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- RIGHT: INCIDENT COMMAND & PROMPT GEN -->
        <!-- Added x-ref="govPanel" for auto-scrolling -->
        <div x-ref="govPanel" class="bg-dark border border-white/10 rounded-xl p-4 md:p-6 flex flex-col h-full min-h-[300px] md:min-h-[500px] shadow-glass">
            <h3 class="font-mono text-xs text-blue-400 uppercase mb-4 tracking-widest border-b border-white/[0.08] pb-2">Incident Command Center</h3>
            
            <!-- Empty State -->
            <div x-show="!$data.selectedProduct" class="text-center text-slate-600 mt-10 md:mt-20">
                <i class="fa-solid fa-tower-observation text-4xl mb-4 opacity-20"></i>
                <p class="text-xs font-mono">Select a Data Product above<br>to open monitor.</p>
            </div>

            <!-- Active Product Details -->
            <div x-show="$data.selectedProduct" class="flex-1 flex flex-col">
                <div class="mb-6 pb-4 border-b border-white/[0.08]">
                     <span class="text-lg font-bold text-white block mb-1" x-text="$data.selectedProduct?.name"></span>
                     <div class="flex flex-wrap items-center gap-2">
                         <span class="text-[10px] px-2 py-0.5 rounded border font-bold" 
                               :class="$data.selectedProduct?.status === 'critical' ? 'bg-red-900/30 border-red-500 text-red-400' : 'bg-green-900/30 border-green-500 text-green-400'"
                               x-text="$data.selectedProduct?.status === 'critical' ? 'CRITICAL INCIDENT' : 'OPERATIONAL'"></span>
                         <span class="text-[10px] text-slate-500 font-mono" x-text="'$' + $data.selectedProduct?.costPerMinute + '/min impact'"></span>
                     </div>
                </div>

                <!-- INCIDENT ALERT (Only shows if broken) -->
                <div x-show="$data.selectedProduct?.status === 'critical'" x-transition class="space-y-4">
                    
                    <div class="bg-red-900/10 border border-red-500 p-4 rounded-lg animate-pulse">
                        <div class="flex items-center gap-2 mb-2 text-red-400 text-xs font-bold uppercase">
                            <i class="fa-solid fa-triangle-exclamation"></i> Business Impact
                        </div>
                        <p class="text-2xl text-white font-mono font-bold mb-1" x-text="'$' + Math.round($data.activeIncident?.totalCost).toLocaleString()"></p>
                        <p class="text-[10px] text-red-300">Estimated Value Lost (Cumulative)</p>
                        <p class="text-xs text-white mt-3 font-mono bg-black/50 p-2 rounded border border-red-500/30 break-all">
                            > <span x-text="$data.activeIncident?.errorMsg"></span>
                        </p>
                    </div>

                    <button @click="$data.repair()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wrench"></i> DEPLOY HOTFIX
                    </button>

                    <!-- AI RCA Prompt Box -->
                    <div class="mt-6 bg-white/5 p-4 rounded-lg border border-white/15">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase">Post-Mortem Generator</h4>
                            <span class="text-[9px] text-blue-400 bg-blue-900/20 px-1 rounded border border-blue-500/20">AI READY</span>
                        </div>
                        <div class="bg-black/50 p-2 rounded text-[10px] text-slate-400 font-mono mb-3 h-20 overflow-hidden relative">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                            <span x-text="$data.generateRCAPrompt()"></span>
                        </div>
                        <button @click="
                                copyToClipboard($data.generateRCAPrompt(), 'RCA Prompt');
                                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                                setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> COPY RCA PROMPT'; }, 2000)
                                " 
                                class="w-full border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-white py-3 rounded-lg text-xs font-bold transition-all uppercase tracking-widest">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> COPY RCA PROMPT
                        </button>
                    </div>

                </div>

                <!-- Healthy State Message -->
                <div x-show="$data.selectedProduct?.status !== 'critical'" class="text-center py-10 opacity-50">
                    <i class="fa-solid fa-shield-heart text-5xl text-green-500 mb-4"></i>
                    <p class="text-xs text-slate-400">System Healthy.<br>Inject a failure to test response.</p>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- SHADOW IT AUDIT TAB -->
<div x-show="currentTab === 'shadow'" x-data="dataGovComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Shadow IT Scanner</h2>
        <p class="text-textMuted text-xs md:text-sm">Don't just ban it. Audit the "Hidden Tax" of manual integration.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: INPUT SCANNER -->
        <div class="lg:col-span-4 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl h-fit">
            <h3 class="font-mono text-xs text-purple-400 uppercase mb-4 font-bold border-b border-white/10 pb-2">Add New Tool</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-slate-500 uppercase">Tool Name</label>
                    <input type="text" x-model="shadowAudit.form.name" @keydown.enter="shadowAudit.addTool()" placeholder="e.g. Monday.com, Trello" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm focus:border-purple-500 focus:outline-none">
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-[10px] text-slate-500 uppercase">User Count</label>
                        <input type="number" x-model="shadowAudit.form.users" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 uppercase">Cost/User ($)</label>
                        <input type="number" x-model="shadowAudit.form.costPerUser" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm">
                    </div>
                </div>

                <div>
                    <label class="text-[10px] text-slate-500 uppercase">Data Sensitivity</label>
                    <select x-model="shadowAudit.form.dataLevel" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm">
                        <option value="public">Public (Non-Sensitive)</option>
                        <option value="internal">Internal (Business Ops)</option>
                        <option value="confidential">Confidential (Strategy)</option>
                        <option value="restricted">Restricted (PII / Financials)</option>
                    </select>
                </div>

                <div>
                    <label class="text-[10px] text-slate-500 uppercase">Integration Status</label>
                    <div class="grid grid-cols-2 gap-2 mt-1">
                        <button @click="shadowAudit.form.integration = 'silo'" :class="shadowAudit.form.integration === 'silo' ? 'bg-red-500/20 border-red-500 text-red-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-file-csv mr-1"></i> Silo (CSV)
                        </button>
                        <button @click="shadowAudit.form.integration = 'api'" :class="shadowAudit.form.integration === 'api' ? 'bg-green-500/20 border-green-500 text-green-400' : 'bg-white/5 border-white/15 text-slate-400'" class="p-2 rounded border text-xs font-bold transition-all">
                            <i class="fa-solid fa-plug mr-1"></i> API (Auto)
                        </button>
                    </div>
                </div>

                <button @click="shadowAudit.addTool()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 rounded-lg shadow-glow transition-all mt-2">
                    SCAN & ADD
                </button>
            </div>
        </div>

        <!-- RIGHT: INVENTORY DASHBOARD -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- Summary Stats -->
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl relative overflow-hidden">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">TOTAL LIABILITY</p>
                    <h3 class="text-2xl font-mono font-bold text-white">
                        $<span x-text="Math.round(shadowAudit.summary.totalCost).toLocaleString()"></span>
                    </h3>
                    <div class="absolute right-0 bottom-0 p-3 opacity-10"><i class="fa-solid fa-money-bill-wave text-4xl"></i></div>
                </div>
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl relative overflow-hidden">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">SHADOW TAX</p>
                    <h3 class="text-2xl font-mono font-bold text-red-400">
                        $<span x-text="Math.round(shadowAudit.summary.hiddenTax).toLocaleString()"></span>
                    </h3>
                    <p class="text-[9px] text-slate-400">Manual Work Cost</p>
                </div>
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl relative overflow-hidden">
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">CRITICAL RISKS</p>
                    <h3 class="text-2xl font-mono font-bold" :class="shadowAudit.summary.highRiskCount > 0 ? 'text-red-500' : 'text-green-400'">
                        <span x-text="shadowAudit.summary.highRiskCount"></span>
                    </h3>
                    <p class="text-[9px] text-slate-400">Tools to Kill</p>
                </div>
            </div>

            <!-- Inventory List -->
            <div class="bg-dark border-2 border-dashed border-white/10 rounded-xl min-h-[300px] flex flex-col relative">
                
                <div x-show="shadowAudit.inventory.length === 0" class="flex-1 flex flex-col items-center justify-center text-slate-600 opacity-50">
                    <i class="fa-solid fa-ghost text-4xl mb-2"></i>
                    <p class="text-xs">No shadow tools detected yet.</p>
                </div>

                <div class="flex-1 overflow-y-auto p-4 space-y-2">
                    <template x-for="tool in shadowAudit.inventory" :key="tool.id">
                        <div class="bg-white/5 backdrop-blur-md border border-white/15 p-3 rounded-lg flex justify-between items-center group relative hover:border-purple-500 transition-colors">
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-white text-sm" x-text="tool.name"></span>
                                    <span class="text-[9px] px-2 py-0.5 rounded border uppercase"
                                          :class="tool.integration === 'silo' ? 'border-red-500 text-red-400 bg-red-500/10' : 'border-green-500 text-green-400 bg-green-500/10'"
                                          x-text="tool.integration"></span>
                                </div>
                                <div class="flex gap-3 text-[10px] text-slate-400 mt-1">
                                    <span>TCO: $<span x-text="Math.round(tool.trueCost).toLocaleString()"></span></span>
                                    <span>Risk: <span :class="tool.risk >= 7 ? 'text-red-400 font-bold' : 'text-slate-400'" x-text="tool.risk + '/10'"></span></span>
                                    <span class="font-mono text-purple-300" x-text="tool.verdict"></span>
                                </div>
                            </div>
                            <button @click="shadowAudit.removeTool(tool.id)" class="text-slate-600 hover:text-red-400 p-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- AI Governance Prompt -->
            <div x-show="shadowAudit.inventory.length > 0" class="bg-white/[0.03] backdrop-blur-md border border-purple-500/30 p-6 rounded-xl relative overflow-hidden group">
                <div class="flex justify-between items-center mb-4 relative z-10">
                    <h3 class="font-mono text-white font-bold flex items-center gap-2">
                        <i class="fa-solid fa-robot text-purple-400"></i> 
                        CISO GOVERNANCE AI
                    </h3>
                    <span class="text-[10px] uppercase bg-purple-900/50 text-purple-400 px-2 py-1 rounded border border-purple-500/30 font-bold tracking-wider">
                        Audit Complete
                    </span>
                </div>

                <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                    <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="shadowAudit.generateGovernancePrompt()"></pre>
                </div>

                <button @click="
                        copyToClipboard(shadowAudit.generateGovernancePrompt(), 'Audit Report');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                        setTimeout(() => {
                            $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE POLICY MEMO (AI)';
                            $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                        }, 2000)
                        " 
                        class="relative z-10 w-full py-4 bg-transparent border border-purple-500 text-purple-400 hover:bg-purple-400 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(168,85,247,0.1)] hover:shadow-[0_0_20px_rgba(168,85,247,0.4)]">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE POLICY MEMO (AI)
                </button>
            </div>

        </div>
    </div>
</div>

        <!-- HALLUCINATION DETECTOR TAB -->
<div x-show="currentTab === 'detector'" x-data="aiDetectorComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-shield-cat mr-1.5 md:mr-2 text-risk"></i>AI Hallucination Detector
        </h2>
        <p class="text-textMuted text-sm">The "Algorithmic Trust Shield". Mathematically verify AI against Policy.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-4 md:gap-8 items-start">
        
        <!-- INPUT COLUMN -->
        <div class="space-y-6">
            
            <!-- 1. The Policy (Golden Source) -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-5 rounded-xl relative">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs font-mono text-primary font-bold uppercase"><i class="fa-solid fa-book mr-2"></i>1. Ground Truth (Policy)</label>
                    <button @click="$data.loadDemo()" class="text-[10px] bg-white/5 hover:bg-white/10 text-white px-2 py-1 rounded border border-white/15">
                        Load "Air Canada" Demo
                    </button>
                </div>
                <textarea x-model="$data.policy" placeholder="Paste your official Credit Policy, Terms & Conditions, or Regulatory Rule here..." class="w-full h-40 bg-dark border border-white/15 rounded p-3 text-sm text-slate-300 font-mono focus:border-primary focus:outline-none"></textarea>
            </div>

            <!-- 2. The AI Output -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-5 rounded-xl">
                <label class="block text-xs font-mono text-purple-400 font-bold uppercase mb-2"><i class="fa-solid fa-robot mr-2"></i>2. AI Chatbot Output</label>
                <textarea x-model="$data.aiOutput" placeholder="Paste the text generated by your LLM/Chatbot here..." class="w-full h-32 bg-dark border border-white/15 rounded p-3 text-sm text-slate-300 font-mono focus:border-purple-400 focus:outline-none"></textarea>
            </div>

            <button @click="$data.scan()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-white text-dark font-bold rounded-lg shadow-glow hover:bg-gray-200 transition-all flex items-center justify-center gap-2">
                <span x-show="!$data.loading"><i class="fa-solid fa-magnifying-glass-chart"></i> RUN MATH VERIFICATION</span>
                <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> CALCULATING JACCARD INDEX...</span>
            </button>
        </div>

        <!-- OUTPUT COLUMN -->
        <div class="relative min-h-[400px]">
            
            <!-- Empty State -->
            <div x-show="!$data.result" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-fingerprint text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Ready to Scan</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.result" x-transition:enter="transition ease-out duration-500 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0"
                 class="bg-dark border-2 rounded-xl overflow-hidden shadow-glass relative"
                 :class="$data.result?.score > 80 ? 'border-primary' : 'border-risk'">
                
                <!-- Header -->
                <div class="p-6 text-center border-b border-white/[0.08]" :class="$data.result?.score > 80 ? 'bg-primary/5' : 'bg-risk/5'">
                    <span class="text-[10px] font-mono uppercase tracking-widest mb-1 block text-slate-400">TRUST SCORE</span>
                    <h3 class="text-6xl font-bold font-mono mb-2" 
                        :class="$data.result?.color"
                        x-text="$data.result?.score"></h3>
                    <span class="px-3 py-1 rounded text-xs font-bold border"
                          :class="$data.result?.score > 80 ? 'bg-primary text-dark border-primary' : 'bg-risk text-dark border-risk'"
                          x-text="$data.result?.verdict"></span>
                </div>

                <!-- Analysis Body -->
                <div class="p-6">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Deviation Log</h4>
                    
                    <div class="space-y-3">
                        <template x-for="(flag, idx) in ($data.result?.flags || [])" :key="idx">
                            <div class="p-3 rounded border-l-4 text-xs bg-white/5"
                                 :class="flag.type === 'CRITICAL' ? 'border-risk text-white' : 'border-yellow-500 text-slate-300'">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fa-solid" :class="flag.type === 'CRITICAL' ? 'fa-triangle-exclamation text-risk' : 'fa-circle-info text-yellow-500'"></i>
                                    <span class="font-bold" x-text="flag.type"></span>
                                </div>
                                <span x-text="flag.msg"></span>
                            </div>
                        </template>
                        <div x-show="$data.result?.flags.length === 0" class="text-center text-slate-500 italic text-xs py-4">
                            No mathematical deviations detected. Output aligns with Policy.
                        </div>
                    </div>

                    <!-- AI Governance Prompt -->
                    <div class="mt-8 pt-6 border-t border-white/[0.08]">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase">Model Risk Officer (MRO) Tool</h4>
                        </div>
                        
                        <div class="bg-black/50 p-3 rounded text-[10px] text-slate-400 font-mono mb-3 h-20 overflow-hidden relative">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                            <span x-text="$data.generateCompliancePrompt()"></span>
                        </div>
                        
                        <button @click="
                                copyToClipboard($data.generateCompliancePrompt(), 'Compliance Memo');
                                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                                setTimeout(() => {
                                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE RISK MEMO (AI)';
                                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                                }, 2000)
                                " 
                                class="w-full border border-purple-500 text-purple-400 hover:bg-purple-500 hover:text-white py-3 rounded text-xs font-bold transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE RISK MEMO (AI)
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- VENDOR COACH TAB -->
<div x-show="currentTab === 'vendor'" x-data="vendorNegotiatorComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Vendor Partnership Coach</h2>
        <p class="text-textMuted text-xs md:text-sm">Stop paying for "Effort". Start paying for "Impact".</p>
    </div>

    <!-- 1. INPUT PHASE -->
    <div x-show="$data.step === 'input'" class="grid lg:grid-cols-2 gap-4 md:gap-8">
        <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl">
            <h3 class="font-mono text-xs text-yellow-500 uppercase mb-4 border-b border-white/10 pb-2">Contract Parameters</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-slate-400 block mb-1">Vendor Name</label>
                    <input type="text" x-model="$data.inputs.vendorName" placeholder="e.g. Infosys, Accenture" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm focus:border-yellow-500 focus:outline-none">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">Annual Spend ($)</label>
                        <input type="number" x-model="$data.inputs.spend" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">Contract Type</label>
                        <select x-model="$data.inputs.model" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm">
                            <option value="tm">Time & Materials (Hourly)</option>
                            <option value="fixed">Fixed Price (Project)</option>
                            <option value="outcome">Managed Service</option>
                        </select>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-xs text-slate-400">Dependency (Lock-in)</label>
                        <span class="text-xs font-bold text-white" x-text="$data.inputs.dependency + '/10'"></span>
                    </div>
                    <input type="range" min="1" max="10" x-model="$data.inputs.dependency" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-red-500">
                    <p class="text-[9px] text-slate-500">10 = Impossible to fire them.</p>
                </div>

                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-xs text-slate-400">Quality Satisfaction</label>
                        <span class="text-xs font-bold text-white" x-text="$data.inputs.quality + '/10'"></span>
                    </div>
                    <input type="range" min="1" max="10" x-model="$data.inputs.quality" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-green-500">
                </div>

                <button @click="$data.analyze()" class="w-full mt-4 bg-yellow-500 hover:bg-yellow-400 text-dark font-bold py-3 rounded-lg shadow-glow transition-all">
                    ANALYZE LEVERAGE
                </button>
            </div>
        </div>

        <!-- RIGHT: EDUCATIONAL PANEL -->
        <div class="bg-dark/50 border-2 border-dashed border-white/10 rounded-xl p-8 flex flex-col justify-center items-center text-center">
            <i class="fa-solid fa-scale-balanced text-4xl text-slate-600 mb-4"></i>
            <h3 class="text-white font-bold text-lg mb-2">The Efficiency Paradox</h3>
            <p class="text-sm text-slate-400 max-w-sm">
                If you pay by the hour, you are incentivizing the vendor to be slow. 
                <br><br>
                Use this tool to calculate your "Leverage Score" and simulate the renegotiation before you walk into the room.
            </p>
        </div>
    </div>

    <!-- 2. ANALYSIS & SIMULATION PHASE -->
<template x-if="$data.step === 'analysis' || $data.step === 'sim'">
    
    <div class="grid lg:grid-cols-12 gap-4 md:gap-6">
        
        <!-- LEFT: DASHBOARD -->
        <div class="lg:col-span-4 space-y-4">
            
            <!-- Leverage Card -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl text-center relative overflow-hidden">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">YOUR LEVERAGE SCORE</p>
                <h3 class="text-5xl font-bold font-mono" :class="$data.analysis?.leverage > 60 ? 'text-green-400' : 'text-red-400'">
                    <span x-text="$data.analysis?.leverage"></span>/100
                </h3>
                <div class="mt-4 text-xs font-bold px-3 py-1 rounded bg-white/5 border border-white/15 inline-block" x-text="$data.analysis.readiness"></div>
            </div>

            <!-- Waste Card -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl text-center">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">ESTIMATED ANNUAL WASTE</p>
                <h3 class="text-3xl font-bold font-mono text-white mb-1">
                    $<span x-text="$data.analysis?.waste.toLocaleString()"></span>
                </h3>
                <p class="text-[10px] text-red-400 italic">Paying for bad quality / rework</p>
            </div>

            <!-- Trap Card -->
            <div class="bg-yellow-900/10 border border-yellow-500/30 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-2 text-yellow-500 text-xs font-bold uppercase">
                    <i class="fa-solid fa-triangle-exclamation"></i> Diagnosed Trap
                </div>
                <p class="text-xs text-white leading-relaxed" x-text="$data.analysis.trap"></p>
            </div>

            <button @click="$data.step = 'input'" class="w-full border border-white/15 text-slate-400 hover:text-white py-2 rounded text-xs">
                Edit Inputs
            </button>
        </div>

        <!-- RIGHT: SIMULATOR / PROMPT -->
        <div class="lg:col-span-8">
            
            <!-- SIMULATOR UI -->
            <div x-show="$data.step === 'analysis'" class="bg-gradient-to-br from-slate-800 to-indigo-900/20 border border-indigo-500/30 p-8 rounded-xl text-center flex flex-col justify-center min-h-[400px]">
                <i class="fa-solid fa-chess text-5xl text-indigo-400 mb-4"></i>
                <h3 class="text-2xl font-bold text-white mb-2">Negotiation Simulator</h3>
                <p class="text-slate-300 max-w-md mx-auto mb-8">Test your strategy against an AI Agent representing <span class="text-white font-bold" x-text="$data.inputs.vendorName"></span>.</p>
                
                <button @click="$data.startSim()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-full shadow-glow mx-auto transition-all">
                    ENTER THE ROOM
                </button>
            </div>

            <!-- ACTIVE GAME -->
            <div x-show="$data.step === 'sim'" class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden flex flex-col h-[500px]">
                
                <!-- Chat Log -->
                <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-dark">
                    <template x-for="(msg, idx) in $data.sim.history" :key="idx">
                        <div class="flex flex-col" :class="msg.role === 'user' ? 'items-end' : 'items-start'">
                            <div class="max-w-[85%] p-3 rounded-lg text-sm"
                                 :class="msg.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white/5 text-slate-200 border border-white/15 rounded-tl-none'">
                                <span x-text="msg.text"></span>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Controls -->
                <div class="p-4 bg-white/5 border-t border-white/10">
                    <p class="text-[10px] text-slate-400 uppercase mb-2 text-center">Choose your tactical move:</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button @click="$data.makeMove('hardball')" class="bg-red-900/30 border border-red-500/50 hover:bg-red-900/50 text-white p-2 rounded text-xs font-bold transition-all">
                            Reject & Demand
                        </button>
                        <button @click="$data.makeMove('partnership')" class="bg-blue-900/30 border border-blue-500/50 hover:bg-blue-900/50 text-white p-2 rounded text-xs font-bold transition-all">
                            Propose New Model
                        </button>
                        <button @click="$data.makeMove('threaten')" class="bg-orange-900/30 border border-orange-500/50 hover:bg-orange-900/50 text-white p-2 rounded text-xs font-bold transition-all">
                            Threaten RFP
                        </button>
                    </div>
                </div>
            </div>

            <!-- PROMPT GENERATOR (Below Sim) -->
            <div class="mt-6 bg-white/[0.03] backdrop-blur-md border border-yellow-500/30 p-6 rounded-xl relative overflow-hidden group">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-mono text-white font-bold flex items-center gap-2">
                        <i class="fa-solid fa-robot text-yellow-500"></i> AI NEGOTIATION SCRIPT
                    </h3>
                </div>
                <div class="bg-black/50 p-3 rounded text-[10px] text-slate-400 font-mono mb-3 h-20 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                    <span x-text="$data.generateNegotiationPrompt()"></span>
                </div>
                <button @click="
                        copyToClipboard($data.generateNegotiationPrompt(), 'Script');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE SCRIPT (AI)'; }, 2000)
                        " 
                        class="w-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-dark py-2 rounded text-xs font-bold transition-all">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE SCRIPT (AI)
                </button>
            </div>

        </div>
    </div>
</template> </div> 

        <!-- FINOPS AUDITOR TAB -->
<div x-show="currentTab === 'capex'" x-data="finOpsAuditorComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">FinOps Auditor</h2>
        <p class="text-textMuted text-xs md:text-sm">Translate "Jira Tickets" into "Balance Sheet Assets" (IAS 38).</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: INPUT & CONTROLS -->
        <div class="lg:col-span-4 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <div>
                <label class="block text-xs font-mono text-white mb-3 uppercase font-bold">
                    <i class="fa-solid fa-list-check mr-2"></i>Step 1: Paste Ticket List
                </label>
                <textarea x-model="$data.input" 
                          class="w-full h-48 bg-dark border border-white/15 rounded-lg p-3 text-xs font-mono text-white focus:border-green-400 focus:outline-none leading-relaxed placeholder-slate-600"
                          placeholder="FEAT-101: New Login Flow&#10;BUG-102: Fix Crash..."></textarea>
            </div>

            <!-- The Aggression Slider -->
            <div class="bg-white/5 p-4 rounded-lg border border-white/15">
                <div class="flex justify-between mb-2">
                    <label class="text-[10px] font-mono text-slate-400 uppercase">Accounting Stance</label>
                    <span class="text-[10px] font-bold" 
                          :class="$data.sensitivity > 60 ? 'text-red-400' : ($data.sensitivity < 40 ? 'text-blue-400' : 'text-green-400')"
                          x-text="$data.sensitivity > 60 ? 'AGGRESSIVE' : ($data.sensitivity < 40 ? 'CONSERVATIVE' : 'BALANCED')"></span>
                </div>
                <input type="range" min="0" max="100" step="10" x-model="$data.sensitivity" class="w-full h-2 bg-dark rounded-lg appearance-none cursor-pointer">
                <p class="text-[9px] text-slate-500 mt-2 italic">
                    <span x-show="$data.sensitivity > 60">"If it's grey, capitalize it. Boost EBITDA."</span>
                    <span x-show="$data.sensitivity < 40">"If in doubt, expense it. Reduce tax."</span>
                    <span x-show="$data.sensitivity >= 40 && $data.sensitivity <= 60">"Strict adherence to IAS 38."</span>
                </p>
            </div>

            <button @click="$data.analyze()" 
                    class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-glow transition-all">
                RUN AUDIT
            </button>
        </div>

        <!-- RIGHT: RESULTS DASHBOARD -->
        <div class="lg:col-span-8 relative min-h-[400px]">
            
            <!-- Empty State -->
            <div x-show="!$data.analysis" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-scale-balanced text-4xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Ready to Classify</p>
            </div>

            <!-- Results -->
            <div x-show="$data.analysis" x-transition class="space-y-6">
                
                <!-- Financial Summary Bar -->
                <div class="grid grid-cols-2 gap-3 md:gap-4">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-3 md:p-5 rounded-xl flex flex-col justify-between">
                        <p class="text-[8px] md:text-[10px] text-slate-500 uppercase tracking-widest">CAP RATE</p>
                        <div class="flex items-baseline gap-1.5 md:gap-2 mt-1">
                            <h3 class="text-2xl md:text-4xl font-bold font-mono text-white" x-text="$data.stats.ratio + '%'"></h3>
                            <span class="text-xs text-slate-400">Target: 40%</span>
                        </div>
                        <div class="w-full bg-white/10 h-2 rounded-full mt-3 overflow-hidden">
                            <div class="h-full transition-all duration-500" 
                                 :class="$data.stats.ratio > 60 ? 'bg-red-500' : 'bg-green-500'"
                                 :style="`width: ${$data.stats.ratio}%`"></div>
                        </div>
                    </div>
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-5 rounded-xl">
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">VALUE CREATION</p>
                        <div class="mt-2 space-y-2">
                            <div class="flex justify-between text-xs">
                                <span class="text-green-400"><i class="fa-solid fa-building mr-2"></i>ASSETS (CapEx)</span>
                                <span class="text-white font-mono" x-text="'$' + $data.stats.capexValue.toLocaleString()"></span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-orange-400"><i class="fa-solid fa-fire mr-2"></i>EXPENSE (OpEx)</span>
                                <span class="text-white font-mono" x-text="'$' + ($data.stats.totalValue - $data.stats.capexValue).toLocaleString()"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Table -->
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden max-h-[300px] overflow-y-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-white/5 text-[10px] text-slate-400 uppercase font-mono sticky top-0">
                            <tr>
                                <th class="p-3">Ticket</th>
                                <th class="p-3">Type</th>
                                <th class="p-3 hidden md:table-cell">Accounting Logic</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700">
                            <template x-for="(item, idx) in ($data.analysis || [])" :key="idx">
                                <tr class="hover:bg-white/10">
                                    <td class="p-3 font-mono text-xs text-white truncate max-w-[150px]" x-text="item.ticket"></td>
                                    <td class="p-3">
                                        <span class="px-2 py-1 rounded text-[10px] font-bold border"
                                              :class="item.type === 'CapEx' ? 'bg-green-900/20 text-green-400 border-green-500/50' : (item.type === 'OpEx' ? 'bg-orange-900/20 text-orange-400 border-orange-500/50' : 'bg-white/10 text-slate-300 border-white/20')">
                                            <span x-text="item.type"></span>
                                        </span>
                                    </td>
                                    <td class="p-3 text-slate-400 text-xs italic hidden md:table-cell" x-text="item.reason"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

                <!-- AI Prompt Box -->
                <div class="bg-white/[0.03] backdrop-blur-md border border-green-500/30 p-6 rounded-xl relative overflow-hidden group">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2">
                            <i class="fa-solid fa-robot text-green-500"></i> EXTERNAL AUDITOR DEFENSE
                        </h3>
                    </div>
                    <div class="bg-black/50 p-3 rounded text-[10px] text-slate-400 font-mono mb-3 h-20 overflow-hidden relative">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                        <span x-text="$data.generateAuditorPrompt()"></span>
                    </div>
                    <button @click="
                            copyToClipboard($data.generateAuditorPrompt(), 'Audit Data');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE DEFENSE MEMO (AI)'; }, 2000)
                            " 
                            class="w-full border border-green-500 text-green-400 hover:bg-green-500 hover:text-dark py-2 rounded text-xs font-bold transition-all">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE DEFENSE MEMO (AI)
                    </button>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- LEGACY CODE EXPLAINER TAB -->
<div x-show="currentTab === 'legacy'" x-data="legacyScannerComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">Legacy Code Scanner</h2>
        <p class="text-textMuted text-xs md:text-sm">Don't let them say "It's too risky to touch." Audit the Black Box yourself.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: THE TERMINAL (Input) -->
        <div class="flex flex-col h-[350px] md:h-[500px]">
            
            <!-- Controls -->
            <div class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-t-xl p-4 flex justify-between items-center">
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                
                <div class="flex gap-2">
                    <select x-model="$data.targetAudience" class="bg-dark border border-white/15 rounded text-xs text-white px-2 py-1">
                        <option value="ceo">Explain to CEO (Biz)</option>
                        <option value="cto">Explain to CTO (Tech)</option>
                        <option value="compliance">Explain to Risk (Audit)</option>
                    </select>
                </div>
            </div>

            <!-- Editor -->
            <div class="flex-1 relative bg-black border-x border-b border-white/10 rounded-b-xl overflow-hidden shadow-glass">
                <textarea x-model="$data.input" 
                          class="w-full h-full bg-black text-green-500 font-mono text-xs p-6 focus:outline-none resize-none leading-loose placeholder-green-900/50"
                          placeholder="// PASTE COBOL, SQL, OR JAVA HERE...
IF CUST-TYPE = 'VIP' 
   PERFORM DISCOUNT-ROUTINE 
ELSE 
   PERFORM STANDARD-FEE 
END-IF."></textarea>
                
                <!-- Run Button -->
                <div class="absolute bottom-6 right-6">
                    <button @click="$data.analyze()" 
                            :disabled="$data.loading"
                            class="bg-green-600 hover:bg-green-500 text-black font-bold py-2 px-6 rounded font-mono text-xs shadow-[0_0_15px_rgba(34,197,94,0.4)] transition-all flex items-center gap-2 disabled:opacity-50">
                        <span x-show="!$data.loading">> RUN STATIC ANALYSIS</span>
                        <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> PARSING...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- RIGHT: THE DIAGNOSTIC (Output) -->
        <div class="relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.analysis" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-code-branch text-4xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Awaiting Source Code</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.analysis" x-transition class="bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl shadow-glass relative overflow-hidden h-full flex flex-col">
                
                <!-- Header -->
                <div class="p-6 border-b border-white/10 bg-white/5">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest mb-1">DETECTED LANGUAGE</p>
                            <h3 class="text-xl font-bold text-white font-mono" x-text="$data.analysis?.language"></h3>
                        </div>
                        <div class="text-right">
                            <span class="px-3 py-1 rounded text-[10px] font-bold border uppercase"
                                  :class="$data.analysis?.riskScore > 50 ? 'bg-red-900/20 border-red-500 text-red-400' : 'bg-green-900/20 border-green-500 text-green-400'"
                                  x-text="$data.analysis?.archetype"></span>
                        </div>
                    </div>
                </div>

                <!-- Body Metrics -->
                <div class="p-6 space-y-6 flex-1">
                    
                    <!-- 1. Risk Meter -->
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-2">
                            <span class="text-slate-400">Technical Bankruptcy Score</span>
                            <span :class="$data.analysis?.riskScore > 50 ? 'text-red-400' : 'text-green-400'" x-text="$data.analysis?.riskScore + '/100'"></span>
                        </div>
                        <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-1000" 
                                 :class="$data.analysis?.riskScore > 50 ? 'bg-red-500' : 'bg-green-500'"
                                 :style="`width: ${$data.analysis?.riskScore}%`"></div>
                        </div>
                    </div>

                    <!-- 2. Value Meter -->
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-2">
                            <span class="text-slate-400">Business Logic Density</span>
                            <span class="text-blue-400" x-text="$data.analysis?.bizScore + '/100'"></span>
                        </div>
                        <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500 transition-all duration-1000" :style="`width: ${$data.analysis?.bizScore}%`"></div>
                        </div>
                    </div>

                    <!-- 3. Flaws List -->
                    <div class="bg-dark p-4 rounded-lg border border-white/10 h-32 overflow-y-auto">
                        <p class="text-[10px] text-slate-500 uppercase mb-2">CODE SMELLS DETECTED</p>
                        <template x-for="(flaw, idx) in ($data.analysis?.flaws || [])" :key="idx">
                            <div class="flex items-center gap-2 text-xs text-red-300 mb-1 font-mono">
                                <i class="fa-solid fa-bug"></i> <span x-text="flaw"></span>
                            </div>
                        </template>
                        <div x-show="$data.analysis?.flaws.length === 0" class="text-xs text-green-400 italic">
                            No critical keywords found. Code structure appears clean.
                        </div>
                    </div>
                </div>

                <!-- Footer: Prompt Gen -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-t border-white/10">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-[10px] font-bold text-white uppercase"><i class="fa-solid fa-language mr-2 text-green-500"></i>AI Translator</h4>
                    </div>
                    
                    <button @click="
                            copyToClipboard($data.generateTranslatorPrompt(), 'Prompt');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE TRANSLATION (AI)'; }, 2000)
                            " 
                            class="w-full border border-green-500 text-green-400 hover:bg-green-500 hover:text-black py-3 rounded text-xs font-bold transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE TRANSLATION (AI)
                    </button>
                    <p class="text-[9px] text-slate-500 text-center mt-2">
                        Takes calculated risk scores and asks AI to extract the Business Rule.
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- WATERMELON DETECTOR TAB -->
<div x-show="currentTab === 'watermelon'" x-data="interrogationComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">"Green Light" Lie Detector</h2>
        <p class="text-textMuted text-xs md:text-sm">Analyze sequential status reports. Detect the "Watermelon Effect".</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: THE EVIDENCE (Inputs) -->
        <div class="space-y-4">
            <template x-for="(week, idx) in ['Week 1 (2 weeks ago)', 'Week 2 (Last week)', 'Week 3 (This week)']" :key="idx">
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl">
                    <label class="block text-xs font-mono text-slate-400 mb-2 uppercase" x-text="week"></label>
                    <textarea x-model="$data.inputs[idx]" 
                              class="w-full h-24 bg-dark border border-white/15 rounded p-3 text-sm text-white focus:border-red-500 focus:outline-none placeholder-slate-600"
                              placeholder="Paste status update text..."></textarea>
                </div>
            </template>

            <button @click="$data.analyze()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2 disabled:opacity-50">
                <span x-show="!$data.loading"><i class="fa-solid fa-magnifying-glass"></i> SCAN FOR B.S.</span>
                <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> RUNNING LINGUISTIC ANALYSIS...</span>
            </button>
        </div>

        <!-- RIGHT: THE VERDICT (Output) -->
        <div class="relative min-h-[400px]">
            
            <!-- Empty State -->
            <div x-show="!$data.result" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <div class="w-20 h-20 rounded-full border-4 border-white/15 flex items-center justify-center mb-4">
                    <i class="fa-solid fa-question text-4xl"></i>
                </div>
                <p class="font-mono text-xs uppercase">Awaiting Reports</p>
            </div>

            <!-- Result Card -->
            <div x-show="$data.result" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass relative"
                 :class="$data.result?.bsScore > 50 ? 'border-red-500' : 'border-green-500'">
                
                <!-- The Gauge -->
                <div class="p-8 text-center bg-gradient-to-b from-slate-900 to-slate-800 border-b border-white/10">
                    <p class="text-[10px] font-mono uppercase tracking-widest text-slate-400 mb-2">DECEPTION PROBABILITY</p>
                    
                    <div class="relative w-40 h-40 mx-auto flex items-center justify-center rounded-full border-8 transition-colors duration-1000"
                         :class="$data.result?.bsScore > 50 ? 'border-red-500 text-red-500 bg-red-500/10' : 'border-green-500 text-green-500 bg-green-500/10'">
                        <span class="text-5xl font-bold font-mono" x-text="$data.result?.bsScore + '%'"></span>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-white mt-6 uppercase tracking-tight" x-text="$data.result?.verdict"></h3>
                </div>

                <!-- The Red Flags -->
                <div class="p-6 bg-dark">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Detected Patterns</h4>
                    <div class="space-y-3">
                        <template x-for="(flag, idx) in ($data.result?.red_flags || [])" :key="idx">
                            <div class="flex gap-3 items-start bg-white/5 p-3 rounded border border-white/10">
                                <i class="fa-solid fa-triangle-exclamation text-red-500 mt-1"></i>
                                <p class="text-sm text-slate-300 leading-tight" x-text="flag"></p>
                            </div>
                        </template>
                    </div>

                    <!-- AI Prompt Generator -->
                    <div class="mt-8 pt-6 border-t border-white/10">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase">Forensic Audit Tool</h4>
                        </div>
                        
                        <div class="bg-black/50 p-3 rounded text-[10px] text-slate-400 font-mono mb-3 h-20 overflow-hidden relative">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                            <span x-text="$data.generateInterrogationPrompt()"></span>
                        </div>
                        
                        <button @click="
                                copyToClipboard($data.generateInterrogationPrompt(), 'Audit Script');
                                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                                setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE INTERROGATION SCRIPT (AI)'; }, 2000)
                                " 
                                class="w-full border border-red-500 text-red-400 hover:bg-red-500 hover:text-white py-3 rounded text-xs font-bold transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE INTERROGATION SCRIPT (AI)
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

        <!-- RISK SIMULATOR TAB -->
<div x-show="currentTab === 'risksim'" x-data="riskSimComponent" x-cloak class="max-w-5xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-8">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">The Risk Dojo</h2>
        <p class="text-textMuted text-xs md:text-sm">Negotiate the "Go/No-Go". Balance Trust vs. Velocity.</p>
    </div>

    <!-- 1. INTRO SCREEN -->
    <div x-show="!$data.active" class="flex flex-col items-center justify-center bg-white/5 backdrop-blur-lg border border-white/10 p-10 rounded-xl text-center max-w-2xl mx-auto">
        <div class="w-24 h-24 rounded-full bg-white/5 border-2 border-risk flex items-center justify-center mb-6 shadow-[0_0_20px_rgba(248,113,113,0.3)]">
            <i class="fa-solid fa-user-shield text-4xl text-risk"></i>
        </div>
        <h3 class="text-2xl font-bold text-white mb-2">Opponent: Marcus (The CRO)</h3>
        <p class="text-slate-400 mb-8 leading-relaxed">
            "My job is to keep this bank out of the headlines. Your job is to launch features. 
            <br>Prove to me you aren't reckless, and I might let you pass."
        </p>
        <button @click="$data.start()" class="bg-risk hover:bg-red-500 text-dark font-bold py-3 px-10 rounded-lg shadow-glow transition-all">
            ENTER BOARDROOM
        </button>
    </div>

    <!-- 2. GAME BOARD -->
    <div x-show="$data.active && !$data.outcome" class="grid lg:grid-cols-12 gap-8">
        
        <!-- LEFT: MARCUS (The Opponent) -->
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-white/5 backdrop-blur-lg border-2 border-risk p-6 rounded-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-gavel text-8xl text-risk"></i></div>
                
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-16 h-16 rounded-full bg-white/5 border border-white/15 flex items-center justify-center">
                        <i class="fa-solid fa-user-tie text-2xl text-slate-300"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">Marcus</h3>
                        <p class="text-[10px] text-slate-400 uppercase tracking-widest">Chief Risk Officer</p>
                    </div>
                </div>

                <!-- Speech Bubble -->
                <div class="bg-white/5 backdrop-blur-md p-4 rounded-lg border-l-4 border-risk relative">
                    <div class="absolute -top-2 left-6 w-4 h-4 bg-white/5 transform rotate-45 border-t border-l border-white/15"></div>
                    <p class="text-sm text-white italic leading-relaxed">
                        "<span x-text="$data.currentObjection?.objection"></span>"
                    </p>
                </div>
            </div>

            <!-- Stats -->
            <div class="bg-white/[0.03] backdrop-blur-md p-4 rounded-xl border border-white/10">
                <div class="mb-4">
                    <div class="flex justify-between text-xs font-bold mb-1">
                        <span class="text-white">Marcus's Trust</span>
                        <span :class="$data.metrics.trust < 30 ? 'text-red-500' : 'text-green-400'" x-text="$data.metrics.trust + '%'"></span>
                    </div>
                    <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-500" 
                             :class="$data.metrics.trust < 30 ? 'bg-red-500' : 'bg-green-500'"
                             :style="`width: ${$data.metrics.trust}%`"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-xs font-bold mb-1">
                        <span class="text-white">Launch Velocity</span>
                        <span class="text-blue-400" x-text="$data.metrics.velocity + '%'"></span>
                    </div>
                    <div class="w-full bg-white/10 h-2 rounded-full overflow-hidden">
                        <div class="bg-blue-500 h-full transition-all duration-500" :style="`width: ${$data.metrics.velocity}%`"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: YOUR HAND (The Cards) -->
        <div class="lg:col-span-8">
            <h3 class="font-mono text-xs text-slate-500 uppercase mb-4 text-center">CHOOSE YOUR TACTIC (ROUND <span x-text="$data.round + 1"></span>/3)</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <template x-for="card in $data.cards" :key="card.id">
                    <button @click="$data.playCard(card.id)" 
                            class="group relative bg-white/5 border border-white/15 hover:border-white p-6 rounded-xl text-left transition-all hover:-translate-y-1 hover:shadow-xl">
                        
                        <div class="flex justify-between items-start mb-3">
                            <div class="w-10 h-10 rounded-full bg-white/[0.03] backdrop-blur-md flex items-center justify-center text-lg" :class="card.id === 'speed' ? 'text-red-400' : 'text-blue-400'">
                                <i :class="'fa-solid ' + card.icon"></i>
                            </div>
                            <!-- Math Preview on Hover -->
                            <div class="text-[9px] font-mono opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 px-2 py-1 rounded">
                                <span :class="card.math.trust >= 0 ? 'text-green-400' : 'text-red-400'">Trust <span x-text="card.math.trust > 0 ? '+' : ''"></span><span x-text="card.math.trust"></span></span> | 
                                <span :class="card.math.velocity >= 0 ? 'text-blue-400' : 'text-orange-400'">Vel <span x-text="card.math.velocity > 0 ? '+' : ''"></span><span x-text="card.math.velocity"></span></span>
                            </div>
                        </div>
                        
                        <h4 class="font-bold text-white text-sm mb-1" x-text="card.label"></h4>
                        <p class="text-xs text-slate-400" x-text="card.desc"></p>
                    </button>
                </template>
            </div>

            <!-- Last Action Log -->
            <div class="mt-6 text-center" x-show="$data.history.length > 0">
                <p class="text-[10px] text-slate-500 uppercase mb-2">LAST TURN RESULT</p>
                <p class="text-sm text-slate-300 italic">"<span x-text="$data.history[$data.history.length-1]?.outcome"></span>"</p>
            </div>
        </div>
    </div>

    <!-- 3. GAME OVER / RESULTS -->
    <div x-show="$data.outcome" x-transition class="max-w-2xl mx-auto">
        
        <div class="text-center mb-5 md:mb-8">
            <div class="inline-block p-4 md:p-6 rounded-full border-4 mb-3 md:mb-4 shadow-glass"
                 :class="$data.outcome.status === 'FIRED' ? 'border-red-500 bg-red-500/20 text-red-500' : 'border-green-500 bg-green-500/20 text-green-500'">
                <i class="fa-solid text-3xl md:text-5xl" :class="$data.outcome.status === 'FIRED' ? 'fa-thumbs-down' : 'fa-handshake'"></i>
            </div>
            <h2 class="text-2xl md:text-4xl font-bold text-white mb-2" x-text="$data.outcome?.status"></h2>
            <p class="text-base md:text-xl text-slate-300 font-mono mb-2" x-text="$data.outcome?.archetype"></p>
            <p class="text-xs md:text-sm text-slate-500" x-text="$data.outcome?.msg"></p>
        </div>

        <!-- AI Prompt Box -->
        <div class="bg-white/[0.03] backdrop-blur-md border border-risk/30 p-6 rounded-xl relative overflow-hidden group">
            <div class="flex justify-between items-center mb-4 relative z-10">
                <h3 class="font-mono text-white font-bold flex items-center gap-2">
                    <i class="fa-solid fa-robot text-risk"></i> 
                    NEGOTIATION COACH AI
                </h3>
            </div>

            <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-28 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateCoachingPrompt()"></pre>
            </div>

            <button @click="
                    copyToClipboard($data.generateCoachingPrompt(), 'Simulation Logs');
                    $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                    $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    setTimeout(() => {
                        $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GET COACHING (AI)';
                        $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                    }, 2000)
                    " 
                    class="relative z-10 w-full py-4 bg-transparent border border-risk text-risk hover:bg-risk hover:text-dark font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest">
                <i class="fa-solid fa-wand-magic-sparkles"></i> GET COACHING (AI)
            </button>
            
            <!-- NEW CAPTION -->
            <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
                Ready to paste into your GenAI tool of choice (ChatGPT, Claude, Gemini).
            </p>
        </div>

        <div class="text-center mt-8">
            <button @click="$data.start()" class="text-slate-500 hover:text-white underline text-sm">Play Again</button>
        </div>

    </div>
</div>


        <!-- EXCEL ESCAPE ROOM TAB -->
<div x-show="currentTab === 'escaperoom'" x-data="excelEscapeComponent" x-cloak class="max-w-4xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-8 px-1">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-green-400 mb-2 tracking-widest">
            <i class="fa-solid fa-terminal mr-1.5 md:mr-2"></i>EXCEL_FACTORY.EXE
        </h2>
        <p class="text-textMuted text-xs md:text-sm">Gamified Tech Debt Simulation. Survive 3 levels of legacy hell.</p>
    </div>

    <!-- 1. INTRO SCREEN -->
    <div x-show="!$data.active && !$data.outcome" class="flex flex-col items-center justify-center p-5 md:p-10 border-2 border-green-500/30 rounded-xl bg-black/80 text-center relative overflow-hidden min-h-[300px] md:min-h-[400px]">
        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(0deg, transparent, transparent 19px, #22c55e 20px);"></div>
        
        <i class="fa-solid fa-ghost text-4xl md:text-6xl text-green-500 mb-4 md:mb-6 animate-bounce relative z-10"></i>
        <h3 class="text-lg md:text-2xl font-bold text-white mb-2 relative z-10 font-mono">Escape the Spreadsheet</h3>
        <p class="text-slate-400 max-w-md mb-5 md:mb-8 relative z-10 text-xs md:text-sm font-mono">
            You have 100 HP (Political Capital). <br>
            Choose wisely: Manual work costs HP. Automation risks failure.
        </p>
        
        <div class="relative z-10 mb-6 w-64">
            <input type="text" x-model="$data.playerName" placeholder="ENTER AGENT NAME..." 
                   class="w-full bg-black border border-green-500 text-green-400 font-mono p-3 rounded focus:outline-none focus:shadow-[0_0_15px_#22c55e] text-center uppercase placeholder-green-900">
        </div>

        <button @click="$data.start()" class="relative z-10 bg-green-600 hover:bg-green-500 text-black font-bold py-3 px-12 rounded shadow-glow transition-all text-lg font-mono">
            > EXECUTE_SIMULATION
        </button>
        
        <!-- View Leaderboard Button -->
        <button @click="$data.fetchLeaderboard(); $data.outcome = { status: 'LEADERBOARD_VIEW' }" 
                class="relative z-10 mt-4 text-xs text-green-500 hover:text-white underline font-mono">
            [VIEW_LEADERBOARD]
        </button>
    </div>

    <!-- 2. GAMEPLAY SCREEN -->
    <div x-show="$data.active && !$data.outcome" class="relative">
        
        <!-- HUD -->
        <div class="flex flex-wrap justify-between items-center gap-2 mb-4 md:mb-6 bg-white/[0.03] backdrop-blur-md p-2.5 md:p-4 rounded-lg border border-white/10 font-mono">
            <div class="flex items-center gap-2 md:gap-4">
                <div class="text-left">
                    <p class="text-[8px] md:text-[10px] text-slate-500 uppercase">HP</p>
                    <div class="w-20 md:w-32 h-3 md:h-4 bg-white/5 rounded-sm mt-0.5 md:mt-1 overflow-hidden border border-white/15">
                        <div class="h-full transition-all duration-500" 
                             :class="$data.hp < 30 ? 'bg-red-500' : 'bg-green-500'"
                             :style="`width: ${$data.hp}%`"></div>
                    </div>
                </div>
                <div class="text-left border-l border-white/10 pl-4">
                    <p class="text-[10px] text-slate-500 uppercase">Efficiency Score</p>
                    <p class="text-xl text-yellow-400 font-bold" x-text="$data.score"></p>
                </div>
            </div>
            <div class="text-right">
                <span class="bg-green-900/30 text-green-400 border border-green-500/30 px-3 py-1 rounded text-xs">
                    LEVEL <span x-text="$data.level"></span>/3
                </span>
            </div>
        </div>

        <!-- ENCOUNTER CARD -->
        <div class="bg-black border-2 border-white/15 rounded-xl p-8 mb-6 relative overflow-hidden min-h-[300px] flex flex-col justify-center shadow-glass">
            <!-- Scanline Effect -->
            <div class="absolute inset-0 pointer-events-none opacity-5 bg-[url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif')] bg-cover"></div>

            <div class="text-center mb-8 relative z-10">
                <p class="text-xs font-mono text-red-400 mb-2 animate-pulse">⚠️ INCIDENT DETECTED</p>
                <h3 class="text-2xl font-bold text-white mb-2 font-mono" x-text="$data.gamePath[$data.level-1]?.enemy"></h3>
                <p class="text-slate-300 text-sm font-mono leading-relaxed max-w-lg mx-auto" x-text="$data.gamePath[$data.level-1]?.desc"></p>
            </div>

            <!-- CHOICES -->
            <div class="grid md:grid-cols-3 gap-4 relative z-10">
                <template x-for="(opt, idx) in $data.gamePath[$data.level-1]?.options" :key="idx">
                    <button @click="$data.makeMove(idx)" 
                            :disabled="$data.loading"
                            class="p-4 border rounded-lg text-left transition-all hover:-translate-y-1 active:scale-95 disabled:opacity-50 group h-full flex flex-col justify-between"
                            :class="opt.type === 'modern' ? 'bg-green-900/10 border-green-500 hover:bg-green-900/30' : (opt.type === 'legacy' ? 'bg-yellow-900/10 border-yellow-500 hover:bg-yellow-900/30' : 'bg-white/5 backdrop-blur-md border-white/15 hover:border-white')">
                        
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[9px] font-mono opacity-70 uppercase tracking-widest" x-text="opt.type"></span>
                                <i class="fa-solid" :class="opt.type === 'modern' ? 'fa-bolt text-green-400' : (opt.type === 'legacy' ? 'fa-wrench text-yellow-400' : 'fa-hand-paper text-slate-400')"></i>
                            </div>
                            <span class="font-bold text-xs text-white leading-tight block mb-2" x-text="opt.label"></span>
                        </div>
                        
                        <div class="text-[9px] font-mono opacity-50 pt-2 border-t border-white/10 group-hover:opacity-100">
                            Risk: <span x-text="opt.risk + '%'"></span> | Cost: <span x-text="opt.cost + ' HP'"></span>
                        </div>
                    </button>
                </template>
            </div>

            <!-- LOADING OVERLAY -->
            <div x-show="$data.loading" class="absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-20">
                <p class="font-mono text-green-400 text-sm animate-pulse">>> EXECUTING COMMAND...</p>
            </div>
        </div>

        <!-- LOG CONSOLE -->
        <div class="bg-black rounded-lg p-3 font-mono text-[10px] h-32 overflow-y-auto border border-green-500/30 shadow-inner flex flex-col-reverse">
            <template x-for="(log, idx) in $data.logs" :key="idx">
                <div class="mb-1 border-b border-white/5 pb-1 last:border-0">
                    <span class="text-green-500">>></span> <span class="text-slate-300" x-text="log"></span>
                </div>
            </template>
        </div>
    </div>

    <!-- 3. GAME OVER / VICTORY SCREEN -->
    <div x-show="$data.outcome" x-transition class="text-center py-6">
        
        <!-- Status Display (Skipped if just viewing leaderboard) -->
        <div x-show="$data.outcome?.status !== 'LEADERBOARD_VIEW'">
            <div class="inline-block p-6 rounded-full border-4 mb-6 shadow-[0_0_50px_currentColor]"
                 :class="$data.outcome?.status === 'FIRED' ? 'border-red-500 bg-red-900/20 text-red-500' : 'border-green-500 bg-green-900/20 text-green-500'">
                <i class="fa-solid text-6xl" :class="$data.outcome?.status === 'FIRED' ? 'fa-skull' : 'fa-trophy'"></i>
            </div>
            
            <h2 class="text-4xl font-bold text-white mb-2 font-mono tracking-widest" x-text="$data.outcome?.status"></h2>
            <p class="text-xl text-white font-bold mb-1" x-text="$data.outcome?.archetype"></p>
            <p class="text-slate-400 mb-8 text-sm" x-text="$data.outcome?.msg"></p>

            <!-- AI Analysis Box -->
            <div class="bg-white/[0.03] backdrop-blur-md border border-green-500/30 p-6 rounded-xl relative overflow-hidden group mb-8 text-left">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                        <i class="fa-solid fa-user-doctor text-green-500"></i> Career Coach AI
                    </h3>
                </div>
                <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                    <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generatePerformancePrompt()"></pre>
                </div>
                <button @click="
                        copyToClipboard($data.generatePerformancePrompt(), 'Game Stats');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GET CAREER FEEDBACK (AI)'; }, 2000)
                        " 
                        class="w-full border border-green-500 text-green-400 hover:bg-green-500 hover:text-black py-3 rounded text-xs font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> GET CAREER FEEDBACK (AI)
                </button>
                <p class="text-center text-[10px] text-slate-500 mt-3">
                    Ready to paste into your GenAI tool of choice.
                </p>
            </div>
        </div>

        <!-- Leaderboard Table -->
        <div class="max-w-md mx-auto bg-white/[0.03] backdrop-blur-md border border-white/10 rounded-lg overflow-hidden mb-8 text-left">
            <div class="bg-white/5 backdrop-blur-md p-3 border-b border-white/10 text-xs font-bold text-white uppercase tracking-widest flex justify-between items-center">
                <span>🏆 Top Agents</span>
                <span class="text-[9px] text-slate-400">GLOBAL RANKING</span>
            </div>
            <table class="w-full text-sm">
                <tbody class="divide-y divide-slate-800">
                    <template x-for="(entry, index) in $data.leaderboard" :key="index">
                        <tr class="hover:bg-white/10 transition-colors" 
                            :class="entry.player_name === $data.playerName ? 'bg-green-900/20' : ''">
                            <td class="p-3 font-mono text-slate-500 w-10" x-text="'#' + (index + 1)"></td>
                            <td class="p-3 text-white font-bold truncate max-w-[150px]" x-text="entry.player_name"></td>
                            <td class="p-3 text-right font-mono text-green-400" x-text="entry.score"></td>
                        </tr>
                    </template>
                    <tr x-show="!$data.leaderboard || $data.leaderboard.length === 0">
                        <td colspan="3" class="p-4 text-center text-xs text-slate-500 italic">
                            Loading or No Data...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <button @click="$data.reset(); $data.start()" class="text-slate-500 hover:text-white underline text-xs">
            Restart Game
        </button>
    </div>

</div>



        <!-- COGNITIVE LOAD CALCULATOR TAB -->
<div x-show="currentTab === 'cognitive'" x-data="cognitiveLoadComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-brain mr-1.5 md:mr-2 text-purple-400"></i>Cognitive Load Calculator
        </h2>
        <p class="text-textMuted text-sm">Measure the "Extraneous Load" killing your team's ability to think.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: THE STRESSORS (INPUTS) -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-8">
            <div class="flex justify-between items-center border-b border-white/10 pb-2">
                <h3 class="font-mono text-xs text-purple-400 uppercase font-bold">Team Inputs</h3>
                <span class="text-[10px] text-slate-500">TEAM SIZE: <span x-text="$data.inputs.teamSize"></span></span>
            </div>

            <!-- 1. Interruptions -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-white font-bold"><i class="fa-solid fa-bell mr-2 text-red-400"></i>Interruptions / Day</label>
                    <span class="text-xs font-bold text-white" x-text="$data.inputs.interruptions"></span>
                </div>
                <input type="range" min="0" max="50" x-model="$data.inputs.interruptions" @input="$data.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-red-500">
                <p class="text-[10px] text-slate-500 mt-2">Slack pings, shoulder taps, urgent emails per person.</p>
            </div>

            <!-- 2. Ambiguity -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-white font-bold"><i class="fa-solid fa-cloud-fog mr-2 text-slate-400"></i>Task Ambiguity</label>
                    <span class="text-xs font-bold text-white" x-text="$data.inputs.ambiguity + '/10'"></span>
                </div>
                <input type="range" min="1" max="10" x-model="$data.inputs.ambiguity" @input="$data.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-slate-400">
                <p class="text-[10px] text-slate-500 mt-2">1 = "Clear Specs", 10 = "Vague one-liners".</p>
            </div>

            <!-- 3. Meetings -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-white font-bold"><i class="fa-solid fa-users mr-2 text-yellow-500"></i>Meeting Hours / Week</label>
                    <span class="text-xs font-bold text-white" x-text="$data.inputs.meetings + ' hrs'"></span>
                </div>
                <input type="range" min="0" max="40" x-model="$data.inputs.meetings" @input="$data.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-yellow-500">
            </div>

            <!-- 4. Tool Frag -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-white font-bold"><i class="fa-solid fa-toolbox mr-2 text-blue-400"></i>Tools per Task</label>
                    <span class="text-xs font-bold text-white" x-text="$data.inputs.tools"></span>
                </div>
                <input type="range" min="1" max="20" x-model="$data.inputs.tools" @input="$data.result = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-blue-500">
                <p class="text-[10px] text-slate-500 mt-2">How many apps to ship one feature?</p>
            </div>

            <button @click="$data.calculate()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                <span x-show="!$data.loading"><i class="fa-solid fa-calculator"></i> MEASURE LOAD</span>
                <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> PROCESSING...</span>
            </button>
        </div>

        <!-- RIGHT: THE BRAIN MONITOR (OUTPUT) -->
        <div class="lg:col-span-7 relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.result" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-brain text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Awaiting Team Data</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.result" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass h-full flex flex-col relative"
                 :class="$data.result?.score > 80 ? 'border-red-500' : ($data.result?.score > 50 ? 'border-yellow-500' : 'border-green-500')">
                
                <!-- Monitor Header -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-b border-white/[0.08] flex justify-between items-center">
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">MENTAL CAPACITY</p>
                        <h3 class="text-3xl font-bold font-mono mt-1" :class="$data.result?.color" x-text="$data.result?.zone"></h3>
                    </div>
                    <div class="w-16 h-16 rounded-full border-4 flex items-center justify-center"
                         :class="$data.result?.score > 80 ? 'border-red-500 bg-red-900/20' : 'border-green-500 bg-green-900/20'">
                        <i class="fa-solid fa-brain text-2xl text-white"></i>
                    </div>
                </div>

                <!-- Metrics Body -->
                <div class="p-6 space-y-6 flex-1">
                    
                    <!-- Load Bar -->
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-2">
                            <span class="text-white">Load Saturation</span>
                            <span :class="$data.result?.color" x-text="$data.result?.score + '%'"></span>
                        </div>
                        <div class="w-full bg-white/5 h-4 rounded-full overflow-hidden relative">
                            <!-- Markers -->
                            <div class="absolute top-0 bottom-0 left-[50%] w-px bg-white/15 z-10"></div>
                            <div class="absolute top-0 bottom-0 left-[80%] w-px bg-red-900 z-10"></div>
                            <!-- Bar -->
                            <div class="h-full transition-all duration-1000 ease-out"
                                 :class="$data.result?.score > 80 ? 'bg-red-500' : ($data.result?.score > 50 ? 'bg-yellow-500' : 'bg-green-500')"
                                 :style="`width: ${$data.result?.score}%`"></div>
                        </div>
                        <p class="text-xs text-slate-400 mt-2 italic" x-text="$data.result?.diagnosis"></p>
                    </div>

                    <!-- Financial Impact -->
                    <div class="bg-white/5 p-4 rounded-lg border border-white/10 flex gap-4 items-center">
                        <div class="bg-white/10 p-3 rounded-full">
                            <i class="fa-solid fa-money-bill-wave text-green-400 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-500 uppercase font-bold">ANNUAL COGNITIVE TAX</p>
                            <h4 class="text-2xl font-mono text-white font-bold" x-text="'$' + $data.result?.annualTax.toLocaleString()"></h4>
                            <p class="text-[9px] text-slate-500">Wasted salary due to context switching & overhead.</p>
                        </div>
                    </div>

                </div>

                <!-- AI Prompt Box -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-t border-white/[0.08]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-purple-400"></i> Psych Analysis
                        </h3>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generatePsychPrompt()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard($data.generatePsychPrompt(), 'Team Audit');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE DEEP WORK PLAN (AI)'; }, 2000)
                            " 
                            class="w-full border border-purple-500 text-purple-400 hover:bg-purple-500 hover:text-white font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE DEEP WORK PLAN (AI)
                    </button>
                </div>

            </div>
        </div>

    </div>
</div>



        <!-- BILINGUAL BINGO TAB -->
<div x-show="currentTab === 'bingo'" x-data="meetingBingoComponent" x-cloak class="max-w-4xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-8">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-table-cells mr-1.5 md:mr-2 text-pink-500"></i>Bilingual Bingo
        </h2>
        <p class="text-textMuted text-sm">Gamify your next meeting. Click tiles when you hear/see the behavior.</p>
    </div>

    <!-- START SCREEN -->
    <div x-show="!$data.active" class="flex flex-col items-center justify-center p-12 bg-white/5 backdrop-blur-lg border-2 border-white/10 border-dashed rounded-xl text-center">
        <i class="fa-solid fa-users-viewfinder text-6xl text-slate-600 mb-6"></i>
        <h3 class="text-xl font-bold text-white mb-2">Ready to Observe?</h3>
        <p class="text-slate-400 max-w-md mb-8">This generates a random 5x5 grid of "Bilingual" (Good) and "Legacy" (Bad) behaviors. Play during the meeting.</p>
        <button @click="$data.startNewGame()" class="bg-pink-600 hover:bg-pink-500 text-white font-bold py-3 px-10 rounded-full shadow-glow transition-all">
            GENERATE BOARD
        </button>
    </div>

    <!-- GAME BOARD -->
    <div x-show="$data.active" class="flex flex-col h-full">
        
        <!-- Scoreboard -->
        <div class="flex justify-between items-center mb-6 bg-white/[0.03] backdrop-blur-md p-4 rounded-xl border border-white/10">
            <div class="flex gap-6">
                <div>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">CULTURE SCORE</p>
                    <h3 class="text-2xl font-mono font-bold" :class="$data.metrics.score > 0 ? 'text-green-400' : 'text-red-400'">
                        <span x-show="$data.metrics.score > 0">+</span><span x-text="$data.metrics.score"></span>
                    </h3>
                </div>
                <div>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">TOXICITY</p>
                    <h3 class="text-2xl font-mono font-bold" :class="$data.metrics.toxicity > 50 ? 'text-red-500' : 'text-slate-300'">
                        <span x-text="$data.metrics.toxicity"></span>%
                    </h3>
                </div>
            </div>
            
            <div class="text-right">
                <span class="px-4 py-2 rounded-lg font-bold text-sm border transition-all duration-500"
                      :class="$data.metrics.status === 'BINGO!' ? 'bg-pink-600 text-white border-pink-400 animate-pulse' : 'bg-white/5 text-slate-400 border-white/15'">
                    <span x-text="$data.metrics.status"></span>
                </span>
            </div>
        </div>

        <!-- The Grid -->
        <div class="grid grid-cols-5 gap-2 md:gap-3 aspect-square max-w-2xl mx-auto w-full">
            <template x-for="(tile, index) in $data.board" :key="tile.id">
                <button @click="$data.toggleTile(index)" 
                        class="relative p-2 md:p-4 rounded-lg border-2 flex items-center justify-center text-center transition-all duration-200 hover:scale-105 active:scale-95"
                        :class="
                            tile.id === 12 ? 'bg-pink-900/50 border-pink-500 text-pink-300' : 
                            (tile.selected ? 
                                (tile.type === 'good' ? 'bg-green-600 border-green-400 text-white' : 'bg-red-600 border-red-400 text-white') 
                                : 'bg-white/5 backdrop-blur-md border-white/10 text-slate-400 hover:border-white/20 hover:text-slate-200')
                        ">
                    
                    <!-- Icon Indicator -->
                    <div x-show="tile.selected && tile.id !== 12" class="absolute top-1 right-1 text-[10px]">
                        <i class="fa-solid" :class="tile.type === 'good' ? 'fa-check' : 'fa-triangle-exclamation'"></i>
                    </div>

                    <span class="text-[9px] md:text-xs font-bold leading-tight select-none" x-text="tile.text"></span>
                </button>
            </template>
        </div>

<!-- Footer Actions -->
        <div class="mt-8 grid md:grid-cols-2 gap-4">
            
            <!-- Reset -->
            <button @click="$data.startNewGame()" class="border border-white/15 text-slate-400 hover:text-white py-3 rounded-lg text-xs font-bold transition-all">
                <i class="fa-solid fa-rotate-right mr-2"></i> NEW GAME
            </button>

            <!-- AI Analysis -->
            <div class="relative group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg blur opacity-50 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
                <button @click="
                        copyToClipboard($data.generateCulturePrompt(), 'Bingo Stats');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-robot mr-2\'></i> ANALYZE CULTURE (AI)'; }, 2000)
                        " 
                        class="relative w-full bg-dark text-white border border-white/15 hover:border-white py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center">
                    <i class="fa-solid fa-robot mr-2"></i> ANALYZE CULTURE (AI)
                </button>
            </div>
        </div>

        <!-- NEW CAPTION -->
        <p class="text-center text-[10px] text-slate-500 mt-4">
            Ready to paste into your GenAI tool of choice. Uses Anthropological Analysis to diagnose rituals.
        </p>
        
    </div>
</div>

        
        <!-- SPRINT HEALTH CHECK TAB -->
<div x-show="currentTab === 'sprintcheck'" x-data="sprintHealthComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-stopwatch mr-1.5 md:mr-2 text-orange-400"></i>Sprint Health Check
        </h2>
        <p class="text-textMuted text-sm">60-second diagnostic. Is your sprint a "Success" or a "Death March"?</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: VITAL SIGNS (INPUTS) -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <h3 class="font-mono text-xs text-orange-400 uppercase font-bold border-b border-white/10 pb-2">Sprint Vitals</h3>

            <!-- Day & Points -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Current Day (1-10)</label>
                    <input type="number" x-model="$data.inputs.day" class="w-full bg-dark border border-white/15 rounded p-2 text-white font-mono">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Planned Points</label>
                    <input type="number" x-model="$data.inputs.plannedPts" class="w-full bg-dark border border-white/15 rounded p-2 text-white font-mono">
                </div>
            </div>

            <!-- Progress & Creep -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-green-400 uppercase font-bold">Completed Points</label>
                    <input type="number" x-model="$data.inputs.completedPts" class="w-full bg-dark border border-green-500/50 rounded p-2 text-white font-mono">
                </div>
                <div>
                    <label class="text-[10px] text-red-400 uppercase font-bold">Added Points (Creep)</label>
                    <input type="number" x-model="$data.inputs.addedPts" class="w-full bg-dark border border-red-500/50 rounded p-2 text-white font-mono">
                </div>
            </div>

            <!-- Sliders -->
            <div>
                <div class="flex justify-between mb-2">
                    <label class="text-xs font-mono text-white font-bold"><i class="fa-solid fa-face-smile mr-2 text-yellow-400"></i>Team Morale</label>
                    <span class="text-xs font-bold text-white" x-text="$data.inputs.mood + '/10'"></span>
                </div>
                <input type="range" min="1" max="10" x-model="$data.inputs.mood" @input="$data.analysis = null; $store.haptics?.fire('slide')" class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-yellow-400">
            </div>

            <div>
                <label class="block text-xs font-mono text-white font-bold mb-2">Blocker Status</label>
                <div class="grid grid-cols-3 gap-2">
                    <button @click="$data.inputs.blockers = 0; $data.analysis = null" :class="$data.inputs.blockers === 0 ? 'bg-green-500 text-dark font-bold' : 'bg-white/10 text-slate-400'" class="p-2 rounded border border-white/15 text-[10px] transition-all">Clear</button>
                    <button @click="$data.inputs.blockers = 1; $data.analysis = null" :class="$data.inputs.blockers === 1 ? 'bg-orange-500 text-white font-bold' : 'bg-white/10 text-slate-400'" class="p-2 rounded border border-white/15 text-[10px] transition-all">Sticky</button>
                    <button @click="$data.inputs.blockers = 2; $data.analysis = null" :class="$data.inputs.blockers === 2 ? 'bg-red-600 text-white font-bold' : 'bg-white/10 text-slate-400'" class="p-2 rounded border border-white/15 text-[10px] transition-all">Critical</button>
                </div>
            </div>

            <button @click="$data.calculate()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-orange-500 hover:bg-orange-400 text-white font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                <span x-show="!$data.loading"><i class="fa-solid fa-stethoscope"></i> RUN DIAGNOSTIC</span>
                <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> ANALYZING...</span>
            </button>
        </div>

        <!-- RIGHT: THE MONITOR (OUTPUT) -->
        <div class="lg:col-span-7 relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.analysis" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-heart-pulse text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Awaiting Vitals</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.analysis" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass h-full flex flex-col relative"
                 :class="$data.analysis?.score < 40 ? 'border-red-500' : ($data.analysis?.score < 70 ? 'border-orange-500' : 'border-green-500')">
                
                <!-- Monitor Header -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-b border-white/[0.08] flex justify-between items-center">
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">SUCCESS PROBABILITY</p>
                        <h3 class="text-4xl font-bold font-mono mt-1" :class="$data.analysis?.color" x-text="$data.analysis?.score + '%'"></h3>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold px-3 py-1 rounded bg-white/5 border" :class="$data.analysis?.color" x-text="$data.analysis?.weather.toUpperCase()"></span>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div class="p-6 space-y-6 flex-1">
                    
                    <!-- Trend Bar -->
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-2">
                            <span class="text-slate-400">Completion vs Time</span>
                            <span :class="$data.analysis?.drift < 0 ? 'text-red-400' : 'text-green-400'" x-text="$data.analysis?.drift + '% Drift'"></span>
                        </div>
                        <div class="w-full bg-white/5 h-4 rounded-full overflow-hidden relative">
                            <!-- Ideal Marker -->
                            <div class="absolute top-0 bottom-0 w-1 bg-white z-10 opacity-50" :style="`left: ${($data.inputs.day * 10)}%`" title="Today"></div>
                            <!-- Actual Bar -->
                            <div class="h-full transition-all duration-1000 ease-out"
                                 :class="$data.analysis?.drift < -10 ? 'bg-red-500' : 'bg-green-500'"
                                 :style="`width: ${$data.analysis?.completionRate}%`"></div>
                        </div>
                    </div>

                    <!-- Warning Flags -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/5 p-4 rounded-lg border border-white/10" :class="$data.analysis?.creep > 10 ? 'border-red-500/50' : ''">
                            <p class="text-[10px] text-slate-500 uppercase font-bold">SCOPE CREEP</p>
                            <h4 class="text-xl font-mono font-bold" :class="$data.analysis?.creep > 10 ? 'text-red-400' : 'text-slate-300'" x-text="$data.analysis?.creep + '%'"></h4>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg border border-white/10">
                            <p class="text-[10px] text-slate-500 uppercase font-bold">PRESCRIPTION</p>
                            <p class="text-xs text-white leading-tight mt-1" x-text="$data.analysis?.prescription"></p>
                        </div>
                    </div>

                </div>

                <!-- AI Prompt Box -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-t border-white/[0.08]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-orange-400"></i> Scrum Master AI
                        </h3>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateStandupPrompt()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard($data.generateStandupPrompt(), 'Standup Script');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE RESCUE SCRIPT (AI)'; }, 2000)
                            " 
                            class="w-full border border-orange-500 text-orange-400 hover:bg-orange-500 hover:text-white font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE RESCUE SCRIPT (AI)
                    </button>
                    
                    <p class="text-center text-[10px] text-slate-500 mt-3">
                        Ready to paste into your GenAI tool of choice.
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>
        



<!-- ADAPTABILITY MONITOR TAB -->
<div x-show="currentTab === 'adaptation'" x-data="adaptMonitorComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-dna mr-1.5 md:mr-2 text-cyan-400"></i>Adaptability Monitor
        </h2>
        <p class="text-textMuted text-sm">Survival of the fittest? No. Survival of the most adaptable.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: SENSORS (INPUTS) -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <h3 class="font-mono text-xs text-cyan-400 uppercase font-bold border-b border-white/10 pb-2">Organizational Sensors</h3>

            <template x-for="dim in $data.dimensions" :key="dim.id">
                <div>
                    <div class="flex justify-between mb-2">
                        <label class="text-xs font-mono text-white font-bold" x-text="dim.label"></label>
                        <span class="text-xs font-bold" :class="dim.val < 4 ? 'text-red-400' : 'text-cyan-400'" x-text="dim.val + '/10'"></span>
                    </div>
                    <input type="range" min="1" max="10" x-model.number="dim.val" @input="$data.result = null; $store.haptics?.fire('slide')" 
                           class="w-full h-2 bg-white/5 rounded-lg appearance-none cursor-pointer accent-cyan-400">
                    <p class="text-[10px] text-slate-500 mt-1" x-text="dim.desc"></p>
                </div>
            </template>

            <button @click="$data.calculate()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-dark font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                <span x-show="!$data.loading"><i class="fa-solid fa-microscope"></i> CALCULATE AQ</span>
                <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> SEQUENCING DNA...</span>
            </button>
        </div>

        <!-- RIGHT: THE RADAR (OUTPUT) -->
        <div class="lg:col-span-7 relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.result" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-chart-radar text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Awaiting Sensor Data</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.result" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass h-full flex flex-col relative"
                 :class="$data.result?.aq > 70 ? 'border-cyan-500' : 'border-white/15'">
                
                <!-- Monitor Header -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-b border-white/[0.08] flex justify-between items-center">
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">ADAPTABILITY QUOTIENT (AQ)</p>
                        <h3 class="text-4xl font-bold font-mono mt-1" :class="$data.result?.color" x-text="$data.result?.aq"></h3>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold px-3 py-1 rounded bg-white/5 border" :class="$data.result?.color" x-text="$data.result?.archetype.toUpperCase()"></span>
                        <p class="text-[9px] text-slate-500 mt-1">ORGANIC STATE</p>
                    </div>
                </div>

                <!-- Alert Console -->
                <div x-show="$data.result?.penalty" class="bg-red-900/20 border-b border-red-500/30 p-2 text-center animate-pulse">
                    <p class="text-[10px] text-red-400 font-mono font-bold">
                        <i class="fa-solid fa-triangle-exclamation mr-2"></i><span x-text="$data.result?.penalty"></span>
                    </p>
                </div>

                <!-- Chart Area -->
                <div class="p-4 flex-1 flex items-center justify-center bg-dark/50">
                    <div class="w-full max-w-sm h-64">
                        <canvas id="adaptChart"></canvas>
                    </div>
                </div>

                <!-- Analysis Footer -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-t border-white/[0.08] space-y-4">
                    <div class="flex items-start gap-3">
                        <div class="bg-white/5 backdrop-blur-md p-2 rounded text-cyan-400"><i class="fa-solid fa-user-doctor"></i></div>
                        <div>
                            <p class="text-[10px] text-slate-500 uppercase font-bold">DIAGNOSIS</p>
                            <p class="text-xs text-white leading-relaxed" x-text="$data.result?.advice"></p>
                        </div>
                    </div>

                    <!-- AI Prompt Button -->
                    <div class="border-t border-white/[0.08] pt-4">
                        <div class="bg-black/50 p-3 rounded text-[10px] text-slate-400 font-mono mb-3 h-16 overflow-hidden relative">
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 pointer-events-none"></div>
                            <span x-text="$data.generateChangePrompt()"></span>
                        </div>

                        <button @click="
                                copyToClipboard($data.generateChangePrompt(), 'Health Report');
                                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                                setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE INTERVENTION PLAN (AI)'; }, 2000)
                                " 
                                class="w-full border border-cyan-500 text-cyan-400 hover:bg-cyan-500 hover:text-dark font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE INTERVENTION PLAN (AI)
                        </button>
                        <p class="text-center text-[10px] text-slate-500 mt-2">
                            Ready to paste into your GenAI tool of choice.
                        </p>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>


        
<!-- REGULATORY IMPACT SIMULATOR TAB -->
<div x-show="currentTab === 'regsim'" x-data="regSimulatorComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-gavel mr-1.5 md:mr-2 text-yellow-500"></i>Regulatory Impact Simulator
        </h2>
        <p class="text-textMuted text-sm">Visualize the "Blast Radius" of incoming regulations on your legacy stack.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: CONFIGURATION -->
        <div class="lg:col-span-4 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <h3 class="font-mono text-xs text-yellow-500 uppercase font-bold border-b border-white/10 pb-2">1. Select Threat</h3>
            
            <div class="grid grid-cols-2 gap-2">
                <template x-for="reg in $data.regulations" :key="reg.id">
                    <button @click="$data.selectedReg = reg; $data.analysis = null" 
                            class="p-3 rounded border text-left transition-all"
                            :class="$data.selectedReg?.id === reg.id ? 'bg-yellow-500 text-black border-yellow-500' : 'bg-white/5 text-slate-400 border-white/15 hover:border-yellow-500'">
                        <span class="block font-bold text-xs" x-text="reg.name"></span>
                        <span class="block text-[9px] opacity-70" x-text="reg.focus"></span>
                    </button>
                </template>
            </div>

            <div x-show="$data.selectedReg" x-transition>
                <div class="bg-white/5 p-3 rounded border border-white/10 mb-6">
                    <p class="text-xs text-slate-300 italic" x-text="$data.selectedReg?.desc"></p>
                </div>

                <h3 class="font-mono text-xs text-yellow-500 uppercase font-bold border-b border-white/10 pb-2 mb-4">2. Org Context</h3>
                
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-[10px] text-slate-400 uppercase">Legacy Debt</label>
                            <span class="text-[10px] font-bold text-white" x-text="$data.inputs.legacyScore + '%'"></span>
                        </div>
                        <input type="range" x-model="$data.inputs.legacyScore" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-red-500">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-[10px] text-slate-400 uppercase">Data Governance</label>
                            <span class="text-[10px] font-bold text-white" x-text="$data.inputs.dataGovernance + '%'"></span>
                        </div>
                        <input type="range" x-model="$data.inputs.dataGovernance" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    </div>
                </div>

                <button @click="$data.simulate()" 
                        :disabled="$data.loading"
                        class="w-full mt-6 py-4 bg-yellow-600 hover:bg-yellow-500 text-black font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                    <span x-show="!$data.loading"><i class="fa-solid fa-burst"></i> SIMULATE IMPACT</span>
                    <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> CALCULATING...</span>
                </button>
            </div>
        </div>

        <!-- RIGHT: THE BLAST RADIUS (OUTPUT) -->
        <div class="lg:col-span-8 relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.analysis" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-scale-unbalanced-flip text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Select Regulation to Begin</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.analysis" x-transition class="h-full flex flex-col gap-6">
                
                <!-- 1. The Bill -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">EST. IMPLEMENTATION COST</p>
                        <h3 class="text-2xl font-mono font-bold text-white mt-1" x-text="'$' + ($data.analysis?.cost / 1000000).toFixed(1) + 'M'"></h3>
                    </div>
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center">
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">TIMELINE</p>
                        <h3 class="text-2xl font-mono font-bold text-yellow-400 mt-1" x-text="$data.analysis?.timeline + ' Months'"></h3>
                    </div>
                    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-4 rounded-xl text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-red-900/20 animate-pulse"></div>
                        <p class="text-[10px] text-red-400 uppercase tracking-widest relative z-10">MAX FINE EXPOSURE</p>
                        <h3 class="text-2xl font-mono font-bold text-red-500 mt-1 relative z-10" x-text="'$' + ($data.analysis?.exposure / 1000000).toFixed(1) + 'M'"></h3>
                    </div>
                </div>

                <!-- 2. The Blast Radius (Heatmap) -->
                <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl flex-1">
                    <h3 class="font-mono text-xs text-white uppercase mb-4 font-bold flex justify-between">
                        <span>System Impact Heatmap</span>
                        <span class="text-red-400" x-text="$data.analysis?.complexity"></span>
                    </h3>
                    
                    <div class="space-y-4">
                        <template x-for="(sys, idx) in ($data.analysis?.systems || [])" :key="idx">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-slate-300 font-bold" x-text="sys.name"></span>
                                    <span class="font-mono" :class="sys.heat > 70 ? 'text-red-500' : (sys.heat > 40 ? 'text-yellow-500' : 'text-green-500')" x-text="Math.round(sys.heat) + '% Impact'"></span>
                                </div>
                                <div class="w-full bg-white/5 h-3 rounded-full overflow-hidden">
                                    <div class="h-full transition-all duration-1000"
                                         :class="sys.heat > 70 ? 'bg-red-600' : (sys.heat > 40 ? 'bg-yellow-500' : 'bg-green-500')"
                                         :style="`width: ${Math.min(100, sys.heat)}%`"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white/5 rounded-lg border-l-4 border-yellow-500">
                        <p class="text-xs text-slate-300 italic">
                            "Because of your <strong>High Legacy Debt</strong>, the cost of implementing <span x-text="$data.selectedReg?.name"></span> is <strong class="text-white">2.5x higher</strong> than a Neobank."
                        </p>
                    </div>
                </div>

                <!-- 3. AI Prompt Box -->
                <div class="bg-white/[0.03] backdrop-blur-md border border-yellow-500/30 p-6 rounded-xl relative overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-yellow-500"></i> Compliance Architect AI
                        </h3>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateCompliancePrompt()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard($data.generateCompliancePrompt(), 'Roadmap Data');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE COMPLIANCE ROADMAP (AI)'; }, 2000)
                            " 
                            class="w-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE COMPLIANCE ROADMAP (AI)
                    </button>
                    
                    <p class="text-center text-[10px] text-slate-500 mt-2">
                        Ready to paste into your GenAI tool of choice.
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>


        <!-- VALUE STREAM CALCULATOR TAB -->
<div x-show="currentTab === 'flow'" x-data="flowCalcComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-water mr-1.5 md:mr-2 text-blue-400"></i>Flow Efficiency Calculator
        </h2>
        <p class="text-textMuted text-xs md:text-sm">Most processes are 90% waiting. Find the hidden waste.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: MAPPER (INPUTS) -->
        <div class="lg:col-span-5 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <div class="flex justify-between items-center border-b border-white/10 pb-2">
                <h3 class="font-mono text-xs text-blue-400 uppercase font-bold">Process Map</h3>
                <select x-model="$data.unit" class="bg-dark border border-white/15 rounded text-[10px] text-white px-2 py-1">
                    <option value="minutes">Minutes</option>
                    <option value="hours">Hours</option>
                    <option value="days">Days</option>
                </select>
            </div>

            <div>
                <label class="text-[10px] text-slate-500 uppercase">Process Name</label>
                <input type="text" x-model="$data.processName" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm focus:border-blue-500 outline-none">
            </div>

            <!-- Steps List -->
            <div class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                <template x-for="(step, index) in $data.steps" :key="step.id">
                    <div class="bg-white/5 backdrop-blur-md p-3 rounded border border-white/15 relative group">
                        <button @click="$data.removeStep(step.id)" class="absolute top-2 right-2 text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-xmark"></i></button>
                        
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-white/10 text-slate-300 w-5 h-5 flex items-center justify-center rounded-full text-[10px] font-bold" x-text="index + 1"></span>
                            <input type="text" x-model="step.name" class="bg-transparent text-white text-sm font-bold w-full focus:outline-none" placeholder="Step Name">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[9px] text-green-400 uppercase font-bold block mb-1">Work Time (Value)</label>
                                <input type="number" x-model="step.work" class="w-full bg-dark border border-green-900 rounded p-1 text-white text-xs">
                            </div>
                            <div>
                                <label class="text-[9px] text-red-400 uppercase font-bold block mb-1">Wait Time (Waste)</label>
                                <input type="number" x-model="step.wait" class="w-full bg-dark border border-red-900 rounded p-1 text-white text-xs">
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <div class="flex gap-3">
                <button @click="$data.addStep()" class="flex-1 border border-white/15 text-slate-400 hover:text-white py-2 rounded-lg text-xs font-bold transition-all">
                    + ADD STEP
                </button>
                <button @click="$data.calculate()" 
                        class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                    <span x-show="!$data.loading"><i class="fa-solid fa-calculator"></i> CALCULATE FLOW</span>
                    <span x-show="$data.loading"><i class="fa-solid fa-circle-notch fa-spin"></i> MAPPING...</span>
                </button>
            </div>
        </div>

        <!-- RIGHT: VISUALIZER (OUTPUT) -->
        <div class="lg:col-span-7 relative min-h-[500px]">
            
            <!-- Empty State -->
            <div x-show="!$data.metrics" class="absolute inset-0 flex flex-col items-center justify-center border-2 border-dashed border-white/10 rounded-xl text-slate-500">
                <i class="fa-solid fa-stopwatch text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Map your Value Stream</p>
            </div>

            <!-- Results Card -->
            <div x-show="$data.metrics" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass h-full flex flex-col relative"
                 :class="$data.metrics?.efficiency < 15 ? 'border-red-500' : ($data.metrics?.efficiency < 40 ? 'border-yellow-500' : 'border-green-500')">
                
                <!-- Monitor Header -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-b border-white/[0.08] flex justify-between items-center">
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">FLOW EFFICIENCY SCORE</p>
                        <h3 class="text-4xl font-bold font-mono mt-1" :class="$data.metrics?.color" x-text="$data.metrics?.efficiency + '%'"></h3>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold px-3 py-1 rounded bg-white/5 border uppercase" :class="$data.metrics?.color" x-text="$data.metrics?.verdict"></span>
                        <p class="text-[9px] text-slate-500 mt-1">Target: >25%</p>
                    </div>
                </div>

                <!-- The "Stream" Visualization -->
                <div class="p-6 bg-dark border-b border-white/[0.08] overflow-x-auto">
                    <p class="text-[10px] text-slate-500 uppercase mb-3 font-bold">TIMELINE VISUALIZATION (GREEN=WORK, RED=WAIT)</p>
                    <div class="flex h-12 w-full rounded-lg overflow-hidden relative min-w-[300px]">
                        <template x-for="(step, idx) in $data.steps" :key="idx">
                            <div class="flex h-full flex-grow" :style="`flex-grow: ${parseFloat(step.work) + parseFloat(step.wait)}`">
                                <!-- Work Segment -->
                                <div class="h-full bg-green-500 border-r border-black/20 relative group" 
                                     :style="`width: ${(step.work / (parseFloat(step.work) + parseFloat(step.wait))) * 100}%`">
                                     <div class="absolute bottom-full mb-1 left-0 text-[9px] bg-black text-white px-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-10" x-text="step.work"></div>
                                </div>
                                <!-- Wait Segment -->
                                <div class="h-full bg-red-500/80 border-r border-black/20 relative group"
                                     :style="`width: ${(step.wait / (parseFloat(step.work) + parseFloat(step.wait))) * 100}%`">
                                     <div class="absolute bottom-full mb-1 right-0 text-[9px] bg-black text-white px-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-10" x-text="step.wait"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div class="flex justify-between text-[10px] text-slate-500 mt-2 font-mono">
                        <span>Start</span>
                        <span>Total Lead Time: <span x-text="$data.metrics?.totalLeadTime + ' ' + $data.unit"></span></span>
                    </div>
                </div>

                <!-- Metrics Body -->
                <div class="p-6 space-y-6 flex-1">
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-green-900/10 border border-green-500/30 p-4 rounded-lg">
                            <p class="text-[10px] text-green-400 uppercase font-bold">VALUE ADD TIME</p>
                            <h4 class="text-2xl font-mono text-white font-bold" x-text="$data.metrics?.totalWork"></h4>
                            <p class="text-[9px] text-slate-500" x-text="$data.unit"></p>
                        </div>
                        <div class="bg-red-900/10 border border-red-500/30 p-4 rounded-lg">
                            <p class="text-[10px] text-red-400 uppercase font-bold">WASTE (WAIT TIME)</p>
                            <h4 class="text-2xl font-mono text-white font-bold" x-text="$data.metrics?.totalWait"></h4>
                            <p class="text-[9px] text-slate-500" x-text="$data.unit"></p>
                        </div>
                    </div>

                    <!-- Bottleneck Alert -->
                    <div class="bg-white/5 backdrop-blur-md border-l-4 border-orange-500 p-4 rounded-r-lg">
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fa-solid fa-triangle-exclamation text-orange-500 text-xs"></i>
                            <p class="text-[10px] text-orange-400 uppercase font-bold">PRIMARY BOTTLENECK DETECTED</p>
                        </div>
                        <p class="text-white font-bold text-sm">"<span x-text="$data.metrics?.bottleneck.name"></span>"</p>
                        <p class="text-xs text-slate-400 mt-1">
                            Accounting for <span x-text="$data.metrics?.totalWait ? Math.round(($data.metrics.bottleneck.wait / $data.metrics.totalWait) * 100) : 0"></span>% of all delays.
                        </p>
                    </div>

                </div>

                <!-- AI Prompt Box -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-t border-white/[0.08]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-blue-400"></i> Lean Master AI
                        </h3>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateLeanPrompt()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard($data.generateLeanPrompt(), 'Analysis Data');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE LEAN STRATEGY (AI)'; }, 2000)
                            " 
                            class="w-full border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-white font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE LEAN STRATEGY (AI)
                    </button>
                    <p class="text-center text-[10px] text-slate-500 mt-3">
                        Ready to paste into your GenAI tool of choice.
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>


        <!-- ADR BUILDER TAB -->
<div x-show="currentTab === 'adr'" x-data="adrBuilderComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-book-journal-whills mr-1.5 md:mr-2 text-indigo-300"></i>ADR Journal
        </h2>
        <p class="text-textMuted text-xs md:text-sm">Don't rely on memory. Rely on weighted math.</p>
    </div>

    <!-- HEADER / DEMO -->
    <div class="flex flex-col sm:flex-row justify-between sm:items-end gap-3 mb-4 md:mb-6">
        <div class="w-full sm:max-w-lg">
            <label class="text-[10px] md:text-xs font-mono text-slate-400 uppercase">Decision Title</label>
            <input type="text" x-model="$data.title" placeholder="e.g. Monolith vs Microservices" class="w-full bg-dark border border-white/15 rounded p-2.5 md:p-3 text-sm md:text-base text-white focus:border-indigo-400 focus:outline-none mt-1">
        </div>
        <button @click="$data.loadDemo()" class="text-xs border border-white/15 hover:bg-white/10 text-slate-300 px-3 py-2 rounded transition-all self-start sm:self-auto shrink-0">
            Load Demo
        </button>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: THE MATRIX (INPUTS) -->
        <div class="lg:col-span-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden">
            <div class="p-4 bg-white/5 border-b border-white/10 flex justify-between items-center">
                <h3 class="font-mono text-xs text-indigo-300 uppercase font-bold">Evaluation Matrix</h3>
                <div class="flex gap-2">
                    <button @click="$data.addCriteria()" class="text-[10px] bg-white/10 hover:bg-white/15 text-white px-2 py-1 rounded">+ Criteria</button>
                    <button @click="$data.addOption()" class="text-[10px] bg-white/10 hover:bg-white/15 text-white px-2 py-1 rounded">+ Option</button>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="bg-white/[0.03] text-slate-400 text-[10px] uppercase font-mono">
                            <th class="p-4 w-1/3">Criteria (Weight 1-5)</th>
                            <template x-for="opt in $data.options" :key="opt.id">
                                <th class="p-4 text-center border-l border-white/10">
                                    <input type="text" x-model="opt.name" class="bg-transparent text-center w-full focus:outline-none text-white font-bold">
                                </th>
                            </template>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700">
                        <template x-for="crit in $data.criteria" :key="crit.id">
                            <tr class="hover:bg-white/10">
                                <td class="p-4">
                                    <div class="flex flex-col gap-1">
                                        <input type="text" x-model="crit.label" class="bg-transparent text-white focus:outline-none">
                                        <div class="flex items-center gap-2">
                                            <span class="text-[9px] text-slate-500">IMPORTANCE:</span>
                                            <input type="range" min="1" max="5" x-model="crit.weight" @input="$data.calculate(); $store.haptics?.fire('slide')" class="w-16 h-1 bg-white/15 rounded-lg appearance-none cursor-pointer">
                                            <span class="text-[9px] font-mono text-indigo-400" x-text="crit.weight"></span>
                                        </div>
                                    </div>
                                </td>
                                <template x-for="opt in $data.options" :key="opt.id">
                                    <td class="p-4 text-center border-l border-white/10">
                                        <input type="number" min="1" max="5" 
                                               x-model="opt.scores[crit.id]" 
                                               @input="$data.calculate()"
                                               class="w-10 bg-dark border border-white/15 rounded text-center text-white focus:border-indigo-400">
                                    </td>
                                </template>
                            </tr>
                        </template>
                    </tbody>
                    <!-- Totals Row -->
                    <tfoot class="bg-white/[0.03] backdrop-blur-md border-t-2 border-white/10">
                        <tr>
                            <td class="p-4 font-mono text-xs text-slate-400 text-right uppercase tracking-widest">Weighted Score</td>
                            <template x-for="opt in $data.options" :key="opt.id">
                                <td class="p-4 text-center border-l border-white/10">
                                    <span class="text-xl font-bold font-mono" 
                                          :class="opt.id === $data.winner?.id ? 'text-green-400' : 'text-slate-500'"
                                          x-text="opt.total"></span>
                                </td>
                            </template>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- RIGHT: THE VERDICT (OUTPUT) -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Winner Card -->
            <div class="bg-gradient-to-br from-slate-800 to-indigo-900/30 border border-indigo-500/30 p-6 rounded-xl relative overflow-hidden" x-show="$data.winner">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-trophy text-6xl text-yellow-400"></i></div>
                
                <p class="text-[10px] text-indigo-300 uppercase tracking-widest mb-2">RECOMMENDED DECISION</p>
                <h3 class="text-2xl font-bold text-white mb-4" x-text="$data.winner?.name"></h3>
                
                <div class="space-y-2">
                    <div class="flex justify-between text-xs border-b border-white/10 pb-1">
                        <span class="text-slate-400">Total Score</span>
                        <span class="text-white font-mono" x-text="$data.winner?.total"></span>
                    </div>
                    <div class="flex justify-between text-xs border-b border-white/10 pb-1">
                        <span class="text-slate-400">Winning Margin</span>
                        <span class="text-green-400 font-mono">+<span x-text="$data.options.length > 1 ? ($data.winner?.total - $data.options.sort((a,b)=>b.total-a.total)[1].total) : 0"></span></span>
                    </div>
                </div>
                
                <div class="mt-6">
                    <span class="text-[9px] bg-indigo-500 text-white px-2 py-1 rounded font-bold uppercase">Status: Proposed</span>
                </div>
            </div>

            <!-- AI Prompt Box -->
            <div class="bg-white/[0.03] backdrop-blur-md border border-white/10 p-6 rounded-xl group">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                        <i class="fa-solid fa-robot text-indigo-400"></i> ADR Generator
                    </h3>
                </div>

                <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                    <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateADRPrompt()"></pre>
                </div>

                <button @click="
                        copyToClipboard($data.generateADRPrompt(), 'Decision Data');
                        $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                        setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE ADR DOC (AI)'; }, 2000)
                        " 
                        class="w-full border border-indigo-500 text-indigo-400 hover:bg-indigo-500 hover:text-white font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE ADR DOC (AI)
                </button>
                <p class="text-center text-[10px] text-slate-500 mt-3">
                    Ready to paste into your GenAI tool of choice.
                </p>
            </div>

        </div>
    </div>
</div>


        <!-- DAILY FEED TAB -->
<div x-show="currentTab === 'feed'" x-data="dailyFeedComponent" x-cloak class="max-w-2xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-8">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-mug-hot mr-1.5 md:mr-2 text-yellow-400"></i>Daily Insight
        </h2>
        <p class="text-textMuted text-sm">Build your executive vocabulary. 60 seconds a day.</p>
    </div>

    <!-- 1. HUD: STREAK & NOTIFICATIONS -->
    <div class="flex justify-between items-center mb-4 md:mb-6 bg-white/5 backdrop-blur-lg border border-white/10 p-3 md:p-4 rounded-xl">
        
        <!-- Left: Streak -->
        <div class="flex items-center gap-2.5 md:gap-4">
            <div class="w-10 h-10 md:w-12 md:h-12 bg-orange-500/20 text-orange-500 rounded-full flex items-center justify-center text-base md:text-xl border border-orange-500/50 shadow-[0_0_15px_rgba(249,115,22,0.3)]">
                <i class="fa-solid fa-fire animate-pulse"></i>
            </div>
            <div>
                <p class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-widest font-mono">STREAK</p>
                <h3 class="text-lg md:text-2xl font-bold text-white"><span x-text="$data.streak"></span> Days</h3>
            </div>
        </div>
        
        <!-- Right: Notification Toggle -->
        <div class="text-right shrink-0">
            <button x-show="$data.notificationPermission === 'default'" 
                    @click="$data.requestNotify()" 
                    class="text-[10px] md:text-xs bg-white/10 hover:bg-white/15 text-white px-3 md:px-4 py-1.5 md:py-2 rounded-full transition-colors border border-white/15 mb-1 flex items-center gap-1.5 md:gap-2">
                <i class="fa-regular fa-bell"></i> <span class="hidden sm:inline">Enable</span> 9AM Alert
            </button>
            <div x-show="$data.notificationPermission === 'granted'" class="flex flex-col items-end">
                <p class="text-[9px] md:text-[10px] text-green-400 font-mono flex items-center gap-1">
                    <i class="fa-solid fa-check-circle"></i> ACTIVE
                </p>
                <p class="text-[8px] md:text-[9px] text-slate-500">09:00</p>
            </div>
        </div>
    </div>

    <!-- 2. MASTERY SCOREBOARD -->
    <div class="grid grid-cols-2 gap-3 md:gap-4 mb-4 md:mb-6">
        <!-- Fluency Score -->
        <div class="bg-white/[0.03] backdrop-blur-md p-3 md:p-4 rounded-xl border border-white/10 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-2 md:p-3 opacity-10"><i class="fa-solid fa-brain text-3xl md:text-4xl text-yellow-400"></i></div>
            <p class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-widest font-bold">FLUENCY XP</p>
            <h3 class="text-2xl md:text-3xl font-mono font-bold text-yellow-400 mt-1" x-text="$data.fluencyScore"></h3>
        </div>
        
        <!-- Rank -->
        <div class="bg-white/[0.03] backdrop-blur-md p-3 md:p-4 rounded-xl border border-white/10">
            <p class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-widest font-bold">RANK</p>
            <div class="flex justify-between items-center mt-1">
                <h3 class="text-base md:text-xl font-bold text-white" x-text="$data.fluencyLevel"></h3>
                <i class="fa-solid" 
                   :class="$data.fluencyLevel === 'Novice' ? 'fa-seedling text-green-400' : ($data.fluencyLevel === 'Apprentice' ? 'fa-book text-blue-400' : 'fa-crown text-yellow-400')"></i>
            </div>
            <!-- XP Progress Bar -->
            <div class="w-full bg-white/10 h-1.5 rounded-full mt-3 overflow-hidden">
                <div class="bg-gradient-to-r from-yellow-600 to-yellow-400 h-full transition-all duration-1000" 
                     :style="`width: ${($data.fluencyScore % 300) / 3}%`"></div>
            </div>
        </div>
    </div>

    <!-- 3. THE FLASHCARD (Main Interaction) -->
    <div class="relative min-h-[400px] md:min-h-[500px]">
        
        <!-- Loading State Overlay -->
        <div x-show="$data.loading" class="absolute inset-0 flex flex-col items-center justify-center bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl z-20">
            <i class="fa-solid fa-satellite-dish fa-spin text-5xl text-yellow-400 mb-6"></i>
            <p class="font-mono text-xs text-yellow-200 animate-pulse uppercase tracking-widest">DOWNLOADING INTELLIGENCE...</p>
        </div>

        <!-- The Card -->
        <div x-show="!$data.loading && $data.currentLesson" class="bg-gradient-to-b from-slate-800 to-slate-900 border border-white/15 rounded-2xl shadow-glass overflow-hidden flex flex-col h-full relative group transition-all duration-500">
            
            <!-- Date Badge -->
            <div class="absolute top-0 right-0 bg-white/10 backdrop-blur text-slate-300 text-[10px] px-3 py-1 rounded-bl-xl font-mono border-b border-l border-white/15">
                <span x-text="new Date().toLocaleDateString(undefined, {weekday:'long', month:'short', day:'numeric'})"></span>
            </div>

            <!-- Card Body -->
            <div class="p-8 flex-1">
                <p class="text-[10px] text-yellow-500 font-bold uppercase tracking-widest mb-2">TERM OF THE DAY</p>
                
                <h2 class="text-4xl font-bold text-white mb-2 tracking-tight leading-tight" x-text="$data.currentLesson?.term"></h2>
                
                <div class="flex items-center gap-2 mb-8">
                    <span class="text-xs text-slate-500 font-mono bg-white/5 px-2 py-1 rounded">/ <span x-text="$data.currentLesson?.pronounce"></span> /</span>
                </div>
                
                <div class="space-y-8">
                    <!-- Definition -->
                    <div>
                        <h4 class="text-xs font-bold text-white mb-2 flex items-center"><i class="fa-solid fa-book-open mr-2 text-slate-400"></i>Definition</h4>
                        <p class="text-base text-slate-300 leading-relaxed font-light" x-text="$data.currentLesson?.definition"></p>
                    </div>
                    
                    <!-- Analogy Box -->
                    <div class="bg-blue-900/10 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <h4 class="text-xs font-bold text-blue-400 mb-2 uppercase"><i class="fa-solid fa-lightbulb mr-2"></i>The Analogy</h4>
                        <p class="text-sm text-blue-100 italic leading-relaxed" x-text="$data.currentLesson?.analogy"></p>
                    </div>

                    <!-- Impact -->
                    <div>
                        <h4 class="text-xs font-bold text-green-400 mb-2 uppercase"><i class="fa-solid fa-chart-line mr-2"></i>Executive Impact</h4>
                        <p class="text-sm text-slate-300" x-text="$data.currentLesson?.impact"></p>
                    </div>
                </div>
            </div>

            <!-- Quiz Section (Bottom) -->
            <div class="bg-black/30 border-t border-white/10 p-6 backdrop-blur-sm">
                
                <!-- State: Question -->
                <div x-show="$data.quizState === 'pending'">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-3 flex justify-between">
                        <span>QUICK CHECK</span>
                        <span class="text-white normal-case italic" x-text="$data.currentLesson?.quiz.q"></span>
                    </p>
                    <div class="grid gap-2">
                        <template x-for="(opt, idx) in ($data.currentLesson?.quiz?.options || [])" :key="idx">
                            <button @click="$data.submitAnswer(idx); $store.haptics?.fire('tap')" 
                                    class="w-full text-left p-3 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 hover:border-yellow-400 transition-all text-sm text-slate-200 group flex justify-between items-center">
                                <span x-text="opt"></span>
                                <i class="fa-solid fa-chevron-right opacity-0 group-hover:opacity-100 transition-opacity text-yellow-400 text-xs"></i>
                            </button>
                        </template>
                    </div>
                </div>

                <!-- State: Success -->
                <div x-show="$data.quizState === 'correct'" class="text-center py-4 animate-bounce">
                    <div class="inline-block p-3 rounded-full bg-green-500/20 text-green-400 mb-2">
                        <i class="fa-solid fa-circle-check text-3xl"></i>
                    </div>
                    <p class="text-lg font-bold text-white">Correct!</p>
                    <p class="text-xs text-green-400 font-mono">+XP GAINED</p>
                </div>

                <!-- State: Fail -->
                <div x-show="$data.quizState === 'wrong'" class="text-center py-4">
                    <div class="inline-block p-3 rounded-full bg-red-500/20 text-red-500 mb-2">
                        <i class="fa-solid fa-circle-xmark text-3xl"></i>
                    </div>
                    <p class="text-lg font-bold text-white">Incorrect.</p>
                    <button @click="$data.quizState = 'pending'" class="text-xs text-slate-400 hover:text-white underline mt-2">Try Again</button>
                </div>

            </div>
        </div>
    </div>

    <!-- 4. AI PROMPT GENERATOR -->
    <div class="mt-8 bg-white/[0.03] backdrop-blur-md border border-yellow-500/30 p-6 rounded-xl relative overflow-hidden group">
        
        <!-- Header -->
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                <i class="fa-solid fa-robot text-yellow-500"></i> Executive Tutor AI
            </h3>
            <span class="text-[9px] uppercase bg-yellow-900/50 text-yellow-400 px-2 py-1 rounded border border-yellow-500/30 font-bold tracking-wider">
                Deep Dive
            </span>
        </div>

        <!-- Preview -->
        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateDeepDivePrompt()"></pre>
        </div>

        <!-- Copy Button -->
        <button @click="
                copyToClipboard($data.generateDeepDivePrompt(), 'Lesson Data');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => { 
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE DEEP DIVE (AI)'; 
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                }, 2000)
                " 
                class="relative z-10 w-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black font-bold py-3 rounded-lg transition-all text-xs flex items-center justify-center gap-2 shadow-[0_0_10px_rgba(234,179,8,0.1)] hover:shadow-[0_0_15px_rgba(234,179,8,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE DEEP DIVE (AI)
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Paste into your GenAI tool to get a "Bullshit Detector" script for this term.
        </p>
    </div>

    <!-- Dev Tools (Hidden in production usually, but kept for testing) -->
    <div class="text-center mt-12 opacity-30 hover:opacity-100 transition-opacity">
        <button @click="$data.fetchWeeklyBatch()" class="text-[9px] text-slate-500 hover:text-white underline">
            [Force Refresh Content]
        </button>
    </div>

</div>


        <!-- EXECUTIVE LIBRARY TAB -->
<div x-show="currentTab === 'library'" x-data="libraryManagerComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-book-open-reader mr-1.5 md:mr-2 text-cyan-300"></i>Executive Library
        </h2>
        <p class="text-textMuted text-sm">The Bilingual Canon. Track your reading and technical fluency.</p>
    </div>

    <!-- PROGRESS HEADER -->
    <div class="bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl mb-8 flex justify-between items-center relative overflow-hidden">
        <!-- Progress Bar Background -->
        <div class="absolute bottom-0 left-0 h-1 bg-cyan-900 w-full">
            <div class="h-full bg-cyan-400 transition-all duration-1000" :style="`width: ${$data.literacyScore}%`"></div>
        </div>

        <div class="flex items-center gap-4">
            <div class="w-16 h-16 rounded-full border-4 flex items-center justify-center bg-white/10"
                 :class="$data.literacyScore >= 80 ? 'border-green-400 text-green-400' : ($data.literacyScore >= 50 ? 'border-yellow-400 text-yellow-400' : 'border-white/20 text-slate-500')">
                <span class="text-xl font-bold font-mono" x-text="$data.literacyScore + '%'"></span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-white">Bilingual Literacy Score</h3>
                <p class="text-xs text-slate-400">
                    <span x-show="$data.literacyScore < 50">Novice. Start reading.</span>
                    <span x-show="$data.literacyScore >= 50 && $data.literacyScore < 80">Apprentice. Gaining fluency.</span>
                    <span x-show="$data.literacyScore >= 80">Expert. You speak both languages.</span>
                </p>
            </div>
        </div>

        <!-- Toggle View -->
        <div class="flex bg-white/5 p-1 rounded-lg border border-white/15">
            <button @click="$data.view = 'books'" 
                    :class="$data.view === 'books' ? 'bg-cyan-600 text-white' : 'text-slate-400 hover:text-white'"
                    class="px-4 py-2 rounded text-xs font-bold transition-all">
                <i class="fa-solid fa-book mr-2"></i>Strategy Books
            </button>
            <button @click="$data.view = 'stack'" 
                    :class="$data.view === 'stack' ? 'bg-cyan-600 text-white' : 'text-slate-400 hover:text-white'"
                    class="px-4 py-2 rounded text-xs font-bold transition-all">
                <i class="fa-solid fa-layer-group mr-2"></i>Tech Stack
            </button>
        </div>
    </div>

    <!-- VIEW 1: BOOKS -->
    <div x-show="$data.view === 'books'" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
        <template x-for="book in $data.books" :key="book.id">
            <div class="bg-white/5 backdrop-blur-lg border p-6 rounded-xl relative group transition-all hover:-translate-y-1"
                 :class="$data.readBooks.includes(book.id) ? 'border-green-500/50 bg-green-900/10' : 'border-white/10 hover:border-cyan-400'">
                
                <div class="flex justify-between items-start mb-4">
                    <span class="text-[10px] font-mono uppercase tracking-widest px-2 py-1 rounded bg-white/10 text-slate-300 border border-white/15" x-text="book.domain"></span>
                    <button @click="$data.toggleBook(book.id)" 
                            class="w-8 h-8 rounded-full flex items-center justify-center border transition-all"
                            :class="$data.readBooks.includes(book.id) ? 'bg-green-500 border-green-500 text-white' : 'border-white/20 text-slate-500 hover:border-white hover:text-white'">
                        <i class="fa-solid fa-check"></i>
                    </button>
                </div>

                <h3 class="text-xl font-bold text-white mb-1" x-text="book.title"></h3>
                <p class="text-xs text-cyan-400 font-mono mb-4" x-text="'// ' + book.author"></p>
                
                <p class="text-sm text-slate-300 leading-relaxed mb-4" x-text="book.summary"></p>
                
                <div class="text-[10px] text-slate-500 font-bold uppercase">Impact: <span x-text="book.impact" :class="book.impact === 'Critical' ? 'text-red-400' : 'text-slate-300'"></span></div>
            </div>
        </template>
    </div>

    <!-- VIEW 2: TECH STACK -->
    <div x-show="$data.view === 'stack'" class="space-y-4" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
        <template x-for="tool in $data.techStack" :key="tool.id">
            <div class="bg-white/5 backdrop-blur-lg border p-4 rounded-xl flex flex-col md:flex-row items-center gap-6 transition-all hover:bg-white/10"
                 :class="$data.knownTools.includes(tool.id) ? 'border-green-500/50' : 'border-white/10'">
                
                <!-- Checkbox -->
                <button @click="$data.toggleTool(tool.id)" 
                        class="shrink-0 w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all"
                        :class="$data.knownTools.includes(tool.id) ? 'bg-green-500 border-green-500 text-white' : 'border-white/15 text-slate-600 hover:border-cyan-400 hover:text-cyan-400'">
                    <i class="fa-solid fa-check"></i>
                </button>

                <!-- Content -->
                <div class="flex-1 text-center md:text-left">
                    <div class="flex flex-col md:flex-row md:items-center gap-2 mb-1">
                        <h3 class="text-lg font-bold text-white" x-text="tool.name"></h3>
                        <span class="text-[10px] bg-white/[0.03] backdrop-blur-md text-slate-400 px-2 py-0.5 rounded border border-white/10 w-fit mx-auto md:mx-0" x-text="tool.category"></span>
                    </div>
                    <p class="text-sm text-cyan-300 font-mono mb-1">"The <span x-text="tool.analogy"></span>"</p>
                    <p class="text-xs text-slate-400" x-text="tool.desc"></p>
                </div>
            </div>
        </template>
    </div>

    <!-- 3. AI TUTOR PROMPT -->
    <div class="mt-12 bg-white/[0.03] backdrop-blur-md border border-cyan-500/30 p-6 rounded-xl relative overflow-hidden group">
        <div class="flex justify-between items-center mb-4 relative z-10">
            <h3 class="font-mono text-white font-bold flex items-center gap-2">
                <i class="fa-solid fa-robot text-cyan-400"></i> 
                PERSONALIZED CURRICULUM AI
            </h3>
            <span class="text-[10px] uppercase bg-cyan-900/50 text-cyan-400 px-2 py-1 rounded border border-cyan-500/30 font-bold tracking-wider">
                Gap Analysis Ready
            </span>
        </div>

        <div class="relative z-10 font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/10 mb-4 h-24 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
            <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateCurriculumPrompt()"></pre>
        </div>

        <button @click="
                copyToClipboard($data.generateCurriculumPrompt(), 'Curriculum');
                $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                $el.classList.add('bg-green-500', 'text-white', 'border-green-500');
                setTimeout(() => {
                    $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE STUDY PLAN (AI)';
                    $el.classList.remove('bg-green-500', 'text-white', 'border-green-500');
                }, 2000)
                " 
                class="relative z-10 w-full py-4 bg-transparent border border-cyan-500 text-cyan-400 hover:bg-cyan-500 hover:text-black font-bold rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-mono text-xs uppercase tracking-widest shadow-[0_0_10px_rgba(34,211,238,0.1)] hover:shadow-[0_0_20px_rgba(34,211,238,0.4)]">
            <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE STUDY PLAN (AI)
        </button>
        
        <p class="text-center text-[10px] text-slate-500 mt-3 relative z-10">
            Paste into AI to get a "Cheat Sheet" for the books and tools you haven't marked as known yet.
        </p>
    </div>

</div>

        <!-- DT ROI TRACKER TAB -->
<div x-show="currentTab === 'dt_tracker'" x-data="cfoReportComponent" x-cloak class="max-w-6xl mx-auto pb-20">
    
    <div class="text-center mb-5 md:mb-10">
        <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-2">
            <i class="fa-solid fa-magnifying-glass-dollar mr-1.5 md:mr-2 text-green-400"></i>ROI Tracker
        </h2>
        <p class="text-textMuted text-sm">Visualize the "J-Curve". Prove the value of Soft Benefits.</p>
    </div>

    <div class="grid lg:grid-cols-12 gap-4 md:gap-8 items-start">
        
        <!-- LEFT: FINANCIAL INPUTS -->
        <div class="lg:col-span-4 bg-white/5 backdrop-blur-lg border border-white/10 p-6 rounded-xl space-y-6">
            <h3 class="font-mono text-xs text-green-400 uppercase font-bold border-b border-white/10 pb-2">Cost Structure</h3>
            
            <div>
                <label class="text-[10px] text-slate-500 uppercase font-bold">Project Name</label>
                <input type="text" x-model="$data.inputs.projectName" class="w-full bg-dark border border-white/15 rounded p-2 text-white text-sm focus:border-green-500 outline-none">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Upfront Cost ($)</label>
                    <input type="number" x-model="$data.inputs.initialCost" class="w-full bg-dark border border-white/15 rounded p-2 text-white font-mono">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Monthly Run Cost ($)</label>
                    <input type="number" x-model="$data.inputs.monthlyCost" class="w-full bg-dark border border-white/15 rounded p-2 text-white font-mono">
                </div>
            </div>

            <h3 class="font-mono text-xs text-blue-400 uppercase font-bold border-b border-white/10 pb-2 pt-2">Benefit Drivers</h3>

            <div>
                <label class="text-[10px] text-slate-500 uppercase font-bold">Hard Savings / Month ($)</label>
                <input type="number" x-model="$data.inputs.monthlyHardSavings" class="w-full bg-dark border border-white/15 rounded p-2 text-white font-mono placeholder-slate-600" placeholder="Server cuts, etc.">
            </div>

            <div class="bg-blue-900/10 p-3 rounded border border-blue-500/30">
                <p class="text-[10px] text-blue-300 font-bold mb-2">SOFT VALUE ENGINE</p>
                <div class="grid grid-cols-2 gap-4 mb-2">
                    <div>
                        <label class="text-[9px] text-slate-400">Team Size</label>
                        <input type="number" x-model="$data.inputs.teamSize" class="w-full bg-dark border border-white/15 rounded p-1 text-white text-xs">
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-400">Efficiency Gain %</label>
                        <input type="number" x-model="$data.inputs.efficiencyGain" class="w-full bg-dark border border-white/15 rounded p-1 text-white text-xs">
                    </div>
                </div>
                
                <!-- Confidence Slider -->
                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-[9px] text-slate-400">CFO Confidence Level</label>
                        <span class="text-[9px] font-bold text-white" x-text="$data.inputs.confidence + '%'"></span>
                    </div>
                    <input type="range" min="0" max="100" step="10" x-model="$data.inputs.confidence" class="w-full h-1 bg-dark rounded-lg appearance-none cursor-pointer accent-blue-400">
                </div>
            </div>

            <!-- Fixed Button -->
            <button @click="$data.calculate()" 
                    :disabled="$data.loading"
                    class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-glow transition-all flex items-center justify-center gap-2">
                
                <!-- Template tag used to prevent flickering logic issues -->
                <template x-if="!$data.loading">
                    <span class="flex items-center gap-2"><i class="fa-solid fa-chart-line"></i> MODEL THE J-CURVE</span>
                </template>
                
                <template x-if="$data.loading">
                    <span class="flex items-center gap-2"><i class="fa-solid fa-circle-notch fa-spin"></i> CALCULATING...</span>
                </template>
            </button>
        </div>

        <!-- RIGHT: THE J-CURVE (OUTPUT) -->
        <div class="lg:col-span-8">
            
            <!-- Empty State (Fixed height for clean look initially) -->
            <div x-show="!$data.results" class="h-96 border-2 border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center text-slate-500">
                <i class="fa-solid fa-sack-dollar text-6xl mb-4 opacity-20"></i>
                <p class="font-mono text-xs uppercase">Input Financials to Begin</p>
            </div>

            <!-- Results Card (Auto height to avoid empty space) -->
            <div x-show="$data.results" x-transition class="bg-white/5 backdrop-blur-lg border-2 rounded-xl overflow-hidden shadow-glass relative"
                 :class="$data.results?.roi24 > 0 ? 'border-green-500' : 'border-red-500'">
                
                <!-- Header -->
                <div class="p-6 bg-white/[0.03] backdrop-blur-md border-b border-white/[0.08] flex justify-between items-center">
                    <div>
                        <p class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">24-MONTH OUTLOOK</p>
                        <h3 class="text-3xl font-bold font-mono mt-1" 
                            :class="$data.results?.endingBalance > 0 ? 'text-green-400' : 'text-red-400'" 
                            x-text="$data.results?.endingBalance > 0 ? '$' + $data.results?.endingBalance.toLocaleString() : '-$' + Math.abs($data.results?.endingBalance).toLocaleString()"></h3>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold px-3 py-1 rounded bg-white/5 border uppercase" :class="$data.results?.color" x-text="$data.results?.verdict"></span>
                        <p class="text-[9px] text-slate-500 mt-1">Payback: <span x-text="$data.results?.payback"></span></p>
                    </div>
                </div>

                <!-- The Visual Graph (CSS Bar Chart) -->
                <div class="p-6 bg-dark/50 relative h-64">
                    <div class="absolute top-2 left-4 text-[10px] text-slate-500 font-mono">CUMULATIVE CASH FLOW (2 Years)</div>
                    
                    <!-- Zero Line -->
                    <div class="w-full h-px bg-white/20 absolute" style="top: 50%;"></div>

                    <div class="flex items-end justify-between h-full w-full gap-1 pt-6 pb-2">
                        <template x-for="(val, index) in $data.results?.chartData">
                            <div class="flex-1 flex flex-col justify-center relative group h-full">
                                <!-- The Bar Container -->
                                <div class="relative h-full w-full">
                                    <div class="absolute w-full rounded-t-sm transition-all duration-500"
                                         :class="val >= 0 ? 'bg-green-500 bottom-1/2 origin-bottom' : 'bg-red-500 top-1/2 origin-top'"
                                         :style="`height: ${Math.min(50, Math.abs(val) / (Math.max(...$data.results.chartData.map(Math.abs)) * 1.2) * 50)}%`">
                                    </div>
                                </div>
                                <!-- Tooltip -->
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 bg-black text-white text-[9px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-20 font-mono border border-white/15">
                                    M<span x-text="index+1"></span>: $<span x-text="val.toLocaleString()"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Composition Analysis -->
                <div class="p-4 grid grid-cols-2 gap-4 bg-white/[0.03] backdrop-blur-md border-t border-white/[0.08]">
                    <div>
                        <p class="text-[10px] text-slate-500 uppercase font-bold">HARD VALUE (P&L)</p>
                        <p class="text-sm font-mono text-white" x-text="'$' + $data.results?.hardContribution.toLocaleString()"></p>
                    </div>
                    <div>
                        <p class="text-[10px] text-slate-500 uppercase font-bold">SOFT VALUE (Strategic)</p>
                        <p class="text-sm font-mono text-blue-300" x-text="'$' + $data.results?.softContribution.toLocaleString()"></p>
                    </div>
                </div>

                <!-- AI Prompt Box -->
                <div class="p-6 bg-white/5 border-t border-white/10">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-mono text-white font-bold flex items-center gap-2 text-xs uppercase">
                            <i class="fa-solid fa-robot text-green-400"></i> CFO Narrative Generator
                        </h3>
                    </div>

                    <div class="relative font-mono text-xs text-slate-300 bg-black/40 backdrop-blur-sm p-4 rounded border border-white/15 mb-4 h-24 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/90 pointer-events-none"></div>
                        <pre class="whitespace-pre-wrap font-sans leading-relaxed" x-text="$data.generateCFOReport()"></pre>
                    </div>

                    <button @click="
                            copyToClipboard($data.generateCFOReport(), 'Financial Model');
                            $el.innerHTML = '<i class=\'fa-solid fa-check\'></i> COPIED';
                            setTimeout(() => { $el.innerHTML = '<i class=\'fa-solid fa-wand-magic-sparkles\'></i> GENERATE BOARD MEMO (AI)'; }, 2000)
                            " 
                            class="w-full border border-green-500 text-green-400 hover:bg-green-500 hover:text-white font-bold py-3 rounded text-xs transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> GENERATE BOARD MEMO (AI)
                    </button>
                    <p class="text-center text-[10px] text-slate-500 mt-3">
                        Ready to paste into your GenAI tool of choice.
                    </p>
                </div>

            </div>
        </div>

    </div>
</div>



        <!-- MEETING TICKER TOOL -->
<div x-show="currentTab === 'ticker'" x-data="meetingTickerComponent" class="max-w-2xl mx-auto space-y-6">
    
    <!-- Header -->
    <div class="text-center space-y-2">
        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-500/20 text-green-400 mb-2">
            <i class="fa-solid fa-stopwatch text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-white">The Meeting Tax Ticker</h2>
        <p class="text-slate-400">Real-time FinOps. Visualize the burn rate of bureaucracy.</p>
    </div>

    <!-- The Ticker Display -->
    <div class="bg-white/5 backdrop-blur-md rounded-xl p-5 md:p-8 text-center border border-white/10 shadow-glass relative overflow-hidden">
        
        <!-- Background Pulse Effect for High Cost -->
        <div x-show="$data.currentCost > 500" 
             class="absolute inset-0 bg-red-500/5 pointer-events-none transition-opacity duration-1000"
             :class="$data.currentCost > 1000 ? 'animate-pulse' : ''"></div>

        <!-- Timer -->
        <div class="text-slate-400 font-mono text-xs md:text-sm mb-1.5 md:mb-2" x-text="$data.formatTime()">0:00</div>

        <!-- BIG MONEY -->
        <div class="text-4xl md:text-6xl font-black mb-1.5 md:mb-2 tracking-tighter"
             :class="$data.statusColor">
            $<span x-text="$data.currentCost.toFixed(2)">0.00</span>
        </div>

        <!-- Burn Rate Subtitle -->
        <div class="text-slate-500 text-xs md:text-sm">
            Burning <span class="text-slate-300 font-bold">$<span x-text="$data.burnRatePerMinute.toFixed(0)">0</span>/min</span>
        </div>

        <!-- Dynamic Feedback -->
        <div class="mt-6 p-3 rounded-lg bg-black/20 border border-white/10">
            <p class="text-sm font-medium" :class="$data.statusColor" x-text="$data.statusMessage"></p>
        </div>
    </div>

    <!-- Controls & Inputs -->
    <div class="grid md:grid-cols-2 gap-4 md:gap-6">
        
        <!-- Sliders (Disable while running to prevent math jumping) -->
        <div class="bg-white/5 backdrop-blur-md p-4 md:p-6 rounded-xl border border-white/10 space-y-4 md:space-y-6">
            
            <!-- Attendees Slider -->
            <div>
                <div class="flex justify-between text-sm mb-2">
                    <label class="text-slate-300">Attendees</label>
                    <span class="text-green-400 font-bold" x-text="$data.attendees"></span>
                </div>
                <input type="range" min="1" max="50" step="1" 
                       x-model="$data.attendees"
                       class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-green-400">
            </div>

            <!-- Hourly Rate Slider -->
            <div>
                <div class="flex justify-between text-sm mb-2">
                    <label class="text-slate-300">Avg. Hourly Cost ($)</label>
                    <span class="text-green-400 font-bold" x-text="'$' + $data.avgRate"></span>
                </div>
                <input type="range" min="50" max="500" step="25" 
                       x-model="$data.avgRate"
                       class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-green-400">
                <p class="text-xs text-slate-500 mt-1">Include salary + overhead + benefits.</p>
            </div>

            <!-- Context Tax Toggle -->
            <div class="flex items-center justify-between pt-2 border-t border-white/10">
                <div class="text-xs text-slate-400">
                    <span class="text-slate-200 font-bold block">Context Switch Tax (+20%)</span>
                    Applies cost for interruption recovery.
                </div>
                <button 
                    @click="$data.includeContextTax = !$data.includeContextTax"
                    class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none"
                    :class="$data.includeContextTax ? 'bg-green-500' : 'bg-white/15'">
                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                        :class="$data.includeContextTax ? 'translate-x-6' : 'translate-x-1'"></span>
                </button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col justify-center space-y-4">
            
            <!-- Start/Pause -->
            <button @click="$data.toggle()"
                    class="w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2"
                    :class="$data.active 
                        ? 'bg-yellow-500 hover:bg-yellow-400 text-slate-900' 
                        : 'bg-green-500 hover:bg-green-400 text-slate-900'">
                <i class="fa-solid" :class="$data.active ? 'fa-pause' : 'fa-play'"></i>
                <span x-text="$data.active ? 'Pause Meeting' : ($data.paused ? 'Resume Meeting' : 'Start Ticker')"></span>
            </button>

            <!-- Reset -->
            <button @click="$data.reset()"
                    class="w-full py-3 rounded-xl border border-white/15 text-slate-400 hover:text-white hover:bg-white/10 transition-colors flex items-center justify-center gap-2">
                <i class="fa-solid fa-rotate-left"></i>
                Reset
            </button>
            
            <!-- "The Bilingual Insight" Box -->
            <div class="bg-blue-500/10 border border-blue-500/20 p-4 rounded-lg">
                <h4 class="text-blue-400 text-xs font-bold uppercase mb-1">
                    <i class="fa-solid fa-lightbulb mr-1"></i> Bilingual Insight
                </h4>
                <p class="text-xs text-slate-300 leading-relaxed">
                    "If you wouldn't sign a PO for $<span x-text="Math.max(100, $data.currentCost).toFixed(0)">100</span> to buy software, why are you spending it on a status update?"
                </p>
            </div>
        </div>
    </div>
</div>

</div>
        
        
            <!-- ═══════════════════════════════════════════════════════
                 VISITOR STATS DASHBOARD
                 ═══════════════════════════════════════════════════════ -->
            <div x-show="currentTab === 'stats'" x-cloak class="max-w-6xl mx-auto pb-20"
                 x-init="$watch('currentTab', v => { if (v === 'stats') $store.visitorStats.fetchDashboard(); })">

                <!-- Header -->
                <div class="mb-4 md:mb-6">
                    <div class="flex items-center gap-2 md:gap-3 mb-2">
                        <div class="w-8 h-8 md:w-10 md:h-10 rounded-xl bg-indigo-500/15 flex items-center justify-center">
                            <i class="fa-solid fa-chart-column text-indigo-400 text-sm md:text-base"></i>
                        </div>
                        <div class="min-w-0 flex-1">
                            <h2 class="text-white text-base md:text-xl font-bold">Visitor Analytics</h2>
                            <p class="text-slate-400 text-[10px] md:text-xs font-mono">Real-time platform intelligence</p>
                        </div>
                        <button @click="$store.visitorStats.refreshDashboard()"
                                class="ml-auto w-8 h-8 md:w-9 md:h-9 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white transition-all shrink-0"
                                :class="$store.visitorStats.dashboardLoading ? 'animate-spin' : ''">
                            <i class="fa-solid fa-arrows-rotate text-xs md:text-sm"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="$store.visitorStats.dashboardLoading && !$store.visitorStats.dashboardLoaded" class="text-center py-20 text-slate-500">
                    <i class="fa-solid fa-spinner fa-spin text-3xl mb-4"></i>
                    <p class="text-sm">Loading analytics data...</p>
                </div>

                <div x-show="$store.visitorStats.dashboardLoaded" class="space-y-6">

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3">
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-1">Total Visitors</div>
                            <div class="text-lg md:text-2xl font-bold text-white font-mono" x-text="($store.visitorStats.summary.total_unique_visitors || 0).toLocaleString()"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-600 font-mono mt-1">All time</div>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-emerald-400/70 uppercase tracking-wider font-mono mb-1">Today</div>
                            <div class="text-lg md:text-2xl font-bold text-emerald-400 font-mono" x-text="$store.visitorStats.summary.today_visitors || 0"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-600 font-mono mt-1">Unique visitors</div>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-blue-400/70 uppercase tracking-wider font-mono mb-1">This Week</div>
                            <div class="text-lg md:text-2xl font-bold text-blue-400 font-mono" x-text="$store.visitorStats.summary.week_visitors || 0"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-600 font-mono mt-1">Unique visitors</div>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-purple-400/70 uppercase tracking-wider font-mono mb-1">Sessions</div>
                            <div class="text-lg md:text-2xl font-bold text-purple-400 font-mono" x-text="($store.visitorStats.summary.total_sessions || 0).toLocaleString()"></div>
                            <div class="text-[8px] md:text-[9px] text-slate-600 font-mono mt-1">Total sessions</div>
                        </div>
                    </div>

                    <!-- Secondary Stats -->
                    <div class="grid grid-cols-2 gap-2 md:gap-3">
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-amber-400/70 uppercase tracking-wider font-mono mb-1">Tool Uses</div>
                            <div class="text-lg md:text-xl font-bold text-amber-400 font-mono" x-text="($store.visitorStats.summary.total_tool_uses || 0).toLocaleString()"></div>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-cyan-400/70 uppercase tracking-wider font-mono mb-1">This Month</div>
                            <div class="text-lg md:text-xl font-bold text-cyan-400 font-mono" x-text="$store.visitorStats.summary.month_visitors || 0"></div>
                        </div>
                    </div>

                    <!-- Daily Trend Chart -->
                    <div class="p-3.5 md:p-5 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] shadow-glass">
                        <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3 md:mb-4">Daily Visitors — Last 30 Days</div>
                        <div class="flex items-end gap-[2px] h-24 md:h-32">
                            <template x-for="(day, i) in $store.visitorStats.dailyTrend" :key="i">
                                <div class="flex-1 flex flex-col items-center justify-end h-full group relative">
                                    <div class="w-full rounded-t bg-gradient-to-t from-indigo-500 to-blue-400 transition-all duration-300 hover:from-indigo-400 hover:to-blue-300"
                                         :style="'height:' + Math.max(2, (day.visitors || 0) / $store.visitorStats.maxDailyVisitors * 100) + '%'">
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="absolute bottom-full mb-2 hidden group-hover:block bg-slate-800/95 backdrop-blur-xl border border-white/15 rounded-lg px-2 py-1 text-[9px] font-mono text-white whitespace-nowrap z-10 shadow-lg pointer-events-none">
                                        <div x-text="$store.visitorStats.formatDay(day.day)"></div>
                                        <div class="text-indigo-300" x-text="(day.visitors || 0) + ' visitors'"></div>
                                        <div class="text-blue-300" x-text="(day.tool_uses || 0) + ' tool uses'"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                        <div class="flex justify-between mt-2 text-[8px] text-slate-600 font-mono">
                            <span x-text="$store.visitorStats.dailyTrend.length > 0 ? $store.visitorStats.formatDay($store.visitorStats.dailyTrend[0]?.day) : ''"></span>
                            <span x-text="$store.visitorStats.dailyTrend.length > 0 ? $store.visitorStats.formatDay($store.visitorStats.dailyTrend[$store.visitorStats.dailyTrend.length - 1]?.day) : ''"></span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                        <!-- Tool Popularity -->
                        <div class="p-3.5 md:p-5 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3 md:mb-4">Top Tools</div>
                            <div class="space-y-2.5">
                                <template x-for="tool in $store.visitorStats.toolPopularity" :key="tool.tool_id">
                                    <div class="flex items-center gap-2">
                                        <span class="text-[10px] text-slate-400 w-24 truncate text-right font-mono" x-text="tool.tool_label || tool.tool_id"></span>
                                        <div class="flex-1 h-2.5 rounded-full bg-white/5 overflow-hidden">
                                            <div class="h-full rounded-full bg-gradient-to-r from-emerald-500 to-cyan-400 transition-all duration-700"
                                                 :style="'width:' + (tool.use_count / $store.visitorStats.maxToolUses * 100) + '%'"></div>
                                        </div>
                                        <span class="text-[10px] text-slate-500 font-mono w-8 text-right" x-text="tool.use_count"></span>
                                    </div>
                                </template>
                                <template x-if="$store.visitorStats.toolPopularity.length === 0">
                                    <div class="text-center py-6 text-slate-600 text-xs">No tool usage data yet</div>
                                </template>
                            </div>
                        </div>

                        <!-- Peak Hours Heatmap -->
                        <div class="p-3.5 md:p-5 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3 md:mb-4">Peak Hours (Last 30d)</div>
                            <div class="grid grid-cols-6 gap-1.5">
                                <template x-for="h in 24" :key="h">
                                    <div class="group relative">
                                        <div class="aspect-square rounded-md flex items-center justify-center text-[8px] font-mono transition-all"
                                             :style="(() => {
                                                 const hourData = $store.visitorStats.hourlyDist.find(d => d.hour == (h-1));
                                                 const count = hourData?.event_count || 0;
                                                 const ratio = count / $store.visitorStats.maxHourlyCount;
                                                 const alpha = Math.max(0.05, ratio * 0.8);
                                                 return 'background: rgba(99, 102, 241, ' + alpha + '); color: rgba(255,255,255,' + Math.max(0.3, ratio) + ')';
                                             })()"
                                             x-text="$store.visitorStats.formatHour(h-1)">
                                        </div>
                                        <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 hidden group-hover:block bg-slate-800/95 backdrop-blur-xl border border-white/15 rounded px-1.5 py-0.5 text-[8px] font-mono text-white whitespace-nowrap z-10 shadow-lg pointer-events-none"
                                             x-text="(() => { const d = $store.visitorStats.hourlyDist.find(x => x.hour == (h-1)); return (d?.event_count || 0) + ' events'; })()">
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Device Breakdown -->
                        <div class="p-3.5 md:p-5 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3 md:mb-4">Devices</div>
                            <div class="flex items-center justify-around">
                                <template x-for="device in $store.visitorStats.deviceBreakdown" :key="device.device_type">
                                    <div class="text-center">
                                        <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl bg-white/5 flex items-center justify-center mx-auto mb-1.5 md:mb-2 border border-white/10">
                                            <i class="fa-solid text-base md:text-lg text-slate-400" :class="$store.visitorStats.deviceIcon(device.device_type)"></i>
                                        </div>
                                        <div class="text-white font-bold text-xs md:text-sm font-mono" x-text="device.unique_users"></div>
                                        <div class="text-[9px] text-slate-600 uppercase" x-text="device.device_type"></div>
                                        <div class="text-[8px] text-slate-500 font-mono" x-text="Math.round(device.unique_users / $store.visitorStats.totalDeviceUsers * 100) + '%'"></div>
                                    </div>
                                </template>
                                <template x-if="$store.visitorStats.deviceBreakdown.length === 0">
                                    <div class="text-center py-6 text-slate-600 text-xs w-full">No device data yet</div>
                                </template>
                            </div>
                        </div>

                        <!-- Browser Breakdown -->
                        <div class="p-3.5 md:p-5 rounded-xl bg-white/[0.04] backdrop-blur-md border border-white/[0.08] shadow-glass">
                            <div class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-wider font-mono mb-3 md:mb-4">Browsers</div>
                            <div class="space-y-2.5">
                                <template x-for="b in $store.visitorStats.browserBreakdown" :key="b.browser">
                                    <div class="flex items-center gap-2">
                                        <span class="text-[10px] text-slate-400 w-16 text-right font-mono" x-text="b.browser"></span>
                                        <div class="flex-1 h-2.5 rounded-full bg-white/5 overflow-hidden">
                                            <div class="h-full rounded-full bg-gradient-to-r from-purple-500 to-pink-400 transition-all duration-700"
                                                 :style="'width:' + (b.unique_users / $store.visitorStats.totalBrowserUsers * 100) + '%'"></div>
                                        </div>
                                        <span class="text-[10px] text-slate-500 font-mono w-8 text-right" x-text="b.unique_users"></span>
                                    </div>
                                </template>
                                <template x-if="$store.visitorStats.browserBreakdown.length === 0">
                                    <div class="text-center py-6 text-slate-600 text-xs">No browser data yet</div>
                                </template>
                            </div>
                        </div>

                    </div><!-- /grid -->

                </div><!-- /dashboardLoaded -->
            </div><!-- /stats tab -->

            <!-- COMMUNITY -->
            <div x-show="currentTab === 'community'" x-cloak class="max-w-3xl mx-auto mt-6 md:mt-12 text-center">
                <div class="bg-gradient-to-b from-white/[0.07] to-transparent backdrop-blur-lg p-6 md:p-10 rounded-2xl border border-primary/20 shadow-glass relative overflow-hidden">
                    
                    <!-- WhatsApp Brand Icon -->
                    <div class="mb-4 md:mb-6">
                        <i class="fa-brands fa-whatsapp text-4xl md:text-6xl text-[#25D366]"></i>
                    </div>

                    <h2 class="font-mono text-xl md:text-3xl font-bold text-white mb-3 md:mb-4">The Fintech Bilinguals</h2>
                    <p class="text-textMuted text-xs md:text-base max-w-lg mx-auto mb-5 md:mb-8">Join the collective of execution-focused leaders. Access exclusive playbooks and peer support.</p>

                    <!-- DESKTOP VIEW: Show QR Code -->
                    <div class="hidden md:flex flex-col items-center">
                        <div class="bg-white p-4 rounded-xl shadow-lg mb-4">
                            <!-- QR Code Generated from your URL -->
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://chat.whatsapp.com/DgFrhnzrKpAJnmLM1Oqmgg" 
                                 alt="WhatsApp QR Code" 
                                 class="w-40 h-40">
                        </div>
                        <p class="text-xs text-textMuted font-mono uppercase tracking-widest">Scan with your phone to join</p>
                    </div>

                    <!-- MOBILE VIEW: Show Clickable Button -->
                    <div class="md:hidden">
                        <a href="https://chat.whatsapp.com/DgFrhnzrKpAJnmLM1Oqmgg" target="_blank" 
                           class="flex items-center justify-center gap-3 w-full bg-[#25D366] hover:bg-[#128c7e] text-white font-bold py-4 px-6 rounded-full shadow-glow transition-all active:scale-95">
                            <i class="fa-brands fa-whatsapp text-2xl"></i>
                            <span class="font-mono text-sm">JOIN COMMUNITY</span>
                        </a>
                        <p class="text-[10px] text-textMuted mt-4">Opens directly in WhatsApp</p>
                    </div>


                    <!-- ARCHITECT CONSOLE (VIP ONLY) — Terminal Command Center -->
            <div x-show="currentTab === 'architect'" x-cloak class="max-w-5xl mx-auto">

                <!-- Terminal Header -->
                <div class="bg-[#0a0a0a] border border-[#00ff41]/20 rounded-lg mb-8 overflow-hidden scanline-bg">
                    <div class="flex items-center gap-2 px-4 py-2 bg-[#00ff41]/5 border-b border-[#00ff41]/10">
                        <span class="w-3 h-3 rounded-full bg-red-500/60"></span>
                        <span class="w-3 h-3 rounded-full bg-yellow-500/60"></span>
                        <span class="w-3 h-3 rounded-full bg-green-500/60"></span>
                        <span class="font-mono text-[10px] text-[#00ff41]/50 ml-2">architect@meridian:/vault$</span>
                    </div>
                    <div class="p-6">
                        <h2 class="font-mono text-2xl font-bold text-[#00ff41] mb-2 flex items-center vip-glow">
                            <i class="fa-solid fa-terminal mr-3"></i>ARCHITECT CONSOLE
                        </h2>
                        <p class="text-sm text-[#00ff41]/50 font-mono">Session active. Vault partition mounted.</p>

                        <!-- System Stats -->
                        <div class="mt-4 flex flex-wrap gap-4 text-[10px] font-mono text-[#00ff41]/40">
                            <span>UPTIME: <span class="text-[#00ff41]/70" x-text="Math.floor((Date.now() - (parseInt(localStorage.getItem('vip_session_start') || Date.now()))) / 60000) + 'm'"></span></span>
                            <span>XP: <span class="text-[#00ff41]/70" x-text="($store.gamification?.xp || 0).toLocaleString()"></span></span>
                            <span>RANK: <span class="text-[#00ff41]/70" x-text="$store.gamification?.rank?.title || '—'"></span></span>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Schema Card -->
                    <div class="bg-[#0a0a0a] border border-[#00ff41]/15 rounded-lg overflow-hidden">
                        <div class="px-4 py-2 border-b border-[#00ff41]/10 flex items-center gap-2">
                            <span class="text-[10px] font-mono text-[#00ff41]/40">$ cat schema.json</span>
                        </div>
                        <div class="p-4 text-xs text-[#00ff41] font-mono overflow-x-auto">
                            <pre x-text="vipJson" class="whitespace-pre-wrap"></pre>
                        </div>
                        <div class="p-3 border-t border-[#00ff41]/10">
                            <button @click="copyToClipboard(vipJson, 'Schema')" 
                                    class="w-full border border-[#00ff41]/20 hover:bg-[#00ff41]/10 text-[#00ff41]/70 hover:text-[#00ff41] text-[11px] font-mono py-2.5 rounded transition-colors flex items-center justify-center gap-2">
                                <i class="fa-solid fa-terminal text-[9px]"></i> cp schema.json /clipboard
                            </button>
                        </div>
                    </div>

                    <!-- Prompt Card -->
                    <div class="bg-[#0a0a0a] border border-[#00ff41]/15 rounded-lg overflow-hidden">
                        <div class="px-4 py-2 border-b border-[#00ff41]/10 flex items-center gap-2">
                            <span class="text-[10px] font-mono text-[#00ff41]/40">$ cat boardroom-script.md</span>
                        </div>
                        <div class="p-4 text-xs text-[#00ff41]/80 font-mono overflow-x-auto h-32">
                            <pre x-text="vipPrompt" class="whitespace-pre-wrap"></pre>
                        </div>
                        <div class="p-3 border-t border-[#00ff41]/10">
                            <button @click="copyToClipboard(vipPrompt, 'Prompt')" 
                                    class="w-full bg-[#00ff41]/10 hover:bg-[#00ff41]/20 text-[#00ff41] text-[11px] font-bold font-mono py-2.5 rounded transition-all flex items-center justify-center gap-2 shadow-glow-vip">
                                <i class="fa-solid fa-robot text-[9px]"></i> cp prompt.md /clipboard
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lock/Exit Button -->
                <div class="mt-8 text-center">
                    <button @click="lockVipMode()" 
                            class="text-[10px] font-mono text-red-500/50 hover:text-red-500 transition-colors uppercase tracking-widest">
                        <i class="fa-solid fa-lock mr-1"></i> Lock Terminal & Exit VIP Mode
                    </button>
                </div>

            </div>  
    </div>  
<div class="fixed bottom-0 left-0 right-0 z-[200] pb-safe flex justify-center pointer-events-none">

</div>  

    </div> <!-- End of tools content -->
</div> <!-- End viewMode='tools' Wrapper -->
</main>


    <!-- NAVIGATION BAR -->
<div x-show="!showLanding" 
     class="fixed bottom-0 left-0 right-0 z-[40] pb-safe flex justify-center pointer-events-none will-change-transform"
     style="transform:translateY(80px);opacity:0">
    
    <div class="flex items-center justify-around gap-1 glass-panel rounded-full p-2 px-6 shadow-glass-lg pointer-events-auto nav-bottom-bar">
       
        <!-- 1. ACADEMY BUTTON -->
        <button @click="$store.haptics?.fire('nav'); viewMode = 'academy'; currentTab = 'dashboard'; document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                class="relative w-16 flex flex-col items-center justify-center gap-1 group transition-all duration-300"
                :class="viewMode === 'academy' ? 'text-white' : 'text-slate-500 hover:text-slate-300'">
            
            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                 :class="viewMode === 'academy' ? 'bg-white/5 scale-100' : 'bg-transparent scale-90'">
                <i class="fa-solid fa-graduation-cap text-lg"></i>
            </div>
            
            <span class="text-[9px] font-bold uppercase tracking-widest">Academy</span>
            
            <!-- Active Dot -->
            <div x-show="viewMode === 'academy'" class="absolute -bottom-1 w-1 h-1 bg-white rounded-full shadow-glow"></div>
        </button>

                <!--  🔴 PASTE THE NEW BOOK BUTTON HERE 🔴  -->
        <button @click="$store.haptics?.fire('nav'); viewMode = 'ebook'; document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                class="relative w-16 flex flex-col items-center justify-center gap-1 group transition-all duration-300"
                :class="viewMode === 'ebook' ? 'text-indigo-400' : 'text-slate-500 hover:text-slate-300'">
            
            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                 :class="viewMode === 'ebook' ? 'bg-indigo-900/20 scale-100' : 'bg-transparent scale-90'">
                <i class="fa-solid fa-book-open text-lg"></i>
            </div>
            
            <span class="text-[9px] font-bold uppercase tracking-widest">Book</span>
            
            <!-- Active Dot -->
            <div x-show="viewMode === 'ebook'" class="absolute -bottom-1 w-1 h-1 bg-indigo-400 rounded-full shadow-glow"></div>
        </button>


        <!-- 2. RADAR BUTTON -->
        <button @click="$store.haptics?.fire('nav'); viewMode = 'tools'; currentGroup = 'radar'; currentTab = 'dashboard'; document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                class="relative w-16 flex flex-col items-center justify-center gap-1 group transition-all duration-300"
                :class="currentGroup === 'radar' && viewMode === 'tools' ? 'text-pink-400' : 'text-slate-500 hover:text-slate-300'">
            
            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                 :class="currentGroup === 'radar' && viewMode === 'tools' ? 'bg-pink-900/20 scale-100' : 'bg-transparent scale-90'">
                <i class="fa-solid fa-bullseye text-lg"></i>
            </div>
            
            <span class="text-[9px] font-bold uppercase tracking-widest">Radar</span>
            
            <!-- Active Dot -->
            <div x-show="currentGroup === 'radar' && viewMode === 'tools'" class="absolute -bottom-1 w-1 h-1 bg-pink-400 rounded-full shadow-glow"></div>
        </button>

        <!-- 3. FORGE BUTTON -->
        <button @click="$store.haptics?.fire('nav'); viewMode = 'tools'; currentGroup = 'forge'; currentTab = 'dashboard'; document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                class="relative w-16 flex flex-col items-center justify-center gap-1 group transition-all duration-300"
                :class="currentGroup === 'forge' && viewMode === 'tools' ? 'text-cyan-400' : 'text-slate-500 hover:text-slate-300'">
            
            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                 :class="currentGroup === 'forge' && viewMode === 'tools' ? 'bg-cyan-900/20 scale-100' : 'bg-transparent scale-90'">
                <i class="fa-solid fa-hammer text-lg"></i>
            </div>
            
            <span class="text-[9px] font-bold uppercase tracking-widest">Forge</span>
            
            <!-- Active Dot -->
            <div x-show="currentGroup === 'forge' && viewMode === 'tools'" class="absolute -bottom-1 w-1 h-1 bg-cyan-400 rounded-full shadow-glow"></div>
        </button>

        <!-- 4. SIMS BUTTON (VIP ONLY) -->
        <template x-if="isVipMode">
            <button @click="$store.haptics?.fire('nav'); viewMode = 'tools'; currentGroup = 'sims'; currentTab = 'dashboard'; document.querySelector('main')?.scrollTo({ top: 0, behavior: 'smooth' })"
                    class="relative w-16 flex flex-col items-center justify-center gap-1 group transition-all duration-300"
                    :class="currentGroup === 'sims' && viewMode === 'tools' ? 'text-[#00ff41]' : 'text-slate-500 hover:text-slate-300'">
                
                <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                     :class="currentGroup === 'sims' && viewMode === 'tools' ? 'bg-[#00ff41]/10 scale-100' : 'bg-transparent scale-90'">
                    <i class="fa-solid fa-terminal text-lg"></i>
                </div>
                
                <span class="text-[9px] font-bold uppercase tracking-widest">Sims</span>
                
                <div x-show="currentGroup === 'sims' && viewMode === 'tools'" class="absolute -bottom-1 w-1 h-1 bg-[#00ff41] rounded-full shadow-glow-vip"></div>
            </button>
        </template>
       
    </div>
</div> <!-- End viewMode='tools' wrapper -->

    
    <!-- Service Worker -->

    <script>
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', () => {
                fetch('sw.js')
                    .then(response => {
                        if (response.status === 200) {
                            navigator.serviceWorker.register('sw.js')
                                .then(r => console.log('SW Registered'))
                                .catch(e => console.log('SW Fail:', e));
                        }
                    })
                    .catch(() => {});
            });
        }
    </script>
   <!-- Component Modules (loaded before main app) -->
   <script src="js/components/radar/case-study.js"></script>
   <script src="js/components/radar/negotiation-dojo.js"></script>
   <script src="js/components/radar/cultural-monitor.js"></script>
   <script src="js/components/radar/war-games.js"></script>
   <script src="js/components/radar/team-manager.js"></script>
   <script src="js/components/radar/talent-manager.js"></script>
   <script src="js/components/forge/kpi-designer.js"></script>
   <script src="js/components/forge/squad-builder.js"></script>
   <script src="js/components/forge/excel-calc.js"></script>
   <script src="js/components/forge/lighthouse-roi.js"></script>
   <script src="js/components/forge/vendor-negotiator.js"></script>
   <script src="js/components/forge/finops-auditor.js"></script>
   <script src="js/components/forge/legacy-scanner.js"></script>
   <script src="js/components/forge/flow-calc.js"></script>
   <script src="js/components/forge/adr-builder.js"></script>
   <script src="js/components/forge/meeting-ticker.js"></script>
   <script src="js/components/forge/translator.js"></script>
   <script src="js/components/sims/future-bank.js"></script>
   <script src="js/components/sims/conway-sim.js"></script>
   <script src="js/components/sims/risk-sim.js"></script>
   <script src="js/components/sims/interrogation.js"></script>
   <script src="js/components/sims/excel-escape.js"></script>
   <script src="js/components/sims/meeting-bingo.js"></script>
   <script src="js/components/sims/cognitive-load.js"></script>
   <script src="js/components/sims/sprint-health.js"></script>
   <script src="js/components/sims/adapt-monitor.js"></script>
   <script src="js/components/sims/reg-simulator.js"></script>
   <script src="js/components/shared/haptics.js"></script>
   <script src="js/components/shared/data-gov.js"></script>
   <script src="js/components/shared/ai-detector.js"></script>
   <script src="js/components/shared/strategy-analyzer.js"></script>
   <script src="js/components/shared/daily-feed.js"></script>
   <script src="js/components/shared/library-manager.js"></script>
   <script src="js/components/shared/cfo-report.js"></script>
   <script src="js/components/shared/academy-advanced.js"></script>
   <script src="js/components/shared/gamification.js"></script>
   <script src="js/components/shared/presence.js"></script>
   <script src="js/components/shared/guestbook.js"></script>
   <script src="js/components/shared/visitor-stats.js"></script>
   <script src="js/animations.js"></script>
   <script src="js/app.js"></script>
</body>
</html>
